<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Curtis&apos; Spot</title>
        <link>https://lkangd.com/feed.xml</link>
        <description>Front-end Engineer. Bloggin about life, tech &amp; everything I love.</description>
        <lastBuildDate>Wed, 11 Sep 2019 06:28:17 GMT</lastBuildDate>
        <docs>http://blogs.law.harvard.edu/tech/rss</docs>
        <generator>https://github.com/nuxt-community/feed-module</generator>
        <copyright>All rights reserved 2019, Curtis Liong</copyright>
        <category>Curtis&apos; Spot</category>
        <item>
            <title><![CDATA[ä¸ºä»€ä¹ˆReactå…ƒç´ æœ‰ä¸€ä¸ª$$typeofå±æ€§ï¼Ÿ]]></title>
            <link>/post/why-do-react-elements-have-typeof-property-zh</link>
            <guid>/post/why-do-react-elements-have-typeof-property-zh</guid>
            <description><![CDATA[æœ‰äº›éƒ¨åˆ†æ˜¯å…³äºå®‰å…¨çš„ã€‚]]></description>
            <content:encoded><![CDATA[<p>ä½ è§‰å¾—ä½ åœ¨å†™ JSXï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">&lt;marquee bgcolor=&quot;#ffa7c4&quot;&gt;hi&lt;/marquee&gt;
</code></pre><p>å…¶å®ï¼Œä½ åœ¨è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">React.createElement(
  /* type */ 'marquee',
  /* props */ { bgcolor: '#ffa7c4' },
  /* children */ 'hi'
)
</code></pre><p>ä¹‹åæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ç»™ä½ ï¼Œæˆ‘ä»¬ç§°æ­¤å¯¹è±¡ä¸ºReactçš„ <em>å…ƒç´ </em>ï¼ˆelementï¼‰ï¼Œå®ƒå‘Šè¯‰ React ä¸‹ä¸€ä¸ªè¦æ¸²æŸ“ä»€ä¹ˆã€‚ä½ çš„ç»„ä»¶ï¼ˆcomponentï¼‰è¿”å›ä¸€ä¸ªå®ƒä»¬ç»„æˆçš„æ ‘ï¼ˆtreeï¼‰ã€‚</p>
<pre data-line="9,"  9="" class="language-jsx"><code 9="" class="language-jsx">{
  type: 'marquee',
  props: {
    bgcolor: '#ffa7c4',
    children: 'hi',
  },
  key: null,
  ref: null,
  $$typeof: Symbol.for('react.element'), // ğŸ§æ˜¯è°
}
</code></pre><p>å¦‚æœä½ ç”¨è¿‡ Reactï¼Œå¯¹ <code>type</code>ã€ <code>props</code>ã€ <code>key</code>ã€ å’Œ <code>ref</code> åº”è¯¥ç†Ÿæ‚‰ã€‚ <strong>ä½† <code>$$typeof</code> æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆç”¨ <code>Symbol()</code> ä½œä¸ºå®ƒçš„å€¼</strong>ï¼Ÿ</p>
<p>è¿™åˆæ˜¯ä¸€ä¸ªä¸ä½ å­¦ä¹ ä½¿ç”¨ React ä¸ <em>ç›¸å…³</em> çš„ç‚¹ï¼Œä½†äº†è§£åä½ ä¼šè§‰å¾—èˆ’å¦ã€‚è¿™ç¯‡æ–‡ç« é‡Œä¹Ÿæåˆ°äº†äº›å…³äºå®‰å…¨çš„æç¤ºï¼Œä½ å¯èƒ½ä¼šæ„Ÿå…´è¶£ã€‚ä¹Ÿè®¸æœ‰ä¸€å¤©ä½ ä¼šæœ‰è‡ªå·±çš„UIåº“ï¼Œè¿™äº›éƒ½ä¼šæ´¾ä¸Šç”¨åœºçš„ï¼Œæˆ‘çœŸçš„å¸Œæœ›å¦‚æ­¤ã€‚</p>
<hr>
<p>åœ¨å®¢æˆ·ç«¯ UI åº“å˜å¾—æ™®éä¸”å…·æœ‰åŸºæœ¬ä¿æŠ¤ä½œç”¨ä¹‹å‰ï¼Œåº”ç”¨ç¨‹åºä»£ç é€šå¸¸æ˜¯å…ˆæ„å»º HTMLï¼Œç„¶åæŠŠå®ƒæ’å…¥ DOM ä¸­ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">const messageEl = document.getElementById('message');
messageEl.innerHTML = '&lt;p&gt;' + message.text + '&lt;/p&gt;';
</code></pre><p>è¿™æ ·çœ‹èµ·æ¥æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å½“ä½  <code>message.text</code> çš„å€¼ç±»ä¼¼ <code>'&lt;img src onerror=&quot;stealYourPassword()&quot;&gt;'</code> æ—¶ï¼Œ<strong>ä½ ä¸ä¼šå¸Œæœ›åˆ«äººå†™çš„å†…å®¹åœ¨ä½ åº”ç”¨çš„ HTML ä¸­é€å­—æ˜¾ç¤ºçš„ã€‚</strong></p>
<p>ï¼ˆæœ‰è¶£çš„æ˜¯ï¼šå¦‚æœä½ åªæ˜¯åœ¨å‰ç«¯æ¸²æŸ“ï¼Œè¿™é‡Œä¸º <code>&lt;script&gt;</code> æ ‡ç­¾ï¼ŒJavaScript ä»£ç ä¸ä¼šè¢«è¿è¡Œã€‚ä½†<a href="https://gomakethings.com/preventing-cross-site-scripting-attacks-when-using-innerhtml-in-vanilla-javascript/">ä¸è¦å› æ­¤</a>è®©ä½ é™·å…¥å·²ç»å®‰å…¨çš„é”™è§‰ã€‚ï¼‰</p>
<p>ä¸ºä»€ä¹ˆé˜²æ­¢æ­¤ç±»æ”»å‡»ï¼Œä½ å¯ä»¥ç”¨åªå¤„ç†æ–‡æœ¬çš„ <code>document.createTextNode()</code> æˆ–è€… <code>textContent</code>ç­‰å®‰å…¨çš„ APIã€‚ä½ ä¹Ÿå¯ä»¥äº‹å…ˆå°†ç”¨æˆ·è¾“å…¥çš„å†…å®¹ï¼Œç”¨è½¬ä¹‰ç¬¦æŠŠæ½œåœ¨å±é™©å­—ç¬¦ï¼ˆ<code>&lt;</code>ã€<code>&gt;</code>ç­‰ï¼‰æ›¿æ¢æ‰ã€‚</p>
<p>å°½ç®¡å¦‚æ­¤ï¼Œè¿™ä¸ªé—®é¢˜çš„æˆæœ¬ä»£ä»·å¾ˆé«˜ï¼Œä¸”å¾ˆéš¾åšåˆ°ç”¨æˆ·æ¯æ¬¡è¾“å…¥éƒ½è®°å¾—è½¬æ¢ä¸€æ¬¡ã€‚<strong>å› æ­¤åƒReactç­‰æ–°åº“ä¼šé»˜è®¤è¿›è¡Œæ–‡æœ¬è½¬ä¹‰ï¼š</strong></p>
<pre   class="language-jsx"><code class="language-jsx">&lt;p&gt;
  {message.text}
&lt;/p&gt;
</code></pre><p>å¦‚æœ <code>message.text</code> æ˜¯ä¸€ä¸ªå¸¦æœ‰ <code>&lt;img&gt;</code> æˆ–å…¶ä»–æ ‡ç­¾çš„æ¶æ„å­—ç¬¦ä¸²ï¼Œå®ƒä¸ä¼šè¢«å½“æˆçœŸçš„ <code>&lt;img&gt;</code> æ ‡ç­¾å¤„ç†ï¼ŒReact ä¼šå…ˆè¿›è¡Œè½¬ä¹‰ <em>ç„¶å</em> æ’å…¥ DOM é‡Œã€‚æ‰€ä»¥ <code>&lt;img&gt;</code> æ ‡ç­¾ä¼šä»¥æ–‡æœ¬çš„å½¢å¼å±•ç°å‡ºæ¥ã€‚</p>
<p>è¦åœ¨ React å…ƒç´ ä¸­æ¸²æŸ“ä»»æ„ HTMLï¼Œä½ ä¸å¾—ä¸å†™ <code>dangerouslySetInnerHTML={{ __html: message.text }}</code>ã€‚<strong>å…¶å®è¿™ç§æ„šè ¢çš„å†™æ³•æ˜¯ä¸€ä¸ªåŠŸèƒ½</strong>ï¼Œåœ¨ code reviews å’Œä»£ç åº“å®¡æ ¸æ—¶ï¼Œä½ å¯ä»¥éå¸¸æ¸…æ™°çš„å®šä½åˆ°ä»£ç ã€‚</p>
<hr>
<p><strong>è¿™æ„å‘³ç€Reactå®Œå…¨ä¸æƒ§æ³¨å…¥æ”»å‡»äº†å—ï¼Ÿä¸</strong>ï¼ŒHTML å’Œ DOM æš´éœ²äº†<a href="https://github.com/facebook/react/issues/3473#issuecomment-90594748">å¤§é‡æ”»å‡»ç‚¹</a>ï¼Œå¯¹ React æˆ–è€…å…¶ä»– UI åº“æ¥è¯´ï¼Œè¦å‡è½»ä¼¤å®³å¤ªéš¾æˆ–è¿›å±•ç¼“æ…¢ã€‚å¤§éƒ¨åˆ†å­˜åœ¨çš„æ”»å‡»æ–¹å‘æ¶‰åŠåˆ°å±æ€§ï¼Œä¾‹å¦‚ï¼Œå¦‚æœä½ æ¸²æŸ“ <code>&lt;a href={user.website}</code>ï¼Œè¦æé˜²ç”¨æˆ·çš„ç½‘å€æ˜¯ <code>'javascript: stealYourPassword()'</code>ã€‚ åƒ <code>&lt;div {...userData}&gt;</code> å†™æ³•å‡ ä¹ä¸å—ç”¨æˆ·è¾“å…¥å½±å“ï¼Œä½†ä¹Ÿæœ‰å±é™©ã€‚</p>
<p>React <a href="https://github.com/facebook/react/issues/10506">å¯ä»¥</a>é€æ­¥æä¾›æ›´å¤šä¿æŠ¤ï¼Œä½†åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå¨èƒæ˜¯æœåŠ¡å™¨äº§ç”Ÿçš„ï¼Œè¿™ä¸ç®¡æ€æ ·éƒ½<a href="https://github.com/facebook/react/issues/3473#issuecomment-91327040">åº”è¯¥</a>è¦é¿å…ã€‚</p>
<p>ä¸è¿‡ï¼Œè½¬ä¹‰æ–‡æœ¬è¿™ç¬¬ä¸€é“é˜²çº¿å¯ä»¥æ‹¦ä¸‹è®¸å¤šæ½œåœ¨æ”»å‡»ï¼ŒçŸ¥é“è¿™æ ·çš„ä»£ç æ˜¯å®‰å…¨çš„å°±å¤Ÿäº†å—ï¼Ÿ</p>
<pre   class="language-jsx"><code class="language-jsx">// è‡ªåŠ¨è½¬ä¹‰
&lt;p&gt;
  {message.text}
&lt;/p&gt;
</code></pre><p><strong>å¥½å§ï¼Œä¹Ÿä¸æ€»æ˜¯æœ‰æ•ˆçš„</strong>ã€‚è¿™å°±æ˜¯ <code>$$typeof</code> çš„ç”¨æ­¦ä¹‹åœ°äº†ã€‚</p>
<hr>
<p>React å…ƒç´ ï¼ˆelementsï¼‰æ˜¯è®¾è®¡å¥½çš„ <em>plain object</em>ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">{
  type: 'marquee',
  props: {
    bgcolor: '#ffa7c4',
    children: 'hi',
  },
  key: null,
  ref: null,
  $$typeof: Symbol.for('react.element'),
}
</code></pre><p>è™½ç„¶é€šå¸¸ç”¨ <code>React.createElement()</code> åˆ›å»ºå®ƒï¼Œä½†è¿™ä¸æ˜¯å¿…é¡»çš„ã€‚æœ‰ä¸€äº› React ç”¨ä¾‹æ¥è¯å®åƒä¸Šé¢è¿™æ ·çš„ <em>plain object</em> å…ƒç´ æ˜¯æœ‰æ•ˆçš„ã€‚å½“ç„¶ï¼Œä½ ä¸ä¼š<em>æƒ³</em>è¿™æ ·å†™çš„ï¼Œä½†è¿™<a href="https://github.com/facebook/react/pull/3583#issuecomment-90296667">å¯ä»¥ç”¨æ¥</a>ä¼˜åŒ–ç¼–è¯‘å™¨ï¼Œåœ¨ workers ä¹‹é—´ä¼ é€’ UI å…ƒç´ ï¼Œæˆ–è€…å°† JSX ä» React åŒ…è§£è€¦å‡ºæ¥ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœä½ çš„æœåŠ¡å™¨æœ‰å…è®¸ç”¨æˆ·å­˜å‚¨ä»»æ„ JSON å¯¹è±¡çš„æ¼æ´ï¼Œè€Œå‰ç«¯éœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™å¯èƒ½ä¼šå‘ç”Ÿä¸€ä¸ªé—®é¢˜ï¼š</p>
<pre data-line="2-10,15,"  2-10,15="" class="language-jsx"><code 2-10,15="" class="language-jsx">// æœåŠ¡ç«¯å…è®¸ç”¨æˆ·å­˜å‚¨ JSON
let expectedTextButGotJSON = {
  type: 'div',
  props: {
    dangerouslySetInnerHTML: {
      __html: '/* æŠŠä½ æƒ³çš„æç€ */'
    },
  },
  // ...
};
let message = { text: expectedTextButGotJSON };

// React 0.13 ä¸­æœ‰é£é™©
&lt;p&gt;
  {message.text}
&lt;/p&gt;
</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒReact 0.13<a href="http://danlec.com/blog/xss-via-a-spoofed-react-element">å¾ˆå®¹æ˜“</a>å—åˆ° XSS æ”»å‡»ã€‚å†æ¬¡å£°æ˜ï¼Œ<strong>è¿™ä¸ªæ”»å‡»æ˜¯æœåŠ¡ç«¯å­˜åœ¨æ¼æ´å¯¼è‡´çš„</strong>ã€‚ä¸è¿‡ï¼ŒReact ä¼šä¸ºäº†å¤§å®¶çš„å®‰å…¨åšæ›´å¤šå·¥ä½œã€‚ä» React 0.14 å¼€å§‹ï¼Œå®ƒåšåˆ°äº†ã€‚</p>
<p>React 0.14 ä¿®å¤æ‰‹æ®µæ˜¯ç”¨ Symbol æ ‡è®°æ¯ä¸ª React å…ƒç´ ï¼ˆelementï¼‰ï¼š</p>
<pre data-line="9,"  9="" class="language-jsx"><code 9="" class="language-jsx">{
  type: 'marquee',
  props: {
    bgcolor: '#ffa7c4',
    children: 'hi',
  },
  key: null,
  ref: null,
  $$typeof: Symbol.for('react.element'),
}
</code></pre><p>è¿™æ˜¯ä¸ªæœ‰æ•ˆçš„åŠæ³•ï¼Œå› ä¸ºJSONä¸æ”¯æŒ <code>Symbol</code> ç±»å‹ã€‚<strong>æ‰€ä»¥å³ä½¿æœåŠ¡å™¨å­˜åœ¨ç”¨JSONä½œä¸ºæ–‡æœ¬è¿”å›å®‰å…¨æ¼æ´ï¼ŒJSON é‡Œä¹Ÿä¸åŒ…å« <code>Symbol.for('react.element')</code></strong>ã€‚React ä¼šæ£€æµ‹ <code>element.$$typeof</code>ï¼Œå¦‚æœå…ƒç´ ä¸¢å¤±æˆ–è€…æ— æ•ˆï¼Œä¼šæ‹’ç»å¤„ç†è¯¥å…ƒç´ ã€‚</p>
<p>ç‰¹æ„ç”¨ <code>Symbol.for()</code> çš„å¥½å¤„æ˜¯ <strong>Symbols é€šç”¨äº iframes å’Œ workers ç­‰ç¯å¢ƒä¸­</strong>ã€‚å› æ­¤æ— è®ºåœ¨å¤šå¥‡æ€ªçš„æ¡ä»¶ä¸‹ï¼Œè¿™æ–¹æ¡ˆä¹Ÿä¸ä¼šå½±å“åˆ°åº”ç”¨ä¸åŒéƒ¨åˆ†ä¼ é€’å¯ä¿¡çš„å…ƒç´ ã€‚åŒæ ·ï¼Œå³ä½¿é¡µé¢ä¸Šæœ‰å¾ˆå¤šä¸ª React å‰¯æœ¬ï¼Œå®ƒä»¬ä¹Ÿ ã€Œæ¥å—ã€ æœ‰æ•ˆçš„ <code>$$typeof</code> å€¼ã€‚</p>
<hr>
<p>å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol#Browser_compatibility">Symbols</a> æ€ä¹ˆåŠï¼Ÿ</p>
<p>å”‰ï¼Œé‚£è¿™ç§ä¿æŠ¤æ–¹æ¡ˆå°±æ— æ•ˆäº†ã€‚Reactä»ç„¶ä¼šåŠ ä¸Š <code>$$typeof</code> å­—æ®µä»¥ä¿è¯ä¸€è‡´æ€§ï¼Œä½†åªæ˜¯<a href="https://github.com/facebook/react/blob/8482cbe22d1a421b73db602e1f470c632b09f693/packages/shared/ReactSymbols.js#L14-L16">è®¾ç½®ä¸€ä¸ªæ•°å­—</a>è€Œå·² â€”â€” <code>0xeac7</code>ã€‚</p>
<p>ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªæ•°å­—ï¼Ÿå› ä¸º <code>0xeac7</code> çœ‹èµ·æ¥æœ‰ç‚¹åƒ ã€ŒReactã€ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Why Do React Elements Have a $$typeof Property?]]></title>
            <link>/post/why-do-react-elements-have-typeof-property</link>
            <guid>/post/why-do-react-elements-have-typeof-property</guid>
            <description><![CDATA[It has something to do with security.]]></description>
            <content:encoded><![CDATA[<p>You might think youâ€™re writing JSX:</p>
<pre   class="language-jsx"><code class="language-jsx">&lt;marquee bgcolor=&quot;#ffa7c4&quot;&gt;hi&lt;/marquee&gt;
</code></pre><p>But really, youâ€™re calling a function:</p>
<pre   class="language-jsx"><code class="language-jsx">React.createElement(
  /* type */ 'marquee',
  /* props */ { bgcolor: '#ffa7c4' },
  /* children */ 'hi'
)
</code></pre><p>And that function gives you back an object. We call this object a React <em>element</em>. It tells React what to render next. Your components return a tree of them.</p>
<pre data-line="9,"  9="" class="language-jsx"><code 9="" class="language-jsx">{
  type: 'marquee',
  props: {
    bgcolor: '#ffa7c4',
    children: 'hi',
  },
  key: null,
  ref: null,
  $$typeof: Symbol.for('react.element'), // ğŸ§ Who dis
}
</code></pre><p>If you used React you might be familiar with <code>type</code>, <code>props</code>, <code>key</code>, and <code>ref</code> fields. <strong>But what is <code>$$typeof</code>? And why does it have a <code>Symbol()</code> as a value?</strong></p>
<p>Thatâ€™s another one of those things that you donâ€™t <em>need</em> to know to use React, but that will make you feel good when you do. Thereâ€™s also some tips about security in this post that you might want to know. Maybe one day youâ€™ll write your own UI library and all of this will come in handy. I certainly hope so.</p>
<hr>
<p>Before client-side UI libraries became common and added basic protection, it was common for app code to construct HTML and insert it into the DOM:</p>
<pre   class="language-jsx"><code class="language-jsx">const messageEl = document.getElementById('message');
messageEl.innerHTML = '&lt;p&gt;' + message.text + '&lt;/p&gt;';
</code></pre><p>That works fine, except when your <code>message.text</code> is something like <code>'&lt;img src onerror=&quot;stealYourPassword()&quot;&gt;'</code>. <strong>You donâ€™t want things written by strangers to appear verbatim in your appâ€™s rendered HTML.</strong></p>
<p>(Fun fact: if you only do client-side rendering, a <code>&lt;script&gt;</code> tag here wouldnâ€™t let you run JavaScript. But <a href="https://gomakethings.com/preventing-cross-site-scripting-attacks-when-using-innerhtml-in-vanilla-javascript/">donâ€™t let this</a> lull you into a false sense of security.)</p>
<p>To protect against such attacks, you can use safe APIs like <code>document.createTextNode()</code> or <code>textContent</code> that only deal with text. You can also preemptively â€œescapeâ€ inputs by replacing potentially dangerous characters like <code>&lt;</code>, <code>&gt;</code> and others in any user-provided text.</p>
<p>Still, the cost of a mistake is high and itâ€™s a hassle to remember it every time you interpolate a user-written string into your output. <strong>This is why modern libraries like React escape text content for strings by default:</strong></p>
<pre   class="language-jsx"><code class="language-jsx">&lt;p&gt;
  {message.text}
&lt;/p&gt;
</code></pre><p>If <code>message.text</code> is a malicious string with an <code>&lt;img&gt;</code> or another tag, it wonâ€™t turn into a real <code>&lt;img&gt;</code> tag. React will escape the content and <em>then</em> insert it into the DOM. So instead of seeing the <code>&lt;img&gt;</code> tag youâ€™ll just see its markup.</p>
<p>To render arbitrary HTML inside a React element, you have to write <code>dangerouslySetInnerHTML={{ __html: message.text }}</code>. <strong>The fact that itâ€™s clumsy to write is a <em>feature</em>.</strong> Itâ€™s meant to be highly visible so that you can catch it in code reviews and codebase audits.</p>
<hr>
<p><strong>Does it mean React is entirely safe from injection attacks? No.</strong> HTML and DOM offer <a href="https://github.com/facebook/react/issues/3473#issuecomment-90594748">plenty of attack surface</a> that is too difficult or slow for React or other UI libraries to mitigate against. Most of the remaining attack vectors involve attributes. For example, if you render <code>&lt;a href={user.website}&gt;</code>, beware of the user whose website is <code>'javascript: stealYourPassword()'</code>. Spreading user input like <code>&lt;div {...userData}&gt;</code> is rare but also dangerous.</p>
<p>React <a href="https://github.com/facebook/react/issues/10506">could</a> provide more protection over time but in many cases these are consequences of server issues that <a href="https://github.com/facebook/react/issues/3473#issuecomment-91327040">should</a> be fixed there anyway.</p>
<p>Still, escaping text content is a reasonable first line of defence that catches a lot of potential attacks. Isnâ€™t it nice to know that code like this is safe?</p>
<pre   class="language-jsx"><code class="language-jsx">// Escaped automatically
&lt;p&gt;
  {message.text}
&lt;/p&gt;
</code></pre><p><strong>Well, that wasnâ€™t always true either.</strong> And thatâ€™s where <code>$$typeof</code> comes in.</p>
<hr>
<p>React elements are plain objects by design:</p>
<pre   class="language-jsx"><code class="language-jsx">{
  type: 'marquee',
  props: {
    bgcolor: '#ffa7c4',
    children: 'hi',
  },
  key: null,
  ref: null,
  $$typeof: Symbol.for('react.element'),
}
</code></pre><p>While normally you create them with <code>React.createElement()</code>, it is not required. There are valid use cases for React to support plain element objects written like I just did above. Of course, you probably wouldnâ€™t <em>want</em> to write them like this â€” but this <a href="https://github.com/facebook/react/pull/3583#issuecomment-90296667">can be</a> useful for an optimizing compiler, passing UI elements between workers, or for decoupling JSX from the React package.</p>
<p>However, <strong>if your server has a hole that lets the user store an arbitrary JSON object</strong> while the client code expects a string, this could become a problem:</p>
<pre data-line="2-10,15,"  2-10,15="" class="language-jsx"><code 2-10,15="" class="language-jsx">// Server could have a hole that lets user store JSON
let expectedTextButGotJSON = {
  type: 'div',
  props: {
    dangerouslySetInnerHTML: {
      __html: '/* put your exploit here */'
    },
  },
  // ...
};
let message = { text: expectedTextButGotJSON };

// Dangerous in React 0.13
&lt;p&gt;
  {message.text}
&lt;/p&gt;
</code></pre><p>In that case, React 0.13 would be <a href="http://danlec.com/blog/xss-via-a-spoofed-react-element">vulnerable</a> to an XSS attack. To clarify, again, <strong>this attack depends on an existing server hole</strong>. Still, React could do a better job of protecting people against it. And starting with React 0.14, it does.</p>
<p>The fix in React 0.14 was to <a href="https://github.com/facebook/react/pull/4832">tag every React element with a Symbol</a>:</p>
<pre data-line="9,"  9="" class="language-jsx"><code 9="" class="language-jsx">{
  type: 'marquee',
  props: {
    bgcolor: '#ffa7c4',
    children: 'hi',
  },
  key: null,
  ref: null,
  $$typeof: Symbol.for('react.element'),
}
</code></pre><p>This works because you canâ€™t just put <code>Symbol</code>s in JSON. <strong>So even if the server has a security hole and returns JSON instead of text, that JSON canâ€™t include <code>Symbol.for('react.element')</code>.</strong> React will check <code>element.$$typeof</code>, and will refuse to process the element if itâ€™s missing or invalid.</p>
<p>The nice thing about using <code>Symbol.for()</code> specifically is that <strong>Symbols are global between environments like iframes and workers.</strong> So this fix doesnâ€™t prevent passing trusted elements between different parts of the app even in more exotic conditions. Similarly, even if there are multiple copies of React on the page, they can still â€œagreeâ€ on the valid <code>$$typeof</code> value.</p>
<hr>
<p>What about the browsers that <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol#Browser_compatibility">donâ€™t support</a> Symbols?</p>
<p>Alas, they donâ€™t get this extra protection. React still includes the <code>$$typeof</code> field on the element for consistency, but itâ€™s <a href="https://github.com/facebook/react/blob/8482cbe22d1a421b73db602e1f470c632b09f693/packages/shared/ReactSymbols.js#L14-L16">set to a number</a> â€” <code>0xeac7</code>.</p>
<p>Why this number specifically? <code>0xeac7</code> kinda looks like â€œReactâ€.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å†™ super(props) ï¼Ÿ]]></title>
            <link>/post/why-do-we-write-super-props-zh</link>
            <guid>/post/why-do-we-write-super-props-zh</guid>
            <description><![CDATA[ç»“å°¾å¤„æœ‰å½©è›‹ã€‚]]></description>
            <content:encoded><![CDATA[<p>æ®è¯´ <a href="https://reactjs.org/docs/hooks-intro.html">Hooks</a> åŠ¿å¤´æ­£ç››ï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯æƒ³ç•¥å¸¦è°ƒä¾ƒåœ°ä» <em>class</em> çš„æœ‰è¶£ä¹‹å¤„å¼€å§‹è¿™ç¯‡åšå®¢ã€‚å¯è¿˜è¡Œï¼Ÿ</p>
<p><strong>è¿™äº›æ¢—å¯¹äºä½¿ç”¨ React è¾“å‡ºäº§å“å¹¶<em>ä¸</em>é‡è¦ï¼Œä½†å¦‚æœä½ æƒ³æ·±å…¥çš„äº†è§£å®ƒä»¬çš„è¿ä½œåŸç†ï¼Œå®ƒä»¬ä¼šéå¸¸çš„æœ‰ç”¨ã€‚</strong></p>
<hr>
<p>é¦–å…ˆï¼Œåœ¨è¿™ä¸€ç”Ÿä¸­ï¼Œ<code>super(props)</code> å‡ºç°åœ¨æˆ‘ä»£ç é‡Œçš„æ¬¡æ•°æ¯”æˆ‘çŸ¥é“çš„è¿˜è¦å¤šï¼š</p>
<pre data-line="3,"  3="" class="language-jsx"><code 3="" class="language-jsx">class Checkbox extends React.Component {
  constructor(props) {
    super(props);
    this.state = { isOn: true };
  }
  // ...
}
</code></pre><p>å½“ç„¶äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <a href="https://github.com/tc39/proposal-class-fields">class fields proposal</a> æ¥çœç•¥è¿™ä¸ªå£°æ˜ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">class Checkbox extends React.Component {
  state = { isOn: true };
  // ...
}
</code></pre><p>æ—©åœ¨ 2015 å¹´ React 0.13 å·²ç»<a href="https://reactjs.org/blog/2015/01/27/react-v0.13.0-beta-1.html#es7-property-initializers">è®¡åˆ’æ”¯æŒ</a> ã€‚åœ¨å½“æ—¶ï¼Œå£°æ˜ <code>constructor</code> å’Œè°ƒç”¨ <code>super(props)</code> ä¸€ç›´è¢«è§†ä½œæš‚æ—¶çš„è§£å†³æ–¹æ¡ˆï¼Œç›´åˆ°æœ‰åˆé€‚çš„ç±»å­—æ®µå£°æ˜å½¢å¼ã€‚</p>
<p>ä½†åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå›åˆ° ES2015 é£æ ¼çš„ä»£ç ï¼š</p>
<pre data-line="3,"  3="" class="language-jsx"><code 3="" class="language-jsx">class Checkbox extends React.Component {
  constructor(props) {
    super(props);
    this.state = { isOn: true };
  }
  // ...
}
</code></pre><p>**ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦è°ƒç”¨ <code>super</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä¸è¿™ä¹ˆåšå—ï¼Ÿé‚£ä¹ˆåœ¨æˆ‘ä»¬è°ƒç”¨å®ƒæ—¶ä¸ä¼ å…¥ <code>props</code>ï¼Œåˆä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿä¼šæœ‰å…¶ä»–çš„ç¼ºçœå‚æ•°å—ï¼Ÿ**æ¥æ¥ä¸‹æˆ‘ä»¬å°±è§£å¼€è¿™ä¸€ç³»åˆ—è°œé¢˜ã€‚</p>
<hr>
<p>åœ¨ JavaScript ä¸­ï¼Œ<code>super</code> æŒ‡çš„æ˜¯çˆ¶ç±»ï¼ˆå³è¶…ç±»ï¼‰çš„æ„é€ å‡½æ•°ã€‚ï¼ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒæŒ‡å‘äº† <code>React.Component</code> çš„å®ç°ã€‚ï¼‰</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ä¹‹å‰ï¼Œä½ æ˜¯ä¸èƒ½åœ¨ constructor ä¸­ä½¿ç”¨ <code>this</code> å…³é”®å­—çš„ã€‚JavaScript ä¸å…è®¸è¿™ä¸ªè¡Œä¸ºã€‚</p>
<pre   class="language-jsx"><code class="language-jsx">class Checkbox extends React.Component {
  constructor(props) {
    // ğŸ”´  è¿˜ä¸èƒ½ä½¿ç”¨ `this`
    super(props);
    // âœ…  ç°åœ¨å¯ä»¥äº†
    this.state = { isOn: true };
  }
  // ...
}
</code></pre><p>JavaScript æœ‰è¶³å¤Ÿåˆç†çš„åŠ¨æœºæ¥å¼ºåˆ¶ä½ åœ¨æ¥è§¦ <code>this</code> ä¹‹å‰æ‰§è¡Œçˆ¶ç±»æ„é€ å‡½æ•°ã€‚è€ƒè™‘è€ƒè™‘ä¸€äº›ç±»å±‚æ¬¡ç»“æ„çš„ä¸œè¥¿ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">class Person {
  constructor(name) {
    this.name = name;
  }
}

class PolitePerson extends Person {
  constructor(name) {
    this.greetColleagues(); // ğŸ”´  è¿™æ˜¯ç¦æ­¢çš„ï¼Œå¾€åè§åŸå› 
    super(name);
  }
  greetColleagues() {
    alert('Good morning folks!');
  }
}
</code></pre><p>è¯•æƒ³ä¸€ä¸‹ï¼Œåœ¨è°ƒç”¨ <code>super</code> ä¹‹å‰ä½¿ç”¨ <code>this</code> ä¸è¢«ç¦æ­¢çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæœˆåï¼Œæˆ‘ä»¬å¯èƒ½åœ¨ <code>greetColleagues</code> æ‰“å°çš„æ¶ˆæ¯ä¸­ä½¿ç”¨äº† person çš„ name å±æ€§ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">  greetColleagues() {
    alert('Good morning folks!');
    alert('My name is ' + this.name + ', nice to meet you!');
  }
</code></pre><p>ä½†æ˜¯æˆ‘ä»¬å¹¶æœªæƒ³èµ· <code>this.greetColleagues</code> åœ¨ <code>super()</code> ç»™ <code>this.name</code> èµ‹å€¼å‰å°±å·²ç»æ‰§è¡Œã€‚<code>this.name</code> æ­¤æ—¶ç”šè‡³å°šæœªå®šä¹‰ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ ·çš„ä»£ç éš¾ä»¥å¾€ä¸‹æ¨æ•²ã€‚</p>
<p>ä¸ºäº†é¿å…è½å…¥è¿™ä¸ªé™·é˜±ï¼Œ**JavaScript å¼ºåˆ¶ä½ åœ¨ä½¿ç”¨ <code>this</code> ä¹‹å‰å…ˆè¡Œè°ƒç”¨ <code>super</code>ã€‚**è®©çˆ¶ç±»æ¥å®Œæˆè¿™ä»¶äº‹æƒ…ï¼ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">  constructor(props) {
    super(props);
    // âœ… èƒ½ä½¿ç”¨ `this` äº†
    this.state = { isOn: true };
  }
</code></pre><p>è¿™é‡Œç•™ä¸‹äº†å¦ä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆè¦ä¼ å…¥ <code>props</code> ï¼Ÿ</p>
<hr>
<p>ä½ æˆ–è®¸ä¼šæƒ³åˆ°ï¼Œä¸ºäº†è®© React.Component æ„é€ å‡½æ•°èƒ½å¤Ÿåˆå§‹åŒ– <code>this.props</code>ï¼Œå°† <code>props</code> ä¼ å…¥ <code>super</code> æ˜¯å¿…é¡»çš„ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">// React å…§éƒ¨
class Component {
  constructor(props) {
    this.props = props;
    // ...
  }
}
</code></pre><p>è¿™å‡ ä¹å°±æ˜¯çœŸç›¸äº† â€” ç¡®ç„¶ï¼Œå®ƒæ˜¯ <a href="https://github.com/facebook/react/blob/1d25aa5787d4e19704c049c3cfa985d3b5190e0d/packages/react/src/ReactBaseClasses.js#L22">è¿™æ ·åš</a> çš„ã€‚</p>
<p>ä½†æœ‰äº›æ‰‘æœ”è¿·ç¦»çš„æ˜¯ï¼Œå³ä¾¿ä½ è°ƒç”¨ <code>super()</code> çš„æ—¶å€™æ²¡æœ‰ä¼ å…¥ <code>props</code>ï¼Œä½ ä¾ç„¶èƒ½å¤Ÿåœ¨ <code>render</code> å‡½æ•°æˆ–å…¶ä»–æ–¹æ³•ä¸­è®¿é—®åˆ° <code>this.props</code>ã€‚ï¼ˆå¦‚æœä½ è´¨ç–‘è¿™ä¸ªæœºåˆ¶ï¼Œå°è¯•ä¸€ä¸‹å³å¯ï¼‰</p>
<p>é‚£ä¹ˆè¿™æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿäº‹å®è¯æ˜ï¼ŒReact åœ¨è°ƒç”¨æ„é€ å‡½æ•°åä¹Ÿç«‹å³å°† <code>props</code> èµ‹å€¼åˆ°äº†å®ä¾‹ä¸Šï¼š**</p>
<pre   class="language-jsx"><code class="language-jsx">  // React å†…éƒ¨
  const instance = new YourComponent(props);
  instance.props = props;
</code></pre><p>å› æ­¤å³ä¾¿ä½ å¿˜è®°äº†å°† <code>props</code> ä¼ ç»™ <code>super()</code>ï¼ŒReact ä¹Ÿä»ç„¶ä¼šåœ¨ä¹‹åå°†å®ƒå®šä¹‰åˆ°å®ä¾‹ä¸Šã€‚è¿™ä¹ˆåšæ˜¯æœ‰åŸå› çš„ã€‚</p>
<p>å½“ React å¢åŠ äº†å¯¹ç±»çš„æ”¯æŒæ—¶ï¼Œä¸ä»…ä»…æ˜¯ä¸ºäº†æœåŠ¡äº ES6ã€‚å…¶ç›®æ ‡æ˜¯å°½å¯èƒ½å¹¿æ³›åœ°æ”¯æŒç±»æŠ½è±¡ã€‚å½“æ—¶æˆ‘ä»¬ <a href="https://reactjs.org/blog/2015/01/27/react-v0.13.0-beta-1.html#other-languages">ä¸æ¸…æ¥š</a>  ClojureScriptï¼ŒCoffeeScriptï¼ŒES6ï¼ŒFableï¼ŒScala.jsï¼ŒTypeScript ç­‰è§£æ±ºæ–¹æ¡ˆæ˜¯å¦‚ä½•æˆåŠŸçš„å®è·µç»„ä»¶å®šä¹‰çš„ã€‚å› è€Œ React åˆ»æ„åœ°æ²¡æœ‰æ˜¾å¼è¦æ±‚è°ƒç”¨ <code>super()</code> â€”â€” å³ä¾¿ ES6 è‡ªèº«å°±åŒ…å«è¿™ä¸ªæœºåˆ¶ã€‚</p>
<p>è¿™æ„å‘³ç€ä½ èƒ½å¤Ÿç”¨ <code>super()</code> ä»£æ›¿ <code>super(props)</code> å—ï¼Ÿ</p>
<p><strong>æœ€å¥½ä¸è¦ï¼Œæ¯•ç«Ÿè¿™æ ·å†™åœ¨é€»è¾‘ä¸Šå¹¶ä¸æ˜ç¡®</strong>ç¡®ç„¶ï¼ŒReact ä¼šåœ¨æ„é€ å‡½æ•°æ‰§è¡Œå®Œæ¯•<em>ä¹‹å</em>ç»™ <code>this.props</code> èµ‹å€¼ã€‚ä½†å¦‚æ­¤ä¸ºä¹‹ä¼šä½¿å¾— <code>this.props</code> åœ¨ <code>super</code> è°ƒç”¨<em>ä¸€ç›´åˆ°æ„é€ å‡½æ•°ç»“æŸæœŸé—´</em>å€¼ä¸º undefinedã€‚</p>
<pre data-line="14,"  14="" class="language-jsx"><code 14="" class="language-jsx">// React å…§éƒ¨
class Component {
  constructor(props) {
    this.props = props;
    // ...
  }
}

// ä½ çš„ç¨‹å¼ç¢¼å…§éƒ¨
class Button extends React.Component {
  constructor(props) {
    super(); // ğŸ˜¬ æˆ‘ä»¬å¿˜äº†ä¼ å…¥ props
    console.log(props);      // âœ… {}
    console.log(this.props); // ğŸ˜¬ æœªå®šä¹‰
  }
  // ...
}
</code></pre><p>å¦‚æœåœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨äº†å…¶ä»–çš„å†…éƒ¨æ–¹æ³•ï¼Œé‚£ä¹ˆä¸€æ—¦å‡ºé”™è¿™ä¼šä½¿å¾—è°ƒè¯•è¿‡ç¨‹é˜»åŠ›æ›´å¤§ã€‚<strong>è¿™å°±æ˜¯æˆ‘å»ºè®®å¼€å‘è€…ä¸€å®šæ‰§è¡Œ <code>super(props)</code> çš„åŸå› ï¼Œå³ä½¿ç†è®ºä¸Šè¿™å¹¶éå¿…è¦ï¼š</strong></p>
<pre   class="language-jsx"><code class="language-jsx">class Button extends React.Component {
  constructor(props) {
    super(props); // âœ… ä¼ å…¥ props
    console.log(props);      // âœ… {}
    console.log(this.props); // âœ… {}
  }
  // ...
}
</code></pre><p>ç¡®ä¿äº† <code>this.props</code> åœ¨æ„é€ å‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹å‰å·²è¢«èµ‹å€¼ã€‚</p>
<hr>
<p>æœ€åï¼Œè¿˜æœ‰ä¸€ç‚¹æ˜¯ React çˆ±å¥½è€…é•¿æœŸä»¥æ¥çš„å¥½å¥‡ä¹‹å¤„ã€‚</p>
<p>ä½ ä¼šå‘ç°å½“ä½ åœ¨ç±»ä¸­ä½¿ç”¨ Context API ï¼ˆæ— è®ºæ˜¯æ—§ç‰ˆçš„ <code>contextTypes</code> æˆ–æ˜¯åœ¨ React 16.6 æ›´æ–°çš„æ–°ç‰ˆ <code>contextTypes</code>ï¼‰çš„æ—¶å€™ï¼Œ<code>context</code> æ˜¯ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥æ„é€ å‡½æ•°çš„ã€‚</p>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½è½¬è€Œå†™æˆ <code>super(props, context)</code> å‘¢ï¼Ÿæˆ‘ä»¬å½“ç„¶å¯ä»¥ï¼Œä½† context çš„ä½¿ç”¨é¢‘ç‡è¾ƒä½ï¼Œå› è€Œå¹¶æ²¡æœ‰æ˜è¿™ä¸ªå‘ã€‚</p>
<p><strong>class fields proposal å‡ºå°åï¼Œè¿™äº›å‘å¤§éƒ¨åˆ†éƒ½ä¼šè‡ªç„¶åœ°æ¶ˆå¤±</strong>åœ¨æ²¡æœ‰æ˜¾ç¤ºçš„å®šä¹‰æ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œä»¥ä¸Šçš„å±æ€§éƒ½ä¼šè¢«è‡ªåŠ¨åœ°åˆå§‹åŒ–ã€‚è¿™ä½¿å¾—åƒ <code>state = {}</code> è¿™ç±»è¡¨è¾¾å¼èƒ½å¤Ÿåœ¨éœ€è¦çš„æƒ…å†µä¸‹å¼•ç”¨ <code>this.props</code> å’Œ <code>this.context</code> çš„å†…å®¹ã€‚</p>
<p>ç„¶è€Œï¼Œæœ‰äº† Hooks ä»¥åï¼Œæˆ‘ä»¬å‡ ä¹å°±ä¸éœ€è¦ <code>super</code> å’Œ <code>this</code> äº†ã€‚ä½†é‚£å°±æ˜¯å¦ä¸€ä¸ªä¸‹åˆçš„èŒ¶ç‚¹äº†ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Why Do We Write super(props)?]]></title>
            <link>/post/why-do-we-write-super-props</link>
            <guid>/post/why-do-we-write-super-props</guid>
            <description><![CDATA[Thereâ€™s a twist at the end.]]></description>
            <content:encoded><![CDATA[<p>I heard <a href="https://reactjs.org/docs/hooks-intro.html">Hooks</a> are the new hotness. Ironically, I want to start this blog by describing fun facts about <em>class</em> components. How about that!</p>
<p><strong>These gotchas are <em>not</em> important for using React productively. But you might find them amusing if you like to dig deeper into how things work.</strong></p>
<p>Hereâ€™s the first one.</p>
<hr>
<p>I wrote <code>super(props)</code> more times in my life than Iâ€™d like to know:</p>
<pre data-line="3,"  3="" class="language-jsx"><code 3="" class="language-jsx">class Checkbox extends React.Component {
  constructor(props) {
    super(props);
    this.state = { isOn: true };
  }
  // ...
}
</code></pre><p>Of course, the <a href="https://github.com/tc39/proposal-class-fields">class fields proposal</a> lets us skip the ceremony:</p>
<pre data-line="1,2,3,"  1,2,3="" class="language-jsx"><code 1,2,3="" class="language-jsx">class Checkbox extends React.Component {
  state = { isOn: true };
  // ...
}
</code></pre><p>A syntax like this was <a href="https://reactjs.org/blog/2015/01/27/react-v0.13.0-beta-1.html#es7-property-initializers">planned</a> when React 0.13 added support for plain classes in 2015. Defining <code>constructor</code> and calling <code>super(props)</code> was always intended to be a temporary solution until class fields provide an ergonomic alternative.</p>
<p>But letâ€™s get back to this example using only ES2015 features:</p>
<pre data-line="3,"  3="" class="language-jsx"><code 3="" class="language-jsx">class Checkbox extends React.Component {
  constructor(props) {
    super(props);
    this.state = { isOn: true };
  }
  // ...
}
</code></pre><p><strong>Why do we call <code>super</code>? Can we <em>not</em> call it? If we have to call it, what happens if we donâ€™t pass <code>props</code>? Are there any other arguments?</strong> Letâ€™s find out.</p>
<hr>
<p>In JavaScript, <code>super</code> refers to the parent class constructor. (In our example, it points to the <code>React.Component</code> implementation.)</p>
<p>Importantly, you canâ€™t use <code>this</code> in a constructor until <em>after</em> youâ€™ve called the parent constructor. JavaScript wonâ€™t let you:</p>
<pre   class="language-jsx"><code class="language-jsx">class Checkbox extends React.Component {
  constructor(props) {
    // ğŸ”´ Canâ€™t use `this` yet
    super(props);
    // âœ… Now itâ€™s okay though
    this.state = { isOn: true };
  }
  // ...
}
</code></pre><p>Thereâ€™s a good reason for why JavaScript enforces that parent constructor runs before you touch <code>this</code>. Consider a class hierarchy:</p>
<pre   class="language-jsx"><code class="language-jsx">class Person {
  constructor(name) {
    this.name = name;
  }
}

class PolitePerson extends Person {
  constructor(name) {
    this.greetColleagues(); // ğŸ”´ This is disallowed, read below why
    super(name);
  }
  greetColleagues() {
    alert('Good morning folks!');
  }
}
</code></pre><p>Imagine using <code>this</code> before <code>super</code> call <em>was</em> allowed. A month later, we might change <code>greetColleagues</code> to include the personâ€™s name in the message:</p>
<pre   class="language-jsx"><code class="language-jsx">  greetColleagues() {
    alert('Good morning folks!');
    alert('My name is ' + this.name + ', nice to meet you!');
  }
</code></pre><p>But we forgot that <code>this.greetColleagues()</code> is called before the <code>super()</code> call had a chance to set up <code>this.name</code>. So <code>this.name</code> isnâ€™t even defined yet! As you can see, code like this can be very difficult to think about.</p>
<p>To avoid such pitfalls, <strong>JavaScript enforces that if you want to use <code>this</code> in a constructor, you <em>have to</em> call <code>super</code> first.</strong> Let the parent do its thing! And this limitation applies to React components defined as classes too:</p>
<pre   class="language-jsx"><code class="language-jsx">  constructor(props) {
    super(props);
    // âœ… Okay to use `this` now
    this.state = { isOn: true };
  }
</code></pre><p>This leaves us with another question: why pass <code>props</code>?</p>
<hr>
<p>You might think that passing <code>props</code> down to <code>super</code> is necessary so that the base <code>React.Component</code> constructor can initialize <code>this.props</code>:</p>
<pre   class="language-jsx"><code class="language-jsx">// Inside React
class Component {
  constructor(props) {
    this.props = props;
    // ...
  }
}
</code></pre><p>And thatâ€™s not far from truth â€” indeed, thatâ€™s <a href="https://github.com/facebook/react/blob/1d25aa5787d4e19704c049c3cfa985d3b5190e0d/packages/react/src/ReactBaseClasses.js#L22">what it does</a>.</p>
<p>But somehow, even if you call <code>super()</code> without the <code>props</code> argument, youâ€™ll still be able to access <code>this.props</code> in the <code>render</code> and other methods. (If you donâ€™t believe me, try it yourself!)</p>
<p>How does <em>that</em> work? It turns out that <strong>React also assigns <code>props</code> on the instance right after calling <em>your</em> constructor:</strong></p>
<pre   class="language-jsx"><code class="language-jsx">  // Inside React
  const instance = new YourComponent(props);
  instance.props = props;
</code></pre><p>So even if you forget to pass <code>props</code> to <code>super()</code>, React would still set them right afterwards. There is a reason for that.</p>
<p>When React added support for classes, it didnâ€™t just add support for ES6 classes alone. The goal was to support as wide range of class abstractions as possible. It was <a href="https://reactjs.org/blog/2015/01/27/react-v0.13.0-beta-1.html#other-languages">not clear</a> how relatively successful would ClojureScript, CoffeeScript, ES6, Fable, Scala.js, TypeScript, or other solutions be for defining components. So React was intentionally unopinionated about whether calling <code>super()</code> is required â€” even though ES6 classes are.</p>
<p>So does this mean you can just write <code>super()</code> instead of <code>super(props)</code>?</p>
<p><strong>Probably not because itâ€™s still confusing.</strong> Sure, React would later assign <code>this.props</code> <em>after</em> your constructor has run. But <code>this.props</code> would still be undefined <em>between</em> the <code>super</code> call and the end of your constructor:</p>
<pre data-line="14,"  14="" class="language-jsx"><code 14="" class="language-jsx">// Inside React
class Component {
  constructor(props) {
    this.props = props;
    // ...
  }
}

// Inside your code
class Button extends React.Component {
  constructor(props) {
    super(); // ğŸ˜¬ We forgot to pass props
    console.log(props);      // âœ… {}
    console.log(this.props); // ğŸ˜¬ undefined 
  }
  // ...
}
</code></pre><p>It can be even more challenging to debug if this happens in some method thatâ€™s called <em>from</em> the constructor. <strong>And thatâ€™s why I recommend always passing down <code>super(props)</code>, even though it isnâ€™t strictly necessary:</strong></p>
<pre   class="language-jsx"><code class="language-jsx">class Button extends React.Component {
  constructor(props) {
    super(props); // âœ… We passed props
    console.log(props);      // âœ… {}
    console.log(this.props); // âœ… {}
  }
  // ...
}
</code></pre><p>This ensures <code>this.props</code> is set even before the constructor exits.</p>
<hr>
<p>Thereâ€™s one last bit that longtime React users might be curious about.</p>
<p>You might have noticed that when you use the Context API in classes (either with the legacy <code>contextTypes</code> or the modern <code>contextType</code> API added in React 16.6), <code>context</code> is passed as a second argument to the constructor.</p>
<p>So why donâ€™t we write <code>super(props, context)</code> instead? We could, but context is used less often so this pitfall just doesnâ€™t come up as much.</p>
<p><strong>With the class fields proposal this whole pitfall mostly disappears anyway.</strong> Without an explicit constructor, all arguments are passed down automatically. This is what allows an expression like <code>state = {}</code> to include references to <code>this.props</code> or <code>this.context</code> if necessary.</p>
<p>With Hooks, we donâ€™t even have <code>super</code> or <code>this</code>. But thatâ€™s a topic for another day.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ä¸ºä»€ä¹ˆ 'XX' ä¸æ˜¯ä¸€ä¸ª Hooks API?]]></title>
            <link>/post/why-isnt-x-a-hook-zh</link>
            <guid>/post/why-isnt-x-a-hook-zh</guid>
            <description><![CDATA[æˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼Œä½†å¹¶ä¸æ˜¯æ„å‘³ç€æˆ‘ä»¬åº”è¯¥è¿™æ ·åšã€‚]]></description>
            <content:encoded><![CDATA[<p>è‡ªä» <a href="https://reactjs.org/hooks">React Hooks</a> å‘å¸ƒ alpha ç‰ˆæœ¬, å°±æœ‰å¾ˆå¤šäººå¯¹ä¸€äº›é—®é¢˜çš„è®¨è®ºï¼Œæ¯”å¦‚: â€œä¸ºä»€ä¹ˆæœ‰äº› API ä¸æ˜¯ä¸€ä¸ª Hook?â€ã€‚</p>
<p>æ¯”å¦‚ä¸‹é¢è¿™äº›å°±æ˜¯ä¸€äº› Hooks APIï¼š</p>
<ul>
<li><a href="https://reactjs.org/docs/hooks-reference.html#usestate"><code>useState()</code></a> å¯ä»¥ç”¨æ¥å£°æ˜ <code>state</code> å˜é‡ã€‚</li>
<li><a href="https://reactjs.org/docs/hooks-reference.html#useeffect"><code>useEffect()</code></a> å¯ä»¥ç”¨æ¥å£°æ˜ <code>side effects</code>ã€‚</li>
<li><a href="https://reactjs.org/docs/hooks-reference.html#usecontext"><code>useContext()</code></a> å¯ä»¥ç”¨æ¥è¯»å– <code>context</code>ã€‚</li>
</ul>
<p>ä½†æ˜¯æœ‰äº› API å°±ä¸æ˜¯ hooksï¼Œæ¯”å¦‚ <code>React.memo()</code> å’Œ <code>&lt;Context.Provider&gt;</code>ã€‚ä¸€èˆ¬å¤§å®¶æå‡ºæ¥çš„ Hook åŸºæœ¬ä¸Šæ˜¯*ä¸å¯ç»„åˆï¼ˆnoncompositionalï¼‰<em>å’Œ</em>åæ¨¡å—åŒ–ï¼ˆantimodularï¼‰*çš„ï¼Œè¿™ç¯‡æ–‡ç« ä¼šå¸®åŠ©ä½ ç†è§£ä¸ºä»€ä¹ˆã€‚</p>
<p><strong>æ³¨ï¼šè¿™ç¯‡æ–‡ç« æ˜¯ä¸€ç¯‡æ·±å…¥æ¢è®¨çš„æ–‡ç« ï¼Œé˜…è¯»å¯¹è±¡åº”è¯¥æ˜¯å¯¹ API çš„è®¨è®ºæ˜¯éå¸¸æ„Ÿå…´è¶£çš„ï¼Œè€Œä¸æ˜¯ä¸ºäº†è€ƒè™‘ä½¿ç”¨ React æ¥æå‡æ•ˆç‡çš„ï¼</strong></p>
<hr>
<p>æˆ‘ä»¬æƒ³è®© React çš„ API ä¿æŒä»¥ä¸‹éå¸¸é‡è¦çš„ä¸¤ç‚¹:</p>
<ol>
<li>
<p><strong>ç»„åˆ:</strong> å¯¹äº Hooks APIæ¥è¯´ï¼Œå¯ä»¥<a href="https://reactjs.org/docs/hooks-custom.html">è‡ªå®šä¹‰ Hooks</a> æ˜¯è®©æˆ‘ä»¬æ„Ÿåˆ°éå¸¸å…´å¥‹çš„. æˆ‘ä»¬æœŸæœ›å¤§å®¶éƒ½å¯ä»¥æ¥æ„å»ºè‡ªå·±çš„Hooks API, å¹¶ä¸”æˆ‘ä»¬éœ€è¦ç¡®ä¿ä¸åŒäººå†™çš„ Hooks API <a href="/why-do-hooks-rely-on-call-order/#flaw-4-the-diamond-problem">ä¸ä¼šé€ æˆå†²çª</a>ã€‚ (æˆ‘ä»¬æ˜¯ä¸æ˜¯å·²ç»è¢«è‡ªç”±çš„ç»„åˆç»„ä»¶è€Œä¸ç”¨æ‹…å¿ƒç›¸äº’é€ æˆå½±å“ç»™æƒ¯åäº†ï¼Ÿ)</p>
</li>
<li>
<p><strong>è°ƒè¯•:</strong> æˆ‘ä»¬å¸Œæœ›éšç€åº”ç”¨è§„æ¨¡çš„ä¸æ–­å¢é•¿ <a href="/the-bug-o-notation/">bug æ˜¯å¾ˆå®¹æ˜“å‘ç°çš„</a>çš„ã€‚Reactæœ€æ£’çš„ä¸€ä¸ªç‰¹æ€§å°±æ˜¯å¦‚æœæŸäº›å†…å®¹è¢«é”™è¯¯çš„æ¸²æŸ“äº†ï¼Œä½ å¯ä»¥è½»æ¾çš„æ‰¾åˆ°å¯¹åº”çš„ç»„ä»¶çš„ prop æˆ–è€… state å¯¼è‡´äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
</li>
</ol>
<p>ç»“åˆè¿™ä¸¤ç‚¹æ¥çœ‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“å“ªäº›æ˜¯<em>ä¸èƒ½</em>æˆä¸ºä¸€ä¸ª Hookã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€äº›ä¾‹å­æ¥è¯´æ˜ï¼š</p>
<hr>
<h2>ä¸€ä¸ª Hook: <code>useState()</code></h2>
<h3>ç»„åˆ</h3>
<p>å¤šä¸ªè‡ªå®šä¹‰çš„ Hooks è°ƒç”¨ <code>useState()</code>ï¼Œè€Œä¸ä¼šé€ æˆå†²çªï¼š</p>
<pre   class="language-js"><code class="language-js">function useMyCustomHook1() {
  const [value, setValue] = useState(0);
  // What happens here, stays here.
}

function useMyCustomHook2() {
  const [value, setValue] = useState(0);
  // What happens here, stays here.
}

function MyComponent() {
  useMyCustomHook1();
  useMyCustomHook2();
  // ...
}
</code></pre><p>æ·»åŠ ä¸€ä¸ªä¸åœ¨æ¡ä»¶åˆ¤æ–­é‡Œçš„ <code>useState()</code> ï¼Œ è°ƒç”¨è¿™ä¸ª API æ˜¯å¾ˆå®‰å…¨çš„ã€‚ä½ ä¸éœ€è¦äº†è§£åœ¨ä¸€ä¸ªç»„ä»¶é‡Œé¢å£°æ˜äº†æ–°çš„ state å˜é‡è¢«å…¶ä»– Hooks ä½¿ç”¨äº†ã€‚ä¹Ÿä¸ä¼šå› ä¸ºæ›´æ–°äº†å…¶ä»–çŠ¶æ€å¯¼è‡´ state å˜é‡è¢«ç ´åã€‚</p>
<p><strong>ç»“è®º:</strong> âœ… <code>useState()</code> ä¸ä¼šå¯¹å…¶ä»–è‡ªå®šä¹‰çš„ Hooks é€ æˆç ´åã€‚</p>
<h3>è°ƒè¯•</h3>
<p>Hooks æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œä½ å¯ä»¥åœ¨ Hooks <em>ä¹‹é—´</em>ä¼ é€’å€¼ï¼š</p>
<pre data-line="4,12,14,"  4,12,14="" class="language-js"><code 4,12,14="" class="language-js">function useWindowWidth() {
  const [width, setWidth] = useState(window.innerWidth);
  // ...
  return width;
}

function useTheme(isMobile) {
  // ...
}

function Comment() {
  const width = useWindowWidth();
  const isMobile = width &lt; MOBILE_VIEWPORT;
  const theme = useTheme(isMobile);
  return (
    &lt;section className={theme.comment}&gt;
      {/* ... */}
    &lt;/section&gt;
  );
}
</code></pre><p>ä½†æ˜¯å¦‚è¿‡æˆ‘ä»¬çš„ä»£ç å‡ºé”™äº†ï¼Œæˆ‘ä»¬æ€ä¹ˆè°ƒè¯•ï¼Ÿ</p>
<p>å‡è®¾æˆ‘ä»¬ä» <code>theme.comment</code> é‡Œæ‹¿å‡ºæ¥çš„ä¸€ä¸ª css class æ˜¯é”™è¯¯çš„, é‚£æˆ‘ä»¬æ€ä¹ˆè°ƒè¯•è¿™ä¸ªé—®é¢˜ï¼Ÿæˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶é‡Œè®¾ç½®ä¸€ä¸ªæ–­ç‚¹æˆ–è€…è¾“å‡ºä¸€äº›æ—¥å¿—ã€‚</p>
<p>ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥å‘ç° <code>theme</code> æ˜¯é”™è¯¯çš„ï¼Œä½†æ˜¯ <code>width</code> å’Œ <code>isMobile</code>æ˜¯æ­£ç¡®çš„ã€‚è¿™å°±å‘Šè¯‰æˆ‘ä»¬é—®é¢˜æ˜¯å‘ç”Ÿåœ¨ <code>useTheme()</code> é‡Œé¢ã€‚ä¹Ÿæœ‰å¯èƒ½ <code>width</code> ä¸å¯¹ï¼Œé‚£ä¹ˆç›¸åº”çš„é—®é¢˜å°±å‡ºåœ¨ <code>useWindowWidth()</code> é‡Œã€‚</p>
<p><strong>ä¸€çœ‹æœ€é¡¶éƒ¨çš„å¯¹åº” Hooks é‡Œçš„ä¸­é—´å€¼å°±çŸ¥é“é—®é¢˜å‘ç”Ÿåœ¨å“ªé‡Œäº†ã€‚</strong> æˆ‘ä»¬ä¸éœ€è¦æŸ¥çœ‹ç»„ä»¶é‡Œæ‰€æœ‰çš„ Hooks çš„å®ç°ã€‚</p>
<p>æˆ‘ä»¬ç›´æ¥æŸ¥çœ‹æœ‰é—®é¢˜çš„é‚£ä¸ªå®ç°ï¼Œé‡å¤è¿™ä¸ªæ­¥éª¤å°±å¯ä»¥ç¡®å®šé—®é¢˜å…·ä½“é—®é¢˜å‘ç”Ÿåœ¨ä»€ä¹ˆåœ°æ–¹ã€‚</p>
<p>å¦‚æœè‡ªå®šä¹‰ Hooks çš„åµŒå¥—å±‚çº§å¢åŠ äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå°±å˜çš„æ›´åŠ é‡è¦ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸‰å±‚åµŒå¥—çš„è‡ªå®šä¹‰ Hookï¼Œæ¯å±‚ä½¿ç”¨äº†ä¸‰ä¸ªä¸åŒçš„è‡ªå®š Hooksã€‚ å®šä½<strong>3ä¸ªæœ‰é—®é¢˜çš„åœ°æ–¹</strong>å’Œå®šä½ <strong>3 + 3Ã—3 + 3Ã—3Ã—3 = 39ä¸ªæœ‰é—®é¢˜åœ°æ–¹</strong>ï¼ŒäºŒè€…ä¹‹é—´çš„æˆæœ¬<a href="/the-bug-o-notation/">å·®åˆ«</a>æ˜¯éå¸¸å¤§çš„ã€‚å¹¸è¿çš„æ˜¯ï¼Œ<code>useState()</code> ä¸ä¼šå¯¹å…¶ä»– Hooks æˆ–è€…ç»„ä»¶é€ æˆè«åå…¶å¦™çš„å½±å“ã€‚é›è¿‡ç•™ç—•ï¼Œä¸€ä¸ª Hooks è¿”å›çš„é”™è¯¯å€¼ï¼Œå’Œæ™®é€šçš„å˜é‡æ˜¯æ²¡æœ‰ä»»ä½•åŒºåˆ«çš„ã€‚ğŸ›</p>
<p><strong>ç»“è®º:</strong> âœ… <code>useState()</code> ä¸ä¼šéšè—æˆ‘ä»¬ä»£ç ä¸­çš„å› æœå…³ç³»ã€‚æˆ‘ä»¬å¯ä»¥ä¸€æ­¥æ­¥çš„å®šä½åˆ°å¯¹åº”çš„bugã€‚</p>
<hr>
<h2>ä¸æ˜¯ä¸€ä¸ª Hook: <code>useBailout()</code></h2>
<p>ä½œä¸ºä¸€ç§ä¼˜åŒ–, ç»„ä»¶ä½¿ç”¨ Hooks å¯ä»¥é¿å…é‡æ–°æ¸²æŸ“ã€‚</p>
<p>å¦ä¸€ç§æ–¹å¼æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://reactjs.org/blog/2018/10/23/react-v-16-6.html#reactmemo"><code>React.memo()</code></a> åŒ…è£¹æ•´ä¸ªç»„ä»¶ã€‚ ä¸ºäº†é¿å…é‡æ–°æ¸²æŸ“ï¼Œ<code>React.memo()</code> ä¼šç”¨æœ¬æ¬¡å³å°†æ¸²æŸ“çš„ props å’Œæœ€åä¸€æ¬¡ç„¶çš„ props é€šè¿‡ <code>shallowly equal</code> å»åšæ¯”è¾ƒï¼Œ è¿™ä¸ªå’Œ <code>PureComponent</code> æ˜¯ç±»ä¼¼çš„ã€‚</p>
<p><code>React.memo()</code> æ¥æ”¶ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°å¹¶è¿”å›ä¸€ä¸ªç»„ä»¶ï¼š</p>
<pre data-line="4,"  4="" class="language-js"><code 4="" class="language-js">function Button(props) {
  // ...
}
export default React.memo(Button);
</code></pre><p><strong>ä½†æ˜¯ <code>useBailout()</code> ä¸ºä»€ä¹ˆä¸ä»…ä»…æ˜¯ä¸€ä¸ªé’©å­</strong></p>
<p>ä¸è®ºä½ å°†å…¶ç§°ä¹‹ä¸º <code>useShouldComponentUpdate()</code>ï¼Œ <code>usePure()</code>ï¼Œ <code>useSkipRender()</code> æˆ–è€… <code>useBailout()</code>ï¼Œ è¿™ä¸ªææ¡ˆ(proposal)çœ‹èµ·æ¥å°±å’Œä¸‹é¢è¿™ä¸ªæ˜¯ä¸€æ ·çš„ï¼š</p>
<pre   class="language-js"><code class="language-js">function Button({ color }) {
  // âš ï¸ éçœŸå®API
  useBailout(prevColor =&gt; prevColor !== color, color);

  return (
    &lt;button className={'button-' + color}&gt;  
      OK
    &lt;/button&gt;
  )
}
</code></pre><p>ä¹Ÿæœ‰ä¸€äº›å…¶ä»–ä¸åŒçš„ææ¡ˆï¼ˆæ¯”å¦‚ï¼š<a href="https://github.com/reactjs/rfcs/pull/30#issuecomment-371337630"><code>usePure()</code></a>ï¼‰ï¼Œä½†æ˜¯ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªææ¡ˆä¹Ÿæœ‰åŒæ ·çš„é—®é¢˜ã€‚</p>
<h3>ç»„åˆ</h3>
<p>è®©æˆ‘ä»¬å°è¯•å°† <code>useBailout()</code> åœ¨ä¸¤ä¸ªè‡ªå®šä¹‰çš„ Hooks ä¸­ä½¿ç”¨ï¼š</p>
<pre data-line="4,5,19,20,"  4,5,19,20="" class="language-js"><code 4,5,19,20="" class="language-js">function useFriendStatus(friendID) {
  const [isOnline, setIsOnline] = useState(null);

  // âš ï¸ éçœŸå®API
  useBailout(prevIsOnline =&gt; prevIsOnline !== isOnline, isOnline);

  useEffect(() =&gt; {
    const handleStatusChange = status =&gt; setIsOnline(status.isOnline);
    ChatAPI.subscribe(friendID, handleStatusChange);
    return () =&gt; ChatAPI.unsubscribe(friendID, handleStatusChange);
  });

  return isOnline;
}

function useWindowWidth() {
  const [width, setWidth] = useState(window.innerWidth);
  
  // âš ï¸ éçœŸå®API
  useBailout(prevWidth =&gt; prevWidth !== width, width);

  useEffect(() =&gt; {
    const handleResize = () =&gt; setWidth(window.innerWidth);
    window.addEventListener('resize', handleResize);
    return () =&gt; window.removeEventListener('resize', handleResize);
  });

  return width;
}
</code></pre><p>å¦‚æœç°åœ¨åœ¨åŒä¸€ä¸ªç»„ä»¶ä¸­ä½¿ç”¨è¿™ä¸¤ä¸ªè‡ªå®šä¹‰çš„ Hooks ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<pre data-line="2,3,"  2,3="" class="language-js"><code 2,3="" class="language-js">function ChatThread({ friendID, isTyping }) {
  const width = useWindowWidth();
  const isOnline = useFriendStatus(friendID);
  return (
    &lt;ChatLayout width={width}&gt;
      &lt;FriendStatus isOnline={isOnline} /&gt;
      {isTyping &amp;&amp; 'Typing...'}
    &lt;/ChatLayout&gt;
  );
}
</code></pre><p>ä»€ä¹ˆæ—¶å€™é‡æ–°æ¸²æŸ“?</p>
<p>å¦‚æœæ¯ä¸€ä¸ª <code>useBailout()</code> éƒ½æœ‰æƒé™å»è·³è¿‡æ›´æ–°ï¼Œé‚£ä¹ˆ <code>useWindowWidth()</code> é‡Œé¢çš„æ›´æ–°å°±ä¼šè¢« <code>useFriendStatus()</code> ç»™é˜»å¡ï¼Œåä¹‹äº¦ç„¶ã€‚ <strong>è¿™äº› Hooks ä¼šç›¸äº’å½±å“ã€‚</strong></p>
<p>ç„¶è€Œï¼Œå¦‚æœå…è®¸<code>useBailout()</code> åœ¨ä¸€ä¸ªç»„ä»¶é‡Œå»é˜»æ­¢æ›´æ–°çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ <code>ChatThread</code> ç»„ä»¶é‡Œçš„ <code>isTyping</code> å±æ€§å‘ç”Ÿå˜åŒ–æ—¶ä¹Ÿæ— æ³•å»æ›´æ–°è¿™ä¸ªç»„ä»¶ã€‚</p>
<p>æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨è¿™ç§è¯­ä¹‰ï¼Œ<strong>ä»»ä½•æ–°æ·»åŠ åˆ° <code>ChatThread</code> é‡Œçš„ Hooks å¦‚æœæ²¡æœ‰<em>åŒæ ·</em>è°ƒç”¨ <code>useBailout()</code>ï¼Œé‚£ä¹ˆè¿™äº› Hooks ä¹ŸåŒæ ·ä¼šè¢«é˜»æ–­</strong>ã€‚ä¸ç„¶ <code>useBailout()</code> ä¹Ÿæ²¡æœ‰åŠæ³•åœ¨ <code>useWindowWidth()</code> å’Œ <code>useFriendStatus()</code> é˜»æ­¢æ›´æ–°æ—¶ â€œæŠ•ä¸Šåå¯¹ç¥¨ï¼ˆvote againstï¼‰â€ã€‚</p>
<p><strong>ç»“è®º:</strong> ğŸ”´ <code>useBailout()</code> è¿åäº†ç»„åˆåŸåˆ™. æ·»åŠ  <code>useBailout()</code> åˆ°ä¸€ä¸ª Hook é‡Œé¢å°±ä¼šå½±å“å…¶ä»– Hooks çš„çŠ¶æ€æ›´æ–°ã€‚æˆ‘å¸Œæœ›å’Œ API æ˜¯<a href="/optimized-for-change/">å¥å£®çš„(antifragile)</a>, ä½†æ˜¯ <code>useBailout()</code> çš„è¡Œä¸ºæ˜¯å®Œå®Œå…¨å…¨ç›¸åçš„ã€‚</p>
<h3>è°ƒè¯•</h3>
<p>åƒ <code>useBailout()</code> çš„è¿™æ ·çš„ hook ä¼šå¯¹è°ƒè¯•é€ æˆä»€ä¹ˆå½±å“ï¼Ÿ</p>
<p>æˆ‘ä»¬ä½¿ç”¨åŒæ ·çš„åˆ—å­:</p>
<pre   class="language-js"><code class="language-js">function ChatThread({ friendID, isTyping }) {
  const width = useWindowWidth();
  const isOnline = useFriendStatus(friendID);
  return (
    &lt;ChatLayout width={width}&gt;
      &lt;FriendStatus isOnline={isOnline} /&gt;
      {isTyping &amp;&amp; 'Typing...'}
    &lt;/ChatLayout&gt;
  );
}
</code></pre><p>å‡è®¾æœ‰äº›ä¸Šå±‚ç»„ä»¶çš„å±æ€§å‘ç”Ÿäº†å˜åŒ–ï¼Œä½†æ˜¯ <code>Typing...</code> label æ²¡æœ‰æŒ‰ç…§æˆ‘ä»¬é¢„æœŸæ˜¾ç¤ºå‡ºæ¥ã€‚è¿™æ—¶å€™æˆ‘ä»¬æ€ä¹ˆè°ƒè¯•å‘¢ï¼Ÿ</p>
<p><strong>é€šå¸¸ï¼Œä½ ä¼šå¾ˆè‡ªä¿¡çš„å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åªéœ€è¦å»çœ‹<em>ä¸Šå±‚ç»„ä»¶</em>ã€‚</strong> å¦‚æœ <code>ChatThread</code> æ²¡æœ‰è·å¾— <code>isTyping</code> çš„æ–°å€¼ã€‚æˆ‘ä»¬å¯ä»¥æ‰“å¼€æ¸²æŸ“ <code>&lt;ChatThread isTyping={myVar} /&gt;</code> çš„ç»„ä»¶ï¼Œç„¶åå»æ£€æŸ¥ <code>myVar</code> ç­‰ç­‰ã€‚åœ¨åŒçº§ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½åœ¨ <code>shouldComponentUpdate()</code> ä¸­å‘ç°è¢«é˜»æ­¢äº†ï¼Œæˆ–è€… <code>isTyping</code> çš„å€¼æ²¡æœ‰æ­£ç¡®çš„ä¼ é€’è¿‡å»ã€‚æ£€æŸ¥åœ¨è¿™ä¸ªé“¾ä¸­çš„æ¯ä¸€ä¸ªç»„ä»¶é€šå¸¸ä¹Ÿèƒ½è½»æ¾çš„å®šä½åˆ°é—®é¢˜çš„æ ¹æºã€‚</p>
<p>å¦‚æœ <code>useBailout()</code> Hook æ˜¯ä¸€ä¸ªçœŸå®çš„ APIã€‚åœ¨ä½ æ·±åº¦åœ°æ£€æŸ¥ <code>ChatThread</code> å’Œ <code>ChatThread</code> é‡Œæ‰€æœ‰ç»„ä»¶<em>ä¸­ä½¿ç”¨åˆ°çš„æ¯ä¸€ä¸ªè‡ªå®šä¹‰ Hook</em> ä¹‹å‰ï¼Œä½ æ°¸è¿œä¸çŸ¥é“è·³è¿‡æ›´æ–°çš„åŸå› ã€‚ç”±äºæ¯ä¸€ä¸ªçˆ¶ç»„ä»¶<em>åŒæ ·</em>å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ Hooksï¼Œè¿™ä¸ª<a href="/the-bug-o-notation/">æƒ…å†µï¼ˆscalesï¼‰</a>å°±å˜çš„æ›´åŠ å¤æ‚äº†ã€‚</p>
<p>è¿™å°±åƒä½ åœ¨ä¸€ä¸ªæŠ½å±‰æŸœé‡Œæœ‰ä¸€å †å°æŠ½å±‰çš„å…¶ä¸­ä¸€ä¸ªæ‰¾åˆ°ä¸€æŠŠå°èºä¸åˆ€ä¸€æ ·ã€‚ä½ æ°¸è¿œä¸çŸ¥é“è¿™ä¸ªâ€œå‘â€åˆ°åº•æœ‰å¤šæ·±ã€‚</p>
<p><strong>ç»“è®º:</strong> ğŸ”´ <code>useBailout()</code> Hook ä¸ä»…ä»…ç ´åå¯ç»„åˆæ€§, ä¸ºäº†æ‰¾åˆ°æœ‰ bug çš„é˜»æ­¢æ›´æ–°ä»£ç ï¼Œå¤§å¤§çš„å¢åŠ äº†è°ƒè¯•æ­¥éª¤å’Œè®¤çŸ¥è´Ÿè· â€”â€” åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™æ˜¯æŒ‡æ•°çº§åˆ«çš„ã€‚</p>
<hr>
<p>æˆ‘ä»¬è®¨è®ºäº†ä¸€ä¸ªçœŸæ­£å­˜åœ¨çš„ Hook - <code>useState()</code>ï¼Œå’Œå¦ä¸€ä¸ªçœ‹ä¸Šå»æ˜¯ Hookï¼Œä½†æ˜¯å®é™…ä¸Š<em>ä¸</em>æ˜¯ä¸€ä¸ª Hook - <code>useBailout()</code> çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ¯”è¾ƒäº†ç»„åˆå’Œè°ƒè¯•ï¼Œå¹¶è®¨è®ºäº†ä¸ºä»€ä¹ˆå…¶ä¸­ä¸€ä¸ªæ˜¯æœ‰æ•ˆçš„ï¼Œå¦ä¸€ä¸ªäº‹æ— æ•ˆçš„ã€‚</p>
<p>è™½ç„¶æ²¡æœ‰ â€œHook ç‰ˆæœ¬â€ çš„ <code>memo()</code> å’Œ <code>shouldComponentUpdate()</code>ï¼Œä½†æ˜¯Reactç¡®å®æä¾›äº†ä¸€ä¸ªå« <a href="https://reactjs.org/docs/hooks-reference.html#usememo"><code>useMemo()</code></a> çš„ API. è™½ç„¶æœ‰ç›¸åŒçš„ç”¨é€”ï¼Œä½†æ˜¯ <code>useMemo()</code> æœ¬èº«çš„è¯­ä¹‰æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸ä¼šé‡åˆ°ä¸Šé¢æ‰€è¯´çš„é—®é¢˜ã€‚</p>
<p><code>useBailout()</code> åªæ˜¯ä¸€ä¸ªä¸ä¼šåƒ Hook ä¸€æ ·å·¥ä½œçš„ä¾‹å­ã€‚ä½†æ˜¯ä¹Ÿè¿˜æœ‰ä¸€äº›å…¶ä»–çš„ Hooks API â€”â€” æ¯”å¦‚ï¼Œ<code>useProvider()</code>, <code>useCatch()</code>, å’Œ <code>useSuspense()</code>ã€‚</p>
<p>ç°åœ¨æ˜ç™½ä¸ºä»€ä¹ˆäº†å—?</p>
<p><em>(ä½å¤´å˜€å’•: ç»„åˆ... è°ƒè¯•...)</em></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Why Isnâ€™t X a Hook?]]></title>
            <link>/post/why-isnt-x-a-hook</link>
            <guid>/post/why-isnt-x-a-hook</guid>
            <description><![CDATA[Just because we can, doesnâ€™t mean we should.]]></description>
            <content:encoded><![CDATA[<p>Since the first alpha version of <a href="https://reactjs.org/hooks">React Hooks</a> was released, there is a question that keeps coming up in discussions: â€œWhy isnâ€™t <em>&lt;some other API&gt;</em> a Hook?â€</p>
<p>To remind you, hereâ€™s a few things that <em>are</em> Hooks:</p>
<ul>
<li><a href="https://reactjs.org/docs/hooks-reference.html#usestate"><code>useState()</code></a> lets you declare a state variable.</li>
<li><a href="https://reactjs.org/docs/hooks-reference.html#useeffect"><code>useEffect()</code></a> lets you declare a side effect.</li>
<li><a href="https://reactjs.org/docs/hooks-reference.html#usecontext"><code>useContext()</code></a> lets you read some context.</li>
</ul>
<p>But there are some other APIs, like <code>React.memo()</code> and <code>&lt;Context.Provider&gt;</code>, that are <em>not</em> Hooks. Commonly proposed Hook versions of them would be <em>noncompositional</em> or <em>antimodular</em>. This article will help you understand why.</p>
<p><strong>Note: this post is a deep dive for folks who are interested in API discussions. You donâ€™t need to think about any of this to be productive with React!</strong></p>
<hr>
<p>There are two important properties that we want React APIs to preserve:</p>
<ol>
<li>
<p><strong>Composition:</strong> <a href="https://reactjs.org/docs/hooks-custom.html">Custom Hooks</a> are largely the reason weâ€™re excited about the Hooks API. We expect people to build their own Hooks very often, and we need to make sure Hooks written by different people <a href="/why-do-hooks-rely-on-call-order/#flaw-4-the-diamond-problem">don't conflict</a>. (Arenâ€™t we all spoiled by how components compose cleanly and donâ€™t break each other?)</p>
</li>
<li>
<p><strong>Debugging:</strong> We want the bugs to be <a href="/the-bug-o-notation/">easy to find</a> as the application grows. One of React's best features is that if you see something wrong rendered, you can walk up the tree until you find which component's prop or state caused the mistake.</p>
</li>
</ol>
<p>These two constraints put together can tell us what can or <em>cannot</em> be a Hook. Letâ€™s try a few examples.</p>
<hr>
<h2>A Real Hook: <code>useState()</code></h2>
<h3>Composition</h3>
<p>Multiple custom Hooks each calling <code>useState()</code> donâ€™t conflict:</p>
<pre   class="language-jsx"><code class="language-jsx">function useMyCustomHook1() {
  const [value, setValue] = useState(0);
  // What happens here, stays here.
}

function useMyCustomHook2() {
  const [value, setValue] = useState(0);
  // What happens here, stays here.
}

function MyComponent() {
  useMyCustomHook1();
  useMyCustomHook2();
  // ...
}
</code></pre><p>Adding a new unconditional <code>useState()</code> call is always safe. You donâ€™t need to know anything about other Hooks used by a component to declare a new state variable. You also canâ€™t break other state variables by updating one of them.</p>
<p><strong>Verdict:</strong> âœ… <code>useState()</code> doesnâ€™t make custom Hooks fragile.</p>
<h3>Debugging</h3>
<p>Hooks are useful because you can pass values <em>between</em> Hooks:</p>
<pre data-line="4,12,14,"  4,12,14="" class="language-jsx"><code 4,12,14="" class="language-jsx">function useWindowWidth() {
  const [width, setWidth] = useState(window.innerWidth);
  // ...
  return width;
}

function useTheme(isMobile) {
  // ...
}

function Comment() {
  const width = useWindowWidth();
  const isMobile = width &lt; MOBILE_VIEWPORT;
  const theme = useTheme(isMobile);
  return (
    &lt;section className={theme.comment}&gt;
      {/* ... */}
    &lt;/section&gt;
  );
}
</code></pre><p>But what if we make a mistake? Whatâ€™s the debugging story?</p>
<p>Let's say the CSS class we get from <code>theme.comment</code> is wrong. How would we debug this? We can set a breakpoint or a few logs in the body of our component.</p>
<p>Maybe weâ€™d see that <code>theme</code> is wrong but <code>width</code> and <code>isMobile</code> are correct. That would tell us the problem is inside <code>useTheme()</code>. Or perhaps we'd see that <code>width</code> itself is wrong. That would tell us to look into <code>useWindowWidth()</code>.</p>
<p><strong>A single look at the intermediate values tells us which of the Hooks at the top level contains the bug.</strong> We don't need to look at <em>all</em> of their implementations.</p>
<p>Then we can â€œzoom inâ€ on the one that has a bug, and repeat.</p>
<p>This becomes more important if the depth of custom Hook nesting increases. Imagine we have 3 levels of custom Hook nesting, each level using 3 different custom Hooks inside. The <a href="/the-bug-o-notation/">difference</a> between looking for a bug in <strong>3 places</strong> versus potentially checking <strong>3 + 3Ã—3 + 3Ã—3Ã—3 = 39 places</strong> is enormous. Luckily, <code>useState()</code> can't magically â€œinfluenceâ€ other Hooks or components. A buggy value returned by it leaves a trail behind it, just like any variable. ğŸ›</p>
<p><strong>Verdict:</strong> âœ… <code>useState()</code> doesnâ€™t obscure the cause-effect relationship in our code. We can follow the breadcrumbs directly to the bug.</p>
<hr>
<h2>Not a Hook: <code>useBailout()</code></h2>
<p>As an optimization, components using Hooks can bail out of re-rendering.</p>
<p>One way to do it is to put a <a href="https://reactjs.org/blog/2018/10/23/react-v-16-6.html#reactmemo"><code>React.memo()</code></a> wrapper around the whole component. It bails out of re-rendering if props are shallowly equal to what we had during the last render. This makes it similar to <code>PureComponent</code> in classes.</p>
<p><code>React.memo()</code> takes a component and returns a component:</p>
<pre data-line="4,"  4="" class="language-jsx"><code 4="" class="language-jsx">function Button(props) {
  // ...
}
export default React.memo(Button);
</code></pre><p><strong>But why isnâ€™t it just a Hook?</strong></p>
<p>Whether you call it <code>useShouldComponentUpdate()</code>, <code>usePure()</code>, <code>useSkipRender()</code>, or <code>useBailout()</code>, the proposal tends to look something like this:</p>
<pre   class="language-jsx"><code class="language-jsx">function Button({ color }) {
  // âš ï¸ Not a real API
  useBailout(prevColor =&gt; prevColor !== color, color);

  return (
    &lt;button className={'button-' + color}&gt;  
      OK
    &lt;/button&gt;
  )
}
</code></pre><p>There are a few more variations (e.g. a simple <code>usePure()</code> marker) but in broad strokes they have the same flaws.</p>
<h3>Composition</h3>
<p>Letâ€™s say we try to put <code>useBailout()</code> in two custom Hooks:</p>
<pre data-line="4,5,19,20,"  4,5,19,20="" class="language-jsx"><code 4,5,19,20="" class="language-jsx">function useFriendStatus(friendID) {
  const [isOnline, setIsOnline] = useState(null);

  // âš ï¸ Not a real API
  useBailout(prevIsOnline =&gt; prevIsOnline !== isOnline, isOnline);

  useEffect(() =&gt; {
    const handleStatusChange = status =&gt; setIsOnline(status.isOnline);
    ChatAPI.subscribe(friendID, handleStatusChange);
    return () =&gt; ChatAPI.unsubscribe(friendID, handleStatusChange);
  });

  return isOnline;
}

function useWindowWidth() {
  const [width, setWidth] = useState(window.innerWidth);
  
  // âš ï¸ Not a real API
  useBailout(prevWidth =&gt; prevWidth !== width, width);

  useEffect(() =&gt; {
    const handleResize = () =&gt; setWidth(window.innerWidth);
    window.addEventListener('resize', handleResize);
    return () =&gt; window.removeEventListener('resize', handleResize);
  });

  return width;
}
</code></pre><p>Now what happens if you use them both in the same component?</p>
<pre data-line="2,3,"  2,3="" class="language-jsx"><code 2,3="" class="language-jsx">function ChatThread({ friendID, isTyping }) {
  const width = useWindowWidth();
  const isOnline = useFriendStatus(friendID);
  return (
    &lt;ChatLayout width={width}&gt;
      &lt;FriendStatus isOnline={isOnline} /&gt;
      {isTyping &amp;&amp; 'Typing...'}
    &lt;/ChatLayout&gt;
  );
}
</code></pre><p>When does it re-render?</p>
<p>If every <code>useBailout()</code> call has the power to skip an update, then updates from <code>useWindowWidth()</code> would be blocked by <code>useFriendStatus()</code>, and vice versa. <strong>These Hooks would break each other.</strong></p>
<p>However, if <code>useBailout()</code> was only respected when <em>all</em> calls to it inside a single component â€œagreeâ€ to block an update, our <code>ChatThread</code> would fail to update on changes to the <code>isTyping</code> prop.</p>
<p>Even worse, with these semantics <strong>any newly added Hooks to <code>ChatThread</code> would break if they donâ€™t <em>also</em> call <code>useBailout()</code></strong>. Otherwise, they canâ€™t â€œvote againstâ€ the bailout inside <code>useWindowWidth()</code> and <code>useFriendStatus()</code>.</p>
<p><strong>Verdict:</strong> ğŸ”´ <code>useBailout()</code> breaks composition. Adding it to a Hook breaks state updates in other Hooks. We want the APIs to be <a href="/optimized-for-change/">antifragile</a>, and this behavior is pretty much the opposite.</p>
<h3>Debugging</h3>
<p>How does a Hook like <code>useBailout()</code> affect debugging?</p>
<p>Weâ€™ll use the same example:</p>
<pre   class="language-jsx"><code class="language-jsx">function ChatThread({ friendID, isTyping }) {
  const width = useWindowWidth();
  const isOnline = useFriendStatus(friendID);
  return (
    &lt;ChatLayout width={width}&gt;
      &lt;FriendStatus isOnline={isOnline} /&gt;
      {isTyping &amp;&amp; 'Typing...'}
    &lt;/ChatLayout&gt;
  );
}
</code></pre><p>Letâ€™s say the <code>Typing...</code> label doesnâ€™t appear when we expect, even though somewhere many layers above the prop is changing. How do we debug it?</p>
<p><strong>Normally, in React you can confidently answer this question by looking <em>up</em>.</strong> If <code>ChatThread</code> doesnâ€™t get a new <code>isTyping</code> value, we can open the component that renders <code>&lt;ChatThread isTyping={myVar} /&gt;</code> and check <code>myVar</code>, and so on. At one of these levels, weâ€™ll either find a buggy <code>shouldComponentUpdate()</code> bailout, or an incorrect <code>isTyping</code> value being passed down. One look at each component in the chain is usually enough to locate the source of the problem.</p>
<p>However, if this <code>useBailout()</code> Hook was real, you would never know the reason an update was skipped until you checked <em>every single custom Hook</em> (deeply) used by our <code>ChatThread</code> and components in its owner chain. Since every parent component can <em>also</em> use custom Hooks, this <a href="/the-bug-o-notation/">scales</a> terribly.</p>
<p>Itâ€™s like if you were looking for a screwdriver in a chest of drawers, and each drawer contained a bunch of smaller chests of drawers, and you donâ€™t know how deep the rabbit hole goes.</p>
<p><strong>Verdict:</strong> ğŸ”´ Not only <code>useBailout()</code> Hook breaks composition, but it also vastly increases the number of debugging steps and cognitive load for finding a buggy bailout â€” in some cases, exponentially.</p>
<hr>
<p>We just looked at one real Hook, <code>useState()</code>, and a common suggestion that is intentionally <em>not</em> a Hook â€” <code>useBailout()</code>. We compared them through the prism of Composition and Debugging, and discussed why one of them works and the other one doesnâ€™t.</p>
<p>While there is no â€œHook versionâ€ of <code>memo()</code> or <code>shouldComponentUpdate()</code>, React <em>does</em> provide a Hook called <a href="https://reactjs.org/docs/hooks-reference.html#usememo"><code>useMemo()</code></a>. It serves a similar purpose, but its semantics are different enough to not run into the pitfalls described above.</p>
<p><code>useBailout()</code> is just one example of something that doesnâ€™t work well as a Hook. But there are a few others â€” for example, <code>useProvider()</code>, <code>useCatch()</code>, or <code>useSuspense()</code>.</p>
<p>Can you see why?</p>
<p><em>(Whispers: Composition... Debugging...)</em></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[ç¼–å†™æœ‰å¼¹æ€§çš„ç»„ä»¶]]></title>
            <link>/post/writing-resilient-components-zh</link>
            <guid>/post/writing-resilient-components-zh</guid>
            <description><![CDATA[æŒ‡å‘æ­£ç¡®é“è·¯çš„å››é¡¹åŸºæœ¬åŸåˆ™.]]></description>
            <content:encoded><![CDATA[<p>å½“å¤§å®¶å¼€å§‹å­¦ä¹  React æ—¶ï¼Œå¸¸å¸¸é—®åˆ°é£æ ¼æŒ‡å—ã€‚è™½ç„¶å‘¢ï¼Œé¡¹ç›®ä¸­åº”ç”¨ä¸€è‡´çš„è§„åˆ™ï¼Œæ˜¯ä¸ªä¸é”™çš„ä¸»æ„ï¼Œä½†æ˜¯å¾ˆå¤šè§„åˆ™æŒºéšæ„çš„â€”â€”æ‰€ä»¥ React å¯¹è¿™äº›å¹¶æ²¡æœ‰å¼ºçƒˆçš„æ„è§ã€‚</p>
<p>ä½ å¯ä»¥ä½¿ç”¨ä¸åŒçš„ç±»å‹ç³»ç»Ÿï¼Œä½¿ç”¨å‡½æ•°å£°æ˜æˆ–è€…ç®­å¤´å‡½æ•°ï¼Œä¹Ÿå¯ä»¥å¯¹ä½ çš„å±æ€§æŒ‰å­—æ¯åºæˆ–ä»»ä½•ä½ æ„¿æ„çš„å…¶ä»–é¡ºåºæ¥æ’åºã€‚</p>
<p>è¿™æ ·çš„çµæ´»æ€§å…è®¸åœ¨é¡¹ç›®ä¸­ <a href="https://reactjs.org/docs/add-react-to-a-website.html">æ•´åˆ React</a> æ—¶ï¼Œèƒ½åº”ç”¨å·²æœ‰çš„ä¸€äº›çº¦å®šä¹ æƒ¯ã€‚ä¸è¿‡åŒæ—¶ï¼Œè¿™ä¹Ÿä¼šå¼•å‘æ— ä¼‘æ­¢çš„äº‰è®ºã€‚</p>
<p><strong>_æœ‰_ä¸€äº›æ¯ä¸ªç»„ä»¶éƒ½åº”æåŠ›éµå®ˆçš„è®¾è®¡åŸåˆ™ã€‚ä½†æˆ‘ä¸è®¤ä¸ºé£æ ¼æŒ‡å—èƒ½å¾ˆå¥½åœ°æ•æ‰è¿™äº›åŸåˆ™ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆè°ˆè°ˆé£æ ¼æŒ‡å—ï¼Œç„¶å<a href="#%E7%BC%96%E5%86%99%E6%9C%89%E5%BC%B9%E6%80%A7%E7%9A%84%E7%BB%84%E4%BB%B6">å†çœ‹çœ‹çœŸçš„æœ‰ç”¨çš„è®¾è®¡åŸåˆ™</a>ã€‚</strong></p>
<hr>
<h2>åˆ«è¢«è™šå¹»çš„é—®é¢˜åˆ†æ•£äº†æ³¨æ„åŠ›</h2>
<p>åœ¨æˆ‘ä»¬è®¨è®ºç»„ä»¶çš„è®¾è®¡åŸåˆ™å‰ï¼Œæˆ‘æƒ³å…ˆç®€å•è¯´è¯´é£æ ¼æŒ‡å—ã€‚è¿™ä¸æ˜¯ä¸ªæµè¡Œçš„è§‚ç‚¹ï¼Œä½†æœ‰äººå¾—è¯´å‡ºæ¥ï¼</p>
<p>åœ¨ JavaScript ç¤¾åŒºä¸­ï¼Œæœ‰ä¸€äº›ç”± linter å¼ºåˆ¶çº¦æŸçš„æ ·å¼æŒ‡å—ã€‚æˆ‘ä¸ªäººçš„è§‚å¯Ÿæ˜¯ï¼Œä»–ä»¬ä¼šäº§æ¯”ä»–ä»¬ä»·å€¼æ›´å¤šçš„éº»çƒ¦ã€‚æˆ‘ç®—ä¸æ¸…æœ‰å¤šå°‘äººå‘æˆ‘å±•ç¤ºè¿‡ä¸€äº›å®Œå…¨æœ‰æ•ˆçš„ä»£ç ï¼Œç„¶åè·Ÿæˆ‘è¯´ â€œReact æç¤ºè¿™æœ‰é—®é¢˜å•Šï¼â€ï¼Œä½†è¿™å…¶å®æ˜¯ç”±ä»–ä»¬çš„ lint é…ç½®äº§ç”Ÿçš„ï¼è¿™å°±å¯¼è‡´äº†ä¸‰ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>
<p>äººä»¬ä¹ æƒ¯äºå°† linter çœ‹ä½œæ˜¯ä¸€ä¸ªè¿‡åˆ†çƒ­å¿ƒåˆåµé—¹çš„çœ‹é—¨äººï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ã€‚ æœ‰ç”¨çš„è­¦å‘Šè¢«é£æ ¼æç¤ºçš„æµ·æ´‹æ·¹æ²¡äº†ã€‚å› æ­¤ï¼Œäººä»¬åœ¨è°ƒè¯•æ—¶ä¸çœ‹ linter çš„æç¤ºï¼Œé”™è¿‡æœ‰ç”¨çš„ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œä¹‹å‰ä¸å¤ªå†™ JavaScript çš„äººç¾¤ï¼ˆä¾‹å¦‚ï¼Œè®¾è®¡äººå‘˜ï¼‰ä¹Ÿå› æ­¤æ›´éš¾ä½¿ç”¨ä»£ç ã€‚</p>
</li>
<li>
<p>å¯¹äºæŸç§æ¨¡å¼ï¼Œå¤§å®¶ä¸å¤ªå­¦ç€<strong>åŒºåˆ†æœ‰æ•ˆå’Œæ— æ•ˆçš„ç”¨æ³•</strong>ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€æ¡æµè¡Œçš„è§„åˆ™æ˜¯ï¼Œç¦æ­¢åœ¨ <code>componentDidMount</code> ä¸­è°ƒç”¨ <code>setState</code>ã€‚ä½†å¦‚æœè¿™ä¸ªç”¨æ³•æ€»æ˜¯ â€œé”™çš„â€ï¼Œé‚£ React æ ¹æœ¬ä¸ä¼šå…è®¸å®ƒï¼è¿™å°±æœ‰ä¸€ä¸ªåˆæ³•çš„ç”¨ä¾‹ï¼Œé‚£å°±æ˜¯æµ‹é‡ DOM èŠ‚ç‚¹å¸ƒå±€â€”â€”ä¾‹å¦‚ï¼Œå®šä½ tooltipã€‚æˆ‘è§è¿‡æœ‰äººæ·»åŠ  <code>setTimeout</code> æ¥ â€œè§£å†³â€ è¿™æ¡è§„åˆ™ï¼Œè¿™å®Œå…¨æé”™äº†ã€‚</p>
</li>
<li>
<p>æœ€ç»ˆï¼Œäººä»¬é‡‡ç”¨ â€œæ‰§æ³•è€…å¿ƒæ€â€ï¼Œå¯¹é‚£äº›<strong>æ²¡å¸¦æ¥æœ‰æ„ä¹‰å˜åŒ–</strong>ä½†åœ¨ä»£ç ä¸­æ˜“äºå‘ç°çš„åœ°æ–¹æŒæ‰¹è¯„æ€åº¦ã€‚â€œä½ ç”¨äº†å‡½æ•°å£°æ˜ï¼Œä½†<em>æˆ‘ä»¬çš„</em>é¡¹ç›®ç”¨çš„æ˜¯ç®­å¤´å‡½æ•°ã€‚â€ æ¯æ¬¡æˆ‘æœ‰å¼ºçƒˆæ„æ„¿ï¼Œæƒ³è¦å¼ºåˆ¶æ‰§è¡Œç±»ä¼¼çš„è§„åˆ™æ—¶ï¼Œä»”ç»†æƒ³æƒ³å°±ä¼šå‘ç°ï¼Œæˆ‘æŠŠä¸ªäººæƒ…ç»ªæŠ•å…¥åˆ°äº†è¿™ä¸ªè§„åˆ™ä¸­â€”â€”ç„¶ååˆåŠªåŠ›è®©è¿™æ¶ˆå¤±ã€‚è¿™è®©æˆ‘é™·å…¥è™šå‡çš„æˆå°±æ„Ÿï¼Œè€Œä¸æ¯«æ²¡æœ‰æ”¹è¿›æˆ‘çš„ä»£ç ã€‚</p>
</li>
</ul>
<p>æˆ‘è¿™æ˜¯åœ¨å®£æ‰¬åœæ­¢ä½¿ç”¨ linter å—ï¼Ÿ ä¸ï¼</p>
<p>**é€šè¿‡è‰¯å¥½çš„é…ç½®ï¼Œlinter æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å·¥å…·ï¼Œå®ƒå¯ä»¥åœ¨ bug å‡ºç°å‰å°±èƒ½å‘ç°å®ƒä»¬ã€‚**ä½†å®ƒå¯¹<em>ä»£ç é£æ ¼</em>çš„å…³æ³¨è¿‡å¤šï¼Œä½¿å…¶å˜å¾—ä¼šåˆ†æ•£æ³¨æ„åŠ›ã€‚</p>
<hr>
<h2>æ•´ç†ä½ çš„ Lint é…ç½®</h2>
<p>è¿™æ˜¯æˆ‘å»ºè®®ä½ åœ¨å‘¨ä¸€è¦åšçš„äº‹ã€‚æŠŠä½ çš„å›¢é˜Ÿå«åˆ°ä¸€èµ·èŠ±åŠä¸ªå°æ—¶æ—¶é—´ï¼Œä¸€æ¡æ¡è¿‡ä¸€ä¸‹ä½ ä»¬é¡¹ç›®ä¸­å¯ç”¨çš„ lint è§„åˆ™ï¼Œæ¥ç€é—®é—®è‡ªå·±ï¼š<em>â€œè¿™æ¡è§„åˆ™æœ‰å¸®æˆ‘æ‰¾åˆ°è¿‡ bug å—?â€</em> å¦‚æœä¸æ˜¯ï¼Œ<em>å…³æ‰è¿™æ¡è§„åˆ™</em>ã€‚ï¼ˆä½ ä¹Ÿå¯ä»¥ç”¨ <a href="https://www.npmjs.com/package/eslint-config-react-app"><code>eslint-config-react-app</code></a> ä»å¤´å¼€å§‹åˆ›å»ºï¼Œé‡Œé¢ä¸å«ä»»ä½•ä»£ç é£æ ¼çš„è§„åˆ™ï¼‰</p>
<p>è‡³å°‘ï¼Œä½ çš„å›¢é˜Ÿåº”è¯¥æœ‰ä¸€ä¸ªæµç¨‹ï¼Œä¼šå»åˆ é™¤å¼•èµ·å¹²æ‰°çš„è§„åˆ™é¡¹ã€‚ä¸è¦å‡è®¾ä¸€å¹´å‰ä½ æˆ–åˆ«äººæ·»åŠ åˆ°ä½ çš„ lint é…ç½®ä¸­çš„ä»»ä½•ä¸œè¥¿ï¼Œéƒ½æ˜¯â€œæœ€ä½³å®è·µâ€ã€‚ä¿æŒè´¨ç–‘ï¼Œæ‰¾åˆ°ç­”æ¡ˆã€‚åˆ«è®©ä»»ä½•äººå‘Šè¯‰ä½ ï¼Œä½ ä¸å¤Ÿèªæ˜ï¼Œä¸èƒ½é€‰æ‹© lint è§„åˆ™ã€‚</p>
<p><strong>é‚£ä»£ç æ ¼å¼åŒ–å‘¢ï¼Ÿ</strong> ç”¨ <a href="https://prettier.io/">Prettier</a> ç„¶åå¿˜æ‰ â€œé£æ ¼â€ã€‚ä½ å®Œå…¨ä¸éœ€è¦ä¸€ä¸ªå·¥å…·å‘Šè¯‰ä½ å¾—åœ¨è¿™åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œå¦‚æœæœ‰åˆ«çš„å·¥å…·èƒ½ä¸ºä½ ä¿®å¤å®ƒã€‚ç”¨ linter æ‰¾ <em>bug</em>ï¼Œè€Œä¸æ˜¯åš <em>ä»£ ç  ç¾ å­¦</em>ã€‚</p>
<p>å½“ç„¶ï¼ŒæŸäº›æ–¹é¢æ¥è¯´ï¼Œç¼–ç é£æ ¼å’Œæ ¼å¼æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œä½†åœ¨æ•´ä¸ªé¡¹ç›®ä¸­å­˜åœ¨ä¸ä¸€è‡´æ—¶è¿˜æ˜¯å¾ˆæ¼äººã€‚</p>
<p>ç„¶è€Œï¼Œå®ƒä»¬ä¸­çš„è®¸å¤šéƒ½å¤ªå¾®å¦™äº†ï¼Œæ— æ³•é€šè¿‡ä¸€æ¡ lint è§„åˆ™æ•æ‰åˆ°ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¯´ï¼Œåœ¨å›¢é˜Ÿæˆå‘˜ä¹‹é—´<strong>å»ºç«‹ä¿¡ä»»</strong>ï¼Œåœ¨ wiki æˆ–ç®€çŸ­çš„è®¾è®¡æŒ‡å—é‡Œåˆ†äº«æœ‰ç”¨çš„çŸ¥è¯†ï¼Œæ˜¯éå¸¸é‡è¦çš„äº‹äº†ã€‚</p>
<p>ä¸æ˜¯ä¸€åˆ‡éƒ½å€¼å¾—è‡ªåŠ¨åŒ–ï¼ä» <em>å®é™…é˜…è¯»</em> ä¸­è·å¾—çš„è§è§£ï¼Œè¿™ç§æŒ‡å—ä¸­çš„ç†ç”±å¯èƒ½æ¯”éµå¾ª &quot;è§„åˆ™&quot; æ›´æœ‰ä»·å€¼ã€‚</p>
<p><strong>å¦‚æœéµå¾ªä¸¥æ ¼çš„é£æ ¼æŒ‡å—æ˜¯ä¸€ç§åˆ†å¿ƒï¼Œé‚£åˆ°åº•ä»€ä¹ˆæ‰æ˜¯é‡è¦çš„å‘¢ï¼Ÿ</strong></p>
<p>è¿™å°±æ˜¯è¿™ç¯‡æ–‡ç« çš„ä¸»é¢˜ã€‚</p>
<hr>
<h2>ç¼–å†™æœ‰å¼¹æ€§çš„ç»„ä»¶</h2>
<p>ä¸è®ºå¤šå°‘ç¼©è¿›æˆ–æŒ‰å­—æ¯åºæ’åˆ—ï¼Œéƒ½ä¸èƒ½ä¿®å¤ç³Ÿç³•çš„è®¾è®¡ã€‚å› æ­¤ï¼Œæˆ‘ä¸ä¼šä¸“æ³¨äºæŸäº›ä»£ç <em>çœ‹èµ·æ¥å¦‚ä½•</em>ï¼Œè€Œæ˜¯ä¸“æ³¨äºå¦‚ä½•è®©å®ƒ<em>å·¥ä½œ</em>ã€‚è¿™æœ‰ä¸€äº›ç»„ä»¶è®¾è®¡åŸåˆ™æˆ‘è®¤ä¸ºæ˜¯éå¸¸æœ‰ç”¨ï¼š</p>
<ol>
<li><strong><a href="#%E5%8E%9F%E5%88%99-1%EF%BC%9A%E4%B8%8D%E9%98%BB%E6%96%AD%E6%95%B0%E6%8D%AE%E6%B5%81">ä¸é˜»æ–­æ•°æ®æµ</a></strong></li>
<li><strong><a href="#%E5%8E%9F%E5%88%99-2%EF%BC%9A%E6%97%B6%E5%88%BB%E5%87%86%E5%A4%87%E6%B8%B2%E6%9F%93">æ—¶åˆ»å‡†å¤‡æ¸²æŸ“</a></strong></li>
<li><strong><a href="#%E5%8E%9F%E5%88%99-3%EF%BC%9A%E6%B2%A1%E6%9C%89%E5%8D%95%E4%BE%8B%E7%BB%84%E4%BB%B6">æ²¡æœ‰å•ä¾‹ç»„ä»¶</a></strong></li>
<li><strong><a href="#%E5%8E%9F%E5%88%99-4%EF%BC%9A%E9%9A%94%E7%A6%BB%E6%9C%AC%E5%9C%B0%E7%8A%B6%E6%80%81">éš”ç¦»æœ¬åœ°çŠ¶æ€</a></strong></li>
</ol>
<p>å³ä½¿ä½ ä¸ä½¿ç”¨ Reactï¼Œå¯¹äºå­˜åœ¨å•å‘æ•°æ®æµçš„ä»»ä½• UI ç»„ä»¶æ¨¡å‹ï¼Œå¯èƒ½ä¹Ÿèƒ½é€šè¿‡åå¤è¯•éªŒå‘ç°ç›¸åŒçš„åŸåˆ™ã€‚</p>
<hr>
<h2 id="åŸåˆ™-1ï¼šä¸é˜»æ–­æ•°æ®æµ">åŸåˆ™ 1ï¼šä¸é˜»æ–­æ•°æ®æµ</h2>
<h3>æ¸²æŸ“ä¸­ä¸è¦é˜»æ–­æ•°æ®æµ</h3>
<p>å½“åˆ«äººä½¿ç”¨ä½ çš„ç»„ä»¶æ—¶ï¼Œä»–ä»¬çš„é¢„æœŸæ˜¯ï¼Œä¸è®ºä¼ é€’å±æ€§å¦‚ä½•å˜åŒ–, ç»„ä»¶éƒ½å°†åæ˜ è¿™äº›å˜åŒ–ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">// isOk ä¹Ÿè®¸åœ¨ state é‡Œï¼Œéšæ—¶ä¼šå˜åŒ–
&lt;Button color={isOk ? 'blue' : 'red'} /&gt;
</code></pre><p>é€šå¸¸ï¼Œè¿™æ˜¯ React é»˜è®¤å·¥ä½œçš„æ–¹å¼ã€‚å¦‚æœä½ åœ¨ <code>Button</code> ç»„ä»¶ä¸­ä½¿ç”¨ <code>color</code>ï¼Œä½ ä¼šçœ‹åˆ°ä»ä¸Šå±‚ä¸ºè¯¥æ¸²æŸ“æä¾›çš„å€¼ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">function Button({ color, children }) {
  return (
    // âœ… `color` æ°¸è¿œæ˜¯æ–°çš„
    &lt;button className={'Button-' + color}&gt;
      {children}
    &lt;/button&gt;
  );
}
</code></pre><p>ç„¶è€Œï¼Œå­¦ä¹  React æ—¶å¸¸è§çš„ä¸€ä¸ªé”™è¯¯æ˜¯ï¼ŒæŠŠ props å¤åˆ¶åˆ° stateï¼š</p>
<pre data-line="3,6,"  3,6="" class="language-jsx"><code 3,6="" class="language-jsx">class Button extends React.Component {
  state = {
    color: this.props.color
  };
  render() {
    const { color } = this.state; // ğŸ”´ `color` ä¸æ–°é²œäº†ï¼
    return (
      &lt;button className={'Button-' + color}&gt;
        {this.props.children}
      &lt;/button&gt;
    );
  }
}
</code></pre><p>è¿™ä¹Ÿè®¸çœ‹èµ·æ¥æ›´ç›´è§‚ï¼Œå¦‚æœä½ ä½¿ç”¨è¿‡ React ä¹‹å¤–çš„ä¸œè¥¿ã€‚ <strong>ä½†æ˜¯ï¼Œé€šè¿‡å°† prop å¤åˆ¶åˆ° stateï¼Œä½ å¿½ç•¥äº†å¯¹å®ƒçš„æ‰€æœ‰æ›´æ–°ã€‚</strong></p>
<pre   class="language-jsx"><code class="language-jsx">// ğŸ”´ ä¸Šé¢çš„å®ç°åœ¨æ›´æ–°æ—¶æ— æ³•æ­£å¸¸å·¥ä½œäº†
&lt;Button color={isOk ? 'blue' : 'red'} /&gt;
</code></pre><p>å¾ˆå°‘æƒ…å†µä¸‹ï¼Œè¿™æ ·çš„è¡Œä¸º <em>æ˜¯</em> æœ‰æ„ä¸ºä¹‹çš„ï¼Œè¯·ç¡®è®¤å°†è¿™æ ·çš„å±æ€§å–åä¸º <code>initialColor</code> æˆ– <code>defaultColor</code> æ¥è¡¨æ˜ç»„ä»¶ä¼šå¿½ç•¥è¿™ä¸ªå±æ€§çš„æ”¹å˜ã€‚</p>
<p>ä½†é€šå¸¸ä½ ä¼šæƒ³åœ¨ä½ çš„ç»„ä»¶ä¸­ <strong>ç›´æ¥è¯»å– props</strong>ï¼Œé¿å…å¤åˆ¶ propsï¼ˆæˆ–ä» props ä¸­è®¡ç®—å¾—åˆ°çš„å€¼) åˆ° stateï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">function Button({ color, children }) {
  return (
    // âœ… `color` æ°¸è¿œæ˜¯æ–°çš„!
    &lt;button className={'Button-' + color}&gt;
      {children}
    &lt;/button&gt;
  );
}
</code></pre><hr>
<p>è®¡ç®—å€¼æ˜¯å¦ä¸€ä¸ªå¤§å®¶å¯èƒ½ä¼šå°† props å¤åˆ¶åˆ° state çš„åœºæ™¯ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæƒ³è±¡ä¸€ä¸‹ <em>æŒ‰é’®æ–‡å­—</em> çš„é¢œè‰²æ˜¯æ ¹æ® <code>color</code> å±æ€§é€šè¿‡æ˜‚è´µè®¡ç®—å¾—æ¥ï¼š</p>
<pre data-line="3,9,"  3,9="" class="language-jsx"><code 3,9="" class="language-jsx">class Button extends React.Component {
  state = {
    textColor: slowlyCalculateTextColor(this.props.color)
  };
  render() {
    return (
      &lt;button className={
        'Button-' + this.props.color +
        ' Button-text-' + this.state.textColor // ğŸ”´ `color` æ”¹å˜çš„æ—¶å€™å°±ä¸æ–°é²œäº†
      }&gt;
        {this.props.children}
      &lt;/button&gt;
    );
  }
}
</code></pre><p>è¿™ä¸ªç»„ä»¶æœ‰ bugï¼Œå®ƒåœ¨ <code>color</code> å±æ€§æ”¹å˜æ—¶æ— æ³•é‡æ–°è®¡ç®— <code>this.state.textColor</code>ã€‚æœ€ç®€å•çš„ä¿®å¤æ˜¯æŠŠ <code>textColor</code> çš„è®¡ç®—æ”¾åˆ° <code>render</code> æ–¹æ³•ä¸­ï¼Œç„¶åæŠŠç»„ä»¶æ”¹ä¸º <code>PureComponent</code>ï¼š</p>
<pre data-line="1,3,"  1,3="" class="language-jsx"><code 1,3="" class="language-jsx">class Button extends React.PureComponent {
  render() {
    const textColor = slowlyCalculateTextColor(this.props.color);
    return (
      &lt;button className={
        'Button-' + this.props.color +
        ' Button-text-' + textColor // âœ… æ°¸è¿œæ˜¯æ–°çš„
      }&gt;
        {this.props.children}
      &lt;/button&gt;
    );
  }
}
</code></pre><p>é—®é¢˜è§£å†³äº†ï¼ç°åœ¨å½“ props æ”¹å˜æ—¶é‡æ–°è®¡ç®— <code>textColor</code>ï¼Œä½†æ˜¯åœ¨å±æ€§ä¸å˜æ—¶ï¼Œèƒ½é¿å…é‡å¤è¿›è¡Œæ˜‚è´µè®¡ç®—ã€‚</p>
<p>ç„¶è€Œï¼Œä¹Ÿè®¸æˆ‘ä»¬è¿˜èƒ½å†ä¼˜åŒ–ä¸€ä¸‹ã€‚å¦‚æœ <code>children</code> æ”¹å˜äº†å‘¢ï¼Ÿå¾ˆé—æ†¾ <code>textColor</code> åœ¨è¿™ç§æƒ…å†µä¸‹ä¼šé‡å¤è®¡ç®—ã€‚æˆ‘ä»¬ç¬¬äºŒæ¬¡å°è¯•å¯èƒ½æ˜¯é€šè¿‡åœ¨ <code>componentDidUpdate</code> ä¸­è°ƒç”¨è®¡ç®—ã€‚</p>
<pre data-line="5-12,"  5-12="" class="language-jsx"><code 5-12="" class="language-jsx">class Button extends React.Component {
  state = {
    textColor: slowlyCalculateTextColor(this.props.color)
  };
  componentDidUpdate(prevProps) {
    if (prevProps.color !== this.props.color) {
      // ğŸ˜” é¢å¤–çš„é‡å¤æ¸²æŸ“
      this.setState({
        textColor: slowlyCalculateTextColor(this.props.color),
      });
    }
  }
  render() {
    return (
      &lt;button className={
        'Button-' + this.props.color +
        ' Button-text-' + this.state.textColor // âœ… åœ¨æœ€åä¸€æ¬¡æ¸²æŸ“åæ˜¯æ–°çš„
      }&gt;
        {this.props.children}
      &lt;/button&gt;
    );
  }
}
</code></pre><p>ç„¶è€Œï¼Œè¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬çš„ç»„ä»¶åœ¨æ¯æ¬¡æ›´æ–°åï¼Œéƒ½æœ‰ä¸¤æ¬¡ render è°ƒç”¨ã€‚å¦‚æœæˆ‘ä»¬è¯•å›¾ä¼˜åŒ–å®ƒï¼Œé‚£ä¹Ÿä¸ç†æƒ³ã€‚</p>
<p>ä½ å¯ä»¥ä½¿ç”¨å·²ä¸æ¨èçš„ <code>componentWillReceiveProps</code> ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚ç„¶è€Œï¼Œå¤§å®¶ç»å¸¸æŠŠ side effects æ”¾è¿™ã€‚è¿™åè¿‡æ¥åˆå¾€å¾€ä¼šç»™å³å°†åˆ°æ¥çš„å¹¶å‘æ¸²æŸ“ <a href="https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html">ç‰¹æ€§åƒ Time Slicing å’Œ Suspense</a> å¸¦æ¥é—®é¢˜ã€‚è€Œæ›´ â€œå®‰å…¨â€ çš„ <code>getDerivedStateFromProps</code> åˆæœ‰ç‚¹éš¾ç”¨ã€‚</p>
<p>è®©æˆ‘ä»¬é€€ä¸€æ­¥ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬æƒ³è¦ <a href="https://en.wikipedia.org/wiki/Memoization"><em>memoization</em></a>ã€‚æˆ‘ä»¬æœ‰ä¸€äº›è¾“å…¥ï¼Œé™¤éè¾“å…¥å‘ç”Ÿå˜åŒ–ï¼Œå¦åˆ™æˆ‘ä»¬ä¸æƒ³é‡æ–°è®¡ç®—è¾“å‡ºã€‚</p>
<p>ä½¿ç”¨ç±»ï¼Œä½ å¯ä»¥ä½¿ç”¨<a href="https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#what-about-memoization">å¸®åŠ©ç¨‹åº</a>å®Œæˆ memoizationã€‚ä½†æ˜¯ï¼ŒHooks æ›´è¿›äº†ä¸€æ­¥ï¼Œæä¾›äº†ä¸€ç§è®°å¿†æ˜‚è´µè®¡ç®—çš„å†…ç½®æ–¹æ³•ï¼š</p>
<pre data-line="2-5,"  2-5="" class="language-jsx"><code 2-5="" class="language-jsx">function Button({ color, children }) {
  const textColor = useMemo(
    () =&gt; slowlyCalculateTextColor(color),
    [color] // âœ… é™¤é `color` æ”¹å˜ï¼Œä¸ä¼šé‡æ–°è®¡ç®—
  );
  return (
    &lt;button className={'Button-' + color + ' Button-text-' + textColor}&gt;
      {children}
    &lt;/button&gt;
  );
}
</code></pre><p>è¿™å°±æ˜¯æ‰€ä»¥ä½ éœ€è¦çš„å…¨éƒ¨ä»£ç äº†ï¼</p>
<p>åœ¨ class ç»„ä»¶ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨å¸®åŠ©ç¨‹åºç±»ä¼¼ <a href="https://github.com/alexreardon/memoize-one"><code>memoize-one</code></a>ã€‚åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œ<code>useMemo</code> Hook æä¾›äº†ç±»ä¼¼çš„åŠŸèƒ½ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬çœ‹åˆ°<strong>ä¼˜åŒ–æ˜‚è´µçš„è®¡ç®—ä¹Ÿä¸æ˜¯å°† props å¤åˆ¶åˆ° state çš„å¥½ç†ç”±</strong>ã€‚æˆ‘ä»¬çš„æ¸²æŸ“ç»“æœåº”è¯¥å“åº” props çš„å˜åŒ–ã€‚</p>
<hr>
<h3>ä¸è¦åœ¨ Side Effects é‡Œé˜»æ–­æ•°æ®æµ</h3>
<p>ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è®¨è®ºäº†å…³äºå¦‚ä½•åœ¨å±æ€§å˜åŒ–æ—¶ä¿æŒæ¸²æŸ“ç»“æœçš„ä¸€è‡´ã€‚é¿å…å¤åˆ¶ props åˆ° state æ˜¯ä¸€éƒ¨åˆ†ã€‚ç„¶è€Œï¼Œ<strong>side effectsï¼ˆä¾‹å¦‚è·å–æ•°æ®ï¼‰ä¹Ÿæ˜¯æ•°æ®æµé‡è¦çš„ä¸€éƒ¨åˆ†</strong></p>
<p>çœ‹çœ‹è¿™ä¸ª React ç»„ä»¶ï¼š</p>
<pre data-line="5-7,"  5-7="" class="language-jsx"><code 5-7="" class="language-jsx">class SearchResults extends React.Component {
  state = {
    data: null
  };
  componentDidMount() {
    this.fetchResults();
  }
  fetchResults() {
    const url = this.getFetchUrl();
    // è·å–æ•°æ®...
  }
  getFetchUrl() {
    return 'http://myapi/results?query' + this.props.query;
  }
  render() {
    // ...
  }
}
</code></pre><p>å¾ˆå¤š React ç»„ä»¶éƒ½åƒè¿™æ ·â€”â€”ä½†å¦‚æœçœ‹çœ‹ï¼Œä¼šå‘ç°è¿™æœ‰ä¸ª bugã€‚<code>fetchResults</code> æ–¹æ³•ä½¿ç”¨äº† <code>query</code> å±æ€§æ¥åšæ•°æ®è·å–ï¼š</p>
<pre data-line="2,"  2="" class="language-jsx"><code 2="" class="language-jsx">  getFetchUrl() {
    return 'http://myapi/results?query' + this.props.query;
  }
</code></pre><p>ä½†å¦‚æœ <code>query</code> å˜äº†å‘¢ï¼Ÿåœ¨è¿™ä¸ªç»„ä»¶ä¸­ï¼Œä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿã€‚<strong>è¿™æ„å‘³ç€ç»„ä»¶çš„ side effects æ²¡æœ‰å“åº”å®ƒ props çš„å˜åŒ–</strong>ã€‚è¿™åœ¨ React åº”ç”¨ä¸­æ˜¯å¸¸è§ bug çš„æ ¹æºã€‚</p>
<p>ä¸ºäº†ä¿®å¤è¿™ä¸ªç»„ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p>
<ul>
<li>æŸ¥çœ‹ <code>componentDidMount</code> å’Œå®ƒæ‰€è°ƒç”¨çš„æ‰€æœ‰æ–¹æ³•
<ul>
<li>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå°±æ˜¯ <code>fetchResults</code> å’Œ <code>getFetchUrl</code></li>
</ul>
</li>
<li>å†™ä¸‹æ‰€æœ‰è¢«ä»–ä»¬ä½¿ç”¨çš„ props å’Œ state
<ul>
<li>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå°±æ˜¯ <code>this.props.query</code></li>
</ul>
</li>
<li>ç¡®ä¿ä¸è®º props å¦‚ä½•å˜åŒ–ï¼Œéƒ½é‡æ–°æ‰§è¡Œ side effect
<ul>
<li>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>componentDidUpdate</code> æ–¹æ³•å®ç°</li>
</ul>
</li>
</ul>
<pre data-line="8-12,18,"  8-12,18="" class="language-jsx"><code 8-12,18="" class="language-jsx">class SearchResults extends React.Component {
  state = {
    data: null
  };
  componentDidMount() {
    this.fetchResults();
  }
  componentDidUpdate(prevProps) {
    if (prevProps.query !== this.props.query) { // âœ… é‡æ–°è·å–æ•°æ®
      this.fetchResults();
    }
  }
  fetchResults() {
    const url = this.getFetchUrl();
    // è·å–æ•°æ®...
  }
  getFetchUrl() {
    return 'http://myapi/results?query' + this.props.query; // âœ… æ›´æ–°ä¹Ÿå¤„ç†å¥½äº†
  }
  render() {
    // ...
  }
}
</code></pre><p>ç°åœ¨æˆ‘ä»¬çš„ä»£ç èƒ½å“åº”æ‰€æœ‰çš„ props å˜åŒ–äº†ï¼Œç”šè‡³æ˜¯ side effectsã€‚</p>
<p>ç„¶è€Œï¼Œç‰¢è®°ä¸è¦å†æç ¸äº†ï¼Œè¿™çœŸæ˜¯ä¸ªæŒ‘æˆ˜ã€‚ä¾‹å¦‚ï¼Œä¹Ÿè®¸åˆåŠ äº† <code>currentPage</code> åˆ° stateï¼Œç„¶ååœ¨ <code>getFetchUrl</code> ä¸­ä½¿ç”¨äº†å®ƒï¼š</p>
<pre data-line="4,21,"  4,21="" class="language-jsx"><code 4,21="" class="language-jsx">class SearchResults extends React.Component {
  state = {
    data: null,
    currentPage: 0,
  };
  componentDidMount() {
    this.fetchResults();
  }
  componentDidUpdate(prevProps) {
    if (prevProps.query !== this.props.query) {
      this.fetchResults();
    }
  }
  fetchResults() {
    const url = this.getFetchUrl();
    // è·å–æ•°æ®...
  }
  getFetchUrl() {
    return (
      'http://myapi/results?query' + this.props.query +
      '&amp;page=' + this.state.currentPage // ğŸ”´ æ›´æ–°è¢«å¿½ç•¥äº†
    );
  }
  render() {
    // ...
  }
}
</code></pre><p>å“å‘€ï¼Œæˆ‘ä»¬çš„ä»£ç åˆæœ‰ bug äº†ï¼Œè¿™æ˜¯å› ä¸º side effect æ²¡æœ‰å“åº” <code>currentPage</code> çš„å˜åŒ–ã€‚</p>
<p><strong>props å’Œ state æ˜¯ React æ•°æ®æµçš„ä¸€éƒ¨åˆ†ã€‚åœ¨è¿™ä¸ªæ•°æ®æµä¸­ï¼Œrendering å’Œ side effects éƒ½åº”å“åº”å®ƒä»¬çš„å˜åŒ–ï¼Œè€Œä¸æ˜¯å¿½ç•¥å®ƒä»¬ï¼</strong></p>
<p>ä¸ºäº†ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼š</p>
<ul>
<li>æŸ¥çœ‹ <code>componentDidMount</code> å’Œå®ƒæ‰€è°ƒç”¨çš„æ‰€æœ‰æ–¹æ³•
<ul>
<li>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå°±æ˜¯ <code>fetchResults</code> å’Œ <code>getFetchUrl</code></li>
</ul>
</li>
<li>å†™ä¸‹æ‰€æœ‰è¢«ä»–ä»¬ä½¿ç”¨çš„ props å’Œ state
<ul>
<li>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå°±æ˜¯ <code>this.props.query</code> <strong>å’Œ <code>this.state.currentPage</code></strong></li>
</ul>
</li>
<li>ç¡®ä¿ä¸è®º props å¦‚ä½•å˜åŒ–ï¼Œéƒ½é‡æ–°æ‰§è¡Œ side effect
<ul>
<li>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>componentDidUpdate</code> æ–¹æ³•å®ç°</li>
</ul>
</li>
</ul>
<p>è®©æˆ‘ä»¬ä¿®å¤æˆ‘ä»¬çš„ç»„ä»¶ï¼Œç”¨ä»¥å¤„ç† <code>currentPage</code> çš„æ›´æ–°å§ï¼š</p>
<pre data-line="11,24,"  11,24="" class="language-jsx"><code 11,24="" class="language-jsx">class SearchResults extends React.Component {
  state = {
    data: null,
    currentPage: 0,
  };
  componentDidMount() {
    this.fetchResults();
  }
  componentDidUpdate(prevProps, prevState) {
    if (
      prevState.currentPage !== this.state.currentPage || // âœ… æ›´æ–°åé‡æ–°è·å–æ•°æ®
      prevProps.query !== this.props.query
    ) {
      this.fetchResults();
    }
  }
  fetchResults() {
    const url = this.getFetchUrl();
    // è·å–æ•°æ®...
  }
  getFetchUrl() {
    return (
      'http://myapi/results?query' + this.props.query +
      '&amp;page=' + this.state.currentPage // âœ… æ›´æ–°è¢«å¤„ç†äº†
    );
  }
  render() {
    // ...
  }
}
</code></pre><p>**å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿä»¥æŸç§æ–¹å¼è‡ªåŠ¨æ•æ‰åˆ°è¿™äº›é”™è¯¯ï¼Œé‚£ä¸æ˜¯å¾ˆå¥½å—ï¼Ÿ**éš¾é“æ²¡æœ‰ä»€ä¹ˆ linter å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¤„ç†è¿™äº‹å—ï¼Ÿ</p>
<hr>
<p>é—æ†¾çš„æ˜¯ï¼Œè‡ªåŠ¨æ£€æŸ¥ç±»ç»„ä»¶çš„ä¸€è‡´æ€§å¤ªå›°éš¾äº†ã€‚ä»»ä½•æ–¹æ³•éƒ½å¯ä»¥è°ƒç”¨ä»»ä½•å…¶ä»–æ–¹æ³•ã€‚é™æ€åˆ†ææ¥è‡ª <code>componentDidMount</code> å’Œ <code>componentDidUpdate</code> çš„è°ƒç”¨å……æ»¡äº†è¯¯æŠ¥ã€‚</p>
<p>ä½†æ˜¯ï¼Œ<em>å¯èƒ½</em> å¯ä»¥è®¾è®¡ä¸€ä¸ª <em>èƒ½</em> è¢«é™æ€åˆ†æçš„ä¸€è‡´æ€§ APIã€‚<a href="/a-complete-guide-to-useeffect/">React <code>useEffect</code> Hook</a> å°±æ˜¯è¿™æ · API çš„ä¸€ä¸ªä¾‹å­ï¼š</p>
<pre data-line="13-14,19,"  13-14,19="" class="language-jsx"><code 13-14,19="" class="language-jsx">function SearchResults({ query }) {
  const [data, setData] = useState(null);
  const [currentPage, setCurrentPage] = useState(0);

  useEffect(() =&gt; {
    function fetchResults() {
      const url = getFetchUrl();
      // æ•°æ®è·å–...
    }

    function getFetchUrl() {
      return (
        'http://myapi/results?query' + query +
        '&amp;page=' + currentPage
      );
    }

    fetchResults();
  }, [currentPage, query]); // âœ… æ›´æ–°åé‡æ–°è·å–

  // ...
}
</code></pre><p>æˆ‘ä»¬å°†é€»è¾‘ <em>æ”¾åœ¨</em> effect ä¸­ï¼Œè¿™æ ·å¯ä»¥æ›´å®¹æ˜“åœ°çœ‹åˆ°<em>å®ƒä» React æ•°æ®æµä¸­ä¾èµ–äº†å“ªäº›å€¼</em>ã€‚è¿™äº›å€¼ç§°ä¸ºâ€œä¾èµ–â€ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­å®ƒä»¬æ˜¯ <code>[currentPage, query]</code>ã€‚</p>
<p>æ³¨æ„è¿™ä¸ªâ€œeffect ä¾èµ–â€æ•°ç»„å¹¶ä¸æ˜¯ä¸€ä¸ªæ–°æ¦‚å¿µã€‚åœ¨ç±»ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»éå†æ‰€æœ‰æ–¹æ³•è°ƒç”¨ï¼Œæ¥æœç´¢è¿™äº›â€œä¾èµ–é¡¹â€ã€‚<code>useEffect</code> API åªæ˜¯æ˜¾å¼åœ°ä½¿ç”¨äº†ç›¸åŒçš„æ¦‚å¿µã€‚</p>
<p>åè¿‡æ¥è¯´ï¼Œè¿™å¯ä»¥è®©æˆ‘ä»¬è‡ªåŠ¨éªŒè¯å®ƒä»¬ï¼š</p>
<p><img src="./useeffect.gif" alt="Demo of exhaustive-deps lint rule"></p>
<p><em>ï¼ˆè¿™ä¸ª demo æ¥è‡ªæœ€æ–°æ¨èçš„ <code>exhaustive-deps</code> lint è§„åˆ™ï¼Œè¿™æ˜¯ <code>eslint-plugin-react-hooks</code> å…¶ä¸­ä¸€éƒ¨åˆ†ã€‚å®ƒå°†ä¸ä¹…åŠ å…¥åˆ° Create React App ä¸­ï¼‰</em></p>
<p><strong>æ³¨æ„ï¼Œæ— è®ºæ˜¯å°†ç»„ä»¶ç¼–å†™ä¸ºç±»è¿˜æ˜¯å‡½æ•°ï¼Œéƒ½å¿…é¡»ä¸º effect å“åº”æ‰€æœ‰ props å’Œ state çš„æ›´æ–°ã€‚</strong></p>
<p>ä½¿ç”¨ class APIï¼Œä½ å¿…é¡»è‡ªå·±è€ƒè™‘ä¸€è‡´æ€§ï¼Œå¹¶éªŒè¯å¯¹æ¯ä¸ªç›¸å…³ prop æˆ– state çš„æ›´æ”¹æ˜¯å¦è¯¥ç”± <code>componentDidUpdate</code> å¤„ç†ã€‚å¦åˆ™ï¼Œç»„ä»¶å¯¹ prop å’Œ state çš„æ›´æ”¹ä¸å…·æœ‰å¼¹æ€§ã€‚è¿™ç”šè‡³ä¸æ˜¯ä¸“å±äº React çš„é—®é¢˜ã€‚å®ƒé€‚ç”¨äºä»»ä½•å…è®¸ä½ å•ç‹¬å¤„ç† â€œåˆ›å»ºâ€ å’Œ â€œæ›´æ–°â€ äº‹ä»¶çš„ UI åº“</p>
<p><strong><code>useEffect</code> API é€šè¿‡é¼“åŠ±ä¸€è‡´æ€§æ¥ç¿»è½¬é»˜è®¤å€¼ã€‚</strong> è¿™ <a href="/a-complete-guide-to-useeffect/">å¯èƒ½åœ¨å¼€å§‹æ—¶è§‰å¾—ä¼šä¸ç†Ÿæ‚‰</a>ï¼Œä½†è¿™æ ·çš„ç»“æœæ˜¯ä½ çš„ç»„ä»¶å¯¹é€»è¾‘æ›´æ”¹æ›´å…·å¼¹æ€§äº†ã€‚ç”±äº â€œä¾èµ–å…³ç³»â€ ç°åœ¨æ˜¯æ˜¾å¼çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ lint è§„åˆ™<em>æ£€éªŒ</em>æ˜¯å¦ä¸€è‡´ã€‚ æˆ‘ä»¬ç”¨ linter æ¥æ•æ‰ bugï¼</p>
<hr>
<h3>ä¸è¦åœ¨ä¼˜åŒ–ä¸­é˜»æ–­æ•°æ®æµ</h3>
<p>è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œä½ å¯èƒ½ä¼šæ„å¤–å¿½ç•¥å¯¹ props çš„æ›´æ”¹ã€‚å½“ä½ æ‰‹åŠ¨ä¼˜åŒ–ç»„ä»¶æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿè¿™ç±»é”™è¯¯ã€‚</p>
<p>æ³¨æ„ï¼Œä½¿ç”¨æµ…æ¯”è¾ƒçš„ä¼˜åŒ–æ–¹æ³•ï¼ˆå¦‚ <code>PureComponent</code> å’Œ <code>React.memo</code>ï¼‰ä¸é»˜è®¤æ¯”è¾ƒæ˜¯å®‰å…¨çš„ã€‚</p>
<p><strong>ä½†æ˜¯ï¼Œå¦‚æœä½ å°è¯•é€šè¿‡ç¼–å†™è‡ªå·±çš„æ¯”è¾ƒæ–¹æ³•æ¥ â€œä¼˜åŒ–â€ ç»„ä»¶ï¼Œä½ å¯èƒ½ä¼šé”™è¯¯åœ°å¿˜è®°æ¯”è¾ƒå‡½æ•°å±æ€§ï¼š</strong></p>
<pre data-line="2-5,7,"  2-5,7="" class="language-jsx"><code 2-5,7="" class="language-jsx">class Button extends React.Component {
  shouldComponentUpdate(prevProps) {
    // ğŸ”´ æ²¡æ¯”è¾ƒ this.props.onClick
    return this.props.color !== prevProps.color;
  }
  render() {
    const onClick = this.props.onClick; // ğŸ”´ å°†ä¸å“åº”æ›´æ–°
    const textColor = slowlyCalculateTextColor(this.props.color);
    return (
      &lt;button
        onClick={onClick}
        className={'Button-' + this.props.color + ' Button-text-' + textColor}&gt;
        {this.props.children}
      &lt;/button&gt;
    );
  }
}
</code></pre><p>ä¸€å¼€å§‹å¾ˆå®¹æ˜“é”™è¿‡è¿™ä¸ªé”™è¯¯ï¼Œå› ä¸ºå¯¹äºç±»ï¼Œä½ é€šå¸¸ä¼šä¼ é€’ä¸€ä¸ª<em>æ–¹æ³•</em>ï¼Œæ‰€ä»¥å®ƒä¼šæœ‰ç›¸åŒçš„èº«ä»½ï¼š</p>
<pre data-line="2-4,9-11,"  2-4,9-11="" class="language-jsx"><code 2-4,9-11="" class="language-jsx">class MyForm extends React.Component {
  handleClick = () =&gt; { // âœ… æ€»æ˜¯åŒä¸€ä¸ªå‡½æ•°
    // Do something
  }
  render() {
    return (
      &lt;&gt;
        &lt;h1&gt;Hello!&lt;/h1&gt;
        &lt;Button color='green' onClick={this.handleClick}&gt;
          Press me
        &lt;/Button&gt;
      &lt;/&gt;
    )
  }
}
</code></pre><p>æ‰€ä»¥æˆ‘ä»¬çš„ä¼˜åŒ–ä¸ä¼š<em>é©¬ä¸Š</em>è¢«ç ´åã€‚ä½†æ˜¯ï¼Œå®ƒå°†æŒç»­ â€œçœ‹åˆ°â€ æ—§çš„ <code>onClick</code> å€¼ï¼Œä½†å…¶ä»– props ä¸ä¼šè¿™æ ·ï¼š</p>
<pre data-line="6,13-15,"  6,13-15="" class="language-jsx"><code 6,13-15="" class="language-jsx">class MyForm extends React.Component {
  state = {
    isEnabled: true
  };
  handleClick = () =&gt; {
    this.setState({ isEnabled: false });
    // Do something
  }
  render() {
    return (
      &lt;&gt;
        &lt;h1&gt;Hello!&lt;/h1&gt;
        &lt;Button color='green' onClick={
          // ğŸ”´ Button å¿½ç•¥äº† onClick çš„æ›´æ–°
          this.state.isEnabled ? this.handleClick : null
        }&gt;
          Press me
        &lt;/Button&gt;
      &lt;/&gt;
    )
  }
}
</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåº”è¯¥ç¦ç”¨æŒ‰é’®ç‚¹å‡»äº‹ä»¶â€”â€”ä½†è¿™ä¸ä¼šå‘ç”Ÿï¼Œå› ä¸º <code>Button</code> ç»„ä»¶å¿½ç•¥äº†å¯¹<code>onClick</code> å±æ€§çš„ä»»ä½•æ›´æ–°ã€‚</p>
<p>å¦‚æœå‡½æ•°æ ‡è¯†æœ¬èº«ä¾èµ–äºå¯èƒ½éšæ—¶é—´å˜åŒ–çš„ä¸œè¥¿ï¼Œä¾‹å¦‚æœ¬ä¾‹ä¸­çš„ <code>draft.content</code>ï¼Œè¿™å¯èƒ½ä¼šè®©äººæ›´åŠ å›°æƒ‘ï¼š</p>
<pre data-line="6-7,"  6-7="" class="language-jsx"><code 6-7="" class="language-jsx">  drafts.map(draft =&gt;
    &lt;Button
      color='blue'
      key={draft.id}
      onClick={
        // ğŸ”´ Button å¿½ç•¥äº† onClick çš„æ›´æ–°
        this.handlePublish.bind(this, draft.content)
      }&gt;
      Publish
    &lt;/Button&gt;
  )
</code></pre><p>è™½ç„¶ <code>draft.content</code> å¯èƒ½éšç€æ—¶é—´çš„æ¨ç§»è€Œæ”¹å˜ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ <code>Button</code> ç»„ä»¶å¿½ç•¥äº†å¯¹<code>onClick</code> å±æ€§çš„æ”¹å˜ï¼Œæ‰€ä»¥å®ƒç»§ç»­çœ‹åˆ° <code>onClick</code> ç»‘å®šæ–¹æ³•çš„ â€œç¬¬ä¸€ä¸ªç‰ˆæœ¬â€ ä¸åŸå§‹çš„<code>draft.content</code>ã€‚</p>
<p><strong>é‚£æ€ä¹ˆé¿å…è¿™ä¸ªé—®é¢˜ï¼Ÿ</strong></p>
<p>æˆ‘å»ºè®®é¿å…æ‰‹åŠ¨å®ç° <code>shouldComponentUpdate</code> ï¼Œä¹Ÿè¦é¿å…åœ¨ <code>React.memo()</code> ä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„æ¯”è¾ƒæ–¹æ³•ã€‚<code>React.memo</code> ä¸­é»˜è®¤çš„æµ…æ¯”è¾ƒä¼šå“åº”å‡½æ•°æ ‡è¯†çš„æ›´æ–°ï¼š</p>
<pre data-line="11,"  11="" class="language-jsx"><code 11="" class="language-jsx">function Button({ onClick, color, children }) {
  const textColor = slowlyCalculateTextColor(this.props.color);
  return (
    &lt;button
      onClick={onClick}
      className={'Button-' + color + ' Button-text-' + textColor}&gt;
      {children}
    &lt;/button&gt;
  );
}
export default React.memo(Button); // âœ… ä½¿ç”¨æµ…æ¯”è¾ƒ
</code></pre><p>åœ¨ç±»ä¸­ï¼Œ<code>PureComponent</code> ä¹Ÿæœ‰ç±»ä¼¼çš„è¡Œä¸º.</p>
<p>è¿™ç¡®ä¿äº†ä¼ é€’ä¸åŒçš„å‡½æ•°ä½œä¸º propï¼Œå§‹ç»ˆèƒ½æœ‰æ•ˆå·¥ä½œã€‚</p>
<p>å¦‚æœä½ åšæŒä½¿ç”¨è‡ªå®šä¹‰çš„æ¯”è¾ƒï¼Œ<strong>è¯·ç¡®ä¿ä¸è·³è¿‡å‡½æ•°ï¼š</strong></p>
<pre data-line="5,"  5="" class="language-jsx"><code 5="" class="language-jsx">  shouldComponentUpdate(prevProps) {
    // âœ… æ¯”è¾ƒ this.props.onClick
    return (
      this.props.color !== prevProps.color ||
      this.props.onClick !== prevProps.onClick
    );
  }
</code></pre><p>æ­£å¦‚ä¹‹å‰æåˆ°çš„ï¼Œåœ¨ç±»ç»„ä»¶ä¸­å¾ˆå®¹æ˜“é”™è¿‡è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºæ–¹æ³•æ ‡è¯†é€šå¸¸æ˜¯ç¨³å®šçš„ï¼ˆä½†å¹¶éæ€»æ˜¯å¦‚æ­¤â€”â€”è€Œè¿™å°±æ˜¯ debug å›°éš¾çš„åœ°æ–¹ï¼‰ã€‚æœ‰äº†Hooksï¼Œæƒ…å†µä¸åŒäº†ï¼š</p>
<ol>
<li>function åœ¨<em>æ¯ä¸ªæ¸²æŸ“</em>ä¸­éƒ½ä¸åŒï¼Œæ‰€ä»¥ä½ èƒ½<a href="https://github.com/facebook/react/issues/14972#issuecomment-468280039">é©¬ä¸Š</a>å‘ç°è¿™ä¸ªé—®é¢˜</li>
<li>é€šè¿‡ <code>useCallback</code> å’Œ <code>useContext</code>ï¼Œä½ èƒ½ <a href="https://reactjs.org/docs/hooks-faq.html#how-to-avoid-passing-callbacks-down">é¿å…å¾€ä¸‹ä¼ é€’å‡½æ•°</a>ã€‚è¿™è®©ä½ ä¼˜åŒ–æ¸²æŸ“æ—¶ä¸ç”¨å¤ªæ‹…å¿ƒå‡½æ•°çš„é—®é¢˜ã€‚</li>
</ol>
<hr>
<p>æ€»ç»“ä¸€ä¸‹è¿™éƒ¨åˆ†ï¼Œ<strong>ä¸è¦é˜»æ–­æ•°æ®æµï¼</strong></p>
<p>æ— è®ºä½•æ—¶ä½¿ç”¨ props å’Œ stateï¼Œè¯·è€ƒè™‘å¦‚æœå®ƒä»¬å‘ç”Ÿå˜åŒ–ä¼šå‘ç”Ÿä»€ä¹ˆã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç»„ä»¶ä¸åº”ä»¥ä¸åŒæ–¹å¼å¤„ç†åˆå§‹æ¸²æŸ“å’Œæ›´æ–°æµç¨‹ã€‚è¿™ä½¿å®ƒèƒ½å¤Ÿé€‚åº”é€»è¾‘ä¸Šçš„å˜åŒ–ã€‚</p>
<p>å¯¹äºç±»ï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­ä½¿ç”¨ props å’Œ state æ—¶å¾ˆå®¹æ˜“å¿˜è®°æ›´æ–°ã€‚Hooks æ¨åŠ¨ä½ åšæ­£ç¡®çš„äº‹æƒ…â€”â€”ä½†æ˜¯å¦‚æœä½ ä¸ä¹ æƒ¯äºè¿™æ ·åšï¼Œå®ƒä¼šéœ€è¦ä¸€äº›å¿ƒç†è°ƒæ•´ã€‚</p>
<hr>
<h2>åŸåˆ™ 2ï¼šæ—¶åˆ»å‡†å¤‡æ¸²æŸ“</h2>
<p>React ç»„ä»¶ä½¿ä½ å¯ä»¥ä¸ç”¨èŠ±å¤ªé•¿æ—¶é—´å°±èƒ½ç¼–å†™æ¸²æŸ“ä»£ç ã€‚ä½ æè¿°äº†åœ¨ä»»ä½•æ—¶åˆ» UI <em>åº”è¯¥</em> å¦‚ä½•ï¼Œæ¥ç€ React å»å®Œæˆã€‚å¥½å¥½åˆ©ç”¨é‚£ä¸ªæ¨¡å‹ï¼</p>
<p>ä¸è¦è¯•å›¾åœ¨ç»„ä»¶è¡Œä¸ºä¸­ï¼Œå‡è®¾ä»»ä½•ä¸å¿…è¦çš„æ—¶åºä¿¡æ¯ã€‚<strong>ä½ çš„ç»„ä»¶åº”è¯¥éšæ—¶å¯ä»¥é‡æ–°æ¸²æŸ“ã€‚</strong></p>
<p>è¿èƒŒè¿™ä¸ªåŸåˆ™çš„æ–¹å¼æ˜¯ä»€ä¹ˆæ ·çš„ï¼ŸReact è®©è¿™æ²¡é‚£ä¹ˆå®¹æ˜“å‘ç”Ÿâ€”â€”ä½†ä½ å¯ä»¥ä½¿ç”¨ä¼ ç»Ÿçš„<code>componentWillReceiveProps</code> ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ¥å®ç°å®ƒï¼š</p>
<pre data-line="5-8,"  5-8="" class="language-jsx"><code 5-8="" class="language-jsx">class TextInput extends React.Component {
  state = {
    value: ''
  };
  // ğŸ”´ æ¯æ¬¡çˆ¶èŠ‚ç‚¹æ¸²æŸ“æ—¶é‡ç½®æœ¬åœ°çŠ¶æ€
  componentWillReceiveProps(nextProps) {
    this.setState({ value: nextProps.value });
  }
  handleChange = (e) =&gt; {
    this.setState({ value: e.target.value });
  };
  render() {
    return (
      &lt;input
        value={this.state.value}
        onChange={this.handleChange}
      /&gt;
    );
  }
}
</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°† <code>value</code> æ”¾åœ¨ state é‡Œï¼Œä½†æˆ‘ä»¬ <em>ä¹Ÿ</em> ä» props æ¥æ”¶ <code>value</code>ã€‚æ¯å½“æˆ‘ä»¬ â€œæ¥æ”¶æ–° propsâ€ æ—¶ï¼Œå°±ä¼šé‡ç½®çŠ¶æ€ä¸­çš„ <code>value</code>ã€‚</p>
<p><strong>è¿™ç§æ¨¡å¼çš„é—®é¢˜åœ¨äºå®ƒå®Œå…¨ä¾èµ–äºå¶ç„¶çš„æ—¶é—´ã€‚</strong></p>
<p>ä¹Ÿè®¸ä»Šå¤©è¿™ä¸ªç»„ä»¶çš„çˆ¶çº§å¾ˆå°‘æ›´æ–°ï¼Œæˆ‘ä»¬çš„ <code>TextInput</code> ä»…åœ¨é‡è¦äº‹ä»¶å‘ç”Ÿæ—¶ â€œæ¥æ”¶ propsâ€ï¼Œæ¯”å¦‚ä¿å­˜è¡¨å•ã€‚</p>
<p>ä½†æ˜å¤©ä½ å¯èƒ½ä¼šå‘ <code>TextInput</code> çš„çˆ¶ç»„ä»¶åŠ ä¸€äº›åŠ¨ç”»ã€‚å¦‚æœçˆ¶ç»„ä»¶ç»å¸¸é‡æ¸²æŸ“ï¼Œå®ƒå°† <a href="https://codesandbox.io/s/m3w9zn1z8x">â€œæ±¡æŸ“â€</a> å­ç»„ä»¶çš„çŠ¶æ€ï¼ä½ å¯ä»¥åœ¨ <a href="https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html">â€œä½ å¯èƒ½ä¸éœ€è¦æ´¾ç”ŸçŠ¶æ€â€</a> ä¸­é˜…è¯»æœ‰å…³æ­¤é—®é¢˜çš„æ›´å¤šä¿¡æ¯ã€‚</p>
<p><strong>æ‰€ä»¥è¯¥æ€ä¹ˆä¿®å¤å‘¢ï¼Ÿ</strong></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¾—è°ƒæ•´ä¸€ä¸‹å¿ƒç†ï¼Œéœ€è¦åœæ­¢å°† â€œæ¥æ”¶ propsâ€ è§†ä¸ºä¸ â€œæ¸²æŸ“â€ ä¸åŒçš„ä¸œè¥¿ã€‚ ç”±çˆ¶ç»„ä»¶å¼•èµ·çš„é‡æ¸²æŸ“ä¸åº”ä¸ç”±æœ¬åœ°çŠ¶æ€æ›´æ”¹å¼•èµ·çš„é‡æ¸²æŸ“ä¸åŒã€‚<strong>ç»„ä»¶åº”è¯¥å…·æœ‰å¼¹æ€§ï¼Œèƒ½é€‚åº”æ›´å°‘æˆ–æ›´é¢‘ç¹åœ°æ¸²æŸ“ï¼Œå¦åˆ™å®ƒä»¬ä¸ç‰¹å®šçˆ¶ç»„ä»¶å­˜åœ¨è¿‡å¤šè€¦åˆã€‚</strong></p>
<p><em>(<a href="https://codesandbox.io/s/m3w9zn1z8x">è¿™ä¸ª demo</a> ç»™æˆ‘ä»¬å±•ç¤ºäº†é‡æ¸²æŸ“ä¼šå¦‚ä½•æ¯åè„†å¼±çš„ç»„ä»¶)</em></p>
<p>å½“ä½ çœŸæ­£æƒ³ä» props æ´¾ç”Ÿ state æ—¶ï¼Œå°½ç®¡æœ‰ä¸€äº›<a href="https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#preferred-solutions">ä¸åŒ</a>çš„<a href="https://reactjs.org/docs/hooks-faq.html#how-do-i-implement-getderivedstatefromprops">è§£å†³æ–¹æ¡ˆ</a>ï¼Œé€šå¸¸ä½ åº”è¯¥ä½¿ç”¨ä¸€ä¸ªå®Œå…¨å—æ§åˆ¶çš„ç»„ä»¶ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">// Option 1: Fully controlled component.
function TextInput({ value, onChange }) {
  return (
    &lt;input
      value={value}
      onChange={onChange}
    /&gt;
  );
}
</code></pre><p>æˆ–è€…ä½¿ç”¨ä¸€ä¸ªä¸å—æ§çš„ç»„ä»¶ï¼ŒåŠ ä¸Š key æ¥é‡ç½®å®ƒï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">// Option 2: Fully uncontrolled component.
function TextInput() {
  const [value, setValue] = useState('');
  return (
    &lt;input
      value={value}
      onChange={e =&gt; setValue(e.target.value)}
    /&gt;
  );
}

// ä¹‹åæˆ‘ä»¬èƒ½é€šè¿‡æ›´æ”¹ key æ¥é‡ç½®å†…éƒ¨ stateï¼š
&lt;TextInput key={formId} /&gt;
</code></pre><p>æœ¬èŠ‚çš„å†…å®¹æ˜¯ï¼Œç»„ä»¶ä¸åº”è¯¥å› ä¸ºå®ƒæˆ–å…¶çˆ¶ç»„ä»¶é¢‘ç¹åœ°é‡æ¸²æŸ“è€Œåæ‰ã€‚å¦‚æœæƒ³é¿å…ä½¿ç”¨ä¼ ç»Ÿçš„ <code>componentWillReceiveProps</code> ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ŒReact API çš„è®¾è®¡ï¼Œå¯ä»¥è½»æ¾å®ç°è¿™ä¸ªç›®çš„ã€‚</p>
<p>è¦å¯¹ä½ çš„ç»„ä»¶è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œå¯ä»¥å°†è¿™æ®µä»£ç ä¸´æ—¶æ·»åŠ åˆ°å®ƒçš„çˆ¶ç»„ä»¶ï¼š</p>
<pre data-line="2,"  2="" class="language-js"><code 2="" class="language-js">componentDidMount() {
  // ä¹‹ååˆ«å¿˜äº†åˆ é™¤è¿™è¡Œï¼
  setInterval(() =&gt; this.forceUpdate(), 100);
}
</code></pre><p><strong>å¯åˆ«æŠŠè¿™æ®µä»£ç ä¿ç•™åœ¨é¡¹ç›®é‡Œ</strong>â€”â€”è¿™åªæ˜¯ç”¨æ¥æ£€æŸ¥çˆ¶ç»„ä»¶é‡æ¸²æŸ“çš„é¢‘ç‡è¶…å‡ºé¢„æœŸæ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆçš„å¿«é€Ÿæ–¹æ³•ã€‚å®ƒä¸åº”è¯¥æŸåå­ç»„ä»¶ï¼</p>
<hr>
<p>ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œé‚£æˆ‘åœ¨ props æ”¹å˜æ—¶é‡ç½® stateï¼Œå†ä½¿ç”¨ <code>PureComponent</code> æ¥é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“â€ã€‚</p>
<p>è¿™æ®µä»£ç åº”è¯¥èƒ½å·¥ä½œï¼Œå¯¹å§ï¼Ÿ</p>
<pre data-line="1-2,"  1-2="" class="language-jsx"><code 1-2="" class="language-jsx">// ğŸ¤” åº”è¯¥é˜»æ­¢ä¸å¿…è¦çš„é‡æ¸²æŸ“... å¯¹å§?
class TextInput extends React.PureComponent {
  state = {
    value: ''
  };
  // ğŸ”´ åœ¨çˆ¶ç»„ä»¶æ›´æ–°æ—¶é‡ç½®æœ¬åœ° state
  componentWillReceiveProps(nextProps) {
    this.setState({ value: nextProps.value });
  }
  handleChange = (e) =&gt; {
    this.setState({ value: e.target.value });
  };
  render() {
    return (
      &lt;input
        value={this.state.value}
        onChange={this.handleChange}
      /&gt;
    );
  }
}
</code></pre><p>ä¹ä¸€çœ‹ï¼Œè¿™ä¸ªç»„ä»¶ä¼¼ä¹è§£å†³äº†çˆ¶çº§é‡æ¸²æŸ“æ—¶ â€œæ±¡æŸ“â€ state çš„é—®é¢˜ã€‚æ¯•ç«Ÿï¼Œå¦‚æœ props æ˜¯ç›¸åŒçš„ï¼Œæˆ‘ä»¬ä¼šè·³è¿‡æ›´æ–°â€”â€”æ‰€ä»¥ <code>componentWillReceiveProps</code> ä¸ä¼šè¢«è°ƒç”¨ã€‚</p>
<p>ä½†æ˜¯è¿™éƒ½æ˜¯å¹»è§‰ã€‚**è¿™ä¸ªç»„ä»¶å¯¹_å®é™…_çš„ prop æ›´æ”¹ä»ç„¶ä¸å…·å¤‡å¼¹æ€§ã€‚**ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æ·»åŠ <em>å¦ä¸€ä¸ª</em>ç»å¸¸å˜åŒ–çš„ propï¼Œå°±åƒç”¨æ¥åšåŠ¨ç”»çš„ <code>style</code>ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¼š â€œä¸¢å¤±â€ å†…éƒ¨çŠ¶æ€ï¼š</p>
<pre data-line="2,"  2="" class="language-jsx"><code 2="" class="language-jsx">&lt;TextInput
  style={{opacity: someValueFromState}}
  value={
    // ğŸ”´ componentWillReceiveProps in TextInput
    // resets to this value on every animation tick.
    value
  }
/&gt;
</code></pre><p>æ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä»ç„¶å­˜åœ¨ç¼ºé™·ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å„ç§ä¼˜åŒ–ï¼Œä¾‹å¦‚ <code>PureComponent</code>ã€<code>shouldComponentUpdate</code> å’Œ <code>React.memo</code>ï¼Œå®ƒä»¬ä¸åº”è¯¥ç”¨äºæ§åˆ¶<em>è¡Œä¸º</em>ã€‚åªæœ‰æé«˜<em>æ€§èƒ½</em>çš„åœºæ™¯ä¸‹ï¼Œå»ä½¿ç”¨å®ƒä»¬ã€‚å¦‚æœåˆ é™¤ä¼˜åŒ–å°±ä¼š_ç ´å_æŸä¸ªç»„ä»¶ï¼Œé‚£ä¹ˆå®ƒå°±å¤ªè„†å¼±äº†ã€‚</p>
<p>è¿™é‡Œçš„è§£å†³æ–¹æ¡ˆå’Œä¹‹å‰æåˆ°çš„ä¸€æ ·ã€‚ä¸è¦å°† â€œæ¥å— propsâ€ è§†ä½œç‰¹æ®Šçš„äº‹ä»¶ã€‚é¿å… â€œåŒæ­¥â€ props å’Œ stateã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå€¼éƒ½åº”è¯¥æ˜¯å®Œå…¨æ§åˆ¶çš„ï¼ˆé€šè¿‡ propsï¼‰ï¼Œæˆ–è€…å®Œå…¨ä¸å—æ§åˆ¶çš„ï¼ˆåœ¨æœ¬åœ° state é‡Œï¼‰ã€‚å¯ä»¥çš„è¯ï¼Œé¿å…<a href="https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#preferred-solutions">æ´¾ç”Ÿ state</a>ã€‚<strong>å½“ç„¶ï¼Œæ—¶åˆ»å‡†å¤‡æ¸²æŸ“ï¼</strong></p>
<hr>
<h2>åŸåˆ™ 3ï¼šæ²¡æœ‰å•ä¾‹ç»„ä»¶</h2>
<p>æœ‰æ—¶æˆ‘ä»¬å‡è®¾æŸä¸ªç»„ä»¶åªä¼šæ˜¾ç¤ºä¸€æ¬¡ï¼Œå¦‚å¯¼èˆªæ ã€‚åœ¨ä¸€æ®µæ—¶é—´å†…è¿™ä¹Ÿè®¸æ˜¯å¯¹çš„ï¼Œç„¶è€Œï¼Œè¿™ç§å‡è®¾å¯¼è‡´çš„è®¾è®¡é—®é¢˜ï¼Œå¸¸å¸¸ä¼šåœ¨åæœŸæ˜¾ç°ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä½ å¯èƒ½éœ€è¦åœ¨è·¯ç”±å˜åŒ–åï¼Œä¸¤ä¸ª <code>Page</code> ç»„ä»¶åˆ‡æ¢<em>é—´</em>å®ç°åŠ¨ç”»â€”â€”å‰ä¸€ä¸ª <code>Page</code> å’Œä¸‹ä¸€ä¸ª <code>Page</code>ã€‚å®ƒä»¬éƒ½éœ€è¦åœ¨åŠ¨ç”»æœŸé—´è¢«åŠ è½½ã€‚ä½†æ˜¯ï¼Œä½ å¯èƒ½ä¼šå‘ç°ï¼Œæ¯ä¸ªç»„ä»¶éƒ½å‡å®šå®ƒæ˜¯å±å¹•ä¸Šå”¯ä¸€çš„ <code>Page</code>ã€‚</p>
<p>è¦é‡ç°è¿™ç±»é—®é¢˜ä¹Ÿå¾ˆå®¹æ˜“ï¼Œè¯•è¯•æ¸²æŸ“ä½ çš„åº”ç”¨ä¸¤æ¬¡ï¼š</p>
<pre data-line="3,4,"  3,4="" class="language-jsx"><code 3,4="" class="language-jsx">ReactDOM.render(
  &lt;&gt;
    &lt;MyApp /&gt;
    &lt;MyApp /&gt;
  &lt;/&gt;,
  document.getElementById('root')
);
</code></pre><p>åˆ°å¤„ç‚¹å‡»çœ‹çœ‹ã€‚ï¼ˆä½ å¯èƒ½éœ€è¦ä¸ºè¿™ä¸ªå®éªŒè°ƒæ•´ä¸€äº› CSS æ ·å¼ï¼‰</p>
<p>**ä½ çš„åº”ç”¨ä»ç„¶æ­£å¸¸è¿è¡Œå—ï¼Ÿ**æˆ–è€…ä½ æ˜¯å¦çœ‹åˆ°å¥‡æ€ªçš„å´©æºƒå’Œé”™è¯¯ï¼Ÿå¶å°”å¯¹å¤æ‚ç»„ä»¶è¿›è¡Œå‹åŠ›æµ‹è¯•æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œå¯ä»¥ç¡®ä¿ç»„ä»¶å­˜åœ¨å¤šä¸ªæ‹·è´æ—¶ä¸ä¼šç›¸äº’å†²çªã€‚</p>
<p>æˆ‘è‡ªå·±å†™è¿‡å‡ æ¬¡æœ‰é—®é¢˜çš„ä»£ç ï¼Œä¾‹å¦‚åœ¨ <code>componentWillUnmount</code> ä¸­æ‰§è¡Œå…¨å±€çŠ¶æ€ â€œæ¸…ç†â€ï¼š</p>
<pre data-line="2-3,"  2-3="" class="language-jsx"><code 2-3="" class="language-jsx">componentWillUnmount() {
  // é‡ç½® Redux store é‡Œçš„ä¸€äº›ä¸œè¥¿
  this.props.resetForm();
}
</code></pre><p>å½“ç„¶ï¼Œå¦‚æœé¡µé¢ä¸Šæœ‰ä¸¤ä¸ªè¿™æ ·çš„ç»„ä»¶ï¼Œå¸è½½å…¶ä¸­ä¸€ä¸ªç»„ä»¶å¯èƒ½ä¼šç ´åå¦ä¸€ä¸ªç»„ä»¶ã€‚åœ¨ <em>mount</em> åé‡ç½® â€œå…¨å±€â€ çŠ¶æ€ä¹Ÿä¸å¥½ï¼š</p>
<pre data-line="2-3,"  2-3="" class="language-jsx"><code 2-3="" class="language-jsx">componentDidMount() {
  // é‡ç½® Redux store é‡Œçš„ä¸€äº›ä¸œè¥¿
  this.props.resetForm();
}
</code></pre><p>åœ¨è¿™æƒ…å†µä¸‹ï¼Œ <em>æŒ‚è½½</em> ç¬¬äºŒä¸ª form å°±ä¼šç ´åå‰ä¸€ä¸ªã€‚</p>
<p>è¿™äº›æ¨¡å¼æ˜¯æ£€æµ‹ç»„ä»¶æ˜¯å¦è„†å¼±çš„å¥½æŒ‡æ ‡ã€‚<strong><em>æ˜¾ç¤º</em> æˆ– <em>éšè—</em> ä¸€é¢—æ ‘ï¼Œä¸åº”è¯¥ç ´åæ ‘ä¹‹å¤–çš„ç»„ä»¶ã€‚</strong></p>
<p>æ— è®ºä½ æ˜¯å¦æœ‰è®¡åˆ’å°†è¿™ä¸ªç»„ä»¶æ¸²æŸ“ä¸¤æ¬¡ï¼Œä»é•¿è¿œæ¥çœ‹ï¼Œè§£å†³è¿™äº›é—®é¢˜æ˜¯å€¼å¾—çš„ã€‚å®ƒå°†å¼•å¯¼ä½ è¿›è¡Œæ›´å…·å¼¹æ€§çš„è®¾è®¡ã€‚</p>
<hr>
<h2>åŸåˆ™ 4ï¼šéš”ç¦»æœ¬åœ°çŠ¶æ€</h2>
<p>å‡è®¾æœ‰ä¸€ä¸ª <code>POST</code> ç¤¾äº¤ç»„ä»¶ï¼Œå®ƒæœ‰ä¸€ä¸ª <code>Comment</code> åˆ—è¡¨ï¼ˆå¯æ‰©å±•ï¼‰å’Œä¸€ä¸ª <code>NewComment</code> è¾“å…¥æ¡†ã€‚</p>
<p>React ç»„ä»¶å¯èƒ½æœ‰æœ¬åœ°çŠ¶æ€ã€‚ä½†æ˜¯å“ªä¸ªçŠ¶æ€çœŸçš„æ˜¯è‡ªå·±çš„å‘¢ï¼Ÿå¸–å­å†…å®¹æœ¬èº«æ˜¯å¦ä¸ºæœ¬åœ°çŠ¶æ€ï¼Ÿè¯„è®ºåˆ—è¡¨å‘¢ï¼Ÿæˆ–è€…è¯„è®ºæµçš„è®°å½•ï¼Ÿæˆ–è¯„è®ºæ¡†é‡Œè¾“å…¥çš„å€¼ï¼Ÿ</p>
<p>å¦‚æœä½ ä¹ æƒ¯äºå°†æ‰€æœ‰å†…å®¹éƒ½æ”¾å…¥ â€œçŠ¶æ€ç®¡ç†â€ï¼Œé‚£ä¹ˆå¯èƒ½å¾ˆéš¾å›ç­”è¿™ä¸ªé—®é¢˜ã€‚æ‰€ä»¥è¿™æœ‰ä¸€ä¸ªç®€å•çš„å†³å®šæ–¹å¼ã€‚</p>
<p><strong>å¦‚æœä½ ä¸ç¡®å®šæŸä¸ªçŠ¶æ€æ˜¯å¦å±äºæœ¬åœ°ï¼Œè¯·é—®è‡ªå·±ï¼šâ€œå¦‚æœæ­¤ç»„ä»¶å‘ˆç°ä¸¤æ¬¡ï¼Œäº¤äº’æ˜¯å¦åº”åæ˜ åœ¨å¦ä¸€ä¸ªå‰¯æœ¬ä¸­ï¼Ÿâ€ åªè¦ç­”æ¡ˆä¸ºâ€œå¦â€ï¼Œé‚£ä½ å°±æ‰¾åˆ°æœ¬åœ°çŠ¶æ€äº†ã€‚</strong></p>
<p>For example, imagine we rendered the same <code>Post</code> twice. Letâ€™s look at different things inside of it that can change.<br>
ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬ä¸¤æ¬¡æ¸²æŸ“ç›¸åŒçš„ <code>Post</code>ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å“ªäº›å†…å®¹ä¼šæ›´æ–°ã€‚</p>
<ul>
<li>
<p><em>å‘å¸ƒå†…å®¹</em> ï¼šæˆ‘ä»¬å¸Œæœ›åœ¨ä¸€æ£µæ ‘ä¸­ç¼–è¾‘å¸–å­ï¼Œåœ¨å¦ä¸€æ£µæ ‘ä¸­ä¹Ÿæ›´æ–°ã€‚å› æ­¤ï¼Œå®ƒå¯èƒ½<strong>ä¸æ˜¯</strong> <code>Post</code> ç»„ä»¶çš„æœ¬åœ°çŠ¶æ€ã€‚ï¼ˆç›¸åï¼Œå¸–å­å†…å®¹å¯èƒ½å­˜åœ¨äº Apolloã€Relay æˆ– Reduxç­‰ç¼“å­˜ä¸­ï¼‰</p>
</li>
<li>
<p><em>è¯„è®ºåˆ—è¡¨</em> ï¼šè¿™ä¸å¸–å­å†…å®¹ç±»ä¼¼ã€‚æˆ‘ä»¬å¸Œæœ›åœ¨ä¸€æ£µæ ‘ä¸­æ·»åŠ ä¸€æ¡æ–°æ³¨é‡Šï¼Œä»¥åæ˜ åœ¨å¦ä¸€æ£µæ ‘ä¸­ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šä¸ºå®ƒä½¿ç”¨æŸç§ç¼“å­˜ï¼Œè€Œ <strong>ä¸åº”è¯¥æ˜¯</strong> æˆ‘ä»¬ <code>Post</code> çš„æœ¬åœ°çŠ¶æ€ã€‚</p>
</li>
<li>
<p><em>è¢«å±•å¼€çš„è¯„è®º</em>ï¼šå¦‚æœåœ¨ä¸€æ£µæ ‘ä¸­å±•å¼€è¯„è®ºä¹Ÿä¼šåœ¨å¦ä¸€æ£µæ ‘ä¸­å±•å¼€ï¼Œè¿™æœ‰ç‚¹å¥‡æ€ªã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ç‰¹å®šçš„ <code>Comment</code> <em>UI å…ƒç´ </em> è¿›è¡Œäº¤äº’ï¼Œè€Œä¸æ˜¯æŠ½è±¡çš„ â€œè¯„è®ºå®ä½“â€ã€‚å› æ­¤ï¼Œâ€œæ˜¯å¦å·²å±•å¼€â€ <strong>åº”è¯¥</strong> æ˜¯ <code>Comment</code> çš„æœ¬åœ°çŠ¶æ€ã€‚</p>
</li>
<li>
<p><em>è¾“å…¥çš„æ–°è¯„è®ºçš„å€¼</em>ï¼šå¦‚æœåœ¨ä¸€ä¸ªè¾“å…¥æ¡†ä¸­è¾“å…¥è¯„è®ºï¼Œä¹Ÿä¼šæ›´æ–°åˆ°å¦ä¸€ä¸ªæ ‘ä¸­çš„è¾“å…¥æ¡†ï¼Œè¿™ä¹Ÿæœ‰ç‚¹å¥‡æ€ªã€‚é™¤éè¾“å…¥æ¡†æ˜ç¡®åœ°ç»„åˆåœ¨ä¸€èµ·ï¼Œå¦åˆ™é€šå¸¸äººä»¬æœŸæœ›å®ƒä»¬æ˜¯ç‹¬ç«‹çš„ã€‚æ‰€ä»¥è¾“å…¥å€¼ <strong>åº”è¯¥</strong> æ˜¯ <code>NewComment</code> ç»„ä»¶çš„æœ¬åœ°çŠ¶æ€ã€‚</p>
</li>
</ul>
<p>æˆ‘ä¸å»ºè®®å¯¹è¿™äº›è§„åˆ™è¿›è¡Œæ•™æ¡å¼çš„è§£é‡Šã€‚å½“ç„¶ï¼Œåœ¨ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºä¸­ï¼Œä½ å¯èƒ½å¸Œæœ›ä½¿ç”¨æœ¬åœ°çŠ¶æ€æ¥å¤„ç†æ‰€æœ‰äº‹æƒ…ï¼ŒåŒ…æ‹¬ â€œç¼“å­˜â€ã€‚æˆ‘åªæ˜¯è°ˆè®ºåœ¨<a href="/the-elements-of-ui-engineering/">ç¬¬ä¸€åŸåˆ™</a>ä¸‹ï¼Œç†æƒ³çŠ¶æ€çš„ç”¨æˆ·ä½“éªŒã€‚</p>
<p><strong>åˆ«æŠŠè¯¥æœ¬åœ°çš„çŠ¶æ€å…¨å±€åŒ–äº†</strong> è¿™æ¶‰åŠåˆ°æˆ‘ä»¬çš„ â€œå¼¹æ€§â€ ä¸»é¢˜ï¼šç»„ä»¶ä¹‹é—´å‘ç”Ÿçš„æ„å¤–åŒæ­¥æ›´å°‘ã€‚ä½œä¸ºå¥–åŠ±ï¼Œè¿™<em>ä¹Ÿ</em>ä¿®å¤äº†ä¸€å¤§ç±»æ€§èƒ½é—®é¢˜ã€‚å½“ä½ çš„ state åœ¨æ­£ç¡®çš„åœ°æ–¹æ—¶ï¼Œâ€œè¿‡åº¦æ¸²æŸ“â€ éƒ½ä¸æˆé—®é¢˜äº†ã€‚</p>
<hr>
<h2>å›é¡¾</h2>
<p>è®©æˆ‘ä»¬å†ä¸€æ¬¡å›é¡¾ä¸€ä¸‹è¿™äº›åŸåˆ™ï¼š</p>
<ol>
<li><strong><a href="#%E5%8E%9F%E5%88%99-1%EF%BC%9A%E4%B8%8D%E9%98%BB%E6%96%AD%E6%95%B0%E6%8D%AE%E6%B5%81">ä¸é˜»æ–­æ•°æ®æµ</a></strong> props å’Œ state å¯èƒ½ä¼šæ›´æ–°ï¼Œç»„ä»¶åº”è¯¥å¤„ç†å¥½è¿™äº›æ›´æ–°ï¼Œä¸è®ºä»€ä¹ˆæ—¶å€™ã€‚</li>
<li><strong><a href="#%E5%8E%9F%E5%88%99-2%EF%BC%9A%E6%97%B6%E5%88%BB%E5%87%86%E5%A4%87%E6%B8%B2%E6%9F%93">æ—¶åˆ»å‡†å¤‡æ¸²æŸ“</a></strong> ä¸€ä¸ªç»„ä»¶ä¸åº”è¯¥è¢«æˆ–å¤šæˆ–å°‘çš„æ¸²æŸ“è€ŒæŸåã€‚</li>
<li><strong><a href="#%E5%8E%9F%E5%88%99-3%EF%BC%9A%E6%B2%A1%E6%9C%89%E5%8D%95%E4%BE%8B%E7%BB%84%E4%BB%B6">æ²¡æœ‰å•ä¾‹ç»„ä»¶</a></strong> å³ä½¿ç»„ä»¶åªæ¸²æŸ“ä¸€æ¬¡ï¼Œä½†é€šè¿‡è®¾è®¡è®©å®ƒæ¸²æŸ“ä¸¤æ¬¡ä¹Ÿä¸ä¼šè¢«ç ´åï¼Œæ˜¯æ›´å¥½äº†ã€‚</li>
<li><strong><a href="#%E5%8E%9F%E5%88%99-4%EF%BC%9A%E9%9A%94%E7%A6%BB%E6%9C%AC%E5%9C%B0%E7%8A%B6%E6%80%81">éš”ç¦»æœ¬åœ°çŠ¶æ€</a></strong> æƒ³æƒ³å“ªä¸ªçŠ¶æ€æ˜¯ç‰¹å®š UI å±•ç¤ºä¸‹çš„æœ¬åœ°çŠ¶æ€â€”â€”å¹¶ä¸”é™¤éå¿…è¦ï¼Œä¸è¦å°†è¯¥çŠ¶æ€æå‡åˆ°æ›´é«˜çš„åœ°æ–¹ã€‚</li>
</ol>
<p><strong>è¿™äº›åŸåˆ™èƒ½å¸®åŠ©ä½ ç¼–å†™<a href="/optimized-for-change/">é’ˆå¯¹æ›´æ–°è€Œä¼˜åŒ–</a>çš„ç»„ä»¶ã€‚è¿™è®©æ·»åŠ ï¼Œæ›´æ”¹å’Œåˆ é™¤é‚£äº›ç»„ä»¶æ›´å®¹æ˜“ã€‚</strong></p>
<p>é‡è¦çš„æ˜¯ï¼Œä¸€æ—¦æˆ‘ä»¬çš„ç»„ä»¶å…·æœ‰äº†å¼¹æ€§ï¼Œé‚£å°±å¯ä»¥å†å›è¿‡å¤´ï¼Œåˆ°æ˜¯å¦åº”æŒ‰å­—æ¯æ’åºçš„ç´§è¿«å›°å¢ƒä¸­å»äº†ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Writing Resilient Components]]></title>
            <link>/post/writing-resilient-components</link>
            <guid>/post/writing-resilient-components</guid>
            <description><![CDATA[Four principles to set you on the right path.]]></description>
            <content:encoded><![CDATA[<p>When people start learning React, they often ask for a style guide. While itâ€™s a good idea to have some consistent rules applied across a project, a lot of them are arbitrary â€” and so React doesnâ€™t have a strong opinion about them.</p>
<p>You can use different type systems, prefer function declarations or arrow functions, sort your props in alphabetical order or in an order you find pleasing.</p>
<p>This flexibility allows <a href="https://reactjs.org/docs/add-react-to-a-website.html">integrating React</a> into projects with existing conventions. But it also invites endless debates.</p>
<p><strong>There <em>are</em> important design principles that every component should strive to follow. But I donâ€™t think style guides capture those principles well. Weâ€™ll talk about style guides first, and then <a href="#writing-resilient-components">look at the principles that really <em>are</em> useful</a>.</strong></p>
<hr>
<h2>Donâ€™t Get Distracted by Imaginary Problems</h2>
<p>Before we talk about component design principles, I want to say a few words about style guides. This isnâ€™t a popular opinion but someone needs to say it!</p>
<p>In the JavaScript community, there are a few strict opinionated style guides enforced by a linter. My personal observation is that they tend to create more friction than theyâ€™re worth. I canâ€™t count how many times somebody showed me some absolutely valid code and said â€œReact complains about thisâ€, but it was their lint config complaining! This leads to three issues:</p>
<ul>
<li>
<p>People get used to seeing the linter as an <strong>overzealous noisy gatekeeper</strong> rather than a helpful tool. Useful warnings are drowned out by a sea of style nits. As a result, people donâ€™t scan the linter messages while debugging, and miss helpful tips. Additionally, people who are less used to writing JavaScript (for example, designers) have a harder time working with the code.</p>
</li>
<li>
<p>People donâ€™t learn to <strong>differentiate between valid and invalid uses</strong> of a certain pattern. For example, there is a popular rule that forbids calling <code>setState</code> inside <code>componentDidMount</code>. But if it was always â€œbadâ€, React simply wouldnâ€™t allow it! There is a legitimate use case for it, and that is to measure the DOM node layout â€” e.g. to position a tooltip. Iâ€™ve seen people â€œwork aroundâ€ this rule by adding a <code>setTimeout</code> which completely misses the point.</p>
</li>
<li>
<p>Eventually, people adopt the â€œenforcer mindsetâ€ and get opinionated about things that <strong>donâ€™t bring a meaningful difference</strong> but are easy to scan for in the code. â€œYou used a function declaration, but <em>our</em> project uses arrow functions.â€ Whenever I have a strong feeling about enforcing a rule like this, looking deeper reveals that I invested emotional effort into this rule â€” and struggle to let it go. It lulls me into a false sense of accomplishment without improving my code.</p>
</li>
</ul>
<p>Am I saying that we should stop linting? Not at all!</p>
<p><strong>With a good config, a linter is a great tool to catch bugs before they happen.</strong> Itâ€™s focusing on the <em>style</em> too much that turns it into a distraction.</p>
<hr>
<h2>Marie Kondo Your Lint Config</h2>
<p>Hereâ€™s what I suggest you to do on Monday. Gather your team for half an hour, go through every lint rule enabled in your projectâ€™s config, and ask yourself: <em>â€œHas this rule ever helped us catch a bug?â€</em> If not, <em>turn it off.</em> (You can also start from a clean slate with <a href="https://www.npmjs.com/package/eslint-config-react-app"><code>eslint-config-react-app</code></a> which has no styling rules.)</p>
<p>At the very least, your team should have a process for removing rules that cause friction. Donâ€™t assume that whatever you or something somebody else added to your lint config a year ago is a â€œbest practiceâ€. Question it and look for answers. Donâ€™t let anyone tell you youâ€™re not smart enough to pick your lint rules.</p>
<p><strong>But what about formatting?</strong> Use <a href="https://prettier.io/">Prettier</a> and forget about the â€œstyle nitsâ€. You donâ€™t need a tool to shout at you for putting an extra space if another tool can fix it for you. Use the linter to find <em>bugs</em>, not enforcing the <em>a e s t h e t i c s</em>.</p>
<p>Of course, there are aspects of the coding style that arenâ€™t directly related to formatting but can still be annoying when inconsistent across the project.</p>
<p>However, many of them are too subtle to catch with a lint rule anyway. This is why itâ€™s important to <strong>build trust</strong> between the team members, and to share useful learnings in the form of a wiki page or a short design guide.</p>
<p>Not everything is worth automating! The insights gained from <em>actually reading</em> the rationale in such a guide can be more valuable than following the â€œrulesâ€.</p>
<p><strong>But if following a strict style guide is a distraction, whatâ€™s actually important?</strong></p>
<p>Thatâ€™s the topic of this post.</p>
<hr>
<h2>Writing Resilient Components</h2>
<p>No amount of indentation or sorting imports alphabetically can fix a broken design. So instead of focusing on how some code <em>looks</em>, I will focus on how it <em>works</em>. Thereâ€™s a few component design principles that I find very helpful:</p>
<ol>
<li><strong><a href="#principle-1-dont-stop-the-data-flow">Donâ€™t stop the data flow</a></strong></li>
<li><strong><a href="#principle-2-always-be-ready-to-render">Always be ready to render</a></strong></li>
<li><strong><a href="#principle-3-no-component-is-a-singleton">No component is a singleton</a></strong></li>
<li><strong><a href="#principle-4-keep-the-local-state-isolated">Keep the local state isolated</a></strong></li>
</ol>
<p>Even if you donâ€™t use React, youâ€™ll likely discover the same principles by trial and error for any UI component model with unidirectional data flow.</p>
<hr>
<h2>Principle 1: Donâ€™t Stop the Data Flow</h2>
<h3>Donâ€™t Stop the Data Flow in Rendering</h3>
<p>When somebody uses your component, they expect that they can pass different props to it over time, and that the component will reflect those changes:</p>
<pre   class="language-jsx"><code class="language-jsx">// isOk might be driven by state and can change at any time
&lt;Button color={isOk ? 'blue' : 'red'} /&gt;
</code></pre><p>In general, this is how React works by default. If you use a <code>color</code> prop inside a <code>Button</code> component, youâ€™ll see the value provided from above for that render:</p>
<pre   class="language-jsx"><code class="language-jsx">function Button({ color, children }) {
  return (
    // âœ… `color` is always fresh!
    &lt;button className={'Button-' + color}&gt;
      {children}
    &lt;/button&gt;
  );
}
</code></pre><p>However, a common mistake when learning React is to copy props into state:</p>
<pre data-line="3,6,"  3,6="" class="language-jsx"><code 3,6="" class="language-jsx">class Button extends React.Component {
  state = {
    color: this.props.color
  };
  render() {
    const { color } = this.state; // ğŸ”´ `color` is stale!
    return (
      &lt;button className={'Button-' + color}&gt;
        {this.props.children}
      &lt;/button&gt;
    );
  }
}
</code></pre><p>This might seem more intuitive at first if you used classes outside of React. <strong>However, by copying a prop into state youâ€™re ignoring all updates to it.</strong></p>
<pre   class="language-jsx"><code class="language-jsx">// ğŸ”´ No longer works for updates with the above implementation
&lt;Button color={isOk ? 'blue' : 'red'} /&gt;
</code></pre><p>In the rare case that this behavior <em>is</em> intentional, make sure to call that prop <code>initialColor</code> or <code>defaultColor</code> to clarify that changes to it are ignored.</p>
<p>But usually youâ€™ll want to <strong>read the props directly in your component</strong> and avoid copying props (or anything computed from the props) into state:</p>
<pre   class="language-jsx"><code class="language-jsx">function Button({ color, children }) {
  return (
    // âœ… `color` is always fresh!
    &lt;button className={'Button-' + color}&gt;
      {children}
    &lt;/button&gt;
  );
}
</code></pre><hr>
<p>Computed values are another reason people sometimes attempt to copy props into state. For example, imagine that we determined the <em>button text</em> color based on an expensive computation with background <code>color</code> as an argument:</p>
<pre data-line="3,9,"  3,9="" class="language-jsx"><code 3,9="" class="language-jsx">class Button extends React.Component {
  state = {
    textColor: slowlyCalculateTextColor(this.props.color)
  };
  render() {
    return (
      &lt;button className={
        'Button-' + this.props.color +
        ' Button-text-' + this.state.textColor // ğŸ”´ Stale on `color` prop updates
      }&gt;
        {this.props.children}
      &lt;/button&gt;
    );
  }
}
</code></pre><p>This component is buggy because it doesnâ€™t recalculate <code>this.state.textColor</code> on the <code>color</code> prop change. The easiest fix would be to move the <code>textColor</code> calculation into the <code>render</code> method, and make this a <code>PureComponent</code>:</p>
<pre data-line="1,3,"  1,3="" class="language-jsx"><code 1,3="" class="language-jsx">class Button extends React.PureComponent {
  render() {
    const textColor = slowlyCalculateTextColor(this.props.color);
    return (
      &lt;button className={
        'Button-' + this.props.color +
        ' Button-text-' + textColor // âœ… Always fresh
      }&gt;
        {this.props.children}
      &lt;/button&gt;
    );
  }
}
</code></pre><p>Problem solved! Now if props change, we'll recalculate <code>textColor</code>, but we avoid the expensive computation on the same props.</p>
<p>However, we might want to optimize it further. What if itâ€™s the <code>children</code> prop that changed? It seems unfortunate to recalculate the <code>textColor</code> in that case. Our second attempt might be to invoke the calculation in <code>componentDidUpdate</code>:</p>
<pre data-line="5-12,"  5-12="" class="language-jsx"><code 5-12="" class="language-jsx">class Button extends React.Component {
  state = {
    textColor: slowlyCalculateTextColor(this.props.color)
  };
  componentDidUpdate(prevProps) {
    if (prevProps.color !== this.props.color) {
      // ğŸ˜” Extra re-render for every update
      this.setState({
        textColor: slowlyCalculateTextColor(this.props.color),
      });
    }
  }
  render() {
    return (
      &lt;button className={
        'Button-' + this.props.color +
        ' Button-text-' + this.state.textColor // âœ… Fresh on final render
      }&gt;
        {this.props.children}
      &lt;/button&gt;
    );
  }
}
</code></pre><p>However, this would mean our component does a second re-render after every change. Thatâ€™s not ideal either if weâ€™re trying to optimize it.</p>
<p>You could use the legacy <code>componentWillReceiveProps</code> lifecycle for this. However, people often put side effects there too. That, in turn, often causes problems for the upcoming Concurrent Rendering <a href="https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html">features like Time Slicing and Suspense</a>. And the â€œsaferâ€ <code>getDerivedStateFromProps</code> method is clunky.</p>
<p>Letâ€™s step back for a second. Effectively, we want <a href="https://en.wikipedia.org/wiki/Memoization"><em>memoization</em></a>. We have some inputs, and we donâ€™t want to recalculate the output unless the inputs change.</p>
<p>With a class, you could use a <a href="https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#what-about-memoization">helper</a> for memoization. However, Hooks take this a step further, giving you a built-in way to memoize expensive computations:</p>
<pre data-line="2-5,"  2-5="" class="language-jsx"><code 2-5="" class="language-jsx">function Button({ color, children }) {
  const textColor = useMemo(
    () =&gt; slowlyCalculateTextColor(color),
    [color] // âœ… Donâ€™t recalculate until `color` changes
  );
  return (
    &lt;button className={'Button-' + color + ' Button-text-' + textColor}&gt;
      {children}
    &lt;/button&gt;
  );
}
</code></pre><p>Thatâ€™s all the code you need!</p>
<p>In a class component, you can use a helper like <a href="https://github.com/alexreardon/memoize-one"><code>memoize-one</code></a> for that. In a function component, <code>useMemo</code> Hook gives you similar functionality.</p>
<p>Now we see that <strong>even optimizing expensive computations isnâ€™t a good reason to copy props into state.</strong> Our rendering result should respect changes to props.</p>
<hr>
<h3>Donâ€™t Stop the Data Flow in Side Effects</h3>
<p>So far, weâ€™ve talked about how to keep the rendering result consistent with prop changes. Avoiding copying props into state is a part of that. However, it is important that <strong>side effects (e.g. data fetching) are also a part of the data flow</strong>.</p>
<p>Consider this React component:</p>
<pre data-line="5-7,"  5-7="" class="language-jsx"><code 5-7="" class="language-jsx">class SearchResults extends React.Component {
  state = {
    data: null
  };
  componentDidMount() {
    this.fetchResults();
  }
  fetchResults() {
    const url = this.getFetchUrl();
    // Do the fetching...
  }
  getFetchUrl() {
    return 'http://myapi/results?query' + this.props.query;
  }
  render() {
    // ...
  }
}
</code></pre><p>A lot of React components are like this â€” but if we look a bit closer, we'll notice a bug. The <code>fetchResults</code> method uses the <code>query</code> prop for data fetching:</p>
<pre data-line="2,"  2="" class="language-jsx"><code 2="" class="language-jsx">  getFetchUrl() {
    return 'http://myapi/results?query' + this.props.query;
  }
</code></pre><p>But what if the <code>query</code> prop changes? In our component, nothing will happen. <strong>This means our componentâ€™s side effects donâ€™t respect changes to its props.</strong> This is a very common source of bugs in React applications.</p>
<p>In order to fix our component, we need to:</p>
<ul>
<li>Look at <code>componentDidMount</code> and every method called from it.
<ul>
<li>In our example, thatâ€™s <code>fetchResults</code> and <code>getFetchUrl</code>.</li>
</ul>
</li>
<li>Write down all props and state used by those methods.
<ul>
<li>In our example, thatâ€™s <code>this.props.query</code>.</li>
</ul>
</li>
<li>Make sure that whenever those props change, we re-run the side effect.
<ul>
<li>We can do this by adding the <code>componentDidUpdate</code> method.</li>
</ul>
</li>
</ul>
<pre data-line="8-12,18,"  8-12,18="" class="language-jsx"><code 8-12,18="" class="language-jsx">class SearchResults extends React.Component {
  state = {
    data: null
  };
  componentDidMount() {
    this.fetchResults();
  }
  componentDidUpdate(prevProps) {
    if (prevProps.query !== this.props.query) { // âœ… Refetch on change
      this.fetchResults();
    }
  }
  fetchResults() {
    const url = this.getFetchUrl();
    // Do the fetching...
  }
  getFetchUrl() {
    return 'http://myapi/results?query' + this.props.query; // âœ… Updates are handled
  }
  render() {
    // ...
  }
}
</code></pre><p>Now our code respects all changes to props, even for side effects.</p>
<p>However, itâ€™s challenging to remember not to break it again. For example, we might add <code>currentPage</code> to the local state, and use it in <code>getFetchUrl</code>:</p>
<pre data-line="4,21,"  4,21="" class="language-jsx"><code 4,21="" class="language-jsx">class SearchResults extends React.Component {
  state = {
    data: null,
    currentPage: 0,
  };
  componentDidMount() {
    this.fetchResults();
  }
  componentDidUpdate(prevProps) {
    if (prevProps.query !== this.props.query) {
      this.fetchResults();
    }
  }
  fetchResults() {
    const url = this.getFetchUrl();
    // Do the fetching...
  }
  getFetchUrl() {
    return (
      'http://myapi/results?query' + this.props.query +
      '&amp;page=' + this.state.currentPage // ğŸ”´ Updates are ignored
    );
  }
  render() {
    // ...
  }
}
</code></pre><p>Alas, our code is again buggy because our side effect doesnâ€™t respect changes to <code>currentPage</code>.</p>
<p><strong>Props and state are a part of the React data flow. Both rendering and side effects should reflect changes in that data flow, not ignore them!</strong></p>
<p>To fix our code, we can repeat the steps above:</p>
<ul>
<li>Look at <code>componentDidMount</code> and every method called from it.
<ul>
<li>In our example, thatâ€™s <code>fetchResults</code> and <code>getFetchUrl</code>.</li>
</ul>
</li>
<li>Write down all props and state used by those methods.
<ul>
<li>In our example, thatâ€™s <code>this.props.query</code> <strong>and <code>this.state.currentPage</code></strong>.</li>
</ul>
</li>
<li>Make sure that whenever those props change, we re-run the side effect.
<ul>
<li>We can do this by changing the <code>componentDidUpdate</code> method.</li>
</ul>
</li>
</ul>
<p>Letâ€™s fix our component to handle updates to the <code>currentPage</code> state:</p>
<pre data-line="11,24,"  11,24="" class="language-jsx"><code 11,24="" class="language-jsx">class SearchResults extends React.Component {
  state = {
    data: null,
    currentPage: 0,
  };
  componentDidMount() {
    this.fetchResults();
  }
  componentDidUpdate(prevProps, prevState) {
    if (
      prevState.currentPage !== this.state.currentPage || // âœ… Refetch on change
      prevProps.query !== this.props.query
    ) {
      this.fetchResults();
    }
  }
  fetchResults() {
    const url = this.getFetchUrl();
    // Do the fetching...
  }
  getFetchUrl() {
    return (
      'http://myapi/results?query' + this.props.query +
      '&amp;page=' + this.state.currentPage // âœ… Updates are handled
    );
  }
  render() {
    // ...
  }
}
</code></pre><p><strong>Wouldnâ€™t it be nice if we could somehow automatically catch these mistakes?</strong> Isnâ€™t that something a linter could help us with?</p>
<hr>
<p>Unfortunately, automatically checking a class component for consistency is too difficult. Any method can call any other method. Statically analyzing calls from <code>componentDidMount</code> and <code>componentDidUpdate</code> is fraught with false positives.</p>
<p>However, one <em>could</em> design an API that <em>can</em> be statically analyzed for consistency. The <a href="/a-complete-guide-to-useeffect/">React <code>useEffect</code> Hook</a> is an example of such API:</p>
<pre data-line="13-14,19,"  13-14,19="" class="language-jsx"><code 13-14,19="" class="language-jsx">function SearchResults({ query }) {
  const [data, setData] = useState(null);
  const [currentPage, setCurrentPage] = useState(0);

  useEffect(() =&gt; {
    function fetchResults() {
      const url = getFetchUrl();
      // Do the fetching...
    }

    function getFetchUrl() {
      return (
        'http://myapi/results?query' + query +
        '&amp;page=' + currentPage
      );
    }

    fetchResults();
  }, [currentPage, query]); // âœ… Refetch on change

  // ...
}
</code></pre><p>We put the logic <em>inside</em> of the effect, and that makes it easier to see <em>which values from the React data flow</em> it depends on. These values are called â€œdependenciesâ€, and in our example they are <code>[currentPage, query]</code>.</p>
<p>Note how this array of â€œeffect dependenciesâ€ isnâ€™t really a new concept. In a class, we had to search for these â€œdependenciesâ€ through all the method calls. The <code>useEffect</code> API just makes the same concept explicit.</p>
<p>This, in turn, lets us validate them automatically:</p>
<p><img src="./useeffect.gif" alt="Demo of exhaustive-deps lint rule"></p>
<p><em>(This is a demo of the new recommended <code>exhaustive-deps</code> lint rule which is a part of <code>eslint-plugin-react-hooks</code>. It will soon be included in Create React App.)</em></p>
<p><strong>Note that it is important to respect all prop and state updates for effects regardless of whether youâ€™re writing component as a  class or a function.</strong></p>
<p>With the class API, you have to think about consistency yourself, and verify that changes to every relevant prop or state are handled by <code>componentDidUpdate</code>. Otherwise, your component is not resilient to prop and state changes. This is not even a React-specific problem. It applies to any UI library that lets you handle â€œcreationâ€ and â€œupdatesâ€ separately.</p>
<p><strong>The <code>useEffect</code> API flips the default by encouraging consistency.</strong> This <a href="/a-complete-guide-to-useeffect/">might feel unfamiliar at first</a>, but as a result your component becomes more resilient to changes in the logic. And since the â€œdependenciesâ€ are now explicit, we can <em>verify</em> the effect is consistent using a lint rule. Weâ€™re using a linter to catch bugs!</p>
<hr>
<h3>Donâ€™t Stop the Data Flow in Optimizations</h3>
<p>There's one more case where you might accidentally ignore changes to props. This mistake can occur when youâ€™re manually optimizing your components.</p>
<p>Note that optimization approaches that use shallow equality like <code>PureComponent</code> and <code>React.memo</code> with the default comparison are safe.</p>
<p><strong>However, if you try to â€œoptimizeâ€ a component by writing your own comparison, you may mistakenly forget to compare function props:</strong></p>
<pre data-line="2-5,7,"  2-5,7="" class="language-jsx"><code 2-5,7="" class="language-jsx">class Button extends React.Component {
  shouldComponentUpdate(prevProps) {
    // ğŸ”´ Doesn't compare this.props.onClick 
    return this.props.color !== prevProps.color;
  }
  render() {
    const onClick = this.props.onClick; // ğŸ”´ Doesn't reflect updates
    const textColor = slowlyCalculateTextColor(this.props.color);
    return (
      &lt;button
        onClick={onClick}
        className={'Button-' + this.props.color + ' Button-text-' + textColor}&gt;
        {this.props.children}
      &lt;/button&gt;
    );
  }
}
</code></pre><p>It is easy to miss this mistake at first because with classes, youâ€™d usually pass a <em>method</em> down, and so it would have the same identity anyway:</p>
<pre data-line="2-4,9-11,"  2-4,9-11="" class="language-jsx"><code 2-4,9-11="" class="language-jsx">class MyForm extends React.Component {
  handleClick = () =&gt; { // âœ… Always the same function
    // Do something
  }
  render() {
    return (
      &lt;&gt;
        &lt;h1&gt;Hello!&lt;/h1&gt;
        &lt;Button color='green' onClick={this.handleClick}&gt;
          Press me
        &lt;/Button&gt;
      &lt;/&gt;
    )
  }
}
</code></pre><p>So our optimization doesnâ€™t break <em>immediately</em>. However, it will keep â€œseeingâ€ the old <code>onClick</code> value if it changes over time but other props donâ€™t:</p>
<pre data-line="6,13-15,"  6,13-15="" class="language-jsx"><code 6,13-15="" class="language-jsx">class MyForm extends React.Component {
  state = {
    isEnabled: true
  };
  handleClick = () =&gt; {
    this.setState({ isEnabled: false });
    // Do something
  }
  render() {
    return (
      &lt;&gt;
        &lt;h1&gt;Hello!&lt;/h1&gt;
        &lt;Button color='green' onClick={
          // ğŸ”´ Button ignores updates to the onClick prop
          this.state.isEnabled ? this.handleClick : null
        }&gt;
          Press me
        &lt;/Button&gt;
      &lt;/&gt;
    )
  }
}
</code></pre><p>In this example, clicking the button should disable it â€” but this doesnâ€™t happen because the <code>Button</code> component ignores any updates to the <code>onClick</code> prop.</p>
<p>This could get even more confusing if the function identity itself depends on something that could change over time, like <code>draft.content</code> in this example:</p>
<pre data-line="6-7,"  6-7="" class="language-jsx"><code 6-7="" class="language-jsx">  drafts.map(draft =&gt;
    &lt;Button
      color='blue'
      key={draft.id}
      onClick={
        // ğŸ”´ Button ignores updates to the onClick prop
        this.handlePublish.bind(this, draft.content)
      }&gt;
      Publish
    &lt;/Button&gt;
  )
</code></pre><p>While <code>draft.content</code> could change over time, our <code>Button</code> component ignored change to the <code>onClick</code> prop so it continues to see the â€œfirst versionâ€ of the <code>onClick</code> bound method with the original <code>draft.content</code>.</p>
<p><strong>So how do we avoid this problem?</strong></p>
<p>I recommend to avoid manually implementing <code>shouldComponentUpdate</code> and to avoid specifying a custom comparison to <code>React.memo()</code>. The default shallow comparison in <code>React.memo</code> will respect changing function identity:</p>
<pre data-line="11,"  11="" class="language-jsx"><code 11="" class="language-jsx">function Button({ onClick, color, children }) {
  const textColor = slowlyCalculateTextColor(this.props.color);
  return (
    &lt;button
      onClick={onClick}
      className={'Button-' + color + ' Button-text-' + textColor}&gt;
      {children}
    &lt;/button&gt;
  );
}
export default React.memo(Button); // âœ… Uses shallow comparison
</code></pre><p>In a class, <code>PureComponent</code> has the same behavior.</p>
<p>This ensures that passing a different function as a prop will always work.</p>
<p>If you insist on a custom comparison, <strong>make sure that you donâ€™t skip functions:</strong></p>
<pre data-line="5,"  5="" class="language-jsx"><code 5="" class="language-jsx">  shouldComponentUpdate(prevProps) {
    // âœ… Compares this.props.onClick 
    return (
      this.props.color !== prevProps.color ||
      this.props.onClick !== prevProps.onClick
    );
  }
</code></pre><p>As I mentioned earlier, itâ€™s easy to miss this problem in a class component because method identities are often stable (but not always â€” and thatâ€™s where the bugs become difficult to debug). With Hooks, the situation is a bit different:</p>
<ol>
<li>Functions are different <em>on every render</em> so you discover this problem <a href="https://github.com/facebook/react/issues/14972#issuecomment-468280039">right away</a>.</li>
<li>With <code>useCallback</code> and <code>useContext</code>, you can <a href="https://reactjs.org/docs/hooks-faq.html#how-to-avoid-passing-callbacks-down">avoid passing functions deep down altogether</a>. This lets you optimize rendering without worrying about functions.</li>
</ol>
<hr>
<p>To sum up this section, <strong>donâ€™t stop the data flow!</strong></p>
<p>Whenever you use props and state, consider what should happen if they change. In most cases, a component shouldnâ€™t treat the initial render and updates differently. That makes it resilient to changes in the logic.</p>
<p>With classes, itâ€™s easy to forget about updates when using props and state inside the lifecycle methods. Hooks nudge you to do the right thing â€” but it takes some mental adjustment if youâ€™re not used to already doing it.</p>
<hr>
<h2>Principle 2: Always Be Ready to Render</h2>
<p>React components let you write rendering code without worrying too much about time. You describe how the UI <em>should</em> look at any given moment, and React makes it happen. Take advantage of that model!</p>
<p>Donâ€™t try to introduce unnecessary timing assumptions into your component behavior. <strong>Your component should be ready to re-render at any time.</strong></p>
<p>How can one violate this principle? React doesnâ€™t make it very easy â€” but you can do it by using the legacy <code>componentWillReceiveProps</code> lifecycle method:</p>
<pre data-line="5-8,"  5-8="" class="language-jsx"><code 5-8="" class="language-jsx">class TextInput extends React.Component {
  state = {
    value: ''
  };
  // ğŸ”´ Resets local state on every parent render
  componentWillReceiveProps(nextProps) {
    this.setState({ value: nextProps.value });
  }
  handleChange = (e) =&gt; {
    this.setState({ value: e.target.value });
  };
  render() {
    return (
      &lt;input
        value={this.state.value}
        onChange={this.handleChange}
      /&gt;
    );
  }
}
</code></pre><p>In this example, we keep <code>value</code> in the local state, but we <em>also</em> receive <code>value</code> from props. Whenever we â€œreceive new propsâ€, we reset the <code>value</code> in state.</p>
<p><strong>The problem with this pattern is that it entirely relies on accidental timing.</strong></p>
<p>Maybe today this componentâ€™s parent updates rarely, and so our <code>TextInput</code> only â€œreceives propsâ€ when something important happens, like saving a form.</p>
<p>But tomorrow you might add some animation to the parent of <code>TextInput</code>. If its parent re-renders more often, it will keep <a href="https://codesandbox.io/s/m3w9zn1z8x">â€œblowing awayâ€</a> the child state! You can read more about this problem in <a href="https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html">â€œYou Probably Donâ€™t Need Derived Stateâ€</a>.</p>
<p><strong>So how can we fix this?</strong></p>
<p>First of all, we need to fix our mental model. We need to stop thinking of â€œreceiving propsâ€ as something different from just â€œrenderingâ€. A re-render caused by a parent shouldnâ€™t behave differently from a re-render caused by our own local state change. <strong>Components should be resilient to rendering less or more often because otherwise theyâ€™re too coupled to their particular parents.</strong></p>
<p><em>(<a href="https://codesandbox.io/s/m3w9zn1z8x">This demo</a> shows how re-rendering can break fragile components.)</em></p>
<p>While there are a few <a href="https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#preferred-solutions">different</a> <a href="https://reactjs.org/docs/hooks-faq.html#how-do-i-implement-getderivedstatefromprops">solutions</a> for when you <em>truly</em> want to derive state from props, usually you should use either a fully controlled component:</p>
<pre   class="language-jsx"><code class="language-jsx">// Option 1: Fully controlled component.
function TextInput({ value, onChange }) {
  return (
    &lt;input
      value={value}
      onChange={onChange}
    /&gt;
  );
}
</code></pre><p>Or you can use an uncontrolled component with a key to reset it:</p>
<pre   class="language-jsx"><code class="language-jsx">// Option 2: Fully uncontrolled component.
function TextInput() {
  const [value, setValue] = useState('');
  return (
    &lt;input
      value={value}
      onChange={e =&gt; setValue(e.target.value)}
    /&gt;
  );
}

// We can reset its internal state later by changing the key:
&lt;TextInput key={formId} /&gt;
</code></pre><p>The takeaway from this section is that your component shouldnâ€™t break just because it or its parent re-renders more often. The React API design makes it easy if you avoid the legacy <code>componentWillReceiveProps</code> lifecycle method.</p>
<p>To stress-test your component, you can temporarily add this code to its parent:</p>
<pre data-line="2,"  2="" class="language-js"><code 2="" class="language-js">componentDidMount() {
  // Don't forget to remove this immediately!
  setInterval(() =&gt; this.forceUpdate(), 100);
}
</code></pre><p><strong>Donâ€™t leave this code in</strong> â€” itâ€™s just a quick way to check what happens when a parent re-renders more often than you expected. It shouldnâ€™t break the child!</p>
<hr>
<p>You might be thinking: â€œIâ€™ll keep resetting state when the props change, but will prevent unnecessary re-renders with <code>PureComponent</code>â€.</p>
<p>This code should work, right?</p>
<pre data-line="1-2,"  1-2="" class="language-jsx"><code 1-2="" class="language-jsx">// ğŸ¤” Should prevent unnecessary re-renders... right?
class TextInput extends React.PureComponent {
  state = {
    value: ''
  };
  // ğŸ”´ Resets local state on every parent render
  componentWillReceiveProps(nextProps) {
    this.setState({ value: nextProps.value });
  }
  handleChange = (e) =&gt; {
    this.setState({ value: e.target.value });
  };
  render() {
    return (
      &lt;input
        value={this.state.value}
        onChange={this.handleChange}
      /&gt;
    );
  }
}
</code></pre><p>At first, it might seem like this component solves the problem ofÂ â€œblowing awayâ€ the state on parent re-render. After all, if the props are the same, we just skip the update â€” and so <code>componentWillReceiveProps</code> doesnâ€™t get called.</p>
<p>However, this gives us a false sense of security. <strong>This component is still not resilient to <em>actual</em> prop changes.</strong> For example, if we added <em>another</em> often-changing prop, like an animated <code>style</code>, we would still â€œloseâ€ the internal state:</p>
<pre data-line="2,"  2="" class="language-jsx"><code 2="" class="language-jsx">&lt;TextInput
  style={{opacity: someValueFromState}}
  value={
    // ğŸ”´ componentWillReceiveProps in TextInput
    // resets to this value on every animation tick.
    value
  }
/&gt;
</code></pre><p>So this approach is still flawed. We can see that various optimizations like <code>PureComponent</code>, <code>shouldComponentUpdate</code>, and <code>React.memo</code> shouldnâ€™t be used for controlling <em>behavior</em>. Only use them to improve <em>performance</em> where it helps. If removing an optimization <em>breaks</em> a component, it was too fragile to begin with.</p>
<p>The solution here is the same as we described earlier. Donâ€™t treat â€œreceiving propsâ€ as a special event. Avoid â€œsyncingâ€ props and state. In most cases, every value should either be fully controlled (through props), or fully uncontrolled (in local state). Avoid derived state <a href="https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#preferred-solutions">when you can</a>. <strong>And always be ready to render!</strong></p>
<hr>
<h2>Principle 3: No Component Is a Singleton</h2>
<p>Sometimes we assume a certain component is only ever displayed once. Such as a navigation bar. This might be true for some time. However, this assumption often causes design problems that only surface much later.</p>
<p>For example, maybe you need to implement an animation <em>between</em> two <code>Page</code> components on a route change â€” the previous <code>Page</code> and the next <code>Page</code>. Both of them need to be mounted during the animation. However, you might discover that each of those components assumes itâ€™s the only <code>Page</code> on the screen.</p>
<p>Itâ€™s easy to check for these problems. Just for fun, try to render your app twice:</p>
<pre data-line="3,4,"  3,4="" class="language-jsx"><code 3,4="" class="language-jsx">ReactDOM.render(
  &lt;&gt;
    &lt;MyApp /&gt;
    &lt;MyApp /&gt;
  &lt;/&gt;,
  document.getElementById('root')
);
</code></pre><p>Click around. (You might need to tweak some CSS for this experiment.)</p>
<p><strong>Does your app still behave as expected?</strong> Or do you see strange crashes and errors? Itâ€™s a good idea to do this stress test on complex components once in a while, and ensure that multiple copies of them donâ€™t conflict with one another.</p>
<p>An example of a problematic pattern Iâ€™ve written myself a few times is performing global state â€œcleanupâ€ in <code>componentWillUnmount</code>:</p>
<pre data-line="2-3,"  2-3="" class="language-jsx"><code 2-3="" class="language-jsx">componentWillUnmount() {
  // Resets something in Redux store
  this.props.resetForm();
}
</code></pre><p>Of course, if there are two such components on the page, unmounting one of them can break the other one. Resetting â€œglobalâ€ state on <em>mount</em> is no better:</p>
<pre data-line="2-3,"  2-3="" class="language-jsx"><code 2-3="" class="language-jsx">componentDidMount() {
  // Resets something in Redux store
  this.props.resetForm();
}
</code></pre><p>In that case <em>mounting</em> a second form will break the first one.</p>
<p>These patterns are good indicators of where our components are fragile. <strong><em>Showing</em> or <em>hiding</em> a tree shouldnâ€™t break components outside of that tree.</strong></p>
<p>Whether you plan to render this component twice or not, solving these issues pays off in the longer term. It leads you to a more resilient design.</p>
<hr>
<h2>Principle 4: Keep the Local State Isolated</h2>
<p>Consider a social media <code>Post</code> component. It has a list of <code>Comment</code> threads (that can be expanded) and a <code>NewComment</code> input.</p>
<p>React components may have local state. But what state is truly local? Is the post content itself local state or not? What about the list of comments? Or the record of which comment threads are expanded? Or the value of the comment input?</p>
<p>If youâ€™re used to putting everything into a â€œstate managerâ€, answering this question can be challenging. So hereâ€™s a simple way to decide.</p>
<p><strong>If youâ€™re not sure whether some state is local, ask yourself: â€œIf this component was rendered twice, should this interaction reflect in the other copy?â€ Whenever the answer is â€œnoâ€, you found some local state.</strong></p>
<p>For example, imagine we rendered the same <code>Post</code> twice. Letâ€™s look at different things inside of it that can change.</p>
<ul>
<li>
<p><em>Post content.</em> Weâ€™d want editing the post in one tree to update it in another tree. Therefore, it probably <strong>should not</strong> be the local state of a <code>Post</code> component. (Instead, the post content could live in some cache like Apollo, Relay, or Redux.)</p>
</li>
<li>
<p><em>List of comments.</em> This is similar to post content. Weâ€™d want adding a new comment in one tree to be reflected in the other tree too. So ideally we would use some kind of a cache for it, and it <strong>should not</strong> be a local state of our <code>Post</code>.</p>
</li>
<li>
<p><em>Which comments are expanded.</em> It would be weird if expanding a comment in one tree would also expand it in another tree. In this case weâ€™re interacting with a particular <code>Comment</code> <em>UI representation</em> rather than an abstract â€œcomment entityâ€. Therefore, an â€œexpandedâ€ flag <strong>should</strong> be a local state of the <code>Comment</code>.</p>
</li>
<li>
<p><em>The value of new comment input.</em> It would be odd if typing a comment in one input would also update an input in another tree. Unless inputs are clearly grouped together, usually people expect them to be independent. So the input value <strong>should</strong> be a local state of the <code>NewComment</code> component.</p>
</li>
</ul>
<p>I donâ€™t suggest a dogmatic interpretation of these rules. Of course, in a simpler app you might want to use local state for everything, including those â€œcachesâ€. Iâ€™m only talking about the ideal user experience <a href="/the-elements-of-ui-engineering/">from the first principles</a>.</p>
<p><strong>Avoid making truly local state global.</strong> This plays into our topic of â€œresilienceâ€: thereâ€™s fewer surprising synchronization happening between components. As a bonus, this <em>also</em> fixes a large class of performance issues. â€œOver-renderingâ€ is much less of an issue when your state is in the right place.</p>
<hr>
<h2>Recap</h2>
<p>Letâ€™s recap these principles one more time:</p>
<ol>
<li><strong><a href="#principle-1-dont-stop-the-data-flow">Donâ€™t stop the data flow.</a></strong> Props and state can change, and components should handle those changes whenever they happen.</li>
<li><strong><a href="#principle-2-always-be-ready-to-render">Always be ready to render.</a></strong> A component shouldnâ€™t break because itâ€™s rendered more or less often.</li>
<li><strong><a href="#principle-3-no-component-is-a-singleton">No component is a singleton.</a></strong> Even if a component is rendered just once, your design will improve if rendering twice doesnâ€™t break it.</li>
<li><strong><a href="#principle-4-keep-the-local-state-isolated">Keep the local state isolated.</a></strong> Think about which state is local to a particular UI representation â€” and donâ€™t hoist that state higher than necessary.</li>
</ol>
<p><strong>These principles help you write components that are <a href="/optimized-for-change/">optimized for change</a>. Itâ€™s easy to add, change them, and delete them.</strong></p>
<p>And most importantly, once our components are resilient, we can come back to the pressing dilemma of whether or not props should be sorted by alphabet.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[åº”å˜è€Œä¼˜]]></title>
            <link>/post/optimized-for-change-zh</link>
            <guid>/post/optimized-for-change-zh</guid>
            <description><![CDATA[ä»€ä¹ˆé€ å°±äº†ä¸€ä¸ªä¼˜ç§€çš„API?]]></description>
            <content:encoded><![CDATA[<p>ä»€ä¹ˆé€ å°±äº†ä¸€ä¸ªä¼˜ç§€çš„ API ï¼Ÿ</p>
<p><em>ä¼˜ç§€</em> çš„ API è®¾è®¡æ˜¯æ—¢å¥½è®°åˆæ˜ç¡®çš„ã€‚å®ƒèƒ½ä¿ƒè¿›ä»£ç çš„å¯è¯»æ€§ã€å‡†ç¡®æ€§å’Œé«˜æ•ˆæ€§ï¼Œä¹Ÿèƒ½å¸®åŠ©å¼€å‘è€…è¿›å…¥<a href="https://blog.codinghorror.com/falling-into-the-pit-of-success/">æˆåŠŸä¹‹å‘</a>ã€‚</p>
<p>æˆ‘ç§°è¿™äº›è®¾è®¡å±‚é¢ä¸ºã€Œç¬¬ä¸€çº§ã€ï¼Œå› ä¸ºè¿™äº›æ˜¯ä¸€ä¸ªåº“å¼€å‘è€…éœ€è¦å…³æ³¨çš„é¦–è¦äº‹é¡¹ã€‚ä½ å¯èƒ½éœ€è¦åœ¨å®ƒä»¬ä¸­çš„æŸäº›ä¸Šåšå¦¥åå’Œæƒè¡¡ï¼Œä½†è‡³å°‘è¿™äº›éƒ½æ˜¯ä½ çš„è€ƒè™‘ç‚¹ã€‚</p>
<p>ç„¶è€Œï¼Œé™¤éä½ è¦å°†ä¸€ä¸ªæ¼«æ¸¸è€…å‘å¾€ç«æ˜Ÿï¼Œä¸ç„¶ä½ çš„ä»£ç å¾ˆæœ‰å¯èƒ½éšç€æ—¶é—´è€Œæ”¹å˜ã€‚åŒæ ·ï¼Œä½  API ä½¿ç”¨è€…çš„ä»£ç ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>
<p>æˆ‘æ‰€çŸ¥é“çš„æœ€å¥½çš„APIè®¾è®¡è€…ä»¬ä¸ä¼šåœç•™äºè¿™äº›ã€Œç¬¬ä¸€çº§ã€å±‚é¢ï¼Œæ¯”å¦‚å¯è¯»æ€§ã€‚ä»–ä»¬å°†å°½å¯èƒ½å¤šçš„åŠªåŠ›èŠ±åœ¨é‚£äº›æˆ‘ç§°ä¸ºã€Œç¬¬äºŒçº§ã€çš„ API è®¾è®¡å±‚é¢ä¸Šï¼š<strong>ä½¿ç”¨æ­¤ API çš„ä»£ç å¦‚ä½•éšæ—¶é—´çš„æ¨ç§»è€Œå‘å±•ã€‚</strong></p>
<p>å¾®å°çš„éœ€æ±‚å˜åŒ–å¯ä»¥ä½¿æœ€ä¼˜é›…çš„ä»£ç æ”¯ç¦»ç ´ç¢ã€‚</p>
<p><em>ä¼˜ç§€</em> çš„ API å¯¹è¿™ä¸€ç‚¹æ˜¯æœ‰é¢„æœŸçš„ã€‚å®ƒä»¬é¢„æ–™åˆ°ä½ å¯èƒ½æƒ³ç§»åŠ¨ä¸€äº›ä»£ç ã€å¤åˆ¶ç²˜è´´ä¸€éƒ¨åˆ†ã€é‡å‘½åã€å°†ä¸€äº›ç‰¹æ®Šä¾‹å­æ•´åˆæˆä¸€ä¸ªé€šç”¨ä¸”å¯å¤ç”¨çš„è¾…åŠ©å‡½æ•°ã€å°†ä¸€ä¸ªæŠ½è±¡è§£æ„æˆä¸€äº›å…·ä½“å®ä¾‹ã€åŠ ä¸€ä¸ª hackã€ä¼˜åŒ–ä¸€ä¸ªç“¶é¢ˆã€æŠ›å¼ƒä¸€éƒ¨åˆ†ä»£ç é‡å†™ã€çŠ¯äº†ä¸€ä¸ªé”™è¯¯ã€åœ¨èµ·å› å’Œç»“æœé—´æ¸¸èµ°ã€ä¿®å¤ä¸€ä¸ª bugã€å®¡é˜…ä¸€ä¸ªä»£ç ä¿®å¤ã€‚</p>
<p>ä¼˜ç§€çš„ API ä¸ä»…ä»…è®©ä½ è¿›å…¥æˆåŠŸä¹‹å‘é‡Œï¼Œè€Œä¸”èƒ½å¸®ä½  <em>é©»ç•™</em> åœ¨é‚£é‡Œã€‚</p>
<p>å®ƒä»¬åº”å˜è€Œä¼˜ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Optimized for Change]]></title>
            <link>/post/optimized-for-change</link>
            <guid>/post/optimized-for-change</guid>
            <description><![CDATA[What makes a great API?]]></description>
            <content:encoded><![CDATA[<p>What makes a great API?</p>
<p><em>Good</em> API design is memorable and unambiguous. It encourages readable, correct and performant code, and helps developers fall into <a href="https://blog.codinghorror.com/falling-into-the-pit-of-success/">the pit of success</a>.</p>
<p>I call these design aspects â€œfirst orderâ€ because they are the first things a library developer tends to focus on. You might have to compromise on some of them and make tradeoffs but at least theyâ€™re always on your mind.</p>
<p>However, unless youâ€™re sending a rover to Mars, your code will probably change over time. And so will the code of your API consumers.</p>
<p>The best API designers I know donâ€™t stop at the â€œfirst orderâ€ aspects like readability. They dedicate just as much, if not more, effort to what I call the â€œsecond orderâ€ API design: <strong>how code using this API would evolve over time.</strong></p>
<p>A slight change in requirements can make the most elegant code fall apart.</p>
<p><em>Great</em> APIs anticipate that. They anticipate that youâ€™ll want to move some code. Copy and paste some part. Rename it. Unify special cases into a generic reusable helper. Unwind an abstraction back into specific cases. Add a hack. Optimize a bottleneck. Throw away a part and start it anew. Make a mistake. Navigate between the cause and the effect. Fix a bug. Review the fix.</p>
<p>Great APIs not only let you fall into a pit of success, but help you <em>stay</em> there.</p>
<p>Theyâ€™re optimized for change.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[åšå¥½æŠ€æœ¯åˆ†äº«ï¼Œç¬¬ä¸€ç« ï¼šé©±åŠ¨]]></title>
            <link>/post/preparing-for-tech-talk-part-1-motivation-zh</link>
            <guid>/post/preparing-for-tech-talk-part-1-motivation-zh</guid>
            <description><![CDATA[è¿™æ˜¯æˆ‘å¯¹ç¾å¦™åˆ†äº«çµæ„Ÿçš„ç§˜æ–¹]]></description>
            <content:encoded><![CDATA[<p>æˆ‘åšè¿‡ä¸€äº›æˆ‘è®¤ä¸ºéå¸¸ä¸é”™çš„<a href="https://www.youtube.com/watch?v=xsSnOQynTHs">æŠ€</a><a href="https://www.youtube.com/watch?v=nLF0n9SACd4">æœ¯</a><a href="https://www.youtube.com/watch?v=dpw9EHDh2bM">åˆ†äº«</a>ã€‚</p>
<p>æœ‰æ—¶äººä»¬é—®æˆ‘å¦‚ä½•å‡†å¤‡å¥½ä¸€ä¸ªåˆ†äº«ã€‚å¯¹äºæ¯ä¸ªäººæ¥è¯´ï¼Œç­”æ¡ˆéƒ½æ˜¯ä¸åŒçš„ï¼Œä¸‹é¢æˆ‘åˆ†äº«çš„æ˜¯å¯¹äºæˆ‘æœ‰ç”¨çš„éƒ¨åˆ†ã€‚</p>
<p><strong>æœ¬æ–‡æ˜¯è¿™ä¸ªç³»åˆ—åˆ†äº«çš„ç¬¬ä¸€éƒ¨åˆ†</strong>ï¼Œæœ¬æ–‡ä¸­æˆ‘é˜è¿°äº†å¦‚ä½•å‡†å¤‡ä¸€ä¸ªæŠ€æœ¯åˆ†äº«--ä»äº§ç”Ÿä¸€ä¸ªæƒ³æ³•åˆ°ç°åœºåˆ†äº«ã€‚</p>
<ul>
<li><strong>åšå¥½æŠ€æœ¯åˆ†äº«ï¼Œç¬¬ä¸€ç« ï¼šé©±åŠ¨</strong></li>
<li><strong><a href="/preparing-for-tech-talk-part-2-what-why-and-how/">åšå¥½æŠ€æœ¯åˆ†äº«ï¼Œç¬¬äºŒç« ï¼šå†…å®¹ï¼ŒåŸå› å’Œæ–¹æ³•</a></strong></li>
<li>æœªå®Œå¾…ç»­</li>
</ul>
<p />
<hr>
<p><strong>æœ¬æ–‡ä¸­ï¼Œæˆ‘åªä¼šå…³æ³¨ç¬¬ä¸€æ­¥ï¼šæˆ‘æ˜¯ä¸ºä»€ä¹ˆå¹¶ä¸”å¦‚ä½•æŒ‘é€‰è¯é¢˜çš„ã€‚</strong> è¿™å¹¶ä¸ä¼šæä¾›å¾ˆå¤šå®è·µå»ºè®®ï¼Œä½†æ˜¯å¯ä»¥è®©ä½ å…³æ³¨ä¸€äº›æ­£ç¡®çš„ç‚¹ã€‚</p>
<hr>
<p>æ˜¯ä»€ä¹ˆ<em>æ¿€åŠ±</em>ä½ ï¼Œè®©ä½ æ¥åšæŠ€æœ¯åˆ†äº«ï¼Ÿ</p>
<p>å¯èƒ½åˆ†äº«å°±æ˜¯ä½ ç°åœ¨å·¥ä½œçš„ä¸€éƒ¨åˆ†ï¼Œå¯èƒ½ä½ å¸Œæœ›ä»¥æ­¤åœ¨å…¬å¸ä¸­è·å¾—æ›´å¤šè®¤åŒï¼Œæ¥è·å¾—ä¸€ä»½æ›´å¥½çš„å·¥ä½œï¼Œæˆ–è€…æ™‹å‡ã€‚å¯èƒ½ä½ ä»…ä»…æ˜¯å¸Œæœ›å¤§å®¶æ›´äº†è§£ä½ çš„å…´è¶£æˆ–å·¥ä½œé¡¹ç›®ã€‚</p>
<p>æˆ‘ä»¬ç§°è¿™äº›é©±åŠ¨æ˜¯<em>å¤–åœ¨</em>çš„ï¼Œå®ƒä»¬å…³ç³»åˆ°åˆ«äººå¦‚ä½•è¯„ä»·ä½ ä»¥åŠä½ çš„å·¥ä½œã€‚ä½†å¦‚æœä½ å·²ç»æ‹¥æœ‰äº†ä½ æƒ³è¦çš„å£°æœ›å’Œé‡‘é’±ï¼Œä½ ä»ç„¶ä¼šåšä¸€ä¸ªæŠ€æœ¯åˆ†äº«å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p>
<p>ä¹Ÿè®¸ä½ äº«å—ä¼ é“å—ä¸šï¼›ä¹Ÿè®¸ä½ äº«å—å­¦ä¹ ï¼Œè€Œåšåˆ†äº«æ­£æ˜¯ä¸€ä¸ªè¿½æ ¹ç©¶åº•çš„å¥½æ–¹å¼ï¼›ä¹Ÿè®¸ä½ å¸Œæœ›å¼•èµ·ä¸€ä¸ªè¯é¢˜çš„è®¨è®ºï¼›ä¹Ÿå¯èƒ½ä½ åªæƒ³å¯¹ä¸€ä¸ªè§‚ç‚¹è¡¡çŸ­è®ºé•¿ã€‚</p>
<p>è¿™äº›<em>å†…åœ¨</em>é©±åŠ¨å¹¶ä¸åªæ˜¯ä»£è¡¨å¸Œæœ›è·å¾—ä¸“ä¸šè®¤å¯ï¼Œè¿™äº›ä¸œè¥¿å¯¹ä½ æ¥è¯´æœ‰å›ºæœ‰çš„ä»·å€¼ã€‚ä¸åŒçš„äººæœ‰ä¸åŒçš„å†…åœ¨é©±åŠ¨ï¼Œäº†è§£ä½ è‡ªå·±çš„å†…åœ¨é©±åŠ¨æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä½ å¯ä»¥é€šè¿‡ä»–ä»¬è¿½æœ¬æº¯æºï¼Œæ›´æ¸…æ¥šåœ°è®¤è¯†è‡ªå·±ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„å†…åœ¨é©±åŠ¨ï¼š</p>
<ul>
<li>
<p><strong>æˆ‘ä¹äºåˆ†äº«çµæ„Ÿæ€§çš„æƒ³æ³•ã€‚</strong> æœ‰æ—¶ï¼Œä¸€ä¸ªæƒ³æ³•èƒ½æ”¹å˜æˆ‘çš„æ€è€ƒæ–¹å¼ï¼Œèƒ½æ‰“å¼€æ–°ä¸–ç•Œçš„å¤§é—¨ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¸€ä¸ªäººæ€è€ƒæ˜¯é—­é—¨é€ è½¦ï¼Œæˆ‘å¸Œæœ›å…¶ä»–äººæ¥å’Œæˆ‘äº¤æµï¼Œèƒ½è®©æˆ‘èŒ…å¡é¡¿å¼€ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œä¸€æ¬¡åˆ†äº«ï¼Œæ˜¯ä¸€ä¸ªé›†æ€å¹¿ç›Šçš„è¿‡ç¨‹ã€‚ï¼ˆåœ¨æˆ‘å¹´è½»æ—¶ï¼Œè™½ç„¶æˆ‘çš„éŸ³ä¹å“å‘³å¹¶ä¸çªå‡ºï¼Œä½†æˆ‘å–œæ¬¢åˆ¶ä½œç£å¸¦ã€‚è€Œç°åœ¨ï¼Œæˆ‘å´å–œæ¬¢åˆ†äº«ï¼Œç”Ÿæ´»æ€»æ˜¯ä¼šå¸¦ç»™ä½ æƒŠå–œã€‚ï¼‰</p>
</li>
<li>
<p><strong>æˆ‘ä¹äºä»¥ç®€å•çš„æ–¹å¼è§£é‡Šäº‹ç‰©ã€‚</strong> å½“æˆ‘ç†è§£ä¸€ä¸ªæƒ³æ³•æ—¶ï¼Œæˆ‘ä¼šè·å¾—æ¯”åƒç”œé£Ÿæ›´å¤§çš„æ„‰æ‚¦æ„Ÿã€‚å­¦ä¹ å¯¹æˆ‘æ¥è¯´ä¸æ˜¯æ˜“äº‹ï¼Œæ‰€ä»¥å½“æˆ‘ææ¸…æ¥šæŸäº‹æ—¶ï¼Œæˆ‘å¸Œæœ›èƒ½é€šè¿‡æˆ‘çš„æ–¹å¼ç‚¹é†’è¢«å®ƒå›°æ‰°çš„äººã€‚æˆ‘å°è¯•è®°ä½åœ¨æˆ‘æç„¶å¤§æ‚Ÿä¹‹å‰æˆ‘çš„è§‚ç‚¹æ˜¯å¦‚ä½•çš„ï¼Œè¿™æ ·èƒ½å¸®åŠ©åˆ«äººåœ¨æ¥å—æˆ‘çš„åˆ†äº«æ—¶è·å¾—åŒæ ·çš„è¿‡ç¨‹ã€‚ï¼ˆæˆ‘å°æ—¶å€™ç»å¸¸è®©åˆ«äººé—®æˆ‘é—®é¢˜ï¼Œè¿™è®©äººéš¾ä»¥å¿å—ï¼Œè€Œåšåˆ†äº«åˆ™æ˜¯ä¸€ä¸ªæ›´æœ‰æˆæ•ˆçš„è®©åˆ«äººæé—®çš„æ–¹å¼ã€‚ï¼‰</p>
</li>
</ul>
<hr>
<p>æŠŠè¿™ä¸¤ä¸ªå†…åœ¨é©±åŠ¨ç»“åˆèµ·æ¥ï¼Œæˆ‘å°±æœ‰äº†ä¸€ä¸ªè®©æˆ‘æ»¡æ„çš„åˆ†äº«çš„ç§˜æ–¹ï¼š<strong>ä»¥ç®€å•çš„æ–¹å¼è§£é‡Šä¸€ä¸ªçµæ„Ÿæ€§çš„æƒ³æ³•ã€‚</strong></p>
<hr>
<p>è¿™æ˜¯æˆ‘çš„å‡†åˆ™ï¼Œä¸€åƒä¸ªäººçœ¼ä¸­å°±æœ‰ä¸€åƒä¸ªå“ˆå§†é›·ç‰¹ï¼Œå¥½å¥½æƒ³æƒ³ä»€ä¹ˆåˆ†äº«è®©ä½ æ„Ÿåˆ°ç‰¹åˆ«ï¼Œä»–ä»¬ä¹‹é—´æœ‰ä½•å½¢å¼ä¸Šçš„ç±»ä¼¼å—ï¼Ÿï¼ˆæœ¬ç³»åˆ—æ¥ä¸‹æ¥ä¼šæ›´å¤šåœ°è®¨è®ºåˆ†äº«å½¢å¼ï¼‰</p>
<p><img src="./patronus.jpg" alt="Luna Lovegood invoking a Patronus Charm. Image Â© 2007 Warner Bros. Ent"></p>
<p>åšä¸€ä¸ªå’Œä½ é©±åŠ¨ä¸€è‡´çš„åˆ†äº«å¯¹ä½ åœ¨ä»¥ä¸‹æ–¹é¢æ˜¯æœ‰å¸®åŠ©çš„ï¼š</p>
<ol>
<li>
<p><strong>è¯é¢˜å˜å¾—æ›´å®¹æ˜“æŒ‘é€‰ã€‚</strong> æˆ‘çš„å‡†åˆ™æ˜¯ã€Œè§£é‡Šä¸€ä¸ªçµæ„Ÿæ€§çš„æƒ³æ³•ï¼Œä»¥åŠä½ ä¸ºä½•éœ€è¦å…³æ³¨å®ƒã€ã€‚åœ¨æˆ‘å­¦ä¼šçš„æœ‰è¶£çš„æ¦‚å¿µä¸Šï¼Œé€šè¿‡å®æ–½è¿™ä¸€å‡†åˆ™æˆ‘å¯ä»¥æå®šæˆ‘çš„åˆ†äº«ææ¡ˆã€‚åªè¦æŒç»­åœ°å’Œèªæ˜äººäº¤æµï¼Œå¬å–ä»–ä»¬å€¼å¾—å‘æ‰¬å…‰å¤§çš„æƒ³æ³•ï¼Œæˆ‘å°±æ€»å¯ä»¥æœ‰ä¸€äº›å€¼å¾—è®¨è®ºçš„è¯é¢˜ã€‚è€Œä½ å¯ä»¥æŒ–æ˜æ›´å¤šå¯èƒ½çš„å‡†åˆ™ï¼</p>
</li>
<li>
<p><strong>è®²å°ä¸Šä½ ä¸ä¼šè§‰å¾—èƒ†æ€¯ã€‚</strong> åœ¨åˆ†äº«å‰çš„ä¸‰åç§’ï¼Œæˆ‘ä¼šè§‰å¾—ææƒ§ï¼Œä¸è¿‡ä¸€æ—¦æˆ‘å¼€å§‹æ¼”è®²ï¼Œè¿™å°±æ˜¯æˆ‘çš„èˆå°äº†ã€‚åˆ†äº«ä¸€ä¸ªçµæ„Ÿæ€§æƒ³æ³•çš„é©±åŠ¨åŠ›æˆ˜èƒœäº†è¢«æ‰¹è¯„æˆ–è€…åšé”™äº‹çš„ææƒ§ã€‚ï¼ˆå½“ç„¶ï¼Œä»¥ä¸Šéƒ½æ˜¯åªæœ‰ä½ åšå¥½äº†å‡†å¤‡æ‰æœ‰æ•ˆï¼Œæˆ‘ä»¬ä¼šåœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­è®¨è®ºï¼‰</p>
</li>
<li>
<p><strong>ä½ ä¼šå˜å¾—æ›´è®©äººä¿¡æœã€‚</strong> <a href="https://mobile.twitter.com/sophiebits/status/1077723835481284608">Sophie</a> åœ¨è¿™æ–¹é¢è¡¨è¾¾å¾—æ¯”æˆ‘å¥½ï¼šå¦‚æœä½ å¯¹ä¸€ä¸ªè¯é¢˜å……æ»¡äº†çƒ­å¿±ï¼Œè§‚ä¼—ä¹Ÿä¼šè¢«ä½ æ„ŸæŸ“ï¼Œä¹Ÿä¼šå¯¹æ­¤æ„Ÿå…´è¶£ã€‚æ¿€æƒ…å¹¶ä¸åªä»£è¡¨æŒ¥ç€æ‰‹æˆ–è€…å¤§å£°è¯´è¯ï¼Œå³ä½¿ä½ å¾ˆå†·é™ï¼Œäººä»¬åŒæ ·å¯ä»¥æ„Ÿå—åˆ°èƒŒåçš„ä¿¡å¿µã€‚ï¼ˆè¿™å°±æ˜¯ä¸ºä½•æˆ‘ä»¬å°±ç®—å¬ä¸æ‡‚<a href="https://www.youtube.com/watch?v=6SWIwW9mg8s">æ­Œè¯</a>ï¼Œä¹Ÿå¯ä»¥æ„Ÿå—ä¸€é¦–æ­Œï¼‰</p>
</li>
</ol>
<hr>
<p>å½“ä½ å¯¹æŸä¸ªè¯é¢˜æ„Ÿåˆ°éå¸¸å…´å¥‹æ—¶ï¼Œè¿˜æœ‰ä¸€ä¸ªåŸå› ä¼šæ¿€åŠ±ä½ --ä½ ä¼šæ„Ÿè§‰è‡ªå·±æ˜¯å®ä¼Ÿäº‹ä¸šçš„ä¸€éƒ¨åˆ†ï¼Œè¿™ä¼šè®©äººå……æ»¡ä¿¡å¿ƒã€‚</p>
<p>å…¶å®æˆ‘çš„åˆ†äº«æ˜¯å…³äºä¸€ä¸ªæƒ³æ³•ï¼Œå¹¶ä¸æ˜¯å…³äºæˆ‘ï¼Œè€Œæˆ‘åªæ˜¯ä¸€ä¸ªä¿¡ä½¿ã€‚é‚£äº›ä¸Šä¸‡çš„è§‚ä¼—ï¼Œä»–ä»¬è¯„åˆ¤çš„ä¸æ˜¯æˆ‘ï¼ˆå³ä½¿ä»–ä»¬æ˜¯å¦‚æ­¤è®¤ä¸ºï¼‰ï¼Œä»–ä»¬åªæ˜¯æ¥å¬å–æˆ‘çš„æƒ³æ³•ã€‚æˆ‘çš„åªæ˜¯æŠŠæƒ³æ³•ä¼ é€’ç»™å…¶ä»–äººã€‚æŠŠè¿™äº›æƒ³æ³•æ¤å…¥å†…å¿ƒåï¼Œæ¥è‡ªåˆ†äº«çš„ç²¾ç¥å‹åŠ›å°±ä¼šæ¶ˆå¤±ã€‚</p>
<hr>
<p>å¯»æ‰¾å¥‘åˆä½ é©±åŠ¨çš„å‡†åˆ™å¯ä»¥å¸®åŠ©ä½ ç¡®å®šä½ çš„è¯è¯­ã€‚ä½†æ˜¯ï¼Œä½ å¦‚ä½•æ‰¾åˆ°å¯ä»¥åº”ç”¨è¿™ä¸ªå‡†åˆ™çš„ç‰¹å®šè¯é¢˜å‘¢ï¼Ÿ</p>
<p><strong>æ ¹æ®æˆ‘çš„ç»éªŒï¼Œè‰¯å¥½çš„è°ˆè¯å§‹äºå¯¹è¯ã€‚</strong> æœ‰äººå‘æˆ‘è§£é‡Šäº†ä¸€ä¸ªæƒ³æ³•ï¼Œç„¶åæˆ‘è¯•ç€å‘åˆ«äººè§£é‡Šï¼Œæˆ‘å’Œåå‡ ä¸ªäººè®¨è®ºå®ƒï¼Œæœ€åæˆ‘èƒ½æ‰¾åˆ°ã€Œæ™®é€‚ã€çš„è§£é‡Šã€‚æƒ³æ³•æœ‰æ—¶ä¼šè¢«å¿½è§†æˆ–è¯¯è§£ï¼Œæˆ‘ä¼šè¯•å›¾è®©ä¸åŒäººä»¥ä¸åŒçš„çœ¼å…‰çœ‹å¾…å®ƒã€‚</p>
<p>å¯¹æˆ‘æ¥è¯´ï¼Œåˆ†äº«åªæ˜¯ä¸€ç§æ¦‚æ‹¬è¿™äº›å¯¹è¯å¹¶ä½¿å®ƒä»¬æˆä¸ºä¸€å¯¹å¤šè€Œéä¸€å¯¹ä¸€çš„æ–¹å¼ã€‚å®ƒå°±åƒä¸€ä¸ªã€Œåº“ã€ï¼Œæ˜¯ä½ ä»è®¸å¤šé¢å¯¹é¢å’Œç¤¾äº¤åª’ä½“è®¨è®ºçš„ã€Œåº”ç”¨ç¨‹åºä»£ç ã€ä¸­æå–å‡ºæ¥ã€‚</p>
<p>å› æ­¤ï¼Œå¦‚æœä½ æƒ³è¿›è¡Œä¸€æ¬¡ç²¾å½©çš„åˆ†äº«ï¼Œä¸äººäº¤è°ˆæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¼€å§‹ã€‚</p>
<p><img src="https://overreacted.io/static/7c324114478c65f71622e8f823dceee3/f8fb9/cauldron.jpg" alt="Hermione Granger making a potion. Vials have text imposed on top: &quot;motivations&quot; and &quot;conversations&quot;. Cauldron is a metaphor for your talk. Image Â© 2001 Warner Bros. Ent"></p>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æè¿°äº†æˆ‘è®¤ä¸ºæœ‰åŠ©äºåˆ†äº«çš„å¥—è·¯ã€‚æˆ‘é‡ç”³ä¸‹ï¼Œæˆ‘åªæ˜¯åˆ†äº«å¯¹æˆ‘æœ‰ç”¨çš„ä¸œè¥¿--å¾ˆå¤š<a href="https://mobile.twitter.com/jackiehluo/status/1077717283026411520">æƒ…å†µ</a>ä¸‹ï¼Œä½ çš„çœ‹æ³•å¯èƒ½å¤§ç›¸å¾„åº­ã€‚</p>
<p>åœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†è®¨è®ºå‡†å¤‡åˆ†äº«å¤§çº²ï¼Œå¹»ç¯ç‰‡ï¼Œé¢„æ¼”ä»¥åŠæˆ‘åœ¨åˆ†äº«å½“å¤©æ‰€åšçš„å·¥ä½œã€‚</p>
<p>æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡ï¼š<strong><a href="/preparing-for-tech-talk-part-2-what-why-and-how/">åšå¥½æŠ€æœ¯åˆ†äº«ï¼Œç¬¬2éƒ¨åˆ†ï¼šå†…å®¹ï¼ŒåŸå› å’Œæ–¹æ³•</a></strong> ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Preparing for a Tech Talk, PartÂ 1: Motivation]]></title>
            <link>/post/preparing-for-tech-talk-part-1-motivation</link>
            <guid>/post/preparing-for-tech-talk-part-1-motivation</guid>
            <description><![CDATA[Hereâ€™s my recipe for a good talk idea.]]></description>
            <content:encoded><![CDATA[<p>Iâ€™ve done a <a href="https://www.youtube.com/watch?v=xsSnOQynTHs">few</a> <a href="https://www.youtube.com/watch?v=nLF0n9SACd4">tech</a> <a href="https://www.youtube.com/watch?v=dpw9EHDh2bM">talks</a> that I think went well.</p>
<p>Sometimes people ask me how I prepare for a talk. For every speaker, the answer is very personal. Iâ€™m just sharing what works for me.</p>
<p><strong>This is the first post in a series</strong> where I explain my process preparing for a tech talk â€” from conceiving the idea to the actual day of the presentation:</p>
<ul>
<li><strong>Preparing for a Tech Talk, Part 1: Motivation (<em>this post</em>)</strong></li>
<li><strong><a href="/preparing-for-tech-talk-part-2-what-why-and-how/">Preparing for a Tech Talk, Part 2: What, Why, and How</a></strong></li>
<li><strong><a href="/preparing-for-tech-talk-part-3-content/">Preparing for a Tech Talk, Part 3: Content</a></strong></li>
<li>To be continued</li>
</ul>
<p />
<hr>
<p><strong>In this post, I will only focus on the first step: why and how I pick a topic.</strong> Itâ€™s not rich in practical tips but might help you ask yourself the right questions.</p>
<hr>
<p>What motivates <em>you</em> to give a talk?</p>
<p>Maybe giving talks is a part of your current job. Maybe you want to gain more recognition in the industry so you can land a better job or get a raise. Maybe youâ€™re out there to bring more attention to your hobby or work project.</p>
<p>Weâ€™ll call these motivations <em>external</em>. They are about what other people think of you and your work. But if you already had all the respect and money that you wanted, would you still choose to give a talk? Why?</p>
<p>Maybe you find it rewarding to teach people. Maybe you enjoy learning, and giving a talk is a nice excuse to dig deeper. Maybe you want to start or change the conversation about a topic. Maybe you want to amplify or critique an idea.</p>
<p>Such <em>internal</em> motivations arenâ€™t a proxy for another desire like professional recognition. These are the things that have intrinsic value to you. Different people are driven by different internal motivations. Itâ€™s helpful to be aware of yours. You can sometimes trace them all the way back to your childhood.</p>
<p>For example, hereâ€™s mine:</p>
<ul>
<li>
<p><strong>I enjoy sharing ideas that inspire me.</strong> Sometimes, an idea transforms the way I think. It opens many doors that I didnâ€™t even know existed. But itâ€™s lonely behind those doors. I want others to join me so that they can show me even more interesting doors inside. For me, a talk is a way to collect, curate, and amplify ideas that I find tasteful. (As a teenager I made mixtapes for crushes with no interest in my music taste. Now I do talks! Life, uh, finds a way.)</p>
</li>
<li>
<p><strong>I enjoy re-explaining things in a simpler way.</strong> When I understand an idea, I get a very pleasant feeling â€” better than eating sweets. But learning doesnâ€™t come easy to me. So when I finally â€œgetâ€ something, I want to share that feeling with the people who are still struggling. I try to remember what it was like <em>before</em> the a-ha moment to help others â€œmake the jumpâ€ while watching my talks. (I was also insufferable as a child because I insisted that everyone asks me questions. A talk is a more productive way to channel that energy.)</p>
</li>
</ul>
<hr>
<p>Combining these two internal motivations gives me a recipe for a personally satisfying talk: <strong>share an inspiring idea by re-explaining it in a simpler way</strong>.</p>
<hr>
<p>That is my formula. Yours might be different â€” think about it! Which talks made you feel in a special way? What are the structural similarities between them? (Weâ€™ll discuss the talk structure more in the next posts in this series.)</p>
<p><img src="./patronus.jpg" alt="Luna Lovegood invoking a Patronus Charm. Image Â© 2007 Warner Bros. Ent"></p>
<p>Giving a talk thatâ€™s aligned with your motivations is helpful in several ways:</p>
<ol>
<li>
<p><strong>Itâ€™s easier to pick a topic.</strong> My formula is â€œexplain an inspiring idea and why you should care about itâ€. I can create talk proposals by applying this formula to any interesting concept that I learned. Iâ€™ll always have something to talk about as long as Iâ€™m listening to smart people with good ideas that deserve more exposure. There are many other possible formulas â€” find yours.</p>
</li>
<li>
<p><strong>Itâ€™s less scary on stage.</strong> I get terrified 30 seconds before the talk but <em>the moment I start talking, Iâ€™m in my element</em>. The drive to share an inspiring idea overtakes the fear of being judged or doing something wrong. (Of course, this only works with good preparation which weâ€™ll talk about in the next posts.)</p>
</li>
<li>
<p><strong>Itâ€™s more convincing.</strong> I canâ€™t phrase it better than <a href="https://mobile.twitter.com/sophiebits/status/1077723835481284608">Sophie did</a>: if youâ€™re enthusiastic about a topic, you can get the audience to care too. Enthusiasm doesnâ€™t necessarily mean being loud or waving hands. Even if youâ€™re calm, people can feel when thereâ€™s an emotional conviction behind a talk. (This is also why we can vibe to a <a href="https://www.youtube.com/watch?v=6SWIwW9mg8s">song</a> even if we donâ€™t understand the words.)</p>
</li>
</ol>
<hr>
<p>Thereâ€™s one more reason it helps when youâ€™re genuinely excited about a topic. Feeling that youâ€™re a part of something bigger does wonders for confidence.</p>
<p>My talks arenâ€™t about <em>me</em> â€” theyâ€™re about an idea, and Iâ€™m just a messenger. Thousands of people on the livestream and in the audience arenâ€™t really there to judge me (even if they think so). They came to experience the idea that I brought to share. My role is just to be a conduit from one mind to another. A lot of nerves and pressure from the talks disappeared after internalizing this.</p>
<hr>
<p>Finding a formula thatâ€™s consistent with your motivations helps you establish your own voice. But how do you find a <em>specific</em> topic to which you can apply it?</p>
<p><strong>In my experience, good talks start as conversations.</strong> Somebody explains an idea to me, and then I try to explain it to someone else. I talk about it to a dozen people, and eventually I find explanations that â€œclickâ€. Sometimes thereâ€™s a thought that seems neglected or misunderstood, and I try to get individual people to see it in a different light.</p>
<p>For me, a talk is just a way to generalize those conversations and make them one-to-many rather than one-to-one. Itâ€™s like a â€œlibraryâ€ you extract out of the â€œapplication codeâ€ of many in-person and social media conversations.</p>
<p>So if you want to give a great talk, <em>talking</em> to people is a good way to start.</p>
<p><img src="./cauldron.jpg" alt="Hermione Granger making a potion. Vials have text imposed on top: &quot;motivations&quot; and &quot;conversations&quot;. Cauldron is a metaphor for your talk. Image Â© 2001 Warner Bros. Ent"></p>
<hr>
<p>In this post, I described the framework that I find helpful for thinking about talk ideas. Again, I want to emphasize Iâ€™m just sharing what works for me â€” there are <a href="https://mobile.twitter.com/jackiehluo/status/1077717283026411520">many kinds of talks</a> and your outlook on this may be very different.</p>
<p>In the next posts in this series, I will talk about preparing the talk outline, slides, rehearsing the talks, and what I do on the day of the presentation.</p>
<p><strong>Next in this series: <a href="/preparing-for-tech-talk-part-2-what-why-and-how/">Preparing for a Tech Talk, Part 2: What, Why, and How</a></strong>.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[æº–å‚™ä¸€å ´æŠ€è¡“åˆ†äº« - ç¬¬äºŒç¯‡ï¼š ä»€éº¼ã€ç‚ºä½•ã€æ€éº¼åš]]></title>
            <link>/post/preparing-for-tech-talk-part-2-what-why-and-how-zh</link>
            <guid>/post/preparing-for-tech-talk-part-2-what-why-and-how-zh</guid>
            <description><![CDATA[æˆ‘å€‘å¿…é ˆæ›´æ·±å…¥çš„äº†è§£]]></description>
            <content:encoded><![CDATA[<p>æˆ‘çµ¦é<a href="https://www.youtube.com/watch?v=xsSnOQynTHs">ä¸€äº›</a>æˆ‘è¦ºå¾—é‚„ä¸éŒ¯çš„<a href="https://www.youtube.com/watch?v=nLF0n9SACd4">æŠ€è¡“</a><a href="https://www.youtube.com/watch?v=dpw9EHDh2bM">åˆ†äº«</a>ã€‚</p>
<p>æœ‰æ™‚å€™å¤§å®¶å•æˆ‘æ€éº¼æº–å‚™ä¸€å ´æŠ€è¡“åˆ†äº«ã€‚é€™å€‹ç­”æ¡ˆå°æ¯å€‹è¬›è€…ä¾†èªªéƒ½æ˜¯éå¸¸å€‹äººçš„ã€‚æˆ‘åªæ˜¯åˆ†äº«ä¸€äº›æˆ‘èªç‚ºå°æˆ‘ä¾†èªªæœ‰ç”¨çš„æŠ€å·§ã€‚</p>
<p><strong>é€™æ˜¯ç³»åˆ—æ–‡çš„ç¬¬äºŒç¯‡</strong> æˆ‘æœƒåˆ†äº«æˆ‘æº–å‚™ä¸€å ´æŠ€è¡“åˆ†äº«çš„éç¨‹ -- å¾æ§‹æ€æƒ³æ³•åˆ°å¯¦éš›ç™¼è¡¨çš„é‚£å¤©ï¼š</p>
<ul>
<li><strong><a href="/preparing-for-tech-talk-part-1-motivation/">æº–å‚™ä¸€å ´æŠ€è¡“åˆ†äº« - ç¬¬ä¸€ç¯‡ï¼šå‹•æ©Ÿ</a></strong></li>
<li><strong>æº–å‚™ä¸€å ´æŠ€è¡“åˆ†äº« - ç¬¬äºŒç¯‡ï¼š ä»€éº¼ã€ç‚ºä½•ã€æ€éº¼åš (<em>æœ¬ç¯‡</em>)</strong></li>
<li>å¾…çºŒ</li>
</ul>
<p />
<hr>
<p><strong>åœ¨æœ¬ç¯‡æ–‡ç« ï¼Œæˆ‘æœƒæ³¨é‡åœ¨å°‹æ‰¾æˆ‘çš„æŠ€è¡“åˆ†äº«çš„ä»€éº¼ã€ç‚ºä½•ã€ä»¥åŠæ€éº¼åšã€‚</strong> åŠæ—©åšé€™äº›äº‹æƒ…å°‡å¹«åŠ©æˆ‘å…é™¤å¾Œé¢éšæ®µä»¤äººé ­ç—›çš„äº‹ã€‚</p>
<hr>
<p>å¦‚æœä½ é‚„æ²’çœ‹é<a href="https://zh.wikipedia.org/wiki/%E5%85%A8%E9%9D%A2%E5%95%9F%E5%8B%95">ã€Œå…¨é¢å•Ÿå‹•ã€</a>ï¼Œä»Šå¤©å¿«å»çœ‹ã€‚<br>
ä»–æ˜¯å€‹åŒ…å«è‘—é›¢å¥‡å¤æ€ªçš„è¦–è¦ºæ•ˆæœä»¥åŠåˆºæ¿€çš„æƒ…ç¯€çš„æœ‰è¶£æˆåŠŸé›»å½±ã€‚ä¸éå°±å¦‚åŒ <a href="https://mobile.twitter.com/ryanflorence">Ryan Florence</a> æ•™æˆ‘çš„ï¼Œé€™éƒ¨é›»å½±ä¹ŸåŒ…å«è‘—é—œæ–¼å¦‚ä½•å‰µé€ ä¸€å€‹ä»¤äººå°è±¡æ·±åˆ»çš„æ¼”èªªçš„å¥½å»ºè­°ã€‚</p>
<p>é‚£éƒ¨é›»å½±æ˜¯é—œæ–¼å¦‚ä½•æŠŠä½ çš„æƒ³æ³•åœ¨æŸäººç†Ÿç¡çš„æ™‚å€™æ”¾é€²ä»–çš„è…¦è¢‹è£¡ã€‚é€™è½èµ·ä¾†æˆ–è¨±æœ‰é»ä¾µå…¥æ€§ï¼ˆè€Œä¸”åœ¨é›»å½±è£¡æ˜¯çŠ¯æ³•çš„ï¼‰ï¼Œä½†å¦‚æœä½ å ±åæˆç‚ºä¸€å ´æŠ€è¡“åˆ†äº«çš„è¬›è€…ï¼Œå®ƒå°±æ˜¯ä¸€å€‹å°æ–¼ä½ å°‡é¢å°çš„æŒ‘æˆ°çš„éå¸¸ç²¾æº–çš„æè¿°ã€‚</p>
<hr>
<p><strong>ä»€éº¼æ˜¯ä½ æƒ³è¦è®“ä½ çš„è½çœ¾å¾ä½ çš„æ¼”è¬›è£¡ç²å¾—çš„ï¼Ÿ</strong> æˆ‘å˜—è©¦è‘—åŠæ—©å°‡å®ƒå»ºæ§‹æˆä¸€å€‹å¥å­ã€‚é€™å€‹æ¦‚å¿µä¸è©²å¤šæ–¼åå¹¾å€‹å­—ã€‚äººå€‘æœƒå¿˜è¨˜ä½ å¤§éƒ¨åˆ†çš„å…§å®¹ï¼Œæ‰€ä»¥ä½ éœ€è¦å°å¿ƒåœ°é¸æ“‡<em>ä»€éº¼</em>æ˜¯ä½ è©²è‘—é‡çš„æ±è¥¿ã€‚é€™æ˜¯ä½ æƒ³è¦ç¨®åœ¨ä»–å€‘è…¦æµ·è£¡çš„ç¨®å­ã€‚</p>
<p><img src="./totem.jpg" alt="ã€Œå…¨é¢å•Ÿå‹•ã€è£¡çš„é™€èº"></p>
<p>èˆ‰ä¾‹ä¾†èªªï¼Œä»¥ä¸‹æ˜¯ä¸€äº›æˆ‘çš„æŠ€è¡“åˆ†äº«è£¡çš„æ ¸å¿ƒæ¦‚å¿µã€‚</p>
<ul>
<li>
<p><a href="https://www.youtube.com/watch?v=xsSnOQynTHs">å³æ™‚é‡è¼‰ (Hot Reloading)</a>: ã€Œå‡½å¼çš„åŸå‰‡æ”¹å–„äº†é–‹ç™¼çš„æµç¨‹ã€‚ã€</p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=nLF0n9SACd4">Beyond React 16</a>: ã€Œç­‰å¾… CPUÂ å’Œ IO æœ‰äº†çµ±ä¸€çš„è§£æ³•ã€‚ã€</p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=dpw9EHDh2bM">ä»‹ç´¹ Hooks</a>: ã€ŒHooks è®“ç‹€æ…‹é‚è¼¯ (stateful logic) èƒ½å¤ é‡è¤‡ä½¿ç”¨ã€‚ã€</p>
</li>
</ul>
<p>æˆ‘ä¸¦ä¸æœƒæ¯æ¬¡éƒ½ç‰¹åˆ¥<em>èªªå‡º</em>æˆ‘çš„ä¸­å¿ƒæ€æƒ³æˆ–æŠŠå®ƒå¯«åœ¨æˆ‘çš„æŠ•å½±ç‰‡è£¡ï¼Œä½†å®ƒæ°¸é æ˜¯æˆ‘æŠ€è¡“åˆ†äº«è£¡çš„æ™ºæ…§éª¨å¹¹ã€‚ä»»ä½•æˆ‘èªªçš„æˆ–æˆ‘å±•ç¤ºçš„æ±è¥¿ï¼Œæœ€çµ‚éƒ½æ˜¯ç”¨ä¾†æ”¯æŒé€™å€‹ä¸­å¿ƒæ€æƒ³ã€‚æˆ‘æƒ³è¦å‘ä½ è­‰æ˜å®ƒã€‚</p>
<hr>
<p>æƒ³æ³•æ˜¯æˆ‘çš„æŠ€è¡“åˆ†äº«è£¡çš„ <strong>ã€Œä»€éº¼ã€</strong>ã€‚ä½†é‚„æœ‰ <strong>ã€Œæ€éº¼åšã€</strong> å’Œ <strong>ã€Œç‚ºä½•ã€</strong>ï¼š</p>
<p><img src="./how-what-why.png" alt="é‡‘å­—å¡”ï¼šã€Œæ€éº¼åšã€åœ¨ã€Œä»€éº¼ã€çš„ä¸Šé¢ã€‚ã€Œä»€éº¼ã€åœ¨ã€Œç‚ºä½•ã€çš„ä¸Šé¢ã€‚"></p>
<p><strong>ã€Œæ€éº¼åšã€</strong> æ˜¯æˆ‘å°‡æƒ³æ³•å‚³éçµ¦è§€çœ¾çš„æ–¹å¼ã€‚ä»¥æˆ‘è€Œå·²ï¼Œæˆ‘å–œæ­¡ç¾å ´ç¤ºç¯„ï¼Œä½†ä»æœ‰å¾ˆå¤šå…¶ä»–æœ‰ç”¨çš„æ–¹å¼ã€‚æˆ‘æœƒåœ¨ä¹‹å¾Œçš„ç³»åˆ—æ–‡ç« è£¡é¢æåˆ°æ›´å¤šçš„ã€Œæ€éº¼åšã€ã€‚</p>
<p>æˆ‘å€‘å·²ç¶“è¨è«–äº† <strong>ã€Œä»€éº¼ã€</strong> æ˜¯æ¼”è¬›è£¡çš„æ ¸å¿ƒæ€æƒ³ã€‚å®ƒæ˜¯æˆ‘æƒ³è¦ç¨®åœ¨ä½ è…¦æµ·è£¡çš„æƒ³æ³•ï¼Œä¹Ÿæ˜¯æˆ‘æƒ³è¦ä½ å¸¶èµ°çš„é ˜æ‚Ÿã€‚å®ƒæ˜¯æˆ‘æƒ³è¦å¤§å®¶è½å®Œå¾Œåˆ†äº«çµ¦æœ‹å‹æˆ–åŒäº‹çš„æ±è¥¿ã€‚</p>
<p>é€™å¸¶æˆ‘å€‘ä¾†åˆ°äº† <strong>ã€Œç‚ºä½•ã€</strong>ã€‚</p>
<hr>
<p>ç‚ºäº†è§£é‡‹ <strong>ã€Œç‚ºä½•ã€</strong>ï¼Œæˆ‘å°‡ç¯€éŒ„ã€Œå…¨é¢å•Ÿå‹•ã€è£¡çš„å°è©±ï¼š</p>
<p><strong>ï¼ˆè­¦å‘Šï¼š ä»¥ä¸‹æœ‰åŠ‡æƒ…é›·ï¼ï¼‰</strong></p>
<blockquote>
<p><strong>Cobb:</strong> ã€Œæˆ‘æœƒåˆ†è£‚æˆ‘çˆ¸çš„å¸åœ‹ã€‚ã€ç¾åœ¨ï¼Œé€™å€‹æ˜é¡¯æ˜¯ Robert æœƒæ‹’çµ•çš„ææ¡ˆã€‚é€™å°±æ˜¯ç‚ºä»€éº¼æˆ‘å€‘å¿…é ˆå°‡å®ƒæ·±æ·±ç¨®æ¤åœ¨ Robert çš„æ½›æ„è­˜è£¡ã€‚æ½›æ„è­˜æ˜¯è¢«æƒ…æ„Ÿçµ¦é©…å‹•çš„ï¼Œå°å§ï¼Ÿä¸æ˜¯ç†ç”±ã€‚æˆ‘å€‘å¿…é ˆæ‰¾åˆ°ä¸€ç¨®å¯ä»¥å°‡é€™å€‹æ¦‚å¿µç¨®æ¤åœ¨ä»–çš„æƒ…æ„Ÿæ¦‚å¿µè£¡çš„æ–¹æ³•ã€‚</p>
<p><strong>Arthur:</strong> ä½ è¦æ€éº¼æŠŠå•†æ¥­ç­–ç•¥è½‰æ›æˆæƒ…æ„Ÿï¼Ÿ</p>
<p><strong>Cobb:</strong> é€™å°±æ˜¯ç‚ºä»€éº¼æˆ‘å€‘éœ€è¦åœ¨é€™è£¡é‡æ¸…é€™ä»¶äº‹ã€‚æœ€å°‘æˆ‘å€‘çŸ¥é“ï¼Œç¾åœ¨ Robert è·Ÿä»–çˆ¸çš„é—œä¿‚å¾ˆç·Šå¼µã€‚</p>
<p><strong>Eames:</strong> æˆ‘å€‘å¯ä»¥è©¦è‘—åˆ©ç”¨å®ƒï¼Ÿæˆ‘å€‘å¯ä»¥å»ºè­°ä»–è—‰ç”±ã€Œæç ¸ã€é‚£å€‹è€äººä¾†å°‡å®ƒåˆ†é›¢å‡ºä»–çˆ¸çš„å…¬å¸ã€‚</p>
<p><strong>Cobb:</strong> ä¸ï¼Œæˆ‘è¦ºå¾—æ­£å‘æƒ…æ„Ÿæ°¸é éƒ½æ¯”è² é¢çš„æƒ…æ„Ÿæœ‰æ•ˆã€‚æˆ‘å€‘éƒ½æœŸå¾…å’Œè§£ã€æƒ…æ„Ÿå®£æ´©ã€‚æˆ‘å€‘éœ€è¦ Robert Fischer èƒ½å¤ ä»¥æ­£å‘çš„æƒ…æ„Ÿåæ‡‰ä¾†é¢å°é€™äº›ã€‚</p>
<p><strong>Eames:</strong> å¥½çš„ï¼Œä¸å¦‚è©¦è©¦é€™å€‹ï¼Ÿã€Œæˆ‘çš„çˆ¸çˆ¸å¸Œæœ›æˆ‘å¯ä»¥è‡ªå·±å»ºç«‹æˆ‘çš„æœªä¾†ï¼Œä¸è¦è·Ÿéš¨ä»–çš„è…³æ­¥ã€‚ã€</p>
<p><strong>Cobb:</strong> é€™å€‹å¯èƒ½è¡Œå¾—é€šã€‚</p>
</blockquote>
<p>ç¾åœ¨ï¼Œæˆ‘ä¸¦ä¸æ˜¯è¦å»ºè­°ä½ è·Ÿä½ çš„æ¼”è¬›åˆ†è§£å¸åœ‹ã€‚</p>
<p>ä½†é€™è£¡å¿…é ˆæœ‰å€‹ä½ èµ°å‡ºä¾†è·Ÿæˆåƒä¸Šè¬çš„äººæŠ€è¡“åˆ†äº«çš„<a href="/preparing-for-tech-talk-part-1-motivation/">åŸå› </a>ã€‚ä½ <em>ç›¸ä¿¡</em>æŸäº›äº‹æƒ… -- è€Œä¸”ä½ æƒ³è¦åˆ†äº«é€™äº›æ„Ÿå—ã€‚ <strong>é€™å°±æ˜¯ã€Œç‚ºä½•ã€-- ä½ æ¼”èªªè£¡çš„æƒ…æ„Ÿæ ¸å¿ƒã€‚</strong></p>
<hr>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›æˆ‘æ¼”è¬›è£¡ã€Œä»€éº¼ã€ã€ã€Œç‚ºä½•ã€ã€ã€Œæ€éº¼åšã€çš„ä¾‹å­ã€‚</p>
<p><a href="https://www.youtube.com/watch?v=xsSnOQynTHs" target="_blank"><img src="how-what-why-hot-reloading.png" alt="æ€éº¼åšï¼šã€Œç¾å ´ç¤ºç¯„ã€ã€‚ä»€éº¼ï¼šã€Œå‡½å¼çš„åŸå‰‡æ”¹å–„äº†é–‹ç™¼çš„æµç¨‹ã€ã€‚ç‚ºä½•ï¼šã€Œåšä¸€å€‹è®“å¯«ç¨‹å¼è®Šå¾—æœ‰è¶£çš„è‡ªå·±çš„å·¥å…·ã€ã€‚"></a></p>
<p><em>(ä¸Šé¢æ˜¯é—œæ–¼ <a href="https://www.youtube.com/watch?v=xsSnOQynTHs">Hot reloading with time travel</a> çš„é‡‘å­—å¡”)</em></p>
<p><a href="https://www.youtube.com/watch?v=nLF0n9SACd4" target="_blank"><img src="how-what-why-beyond-react-16.png" alt="æ€éº¼åšï¼šã€Œç¾å ´ç¤ºç¯„ã€ã€‚ä»€éº¼ï¼šã€Œç­‰å¾… CPUÂ å’Œ IO æœ‰äº†çµ±ä¸€çš„è§£æ³•ã€ã€‚ç‚ºä½•ï¼šã€ŒReact åœ¨ä¹ä½¿ç”¨è€…ä»¥åŠé–‹ç™¼è€…ã€ã€‚"></a></p>
<p><em>(ä¸Šé¢æ˜¯é—œæ–¼ <a href="https://www.youtube.com/watch?v=nLF0n9SACd4">Beyond React 16</a> çš„é‡‘å­—å¡”)</em></p>
<p><a href="https://www.youtube.com/watch?v=dpw9EHDh2bM" target="_blank"><img src="how-what-why-introducing-hooks.png" alt="æ€éº¼åšï¼šã€Œç¾å ´ç¤ºç¯„ã€ã€‚ä»€éº¼ï¼šã€ŒHooks è®“ç‹€æ…‹é‚è¼¯ (stateful logic) èƒ½å¤ é‡è¤‡ä½¿ç”¨ã€ã€‚ç‚ºä½•ï¼šã€ŒHooks æ­éœ²äº† React çš„çœŸæ­£è‡ªç„¶ç”Ÿæ…‹ã€ã€‚"></a></p>
<p><em>(ä¸Šé¢æ˜¯é—œæ–¼ <a href="https://www.youtube.com/watch?v=dpw9EHDh2bM">Introducing Hooks</a> çš„é‡‘å­—å¡”)</em></p>
<p>ä¸€å€‹ä»¤äººå°è±¡æ·±åˆ»çš„æ¼”èªªéœ€è¦ç°¡æ½”çš„æƒ³æ³•ã€è®“è§€çœ¾åœ¨ä¹å®ƒã€ä»¥åŠæ¸…æ¥šä¸”æœ‰èªªæœåŠ›çš„åŸ·è¡Œã€‚é€™å°±æ˜¯ã€Œä»€éº¼ã€ã€ã€Œç‚ºä½•ã€ã€ã€Œæ€éº¼åšã€ã€‚</p>
<hr>
<p>åœ¨é€™ç¯‡æ–‡ç« ï¼Œæˆ‘æè¿°äº†æˆ‘å¦‚ä½•æ¶æ§‹æˆ‘æ¼”èªªçš„æ ¸å¿ƒæ€æƒ³ã€‚å†ä¸€æ¬¡ï¼Œæˆ‘æƒ³è¦å¼·èª¿æˆ‘åªæ˜¯åˆ†äº«å°æˆ‘ä¾†èªªæœ‰ç”¨çš„æ–¹æ³• -- é‚„æœ‰å¾ˆå¤š<a href="https://mobile.twitter.com/jackiehluo/status/1077717283026411520">å…¶ä»–å½¢å¼çš„æ¼”èªª</a>ï¼Œä½ å°æ–¼å®ƒçš„è§€é»å¯èƒ½éå¸¸ä¸åŒã€‚</p>
<p>åœ¨æœªä¾†çš„ç³»åˆ—æ–‡ç« ä¸­ï¼Œæˆ‘å°‡æœƒæåˆ°å¦‚ä½•æº–å‚™æ¼”èªªçš„å¤§ç¶±ã€æŠ•å½±ç‰‡ã€æ¼”èªªçš„é æ¼”ï¼Œä»¥åŠæˆ‘åœ¨æ¼”èªªç•¶å¤©æ‰€åšçš„äº‹ã€‚</p>
<p><strong>æœ¬ç³»åˆ—å…ˆå‰çš„æ–‡ç« : <a href="/preparing-for-tech-talk-part-1-motivation/">æº–å‚™ä¸€å ´æŠ€è¡“åˆ†äº« - ç¬¬ä¸€ç¯‡ï¼šå‹•æ©Ÿ</a></strong>ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Preparing for a Tech Talk, PartÂ 2: What, Why, and How]]></title>
            <link>/post/preparing-for-tech-talk-part-2-what-why-and-how</link>
            <guid>/post/preparing-for-tech-talk-part-2-what-why-and-how</guid>
            <description><![CDATA[We need to go deeper.]]></description>
            <content:encoded><![CDATA[<p>Iâ€™ve done a <a href="https://www.youtube.com/watch?v=xsSnOQynTHs">few</a> <a href="https://www.youtube.com/watch?v=nLF0n9SACd4">tech</a> <a href="https://www.youtube.com/watch?v=dpw9EHDh2bM">talks</a> that I think went well.</p>
<p>Sometimes people ask me how I prepare for a talk. For every speaker, the answer is very personal. Iâ€™m just sharing what works for me.</p>
<p><strong>This is the second post in a series</strong> where I explain my process preparing for a tech talk â€” from conceiving the idea to the actual day of the presentation:</p>
<ul>
<li><strong><a href="/preparing-for-tech-talk-part-1-motivation/">Preparing for a Tech Talk, Part 1: Motivation</a></strong></li>
<li><strong>Preparing for a Tech Talk, Part 2: What, Why, and How (<em>this post</em>)</strong></li>
<li><strong><a href="/preparing-for-tech-talk-part-3-content/">Preparing for a Tech Talk, Part 3: Content</a></strong></li>
<li>To be continued</li>
</ul>
<p />
<hr>
<p><strong>In this post, I will focus on finding the What, Why, and How of my talk.</strong> Doing this early helps me avoid a lot of headache at a later stage.</p>
<hr>
<p>If you havenâ€™t seen <a href="https://en.wikipedia.org/wiki/Inception">Inception</a>, watch it today. Itâ€™s an enjoyable blockbuster with mindbending visuals and a stimulating plot. But as <a href="https://mobile.twitter.com/ryanflorence">Ryan Florence</a> taught me, it also contains good advice for creating a memorable talk.</p>
<p>That movie is about putting ideas into other peopleâ€™s heads while they sleep. This might sound a bit invasive (and is illegal in the movie). But if you signed up to give a tech talk, thatâ€™s a pretty accurate description of your challenge.</p>
<hr>
<p><strong>What is the one thing that you want people to take away from your talk?</strong> I try to formulate it as a sentence early on. This idea shouldnâ€™t be longer than a dozen words. People will forget most of what you say so you need to pick carefully <em>what</em> you want to stick. Itâ€™s the seed you want to plant in their heads.</p>
<p><img src="./totem.jpg" alt="Spinning top from the Inception movie"></p>
<p>For example, hereâ€™s the core ideas of my talks.</p>
<ul>
<li>
<p><a href="https://www.youtube.com/watch?v=xsSnOQynTHs">Hot Reloading</a>: â€œFunctional principles improve the development workflow.â€</p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=nLF0n9SACd4">Beyond React 16</a>: â€œWaiting for CPU and IO has a unified solution.â€</p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=dpw9EHDh2bM">Introducing Hooks</a>: â€œHooks make stateful logic reusable.â€</p>
</li>
</ul>
<p>I donâ€™t always explicitly <em>say</em> the central idea out loud or write it on a slide, but it is always the intellectual backbone of my talk. Everything I say and show must ultimately work towards supporting this idea. I want to prove it to you.</p>
<hr>
<p>An idea is the <strong>â€œWhatâ€</strong> of my talk. But there is also <strong>â€œHowâ€</strong> and <strong>â€œWhyâ€</strong>:</p>
<p><img src="./how-what-why.png" alt="Pyramid: â€œHowâ€ is on top of â€œWhatâ€. â€œWhatâ€ is on top of â€œWhyâ€."></p>
<p><strong>â€œHowâ€</strong> is my method for delivering the idea to the audience. Personally, I prefer live demos, but there are many things that can work. I will talk more about â€œHowâ€ in the later blog posts in this series.</p>
<p>Weâ€™ve just discussed <strong>â€œWhatâ€</strong> which is the core idea of the talk. Itâ€™s the thought I want to plant in your head and the insight I want you to walk away with. Itâ€™s what I want people to share with their friends and colleagues.</p>
<p>Which brings us to <strong>â€œWhyâ€</strong>.</p>
<hr>
<p>To explain <strong>â€œWhyâ€</strong>, Iâ€™ll quote this dialog from the Inception movie:</p>
<p><strong>(warning: spoilers!)</strong></p>
<blockquote>
<p><strong>Cobb:</strong> &quot;I will split up my father's empire.&quot; Now, this is obviously an idea that Robert himself will choose to reject. Which is why we need to plant it deep in his subconscious. The subconscious is motivated by emotion, right? Not reason. We need to find a way to translate this into an emotional concept.</p>
<p><strong>Arthur:</strong> How do you translate a business strategy into an emotion?</p>
<p><strong>Cobb:</strong> That's what we're here to figure out, right. Now Robert's relationship with his father is stressed, to say the least.</p>
<p><strong>Eames:</strong> Well can we run with that? We could suggest him breaking up his fathers company as a &quot;screw you&quot; to the old man.</p>
<p><strong>Cobb:</strong> No, cause I think positive emotion trumps negative emotion every time. We all yearn for reconciliation, for catharsis. We need Robert Fischer to have a positive emotional reaction to all this.</p>
<p><strong>Eames:</strong> Alright, well, try this? &quot;My father accepts that I want to create for myself, not follow in his footsteps.&quot;</p>
<p><strong>Cobb:</strong> That might work.</p>
</blockquote>
<p>Now, Iâ€™m not suggesting that you break up empires with your talk.</p>
<p>But there must be a <a href="/preparing-for-tech-talk-part-1-motivation/">reason</a> you get out in front of thousands of people to speak about something. You <em>believe</em> in something â€” and you want others to share that feeling. <strong>This is the â€œWhyâ€ â€” the emotional core of your talk.</strong></p>
<hr>
<p>Hereâ€™s the example â€œWhatâ€, â€œWhyâ€, and â€œHowâ€ from my talks.</p>
<p><a href="https://www.youtube.com/watch?v=xsSnOQynTHs" target="_blank"><img src="how-what-why-hot-reloading.png" alt="How: â€œLive demoâ€. What: â€œFunctional principles improve the developer experienceâ€. Why: â€œCreate your own tools to make programming funâ€."></a></p>
<p><em>(The above pyramid is for <a href="https://www.youtube.com/watch?v=xsSnOQynTHs">Hot reloading with time travel</a>)</em></p>
<p><a href="https://www.youtube.com/watch?v=nLF0n9SACd4" target="_blank"><img src="how-what-why-beyond-react-16.png" alt="How: â€œLive demoâ€. What: â€œWaiting for CPU and IO has a unified solutionâ€. Why: â€œReact cares about both user and developer experienceâ€."></a></p>
<p><em>(The above pyramid is for <a href="https://www.youtube.com/watch?v=nLF0n9SACd4">Beyond React 16</a>)</em></p>
<p><a href="https://www.youtube.com/watch?v=dpw9EHDh2bM" target="_blank"><img src="how-what-why-introducing-hooks.png" alt="How: â€œLive demoâ€. What: â€œHooks make stateful logic reusable. Why: â€œHooks reveal the true nature of Reactâ€."></a></p>
<p><em>(The above pyramid is for <a href="https://www.youtube.com/watch?v=dpw9EHDh2bM">Introducing Hooks</a>)</em></p>
<p>A memorable talk takes a concise idea, makes the audience care about it, and has a clear and convincing execution. Thatâ€™s the â€œWhatâ€, â€œWhyâ€, and â€œHowâ€.</p>
<hr>
<p>In this post, I described how I organize the core ideas of my talks. Again, I want to emphasize Iâ€™m just sharing what works for me â€” there are <a href="https://mobile.twitter.com/jackiehluo/status/1077717283026411520">many kinds of talks</a> and your outlook on this may be very different.</p>
<p>In the next posts in this series, I will talk about preparing the talk outline, slides, rehearsing the talks, and what I do on the day of the presentation.</p>
<p><strong>Next in this series: <a href="/preparing-for-tech-talk-part-3-content/">Preparing for a Tech Talk, Part 3: Content</a></strong>.</p>
<p><strong>Previous in this series: <a href="/preparing-for-tech-talk-part-1-motivation/">Preparing for a Tech Talk, Part 1: Motivation</a></strong>.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[å°† React ä½œä¸º UI è¿è¡Œæ—¶]]></title>
            <link>/post/react-as-a-ui-runtime-zh</link>
            <guid>/post/react-as-a-ui-runtime-zh</guid>
            <description><![CDATA[æ·±å…¥ç†è§£ React ç¼–ç¨‹æ¨¡å‹]]></description>
            <content:encoded><![CDATA[<p>å¤§å¤šæ•°æ•™ç¨‹æŠŠ React ç§°ä½œæ˜¯ä¸€ä¸ª UI åº“ã€‚è¿™æ˜¯æœ‰é“ç†çš„ï¼Œå› ä¸º React å°±æ˜¯ä¸€ä¸ª UI åº“ã€‚æ­£å¦‚å®˜ç½‘ä¸Šçš„æ ‡è¯­æ‰€è¯´çš„é‚£æ ·ã€‚</p>
<p><img src="./react.png" alt="React homepage screenshot: &quot;A JavaScript library for building user interfaces&quot;"></p>
<p>æˆ‘æ›¾ç»å†™è¿‡å…³äºæ„å»º<a href="/the-elements-of-ui-engineering/">ç”¨æˆ·ç•Œé¢</a>ä¼šé‡åˆ°çš„éš¾é¢˜ä¸€æ–‡ã€‚ä½†æ˜¯æœ¬ç¯‡æ–‡ç« å°†ä»¥ä¸€ç§ä¸åŒçš„æ–¹å¼æ¥è®²è¿° React â€” å› ä¸ºå®ƒæ›´åƒæ˜¯ä¸€ç§<a href="https://en.wikipedia.org/wiki/Runtime_system">ç¼–ç¨‹è¿è¡Œæ—¶</a>ã€‚</p>
<p><strong>æœ¬ç¯‡æ–‡ç« ä¸ä¼šæ•™ä½ ä»»ä½•æœ‰å…³å¦‚ä½•åˆ›å»ºç”¨æˆ·ç•Œé¢çš„æŠ€å·§ã€‚</strong> ä½†æ˜¯å®ƒå¯èƒ½ä¼šå¸®åŠ©ä½ æ›´æ·±å…¥åœ°ç†è§£ React ç¼–ç¨‹æ¨¡å‹ã€‚</p>
<hr>
<p><strong>æ³¨æ„ï¼šå¦‚æœä½ è¿˜åœ¨å­¦ä¹  React ï¼Œè¯·ç§»æ­¥åˆ°<a href="https://reactjs.org/docs/getting-started.html#learn-react">å®˜æ–¹æ–‡æ¡£</a>è¿›è¡Œå­¦ä¹ </strong></p>
<p><font size="60">âš ï¸</font></p>
<p><strong>æœ¬ç¯‡æ–‡ç« å°†ä¼šéå¸¸æ·±å…¥ â€” æ‰€ä»¥å¹¶ä¸é€‚åˆåˆå­¦è€…é˜…è¯»ã€‚</strong> åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¼šä»æœ€ä½³åŸåˆ™çš„è§’åº¦å°½å¯èƒ½åœ°é˜è¿° React ç¼–ç¨‹æ¨¡å‹ã€‚æˆ‘ä¸ä¼šè§£é‡Šå¦‚ä½•ä½¿ç”¨å®ƒ â€” è€Œæ˜¯è®²è§£å®ƒçš„åŸç†ã€‚</p>
<p>æ–‡ç« é¢å‘æœ‰ç»éªŒçš„ç¨‹åºå‘˜å’Œé‚£äº›ä½¿ç”¨è¿‡å…¶ä»– UI åº“ä½†åœ¨é¡¹ç›®ä¸­æƒè¡¡åˆ©å¼Šåæœ€ç»ˆé€‰æ‹©äº† React çš„äººï¼Œæˆ‘å¸Œæœ›å®ƒä¼šå¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼</p>
<p><strong>è®¸å¤šäººæˆåŠŸä½¿ç”¨äº† React å¤šå¹´å´ä»æœªè€ƒè™‘è¿‡ä¸‹é¢æˆ‘å°†è¦è®²è¿°çš„ä¸»é¢˜ã€‚</strong> è¿™è‚¯å®šæ˜¯ä»ç¨‹åºå‘˜çš„è§’åº¦æ¥çœ‹å¾… React ï¼Œè€Œä¸æ˜¯ä»¥<a href="http://mrmrs.cc/writing/2016/04/21/developing-ui/">è®¾è®¡è€…</a>çš„è§’åº¦ã€‚ä½†æˆ‘å¹¶ä¸è®¤ä¸ºç«™åœ¨ä¸¤ä¸ªä¸åŒçš„è§’åº¦æ¥é‡æ–°è®¤è¯† React ä¼šæœ‰ä»€ä¹ˆåå¤„ã€‚</p>
<p>è¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬å¼€å§‹æ·±å…¥ç†è§£ React å§ï¼</p>
<hr>
<h2>å®¿ä¸»æ ‘</h2>
<p>ä¸€äº›ç¨‹åºè¾“å‡ºæ•°å­—ã€‚å¦ä¸€äº›ç¨‹åºè¾“å‡ºè¯—è¯ã€‚ä¸åŒçš„è¯­è¨€å’Œå®ƒä»¬çš„è¿è¡Œæ—¶é€šå¸¸ä¼šå¯¹ç‰¹å®šçš„ä¸€ç»„ç”¨ä¾‹è¿›è¡Œä¼˜åŒ–ï¼Œè€Œ React ä¹Ÿä¸ä¾‹å¤–ã€‚</p>
<p>React ç¨‹åºé€šå¸¸ä¼šè¾“å‡º<strong>ä¸€æ£µä¼šéšæ—¶é—´å˜åŒ–çš„æ ‘ã€‚</strong> å®ƒæœ‰å¯èƒ½æ˜¯ä¸€æ£µ <a href="https://www.npmjs.com/package/react-dom">DOM æ ‘</a> ï¼Œ<a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/Devpedia-CocoaApp/View%20Hierarchy.html">iOS è§†å›¾å±‚</a> ï¼Œ<a href="https://react-pdf.org/">PDF åŸè¯­</a> ï¼Œåˆæˆ–æ˜¯ <a href="https://reactjs.org/docs/test-renderer.html">JSON å¯¹è±¡</a> ã€‚ç„¶è€Œï¼Œé€šå¸¸æˆ‘ä»¬å¸Œæœ›ç”¨å®ƒæ¥å±•ç¤º UI ã€‚æˆ‘ä»¬ç§°å®ƒä¸ºâ€œå®¿ä¸»æ ‘â€ï¼Œå› ä¸ºå®ƒå¾€å¾€æ˜¯ React ä¹‹å¤–å®¿ä¸»ç¯å¢ƒä¸­çš„ä¸€éƒ¨åˆ† â€” å°±åƒ DOM æˆ– iOS ã€‚å®¿ä¸»æ ‘é€šå¸¸æœ‰<a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild">å®ƒ</a><a href="https://developer.apple.com/documentation/uikit/uiview/1622616-addsubview">è‡ªå·±</a>çš„å‘½ä»¤å¼ API ã€‚è€Œ React å°±æ˜¯å®ƒä¸Šé¢çš„é‚£ä¸€å±‚ã€‚</p>
<p>æ‰€ä»¥åˆ°åº• React æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿéå¸¸æŠ½è±¡åœ°ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ ç¼–å†™å¯é¢„æµ‹çš„ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ“æ§å¤æ‚çš„å®¿ä¸»æ ‘è¿›è€Œå“åº”åƒç”¨æˆ·äº¤äº’ã€ç½‘ç»œå“åº”ã€å®šæ—¶å™¨ç­‰å¤–éƒ¨äº‹ä»¶çš„åº”ç”¨ç¨‹åºã€‚</p>
<p>å½“ä¸“ä¸šçš„å·¥å…·å¯ä»¥æ–½åŠ ç‰¹å®šçš„çº¦æŸä¸”èƒ½ä»ä¸­è·ç›Šæ—¶ï¼Œå®ƒæ¯”ä¸€èˆ¬çš„å·¥å…·è¦å¥½ã€‚React å°±æ˜¯è¿™æ ·çš„å…¸èŒƒï¼Œå¹¶ä¸”å®ƒåšæŒä¸¤ä¸ªåŸåˆ™ï¼š</p>
<ul>
<li><strong>ç¨³å®šæ€§ã€‚</strong> å®¿ä¸»æ ‘æ˜¯ç›¸å¯¹ç¨³å®šçš„ï¼Œå¤§å¤šæ•°æƒ…å†µçš„æ›´æ–°å¹¶ä¸ä¼šä»æ ¹æœ¬ä¸Šæ”¹å˜å…¶æ•´ä½“ç»“æ„ã€‚å¦‚æœåº”ç”¨ç¨‹åºæ¯ç§’éƒ½ä¼šå°†å…¶æ‰€æœ‰å¯äº¤äº’çš„å…ƒç´ é‡æ–°æ’åˆ—ä¸ºå®Œå…¨ä¸åŒçš„ç»„åˆï¼Œé‚£å°†ä¼šå˜å¾—éš¾ä»¥ä½¿ç”¨ã€‚é‚£ä¸ªæŒ‰é’®å»å“ªäº†ï¼Ÿä¸ºä»€ä¹ˆæˆ‘çš„å±å¹•åœ¨è·³èˆï¼Ÿ</li>
<li><strong>é€šç”¨æ€§ã€‚</strong> å®¿ä¸»æ ‘å¯ä»¥è¢«æ‹†åˆ†ä¸ºå¤–è§‚å’Œè¡Œä¸ºä¸€è‡´çš„ UI æ¨¡å¼ï¼ˆä¾‹å¦‚æŒ‰é’®ã€åˆ—è¡¨å’Œå¤´åƒï¼‰è€Œä¸æ˜¯éšæœºçš„å½¢çŠ¶ã€‚</li>
</ul>
<p><strong>è¿™äº›åŸåˆ™æ°å¥½é€‚ç”¨äºå¤§å¤šæ•° UI ã€‚</strong> ç„¶è€Œï¼Œå½“è¾“å‡ºæ²¡æœ‰ç¨³å®šçš„â€œæ¨¡å¼â€æ—¶ React å¹¶ä¸é€‚ç”¨ã€‚ä¾‹å¦‚ï¼ŒReact ä¹Ÿè®¸å¯ä»¥å¸®åŠ©ä½ ç¼–å†™ä¸€ä¸ª Twitter å®¢æˆ·ç«¯ï¼Œä½†å¯¹äºä¸€ä¸ª <a href="https://www.youtube.com/watch?v=Uzx9ArZ7MUU">3D ç®¡é“å±å¹•ä¿æŠ¤ç¨‹åº</a> å¹¶ä¸ä¼šèµ·å¤ªå¤§ä½œç”¨ã€‚</p>
<h2>å®¿ä¸»å®ä¾‹</h2>
<p>å®¿ä¸»æ ‘ç”±èŠ‚ç‚¹ç»„æˆï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œå®¿ä¸»å®ä¾‹â€ã€‚</p>
<p>åœ¨ DOM ç¯å¢ƒä¸­ï¼Œå®¿ä¸»å®ä¾‹å°±æ˜¯æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„ DOM èŠ‚ç‚¹ â€” å°±åƒå½“ä½ è°ƒç”¨ <code>document.createElement('div')</code> æ—¶è·å¾—çš„å¯¹è±¡ã€‚åœ¨ iOS ä¸­ï¼Œå®¿ä¸»å®ä¾‹å¯ä»¥æ˜¯ä» JavaScript åˆ°åŸç”Ÿè§†å›¾å”¯ä¸€æ ‡è¯†çš„å€¼ã€‚</p>
<p>å®¿ä¸»å®ä¾‹æœ‰å®ƒä»¬è‡ªå·±çš„å±æ€§ï¼ˆä¾‹å¦‚ <code>domNode.className</code> æˆ–è€… <code>view.tintColor</code> ï¼‰ã€‚å®ƒä»¬ä¹Ÿæœ‰å¯èƒ½å°†å…¶ä»–çš„å®¿ä¸»å®ä¾‹ä½œä¸ºå­é¡¹ã€‚</p>
<p>ï¼ˆè¿™å’Œ React æ²¡æœ‰ä»»ä½•è”ç³» â€” å› ä¸ºæˆ‘åœ¨è®²è¿°å®¿ä¸»ç¯å¢ƒã€‚ï¼‰</p>
<p>é€šå¸¸ä¼šæœ‰åŸç”Ÿçš„ API ç”¨äºæ“æ§è¿™äº›å®¿ä¸»å®ä¾‹ã€‚ä¾‹å¦‚ï¼Œåœ¨ DOM ç¯å¢ƒä¸­ä¼šæä¾›åƒ <code>appendChild</code>ã€<code>removeChild</code>ã€<code>setAttribute</code> ç­‰ä¸€ç³»åˆ—çš„ API ã€‚åœ¨ React åº”ç”¨ä¸­ï¼Œé€šå¸¸ä½ ä¸ä¼šè°ƒç”¨è¿™äº› API ï¼Œå› ä¸ºé‚£æ˜¯ React çš„å·¥ä½œã€‚</p>
<h2>æ¸²æŸ“å™¨</h2>
<p>æ¸²æŸ“å™¨æ•™ä¼š React å¦‚ä½•ä¸ç‰¹å®šçš„å®¿ä¸»ç¯å¢ƒé€šä¿¡ä»¥åŠå¦‚ä½•ç®¡ç†å®ƒçš„å®¿ä¸»å®ä¾‹ã€‚React DOMã€React Native ç”šè‡³ <a href="https://mobile.twitter.com/vadimdemedes/status/1089344289102942211">Ink</a> éƒ½å¯ä»¥ç§°ä½œ React æ¸²æŸ“å™¨ã€‚ä½ ä¹Ÿå¯ä»¥<a href="https://github.com/facebook/react/tree/master/packages/react-reconciler">åˆ›å»ºè‡ªå·±çš„ React æ¸²æŸ“å™¨</a> ã€‚</p>
<p>React æ¸²æŸ“å™¨èƒ½ä»¥ä¸‹é¢ä¸¤ç§æ¨¡å¼ä¹‹ä¸€è¿›è¡Œå·¥ä½œã€‚</p>
<p>ç»å¤§å¤šæ•°æ¸²æŸ“å™¨éƒ½è¢«ç”¨ä½œâ€œçªå˜â€æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼æ­£æ˜¯ DOM çš„å·¥ä½œæ–¹å¼ï¼šæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œè®¾ç½®å®ƒçš„å±æ€§ï¼Œåœ¨ä¹‹åå¾€é‡Œé¢å¢åŠ æˆ–è€…åˆ é™¤å­èŠ‚ç‚¹ã€‚å®¿ä¸»å®ä¾‹æ˜¯å®Œå…¨å¯å˜çš„ã€‚</p>
<p>ä½† React ä¹Ÿèƒ½ä»¥â€ä¸å˜â€œæ¨¡å¼å·¥ä½œã€‚è¿™ç§æ¨¡å¼é€‚ç”¨äºé‚£äº›å¹¶ä¸æä¾›åƒ <code>appendChild</code> çš„ API è€Œæ˜¯å…‹éš†åŒäº²æ ‘å¹¶å§‹ç»ˆæ›¿æ¢æ‰é¡¶çº§å­æ ‘çš„å®¿ä¸»ç¯å¢ƒã€‚åœ¨å®¿ä¸»æ ‘çº§åˆ«ä¸Šçš„ä¸å¯å˜æ€§ä½¿å¾—å¤šçº¿ç¨‹å˜å¾—æ›´åŠ å®¹æ˜“ã€‚<a href="https://facebook.github.io/react-native/blog/2018/06/14/state-of-react-native-2018">React Fabric</a> å°±åˆ©ç”¨äº†è¿™ä¸€æ¨¡å¼ã€‚</p>
<p>ä½œä¸º React çš„ä½¿ç”¨è€…ï¼Œä½ æ°¸è¿œä¸éœ€è¦è€ƒè™‘è¿™äº›æ¨¡å¼ã€‚æˆ‘åªæƒ³å¼ºè°ƒ React ä¸ä»…ä»…åªæ˜¯ä»ä¸€ç§æ¨¡å¼è½¬æ¢åˆ°å¦ä¸€ç§æ¨¡å¼çš„é€‚é…å™¨ã€‚å®ƒçš„ç”¨å¤„åœ¨äºä»¥ä¸€ç§æ›´å¥½çš„æ–¹å¼æ“æ§å®¿ä¸»å®ä¾‹è€Œä¸ç”¨åœ¨æ„é‚£äº›ä½çº§è§†å›¾ API èŒƒä¾‹ã€‚</p>
<h2>React å…ƒç´ </h2>
<p>åœ¨å®¿ä¸»ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªå®¿ä¸»å®ä¾‹ï¼ˆä¾‹å¦‚ DOM èŠ‚ç‚¹ï¼‰æ˜¯æœ€å°çš„æ„å»ºå•å…ƒã€‚è€Œåœ¨ React ä¸­ï¼Œæœ€å°çš„æ„å»ºå•å…ƒæ˜¯ React å…ƒç´ ã€‚</p>
<p>React å…ƒç´ æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ã€‚å®ƒç”¨æ¥æè¿°ä¸€ä¸ªå®¿ä¸»å®ä¾‹ã€‚</p>
<pre   class="language-jsx"><code class="language-jsx">// JSX æ˜¯ç”¨æ¥æè¿°è¿™äº›å¯¹è±¡çš„è¯­æ³•ç³–ã€‚
// &lt;button className=&quot;blue&quot; /&gt;
{
  type: 'button',
  props: { className: 'blue' }
}
</code></pre><p>React å…ƒç´ æ˜¯è½»é‡çº§çš„å› ä¸ºæ²¡æœ‰å®¿ä¸»å®ä¾‹ä¸å®ƒç»‘å®šåœ¨ä¸€èµ·ã€‚åŒæ ·çš„ï¼Œå®ƒåªæ˜¯å¯¹ä½ æƒ³è¦åœ¨å±å¹•ä¸Šçœ‹åˆ°çš„å†…å®¹çš„æè¿°ã€‚</p>
<p>å°±åƒå®¿ä¸»å®ä¾‹ä¸€æ ·ï¼ŒReact å…ƒç´ ä¹Ÿèƒ½å½¢æˆä¸€æ£µæ ‘ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">// JSX æ˜¯ç”¨æ¥æè¿°è¿™äº›å¯¹è±¡çš„è¯­æ³•ç³–ã€‚
// &lt;dialog&gt;
//   &lt;button className=&quot;blue&quot; /&gt;
//   &lt;button className=&quot;red&quot; /&gt;
// &lt;/dialog&gt;
{
  type: 'dialog',
  props: {
    children: [{
      type: 'button',
      props: { className: 'blue' }
    }, {
      type: 'button',
      props: { className: 'red' }
    }]
  }
}
</code></pre><p><em>(æ³¨æ„ï¼šæˆ‘çœç•¥äº†ä¸€äº›å¯¹æ­¤è§£é‡Šä¸é‡è¦çš„<a href="/why-do-react-elements-have-typeof-property/">å±æ€§</a>)</em></p>
<p>ä½†æ˜¯ï¼Œè¯·è®°ä½ <strong>React å…ƒç´ å¹¶ä¸æ˜¯æ°¸è¿œå­˜åœ¨çš„</strong> ã€‚å®ƒä»¬æ€»æ˜¯åœ¨é‡å»ºå’Œåˆ é™¤ä¹‹é—´ä¸æ–­å¾ªç¯ç€ã€‚</p>
<p>React å…ƒç´ å…·æœ‰ä¸å¯å˜æ€§ã€‚ä¾‹å¦‚ï¼Œä½ ä¸èƒ½æ”¹å˜ React å…ƒç´ ä¸­çš„å­å…ƒç´ æˆ–è€…å±æ€§ã€‚å¦‚æœä½ æƒ³è¦åœ¨ç¨åæ¸²æŸ“ä¸€äº›ä¸åŒçš„ä¸œè¥¿ï¼Œä½ éœ€è¦ä»å¤´åˆ›å»ºæ–°çš„ React å…ƒç´ æ ‘æ¥æè¿°å®ƒã€‚</p>
<p>æˆ‘å–œæ¬¢å°† React å…ƒç´ æ¯”ä½œç”µå½±ä¸­æ”¾æ˜ çš„æ¯ä¸€å¸§ã€‚å®ƒä»¬æ•æ‰ UI åœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ã€‚å®ƒä»¬æ°¸è¿œä¸ä¼šå†æ”¹å˜ã€‚</p>
<h2>å…¥å£</h2>
<p>æ¯ä¸€ä¸ª React æ¸²æŸ“å™¨éƒ½æœ‰ä¸€ä¸ªâ€œå…¥å£â€ã€‚æ­£æ˜¯é‚£ä¸ªç‰¹å®šçš„ API è®©æˆ‘ä»¬å‘Šè¯‰ React ï¼Œå°†ç‰¹å®šçš„ React å…ƒç´ æ ‘æ¸²æŸ“åˆ°çœŸæ­£çš„å®¿ä¸»å®ä¾‹ä¸­å»ã€‚</p>
<p>ä¾‹å¦‚ï¼ŒReact DOM çš„å…¥å£å°±æ˜¯ <code>ReactDOM.render</code> ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">ReactDOM.render(
  // { type: 'button', props: { className: 'blue' } }
  &lt;button className=&quot;blue&quot; /&gt;,
  document.getElementById('container')
);
</code></pre><p>å½“æˆ‘ä»¬è°ƒç”¨ <code>ReactDOM.render(reactElement, domContainer)</code> æ—¶ï¼Œæˆ‘ä»¬çš„æ„æ€æ˜¯ï¼š<strong>â€œäº²çˆ±çš„ React ï¼Œå°†æˆ‘çš„ <code>reactElement</code> æ˜ å°„åˆ° <code>domContaienr</code> çš„å®¿ä¸»æ ‘ä¸Šå»å§ã€‚â€œ</strong></p>
<p>React ä¼šæŸ¥çœ‹ <code>reactElement.type</code> ï¼ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ <code>button</code> ï¼‰ç„¶åå‘Šè¯‰ React DOM æ¸²æŸ“å™¨åˆ›å»ºå¯¹åº”çš„å®¿ä¸»å®ä¾‹å¹¶è®¾ç½®æ­£ç¡®çš„å±æ€§ï¼š</p>
<pre data-line="3,4,"  3,4="" class="language-jsx"><code 3,4="" class="language-jsx">// åœ¨ ReactDOM æ¸²æŸ“å™¨å†…éƒ¨ï¼ˆç®€åŒ–ç‰ˆï¼‰
function createHostInstance(reactElement) {
  let domNode = document.createElement(reactElement.type);
  domNode.className = reactElement.props.className;
  return domNode;
}
</code></pre><p>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒReact ä¼šè¿™æ ·åšï¼š</p>
<pre data-line="1,2,"  1,2="" class="language-jsx"><code 1,2="" class="language-jsx">let domNode = document.createElement('button');
domNode.className = 'blue';

domContainer.appendChild(domNode);
</code></pre><p>å¦‚æœ React å…ƒç´ åœ¨ <code>reactElement.props.children</code> ä¸­å«æœ‰å­å…ƒç´ ï¼ŒReact ä¼šåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­é€’å½’åœ°ä¸ºå®ƒä»¬åˆ›å»ºå®¿ä¸»å®ä¾‹ã€‚</p>
<h2>åè°ƒ</h2>
<p>å¦‚æœæˆ‘ä»¬ç”¨åŒä¸€ä¸ª container è°ƒç”¨ <code>ReactDOM.render()</code> ä¸¤æ¬¡ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p>
<pre data-line="2,11,"  2,11="" class="language-jsx"><code 2,11="" class="language-jsx">ReactDOM.render(
  &lt;button className=&quot;blue&quot; /&gt;,
  document.getElementById('container')
);

// ... ä¹‹å ...

// åº”è¯¥æ›¿æ¢æ‰ button å®¿ä¸»å®ä¾‹å—ï¼Ÿ
// è¿˜æ˜¯åœ¨å·²æœ‰çš„ button ä¸Šæ›´æ–°å±æ€§ï¼Ÿ
ReactDOM.render(
  &lt;button className=&quot;red&quot; /&gt;,
  document.getElementById('container')
);
</code></pre><p>åŒæ ·çš„ï¼ŒReact çš„å·¥ä½œæ˜¯å°† React å…ƒç´ æ ‘æ˜ å°„åˆ°å®¿ä¸»æ ‘ä¸Šå»ã€‚ç¡®å®šè¯¥å¯¹å®¿ä¸»å®ä¾‹åšä»€ä¹ˆæ¥å“åº”æ–°çš„ä¿¡æ¯æœ‰æ—¶å€™å«åš<a href="https://reactjs.org/docs/reconciliation.html">åè°ƒ</a> ã€‚</p>
<p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³å®ƒã€‚ç®€åŒ–ç‰ˆçš„ React ä¼šä¸¢å¼ƒå·²ç»å­˜åœ¨çš„æ ‘ç„¶åä»å¤´å¼€å§‹åˆ›å»ºå®ƒï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">let domContainer = document.getElementById('container');
// æ¸…é™¤æ‰åŸæ¥çš„æ ‘
domContainer.innerHTML = '';
// åˆ›å»ºæ–°çš„å®¿ä¸»å®ä¾‹æ ‘
let domNode = document.createElement('button');
domNode.className = 'red';
domContainer.appendChild(domNode);
</code></pre><p>ä½†æ˜¯åœ¨ DOM ç¯å¢ƒä¸‹ï¼Œè¿™æ ·çš„åšæ³•æ•ˆç‡ä½ä¸‹è€Œä¸”ä¼šä¸¢å¤±åƒ focusã€selectionã€scroll ç­‰è®¸å¤šçŠ¶æ€ã€‚ç›¸åï¼Œæˆ‘ä»¬å¸Œæœ› React è¿™æ ·åšï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">let domNode = domContainer.firstChild;
// æ›´æ–°å·²æœ‰çš„å®¿ä¸»å®ä¾‹
domNode.className = 'red';
</code></pre><p>æ¢å¥è¯è¯´ï¼ŒReact éœ€è¦å†³å®šä½•æ—¶æ›´æ–°ä¸€ä¸ªå·²æœ‰çš„å®¿ä¸»å®ä¾‹æ¥åŒ¹é…æ–°çš„ React å…ƒç´ ï¼Œä½•æ—¶è¯¥é‡æ–°åˆ›å»ºæ–°çš„å®¿ä¸»å®ä¾‹ã€‚</p>
<p>è¿™å°±å¼•å‡ºäº†ä¸€ä¸ªè¯†åˆ«é—®é¢˜ã€‚React å…ƒç´ å¯èƒ½æ¯æ¬¡éƒ½ä¸ç›¸åŒï¼Œåˆ°åº•ä»€ä¹ˆæ—¶å€™æ‰è¯¥ä»æ¦‚å¿µä¸Šå¼•ç”¨åŒä¸€ä¸ªå®¿ä¸»å®ä¾‹å‘¢ï¼Ÿ</p>
<p>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒå¾ˆç®€å•ã€‚æˆ‘ä»¬ä¹‹å‰æ¸²æŸ“äº† <code>&lt;button&gt;</code> ä½œä¸ºç¬¬ä¸€ä¸ªï¼ˆä¹Ÿæ˜¯å”¯ä¸€ï¼‰çš„å­å…ƒç´ ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æƒ³è¦åœ¨åŒä¸€ä¸ªåœ°æ–¹å†æ¬¡æ¸²æŸ“ <code>&lt;button&gt;</code> ã€‚åœ¨å®¿ä¸»å®ä¾‹ä¸­æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ª <code>&lt;button&gt;</code> ä¸ºä»€ä¹ˆè¿˜è¦é‡æ–°åˆ›å»ºå‘¢ï¼Ÿè®©æˆ‘ä»¬é‡ç”¨å®ƒã€‚</p>
<p>è¿™ä¸ React å¦‚ä½•æ€è€ƒå¹¶è§£å†³è¿™ç±»é—®é¢˜å·²ç»å¾ˆæ¥è¿‘äº†ã€‚</p>
<p><strong>å¦‚æœç›¸åŒçš„å…ƒç´ ç±»å‹åœ¨åŒä¸€ä¸ªåœ°æ–¹å…ˆåå‡ºç°ä¸¤æ¬¡ï¼ŒReact ä¼šé‡ç”¨å·²æœ‰çš„å®¿ä¸»å®ä¾‹ã€‚</strong></p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­ï¼Œå…¶ä¸­çš„æ³¨é‡Šå¤§è‡´è§£é‡Šäº† React æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p>
<pre data-line="9,10,16,26,27,"  9,10,16,26,27="" class="language-jsx"><code 9,10,16,26,27="" class="language-jsx">// let domNode = document.createElement('button');
// domNode.className = 'blue';
// domContainer.appendChild(domNode);
ReactDOM.render(
  &lt;button className=&quot;blue&quot; /&gt;,
  document.getElementById('container')
);

// èƒ½é‡ç”¨å®¿ä¸»å®ä¾‹å—ï¼Ÿèƒ½ï¼(button â†’ button)
// domNode.className = 'red';
ReactDOM.render(
  &lt;button className=&quot;red&quot; /&gt;,
  document.getElementById('container')
);

// èƒ½é‡ç”¨å®¿ä¸»å®ä¾‹å—ï¼Ÿä¸èƒ½ï¼(button â†’ p)
// domContainer.removeChild(domNode);
// domNode = document.createElement('p');
// domNode.textContent = 'Hello';
// domContainer.appendChild(domNode);
ReactDOM.render(
  &lt;p&gt;Hello&lt;/p&gt;,
  document.getElementById('container')
);

// èƒ½é‡ç”¨å®¿ä¸»å®ä¾‹å—ï¼Ÿèƒ½ï¼(p â†’ p)
// domNode.textContent = 'Goodbye';
ReactDOM.render(
  &lt;p&gt;Goodbye&lt;/p&gt;,
  document.getElementById('container')
);
</code></pre><p>åŒæ ·çš„å¯å‘å¼æ–¹æ³•ä¹Ÿé€‚ç”¨äºå­æ ‘ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬åœ¨ <code>&lt;dialog&gt;</code> ä¸­æ–°å¢ä¸¤ä¸ª <code>&lt;button&gt;</code> ï¼ŒReact ä¼šå…ˆå†³å®šæ˜¯å¦è¦é‡ç”¨ <code>&lt;dialog&gt;</code> ï¼Œç„¶åä¸ºæ¯ä¸€ä¸ªå­å…ƒç´ é‡å¤è¿™ä¸ªå†³å®šæ­¥éª¤ã€‚</p>
<h2>æ¡ä»¶</h2>
<p>å¦‚æœ React åœ¨æ¸²æŸ“æ›´æ–°å‰ååªé‡ç”¨é‚£äº›å…ƒç´ ç±»å‹åŒ¹é…çš„å®¿ä¸»å®ä¾‹ï¼Œé‚£å½“é‡åˆ°åŒ…å«æ¡ä»¶è¯­å¥çš„å†…å®¹æ—¶åˆè¯¥å¦‚ä½•æ¸²æŸ“å‘¢ï¼Ÿ</p>
<p>å‡è®¾æˆ‘ä»¬åªæƒ³é¦–å…ˆå±•ç¤ºä¸€ä¸ªè¾“å…¥æ¡†ï¼Œä½†ä¹‹åè¦åœ¨å®ƒä¹‹å‰æ¸²æŸ“ä¸€æ¡ä¿¡æ¯ï¼š</p>
<pre data-line="12,"  12="" class="language-jsx"><code 12="" class="language-jsx">// ç¬¬ä¸€æ¬¡æ¸²æŸ“
ReactDOM.render(
  &lt;dialog&gt;
    &lt;input /&gt;
  &lt;/dialog&gt;,
  domContainer
);

// ä¸‹ä¸€æ¬¡æ¸²æŸ“
ReactDOM.render(
  &lt;dialog&gt;
    &lt;p&gt;I was just added here!&lt;/p&gt;
    &lt;input /&gt;
  &lt;/dialog&gt;,
  domContainer
);
</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>&lt;input&gt;</code> å®¿ä¸»å®ä¾‹ä¼šè¢«é‡æ–°åˆ›å»ºã€‚React ä¼šéå†æ•´ä¸ªå…ƒç´ æ ‘ï¼Œå¹¶å°†å…¶ä¸å…ˆå‰çš„ç‰ˆæœ¬è¿›è¡Œæ¯”è¾ƒï¼š</p>
<ul>
<li><code>dialog â†’ dialog</code> ï¼šèƒ½é‡ç”¨å®¿ä¸»å®ä¾‹å—ï¼Ÿ<strong>èƒ½ â€” å› ä¸ºç±»å‹æ˜¯åŒ¹é…çš„ã€‚</strong>
<ul>
<li><code>input â†’ p</code> ï¼šèƒ½é‡ç”¨å®¿ä¸»å®ä¾‹å—ï¼Ÿ<strong>ä¸èƒ½ï¼Œç±»å‹æ”¹å˜äº†ï¼</strong> éœ€è¦åˆ é™¤å·²æœ‰çš„ <code>input</code> ç„¶åé‡æ–°åˆ›å»ºä¸€ä¸ª <code>p</code> å®¿ä¸»å®ä¾‹ã€‚</li>
<li><code>(nothing) â†’ input</code> ï¼šéœ€è¦é‡æ–°åˆ›å»ºä¸€ä¸ª <code>input</code> å®¿ä¸»å®ä¾‹ã€‚</li>
</ul>
</li>
</ul>
<p>å› æ­¤ï¼ŒReact ä¼šåƒè¿™æ ·æ‰§è¡Œæ›´æ–°ï¼š</p>
<pre data-line="1,2,8,9,"  1,2,8,9="" class="language-jsx"><code 1,2,8,9="" class="language-jsx">let oldInputNode = dialogNode.firstChild;
dialogNode.removeChild(oldInputNode);

let pNode = document.createElement('p');
pNode.textContent = 'I was just added here!';
dialogNode.appendChild(pNode);

let newInputNode = document.createElement('input');
dialogNode.appendChild(newInputNode);
</code></pre><p>è¿™æ ·çš„åšæ³•å¹¶ä¸ç§‘å­¦å› ä¸ºäº‹å®ä¸Š <code>&lt;input&gt;</code> å¹¶æ²¡æœ‰è¢« <code>&lt;p&gt;</code> æ‰€æ›¿ä»£ â€” å®ƒåªæ˜¯ç§»åŠ¨äº†ä½ç½®è€Œå·²ã€‚æˆ‘ä»¬ä¸å¸Œæœ›å› ä¸ºé‡å»º DOM è€Œä¸¢å¤±äº† selectionã€focus ç­‰çŠ¶æ€ä»¥åŠå…¶ä¸­çš„å†…å®¹ã€‚</p>
<p>è™½ç„¶è¿™ä¸ªé—®é¢˜å¾ˆå®¹æ˜“è§£å†³ï¼ˆåœ¨ä¸‹é¢æˆ‘ä¼šé©¬ä¸Šè®²åˆ°ï¼‰ï¼Œä½†è¿™ä¸ªé—®é¢˜åœ¨ React åº”ç”¨ä¸­å¹¶ä¸å¸¸è§ã€‚è€Œå½“æˆ‘ä»¬æ¢è®¨ä¸ºä»€ä¹ˆä¼šè¿™æ ·æ—¶å´å¾ˆæœ‰æ„æ€ã€‚</p>
<p>äº‹å®ä¸Šï¼Œä½ å¾ˆå°‘ä¼šç›´æ¥è°ƒç”¨ <code>ReactDOM.render</code> ã€‚ç›¸åï¼Œåœ¨ React åº”ç”¨ä¸­ç¨‹åºå¾€å¾€ä¼šè¢«æ‹†åˆ†æˆè¿™æ ·çš„å‡½æ•°ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">function Form({ showMessage }) {
  let message = null;
  if (showMessage) {
    message = &lt;p&gt;I was just added here!&lt;/p&gt;;
  }
  return (
    &lt;dialog&gt;
      {message}
      &lt;input /&gt;
    &lt;/dialog&gt;
  );
}
</code></pre><p>è¿™ä¸ªä¾‹å­å¹¶ä¸ä¼šé‡åˆ°åˆšåˆšæˆ‘ä»¬æ‰€æè¿°çš„é—®é¢˜ã€‚è®©æˆ‘ä»¬ç”¨å¯¹è±¡æ³¨é‡Šè€Œä¸æ˜¯ JSX ä¹Ÿè®¸å¯ä»¥æ›´å¥½åœ°ç†è§£å…¶ä¸­çš„åŸå› ã€‚æ¥çœ‹ä¸€ä¸‹ <code>dialog</code> ä¸­çš„å­å…ƒç´ æ ‘ï¼š</p>
<pre data-line="12-15,"  12-15="" class="language-jsx"><code 12-15="" class="language-jsx">function Form({ showMessage }) {
  let message = null;
  if (showMessage) {
    message = {
      type: 'p',
      props: { children: 'I was just added here!' }
    };
  }
  return {
    type: 'dialog',
    props: {
      children: [
        message,
        { type: 'input', props: {} }
      ]
    }
  };
}
</code></pre><p><strong>ä¸ç®¡ <code>showMessage</code> æ˜¯ <code>true</code> è¿˜æ˜¯ <code>false</code> ï¼Œåœ¨æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ <code>&lt;input&gt;</code> æ€»æ˜¯åœ¨ç¬¬äºŒä¸ªå­©å­çš„ä½ç½®ä¸”ä¸ä¼šæ”¹å˜ã€‚</strong></p>
<p>å¦‚æœ <code>showMessage</code> ä» <code>false</code> æ”¹å˜ä¸º <code>true</code> ï¼ŒReact ä¼šéå†æ•´ä¸ªå…ƒç´ æ ‘ï¼Œå¹¶ä¸ä¹‹å‰çš„ç‰ˆæœ¬è¿›è¡Œæ¯”è¾ƒï¼š</p>
<ul>
<li><code>dialog â†’ dialog</code> ï¼šèƒ½å¤Ÿé‡ç”¨å®¿ä¸»å®ä¾‹å—ï¼Ÿ<strong>èƒ½ â€” å› ä¸ºç±»å‹åŒ¹é…ã€‚</strong>
<ul>
<li><code>(null) â†’ p</code> ï¼šéœ€è¦æ’å…¥ä¸€ä¸ªæ–°çš„ <code>p</code> å®¿ä¸»å®ä¾‹ã€‚</li>
<li><code>input â†’ input</code> ï¼šèƒ½å¤Ÿé‡ç”¨å®¿ä¸»å®ä¾‹å—ï¼Ÿ<strong>èƒ½ â€” å› ä¸ºç±»å‹åŒ¹é…ã€‚</strong></li>
</ul>
</li>
</ul>
<p>ä¹‹å React å¤§è‡´ä¼šåƒè¿™æ ·æ‰§è¡Œä»£ç ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">let inputNode = dialogNode.firstChild;
let pNode = document.createElement('p');
pNode.textContent = 'I was just added here!';
dialogNode.insertBefore(pNode, inputNode);
</code></pre><p>è¿™æ ·ä¸€æ¥è¾“å…¥æ¡†ä¸­çš„çŠ¶æ€å°±ä¸ä¼šä¸¢å¤±äº†ã€‚</p>
<h2>åˆ—è¡¨</h2>
<p>æ¯”è¾ƒæ ‘ä¸­åŒä¸€ä½ç½®çš„å…ƒç´ ç±»å‹å¯¹äºæ˜¯å¦è¯¥é‡ç”¨è¿˜æ˜¯é‡å»ºç›¸åº”çš„å®¿ä¸»å®ä¾‹å¾€å¾€å·²ç»è¶³å¤Ÿã€‚</p>
<p>ä½†è¿™åªé€‚ç”¨äºå½“å­å…ƒç´ æ˜¯é™æ­¢çš„å¹¶ä¸”ä¸ä¼šé‡æ’åºçš„æƒ…å†µã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå³ä½¿ <code>message</code> ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä»ç„¶çŸ¥é“è¾“å…¥æ¡†åœ¨æ¶ˆæ¯ä¹‹åï¼Œå¹¶ä¸”å†æ²¡æœ‰å…¶ä»–çš„å­å…ƒç´ ã€‚</p>
<p>è€Œå½“é‡åˆ°åŠ¨æ€åˆ—è¡¨æ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½ç¡®å®šå…¶ä¸­çš„é¡ºåºæ€»æ˜¯ä¸€æˆä¸å˜çš„ã€‚</p>
<pre   class="language-jsx"><code class="language-jsx">function ShoppingList({ list }) {
  return (
    &lt;form&gt;
      {list.map(item =&gt; (
        &lt;p&gt;
          You bought {item.name}
          &lt;br /&gt;
          Enter how many do you want: &lt;input /&gt;
        &lt;/p&gt;
      ))}
    &lt;/form&gt;
  )
}
</code></pre><p>å¦‚æœæˆ‘ä»¬çš„å•†å“åˆ—è¡¨è¢«é‡æ–°æ’åºäº†ï¼ŒReact åªä¼šçœ‹åˆ°æ‰€æœ‰çš„ <code>p</code> ä»¥åŠé‡Œé¢çš„ <code>input</code> æ‹¥æœ‰ç›¸åŒçš„ç±»å‹ï¼Œå¹¶ä¸çŸ¥é“è¯¥å¦‚ä½•ç§»åŠ¨å®ƒä»¬ã€‚ï¼ˆåœ¨ React çœ‹æ¥ï¼Œè™½ç„¶è¿™äº›å•†å“æœ¬èº«æ”¹å˜äº†ï¼Œä½†æ˜¯å®ƒä»¬çš„é¡ºåºå¹¶æ²¡æœ‰æ”¹å˜ã€‚ï¼‰</p>
<p>æ‰€ä»¥ React ä¼šå¯¹è¿™åä¸ªå•†å“è¿›è¡Œç±»ä¼¼å¦‚ä¸‹çš„é‡æ’åºï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">for (let i = 0; i &lt; 10; i++) {
  let pNode = formNode.childNodes[i];
  let textNode = pNode.firstChild;
  textNode.textContent = 'You bought ' + items[i].name;
}
</code></pre><p>React åªä¼šå¯¹å…¶ä¸­çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œæ›´æ–°è€Œä¸æ˜¯å°†å…¶é‡æ–°æ’åºã€‚è¿™æ ·åšä¼šé€ æˆæ€§èƒ½ä¸Šçš„é—®é¢˜å’Œæ½œåœ¨çš„ bug ã€‚ä¾‹å¦‚ï¼Œå½“å•†å“åˆ—è¡¨çš„é¡ºåºæ”¹å˜æ—¶ï¼ŒåŸæœ¬åœ¨ç¬¬ä¸€ä¸ªè¾“å…¥æ¡†çš„å†…å®¹ä»ç„¶ä¼šå­˜åœ¨äºç°åœ¨çš„ç¬¬ä¸€ä¸ªè¾“å…¥æ¡†ä¸­ â€” å°½ç®¡äº‹å®ä¸Šåœ¨å•†å“åˆ—è¡¨é‡Œå®ƒåº”è¯¥ä»£è¡¨ç€å…¶ä»–çš„å•†å“ï¼</p>
<p><strong>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¯æ¬¡å½“è¾“å‡ºä¸­åŒ…å«å…ƒç´ æ•°ç»„æ—¶ï¼ŒReact éƒ½ä¼šè®©ä½ æŒ‡å®šä¸€ä¸ªå«åš <code>key</code> çš„å±æ€§ï¼š</strong></p>
<pre data-line="5,"  5="" class="language-jsx"><code 5="" class="language-jsx">function ShoppingList({ list }) {
  return (
    &lt;form&gt;
      {list.map(item =&gt; (
        &lt;p key={item.productId}&gt;
          You bought {item.name}
          &lt;br /&gt;
          Enter how many do you want: &lt;input /&gt;
        &lt;/p&gt;
      ))}
    &lt;/form&gt;
  )
}
</code></pre><p><code>key</code> ç»™äºˆ React åˆ¤æ–­å­å…ƒç´ æ˜¯å¦çœŸæ­£ç›¸åŒçš„èƒ½åŠ›ï¼Œå³ä½¿åœ¨æ¸²æŸ“å‰åå®ƒåœ¨çˆ¶å…ƒç´ ä¸­çš„ä½ç½®ä¸æ˜¯ç›¸åŒçš„ã€‚</p>
<p>å½“ React åœ¨ <code>&lt;form&gt;</code> ä¸­å‘ç° <code>&lt;p key=&quot;42&quot;&gt;</code> ï¼Œå®ƒå°±ä¼šæ£€æŸ¥ä¹‹å‰ç‰ˆæœ¬ä¸­çš„ <code>&lt;form&gt;</code> æ˜¯å¦åŒæ ·å«æœ‰ <code>&lt;p key=&quot;42&quot;&gt;</code> ã€‚å³ä½¿ <code>&lt;form&gt;</code> ä¸­çš„å­å…ƒç´ ä»¬æ”¹å˜ä½ç½®åï¼Œè¿™ä¸ªæ–¹æ³•åŒæ ·æœ‰æ•ˆã€‚åœ¨æ¸²æŸ“å‰åå½“ key ä»ç„¶ç›¸åŒæ—¶ï¼ŒReact ä¼šé‡ç”¨å…ˆå‰çš„å®¿ä¸»å®ä¾‹ï¼Œç„¶åé‡æ–°æ’åºå…¶å…„å¼Ÿå…ƒç´ ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ <code>key</code> åªä¸ç‰¹å®šçš„çˆ¶äº² React å…ƒç´ ç›¸å…³è”ï¼Œæ¯”å¦‚ <code>&lt;form&gt;</code> ã€‚React å¹¶ä¸ä¼šå»åŒ¹é…çˆ¶å…ƒç´ ä¸åŒä½† key ç›¸åŒçš„å­å…ƒç´ ã€‚ï¼ˆReact å¹¶æ²¡æœ‰æƒ¯ç”¨çš„æ”¯æŒå¯¹åœ¨ä¸é‡æ–°åˆ›å»ºå…ƒç´ çš„æƒ…å†µä¸‹è®©å®¿ä¸»å®ä¾‹åœ¨ä¸åŒçš„çˆ¶å…ƒç´ ä¹‹é—´ç§»åŠ¨ã€‚ï¼‰</p>
<p>ç»™ <code>key</code> èµ‹äºˆä»€ä¹ˆå€¼æœ€å¥½å‘¢ï¼Ÿæœ€å¥½çš„ç­”æ¡ˆå°±æ˜¯ï¼š<strong>ä»€ä¹ˆæ—¶å€™ä½ ä¼šè¯´ä¸€ä¸ªå…ƒç´ ä¸ä¼šæ”¹å˜å³ä½¿å®ƒåœ¨çˆ¶å…ƒç´ ä¸­çš„é¡ºåºè¢«æ”¹å˜ï¼Ÿ</strong> ä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„å•†å“åˆ—è¡¨ä¸­ï¼Œå•†å“æœ¬èº«çš„ ID æ˜¯åŒºåˆ«äºå…¶ä»–å•†å“çš„å”¯ä¸€æ ‡è¯†ï¼Œé‚£ä¹ˆå®ƒå°±æœ€é€‚åˆä½œä¸º <code>key</code> ã€‚</p>
<h2>ç»„ä»¶</h2>
<p>æˆ‘ä»¬å·²ç»çŸ¥é“å‡½æ•°ä¼šè¿”å› React å…ƒç´ ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">function Form({ showMessage }) {
  let message = null;
  if (showMessage) {
    message = &lt;p&gt;I was just added here!&lt;/p&gt;;
  }
  return (
    &lt;dialog&gt;
      {message}
      &lt;input /&gt;
    &lt;/dialog&gt;
  );
}
</code></pre><p>è¿™äº›å‡½æ•°è¢«å«åšç»„ä»¶ã€‚å®ƒä»¬è®©æˆ‘ä»¬å¯ä»¥æ‰“é€ è‡ªå·±çš„â€œå·¥å…·ç®±â€ï¼Œä¾‹å¦‚æŒ‰é’®ã€å¤´åƒã€è¯„è®ºæ¡†ç­‰ç­‰ã€‚ç»„ä»¶å°±åƒ React çš„é¢åŒ…å’Œé»„æ²¹ã€‚</p>
<p>ç»„ä»¶æ¥å—ä¸€ä¸ªå‚æ•° â€” å¯¹è±¡å“ˆå¸Œã€‚å®ƒåŒ…å«â€œpropsâ€ï¼ˆâ€œå±æ€§â€çš„ç®€ç§°ï¼‰ã€‚åœ¨è¿™é‡Œ <code>showMessage</code> å°±æ˜¯ä¸€ä¸ª prop ã€‚å®ƒä»¬å°±åƒæ˜¯å…·åå‚æ•°ä¸€æ ·ã€‚</p>
<h2>çº¯å‡€</h2>
<p>React ç»„ä»¶ä¸­å¯¹äº props åº”è¯¥æ˜¯çº¯å‡€çš„ã€‚</p>
<pre   class="language-jsx"><code class="language-jsx">function Button(props) {
  // ğŸ”´ æ²¡æœ‰ä½œç”¨
  props.isActive = true;
}
</code></pre><p>é€šå¸¸æ¥è¯´ï¼Œçªå˜åœ¨ React ä¸­ä¸æ˜¯æƒ¯ç”¨çš„ã€‚ï¼ˆæˆ‘ä»¬ä¼šåœ¨ä¹‹åè®²è§£å¦‚ä½•ç”¨æ›´æƒ¯ç”¨çš„æ–¹å¼æ¥æ›´æ–° UI ä»¥å“åº”äº‹ä»¶ã€‚ï¼‰</p>
<p>ä¸è¿‡ï¼Œå±€éƒ¨çš„çªå˜æ˜¯ç»å¯¹å…è®¸çš„ï¼š</p>
<pre data-line="2,5,"  2,5="" class="language-jsx"><code 2,5="" class="language-jsx">function FriendList({ friends }) {
  let items = [];
  for (let i = 0; i &lt; friends.length; i++) {
    let friend = friends[i];
    items.push(
      &lt;Friend key={friend.id} friend={friend} /&gt;
    );
  }
  return &lt;section&gt;{items}&lt;/section&gt;;
}
</code></pre><p>å½“æˆ‘ä»¬åœ¨å‡½æ•°ç»„ä»¶å†…éƒ¨åˆ›å»º <code>items</code> æ—¶ä¸ç®¡æ€æ ·æ”¹å˜å®ƒéƒ½è¡Œï¼Œåªè¦è¿™äº›çªå˜å‘ç”Ÿåœ¨å°†å…¶ä½œä¸ºæœ€åçš„æ¸²æŸ“ç»“æœä¹‹å‰ã€‚æ‰€ä»¥å¹¶ä¸éœ€è¦é‡å†™ä½ çš„ä»£ç æ¥é¿å…å±€éƒ¨çªå˜ã€‚</p>
<p>åŒæ ·åœ°ï¼Œæƒ°æ€§åˆå§‹åŒ–æ˜¯è¢«å…è®¸çš„å³ä½¿å®ƒä¸æ˜¯å®Œå…¨â€œçº¯å‡€â€çš„ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">function ExpenseForm() {
  // åªè¦ä¸å½±å“å…¶ä»–ç»„ä»¶è¿™æ˜¯è¢«å…è®¸çš„ï¼š
  SuperCalculator.initializeIfNotReady();

  // ç»§ç»­æ¸²æŸ“......
}
</code></pre><p>åªè¦è°ƒç”¨ç»„ä»¶å¤šæ¬¡æ˜¯å®‰å…¨çš„ï¼Œå¹¶ä¸”ä¸ä¼šå½±å“å…¶ä»–ç»„ä»¶çš„æ¸²æŸ“ï¼ŒReact å¹¶ä¸å…³å¿ƒä½ çš„ä»£ç æ˜¯å¦åƒä¸¥æ ¼çš„å‡½æ•°å¼ç¼–ç¨‹ä¸€æ ·ç™¾åˆ†ç™¾çº¯å‡€ã€‚åœ¨ React ä¸­ï¼Œ<a href="https://stackoverflow.com/questions/1077412/what-is-an-idempotent-operation">å¹‚ç­‰æ€§</a>æ¯”çº¯å‡€æ€§æ›´åŠ é‡è¦ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ React ç»„ä»¶ä¸­ä¸å…è®¸æœ‰ç”¨æˆ·å¯ä»¥ç›´æ¥çœ‹åˆ°çš„å‰¯ä½œç”¨ã€‚æ¢å¥è¯è¯´ï¼Œä»…è°ƒç”¨å‡½æ•°å¼ç»„ä»¶æ—¶ä¸åº”è¯¥åœ¨å±å¹•ä¸Šäº§ç”Ÿä»»ä½•å˜åŒ–ã€‚</p>
<h2>é€’å½’</h2>
<p>æˆ‘ä»¬è¯¥å¦‚ä½•åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ç»„ä»¶ï¼Ÿç»„ä»¶å±äºå‡½æ•°å› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥è¿›è¡Œè°ƒç”¨ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">let reactElement = Form({ showMessage: true });
ReactDOM.render(reactElement, domContainer);
</code></pre><p>ç„¶è€Œï¼Œåœ¨ React è¿è¡Œæ—¶ä¸­è¿™å¹¶ä¸æ˜¯æƒ¯ç”¨çš„ä½¿ç”¨ç»„ä»¶çš„æ–¹å¼ã€‚</p>
<p>ç›¸åï¼Œä½¿ç”¨ç»„ä»¶æƒ¯ç”¨çš„æ–¹å¼ä¸æˆ‘ä»¬å·²ç»äº†è§£çš„æœºåˆ¶ç›¸åŒ â€” å³ React å…ƒç´ ã€‚<strong>è¿™æ„å‘³ç€ä¸éœ€è¦ä½ ç›´æ¥è°ƒç”¨ç»„ä»¶å‡½æ•°ï¼ŒReact ä¼šåœ¨ä¹‹åä¸ºä½ åšè¿™ä»¶äº‹æƒ…ï¼š</strong></p>
<pre   class="language-jsx"><code class="language-jsx">// { type: Form, props: { showMessage: true } }
let reactElement = &lt;Form showMessage={true} /&gt;;
ReactDOM.render(reactElement, domContainer);
</code></pre><p>ç„¶ååœ¨ React å†…éƒ¨ï¼Œä½ çš„ç»„ä»¶ä¼šè¿™æ ·è¢«è°ƒç”¨ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">// React å†…éƒ¨çš„æŸä¸ªåœ°æ–¹
let type = reactElement.type; // Form
let props = reactElement.props; // { showMessage: true }
let result = type(props); // æ— è®º Form ä¼šè¿”å›ä»€ä¹ˆ
</code></pre><p>ç»„ä»¶å‡½æ•°åç§°æŒ‰ç…§è§„å®šéœ€è¦å¤§å†™ã€‚å½“ JSX è½¬æ¢æ—¶çœ‹è§ <code>&lt;Form&gt;</code> è€Œä¸æ˜¯ <code>&lt;form&gt;</code> ï¼Œå®ƒè®©å¯¹è±¡ <code>type</code> æœ¬èº«æˆä¸ºæ ‡è¯†ç¬¦è€Œä¸æ˜¯å­—ç¬¦ä¸²ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">console.log(&lt;form /&gt;.type); // 'form' å­—ç¬¦ä¸²
console.log(&lt;Form /&gt;.type); // Form å‡½æ•°
</code></pre><p>æˆ‘ä»¬å¹¶æ²¡æœ‰å…¨å±€çš„æ³¨å†Œæœºåˆ¶ â€” å­—é¢ä¸Šå½“æˆ‘ä»¬è¾“å…¥ <code>&lt;Form&gt;</code> æ—¶ä»£è¡¨ç€ <code>Form</code> ã€‚å¦‚æœ <code>Form</code> åœ¨å±€éƒ¨ä½œç”¨åŸŸä¸­å¹¶ä¸å­˜åœ¨ï¼Œä½ ä¼šå‘ç°ä¸€ä¸ª JavaScript é”™è¯¯ï¼Œå°±åƒå¹³å¸¸ä½ ä½¿ç”¨é”™è¯¯çš„å˜é‡åç§°ä¸€æ ·ã€‚</p>
<p><strong>å› æ­¤ï¼Œå½“å…ƒç´ ç±»å‹æ˜¯ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ React ä¼šåšä»€ä¹ˆå‘¢ï¼Ÿå®ƒä¼šè°ƒç”¨ä½ çš„ç»„ä»¶ï¼Œç„¶åè¯¢é—®ç»„ä»¶æƒ³è¦æ¸²æŸ“ä»€ä¹ˆå…ƒç´ ã€‚</strong></p>
<p>è¿™ä¸ªæ­¥éª¤ä¼šé€’å½’å¼åœ°æ‰§è¡Œä¸‹å»ï¼Œæ›´è¯¦ç»†çš„æè¿°åœ¨<a href="https://reactjs.org/blog/2015/12/18/react-components-elements-and-instances.html">è¿™é‡Œ</a> ã€‚æ€»çš„æ¥è¯´ï¼Œå®ƒä¼šåƒè¿™æ ·æ‰§è¡Œï¼š</p>
<ul>
<li><strong>ä½ ï¼š</strong> <code>ReactDOM.render(&lt;App /&gt;, domContainer)</code></li>
<li><strong>Reactï¼š</strong> <code>App</code> ï¼Œä½ æƒ³è¦æ¸²æŸ“ä»€ä¹ˆï¼Ÿ
<ul>
<li><code>App</code> ï¼šæˆ‘è¦æ¸²æŸ“åŒ…å« <code>&lt;Content&gt;</code> çš„ <code>&lt;Layout&gt;</code> ã€‚</li>
</ul>
</li>
<li><strong>Reactï¼š</strong> <code>&lt;Layout&gt;</code> ï¼Œä½ è¦æ¸²æŸ“ä»€ä¹ˆï¼Ÿ
<ul>
<li><code>Layout</code> ï¼šæˆ‘è¦åœ¨ <code>&lt;div&gt;</code> ä¸­æ¸²æŸ“æˆ‘çš„å­å…ƒç´ ã€‚æˆ‘çš„å­å…ƒç´ æ˜¯ <code>&lt;Content&gt;</code> æ‰€ä»¥æˆ‘çŒœå®ƒåº”è¯¥æ¸²æŸ“åˆ° <code>&lt;div&gt;</code> ä¸­å»ã€‚</li>
</ul>
</li>
<li><strong>Reactï¼š</strong> <code>&lt;Content&gt;</code> ï¼Œä½ è¦æ¸²æŸ“ä»€ä¹ˆï¼Ÿ
<ul>
<li><code>&lt;Content&gt;</code> ï¼šæˆ‘è¦åœ¨ <code>&lt;article&gt;</code> ä¸­æ¸²æŸ“ä¸€äº›æ–‡æœ¬å’Œ <code>&lt;Footer&gt;</code> ã€‚</li>
</ul>
</li>
<li><strong>Reactï¼š</strong> <code>&lt;Footer&gt;</code> ï¼Œä½ è¦æ¸²æŸ“ä»€ä¹ˆï¼Ÿ
<ul>
<li><code>&lt;Footer&gt;</code> ï¼šæˆ‘è¦æ¸²æŸ“å«æœ‰æ–‡æœ¬çš„ <code>&lt;footer&gt;</code> ã€‚</li>
</ul>
</li>
<li><strong>Reactï¼š</strong> å¥½çš„ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼š</li>
</ul>
<pre   class="language-jsx"><code class="language-jsx">// æœ€ç»ˆçš„ DOM ç»“æ„
&lt;div&gt;
  &lt;article&gt;
    Some text
    &lt;footer&gt;some more text&lt;/footer&gt;
  &lt;/article&gt;
&lt;/div&gt;
</code></pre><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¯´åè°ƒæ˜¯é€’å½’å¼çš„ã€‚å½“ React éå†æ•´ä¸ªå…ƒç´ æ ‘æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°å…ƒç´ çš„ <code>type</code> æ˜¯ä¸€ä¸ªç»„ä»¶ã€‚React ä¼šè°ƒç”¨å®ƒç„¶åç»§ç»­æ²¿ç€è¿”å›çš„ React å…ƒç´ ä¸‹è¡Œã€‚æœ€ç»ˆæˆ‘ä»¬ä¼šè°ƒç”¨å®Œæ‰€æœ‰çš„ç»„ä»¶ï¼Œç„¶å React å°±ä¼šçŸ¥é“è¯¥å¦‚ä½•æ”¹å˜å®¿ä¸»æ ‘ã€‚</p>
<p>åœ¨ä¹‹å‰å·²ç»è®¨è®ºè¿‡çš„ç›¸åŒçš„åè°ƒå‡†åˆ™ï¼Œåœ¨è¿™ä¸€æ ·é€‚ç”¨ã€‚å¦‚æœåœ¨åŒä¸€ä½ç½®çš„ <code>type</code> æ”¹å˜äº†ï¼ˆç”±ç´¢å¼•å’Œå¯é€‰çš„ <code>key</code> å†³å®šï¼‰ï¼ŒReact ä¼šåˆ é™¤å…¶ä¸­çš„å®¿ä¸»å®ä¾‹å¹¶å°†å…¶é‡å»ºã€‚</p>
<h2>æ§åˆ¶åè½¬</h2>
<p>ä½ ä¹Ÿè®¸ä¼šå¥½å¥‡ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ç›´æ¥è°ƒç”¨ç»„ä»¶ï¼Ÿä¸ºä»€ä¹ˆè¦ç¼–å†™ <code>&lt;Form /&gt;</code> è€Œä¸æ˜¯ <code>Form()</code> ï¼Ÿ</p>
<p><strong>React èƒ½å¤Ÿåšçš„æ›´å¥½å¦‚æœå®ƒâ€œçŸ¥æ™“â€ä½ çš„ç»„ä»¶è€Œä¸æ˜¯åœ¨ä½ é€’å½’è°ƒç”¨å®ƒä»¬ä¹‹åç”Ÿæˆçš„ React å…ƒç´ æ ‘ã€‚</strong></p>
<pre   class="language-jsx"><code class="language-jsx">// ğŸ”´ React å¹¶ä¸çŸ¥é“ Layout å’Œ Article çš„å­˜åœ¨ã€‚
// å› ä¸ºä½ åœ¨è°ƒç”¨å®ƒä»¬ã€‚
ReactDOM.render(
  Layout({ children: Article() }),
  domContainer
)

// âœ… ReactçŸ¥é“ Layout å’Œ Article çš„å­˜åœ¨ã€‚
// React æ¥è°ƒç”¨å®ƒä»¬ã€‚
ReactDOM.render(
  &lt;Layout&gt;&lt;Article /&gt;&lt;/Layout&gt;,
  domContainer
)
</code></pre><p>è¿™æ˜¯ä¸€ä¸ªå…³äº<a href="https://en.wikipedia.org/wiki/Inversion_of_control">æ§åˆ¶åè½¬</a>çš„ç»å…¸æ¡ˆä¾‹ã€‚é€šè¿‡è®© React è°ƒç”¨æˆ‘ä»¬çš„ç»„ä»¶ï¼Œæˆ‘ä»¬ä¼šè·å¾—ä¸€äº›æœ‰è¶£çš„å±æ€§ï¼š</p>
<ul>
<li><strong>ç»„ä»¶ä¸ä»…ä»…åªæ˜¯å‡½æ•°ã€‚</strong> React èƒ½å¤Ÿç”¨åœ¨æ ‘ä¸­ä¸ç»„ä»¶æœ¬èº«ç´§å¯†ç›¸è¿çš„å±€éƒ¨çŠ¶æ€ç­‰ç‰¹æ€§æ¥å¢å¼ºç»„ä»¶åŠŸèƒ½ã€‚ä¼˜ç§€çš„è¿è¡Œæ—¶æä¾›äº†ä¸å½“å‰é—®é¢˜ç›¸åŒ¹é…çš„åŸºæœ¬æŠ½è±¡ã€‚å°±åƒæˆ‘ä»¬å·²ç»æåˆ°è¿‡çš„ï¼ŒReact ä¸“é—¨é’ˆå¯¹äºé‚£äº›æ¸²æŸ“ UI æ ‘å¹¶ä¸”èƒ½å¤Ÿå“åº”äº¤äº’çš„åº”ç”¨ã€‚å¦‚æœä½ ç›´æ¥è°ƒç”¨äº†ç»„ä»¶ï¼Œä½ å°±åªèƒ½è‡ªå·±æ¥æ„å»ºè¿™äº›ç‰¹æ€§äº†ã€‚</li>
<li><strong>ç»„ä»¶ç±»å‹å‚ä¸åè°ƒã€‚</strong> é€šè¿‡ React æ¥è°ƒç”¨ä½ çš„ç»„ä»¶ï¼Œèƒ½è®©å®ƒäº†è§£æ›´å¤šå…³äºå…ƒç´ æ ‘çš„ç»“æ„ã€‚ä¾‹å¦‚ï¼Œå½“ä½ ä»æ¸²æŸ“ <code>&lt;Feed&gt;</code> é¡µé¢è½¬åˆ° <code>Profile</code> é¡µé¢ï¼ŒReact ä¸ä¼šå°è¯•é‡ç”¨å…¶ä¸­çš„å®¿ä¸»å®ä¾‹ â€” å°±åƒä½ ç”¨ <code>&lt;p&gt;</code> æ›¿æ¢æ‰ <code>&lt;button&gt;</code> ä¸€æ ·ã€‚æ‰€æœ‰çš„çŠ¶æ€éƒ½ä¼šä¸¢å¤± â€” å¯¹äºæ¸²æŸ“å®Œå…¨ä¸åŒçš„è§†å›¾æ—¶ï¼Œé€šå¸¸æ¥è¯´è¿™æ˜¯ä¸€ä»¶å¥½äº‹ã€‚ä½ ä¸ä¼šæƒ³è¦åœ¨ <code>&lt;PasswordForm&gt;</code> å’Œ  <code>&lt;MessengerChat&gt;</code> ä¹‹é—´ä¿ç•™è¾“å…¥æ¡†çš„çŠ¶æ€å°½ç®¡ <code>&lt;input&gt;</code> çš„ä½ç½®æ„å¤–åœ°â€œæ’åˆ—â€åœ¨å®ƒä»¬ä¹‹é—´ã€‚</li>
<li><strong>React èƒ½å¤Ÿæ¨è¿Ÿåè°ƒã€‚</strong> å¦‚æœè®© React æ§åˆ¶è°ƒç”¨ä½ çš„ç»„ä»¶ï¼Œå®ƒèƒ½åšå¾ˆå¤šæœ‰è¶£çš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥è®©æµè§ˆå™¨åœ¨ç»„ä»¶è°ƒç”¨ä¹‹é—´åšä¸€äº›å·¥ä½œï¼Œè¿™æ ·é‡æ¸²æŸ“å¤§ä½“é‡çš„ç»„ä»¶æ ‘æ—¶å°±<a href="https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html">ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹</a>ã€‚æƒ³è¦æ‰‹åŠ¨ç¼–æ’è¿™ä¸ªè¿‡ç¨‹è€Œä¸ä¾èµ– React çš„è¯å°†ä¼šååˆ†å›°éš¾ã€‚</li>
<li><strong>æ›´å¥½çš„å¯è°ƒè¯•æ€§ã€‚</strong> å¦‚æœç»„ä»¶æ˜¯åº“ä¸­æ‰€é‡è§†çš„ä¸€ç­‰å…¬æ°‘ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„å»º<a href="https://github.com/facebook/react-devtools">ä¸°å¯Œçš„å¼€å‘è€…å·¥å…·</a>ï¼Œç”¨äºå¼€å‘ä¸­çš„è‡ªçœã€‚</li>
</ul>
<p>è®© React è°ƒç”¨ä½ çš„ç»„ä»¶å‡½æ•°è¿˜æœ‰æœ€åä¸€ä¸ªå¥½å¤„å°±æ˜¯æƒ°æ€§æ±‚å€¼ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯ä»€ä¹ˆæ„æ€ã€‚</p>
<h2>æƒ°æ€§æ±‚å€¼</h2>
<p>å½“æˆ‘ä»¬åœ¨ JavaScript ä¸­è°ƒç”¨å‡½æ•°æ—¶ï¼Œå‚æ•°å¾€å¾€åœ¨å‡½æ•°è°ƒç”¨ä¹‹å‰è¢«æ‰§è¡Œã€‚</p>
<pre   class="language-jsx"><code class="language-jsx">// (2) å®ƒä¼šä½œä¸ºç¬¬äºŒä¸ªè®¡ç®—
eat(
  // (1) å®ƒä¼šé¦–å…ˆè®¡ç®—
  prepareMeal()
);
</code></pre><p>è¿™é€šå¸¸æ˜¯ JavaScript å¼€å‘è€…æ‰€æœŸæœ›çš„å› ä¸º JavaScript å‡½æ•°å¯èƒ½æœ‰éšå«çš„å‰¯ä½œç”¨ã€‚å¦‚æœæˆ‘ä»¬è°ƒç”¨äº†ä¸€ä¸ªå‡½æ•°ï¼Œä½†ç›´åˆ°å®ƒçš„ç»“æœä¸çŸ¥æ€åœ°è¢«â€œä½¿ç”¨â€åè¯¥å‡½æ•°ä»æ²¡æœ‰æ‰§è¡Œï¼Œè¿™ä¼šè®©æˆ‘ä»¬æ„Ÿåˆ°ååˆ†è¯§å¼‚ã€‚</p>
<p>ä½†æ˜¯ï¼ŒReact ç»„ä»¶æ˜¯<a href="#%E7%BA%AF%E5%87%80">ç›¸å¯¹</a>çº¯å‡€çš„ã€‚å¦‚æœæˆ‘ä»¬çŸ¥é“å®ƒçš„ç»“æœä¸ä¼šåœ¨å±å¹•ä¸Šå‡ºç°ï¼Œåˆ™å®Œå…¨æ²¡æœ‰å¿…è¦æ‰§è¡Œå®ƒã€‚</p>
<p>è€ƒè™‘ä¸‹é¢è¿™ä¸ªå«æœ‰ <code>&lt;Comments&gt;</code> çš„ <code>&lt;Page&gt;</code> ç»„ä»¶ï¼š</p>
<pre data-line="11,"  11="" class="language-jsx"><code 11="" class="language-jsx">function Story({ currentUser }) {
  // return {
  //   type: Page,
  //   props: {
  //     user: currentUser,
  //     children: { type: Comments, props: {} }
  //   }
  // }
  return (
    &lt;Page user={currentUser}&gt;
      &lt;Comments /&gt;
    &lt;/Page&gt;
  );
}
</code></pre><p><code>&lt;Page&gt;</code> ç»„ä»¶èƒ½å¤Ÿåœ¨ <code>&lt;Layout&gt;</code> ä¸­æ¸²æŸ“ä¼ é€’ç»™å®ƒçš„å­é¡¹ï¼š</p>
<pre data-line="4,"  4="" class="language-jsx"><code 4="" class="language-jsx">function Page({ currentUser, children }) {
  return (
    &lt;Layout&gt;
      {children}
    &lt;/Layout&gt;
  );
}
</code></pre><p><em>(åœ¨ JSX ä¸­ <code>&lt;A&gt;&lt;B /&gt;&lt;/A&gt;</code> å’Œ <code>&lt;A children={&lt;B /&gt;} /&gt;</code>ç›¸åŒã€‚)</em></p>
<p>ä½†æ˜¯è¦æ˜¯å­˜åœ¨æå‰è¿”å›çš„æƒ…å†µå‘¢ï¼Ÿ</p>
<pre data-line="2-4,"  2-4="" class="language-jsx"><code 2-4="" class="language-jsx">function Page({ currentUser, children }) {
  if (!currentUser.isLoggedIn) {
    return &lt;h1&gt;Please login&lt;/h1&gt;;
  }
  return (
    &lt;Layout&gt;
      {children}
    &lt;/Layout&gt;
  );
}
</code></pre><p>å¦‚æœæˆ‘ä»¬åƒå‡½æ•°ä¸€æ ·è°ƒç”¨ <code>Comments()</code> ï¼Œä¸ç®¡ <code>Page</code> æ˜¯å¦æƒ³æ¸²æŸ“å®ƒä»¬éƒ½ä¼šè¢«ç«‹å³æ‰§è¡Œï¼š</p>
<pre data-line="4,8,"  4,8="" class="language-jsx"><code 4,8="" class="language-jsx">// {
//   type: Page,
//   props: {
//     children: Comments() // æ€»æ˜¯è°ƒç”¨ï¼
//   }
// }
&lt;Page&gt;
  {Comments()}
&lt;/Page&gt;
</code></pre><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¼ é€’çš„æ˜¯ä¸€ä¸ª React å…ƒç´ ï¼Œæˆ‘ä»¬ä¸éœ€è¦è‡ªå·±æ‰§è¡Œ <code>Comments</code> ï¼š</p>
<pre data-line="4,8,"  4,8="" class="language-jsx"><code 4,8="" class="language-jsx">// {
//   type: Page,
//   props: {
//     children: { type: Comments }
//   }
// }
&lt;Page&gt;
  &lt;Comments /&gt;
&lt;/Page&gt;
</code></pre><p>è®© React æ¥å†³å®šä½•æ—¶ä»¥åŠæ˜¯å¦è°ƒç”¨ç»„ä»¶ã€‚å¦‚æœæˆ‘ä»¬çš„çš„ <code>Page</code> ç»„ä»¶å¿½ç•¥è‡ªèº«çš„ <code>children</code> prop ä¸”ç›¸ååœ°æ¸²æŸ“äº† <code>&lt;h1&gt;Please login&lt;/h1&gt;</code> ï¼ŒReact ä¸ä¼šå°è¯•å»è°ƒç”¨ <code>Comments</code> å‡½æ•°ã€‚é‡ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>è¿™å¾ˆå¥½ï¼Œå› ä¸ºå®ƒæ—¢å¯ä»¥è®©æˆ‘ä»¬é¿å…ä¸å¿…è¦çš„æ¸²æŸ“ä¹Ÿèƒ½ä½¿æˆ‘ä»¬çš„ä»£ç å˜å¾—ä¸é‚£ä¹ˆè„†å¼±ã€‚ï¼ˆå½“ç”¨æˆ·é€€å‡ºç™»å½•æ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸åœ¨ä¹ <code>Comments</code> æ˜¯å¦è¢«ä¸¢å¼ƒ â€” å› ä¸ºå®ƒä»æ²¡æœ‰è¢«è°ƒç”¨è¿‡ã€‚ï¼‰</p>
<h2>çŠ¶æ€</h2>
<p>æˆ‘ä»¬å…ˆå‰æåˆ°è¿‡å…³äº<a href="#%E5%8D%8F%E8%B0%83">åè°ƒ</a>å’Œåœ¨æ ‘ä¸­å…ƒç´ æ¦‚å¿µä¸Šçš„â€œä½ç½®â€æ˜¯å¦‚ä½•è®© React çŸ¥æ™“æ˜¯è¯¥é‡ç”¨å®¿ä¸»å®ä¾‹è¿˜æ˜¯è¯¥é‡å»ºå®ƒã€‚å®¿ä¸»å®ä¾‹èƒ½å¤Ÿæ‹¥æœ‰æ‰€æœ‰ç›¸å…³çš„å±€éƒ¨çŠ¶æ€ï¼šfocusã€selectionã€input ç­‰ç­‰ã€‚æˆ‘ä»¬æƒ³è¦åœ¨æ¸²æŸ“æ›´æ–°æ¦‚å¿µä¸Šç›¸åŒçš„ UI æ—¶ä¿ç•™è¿™äº›çŠ¶æ€ã€‚æˆ‘ä»¬ä¹Ÿæƒ³å¯é¢„æµ‹æ€§åœ°æ‘§æ¯å®ƒä»¬ï¼Œå½“æˆ‘ä»¬åœ¨æ¦‚å¿µä¸Šæ¸²æŸ“çš„æ˜¯å®Œå…¨ä¸åŒçš„ä¸œè¥¿æ—¶ï¼ˆä¾‹å¦‚ä» <code>&lt;SignupForm&gt;</code> è½¬æ¢åˆ° <code>&lt;MessengerChat&gt;</code>ï¼‰ã€‚</p>
<p><strong>å±€éƒ¨çŠ¶æ€æ˜¯å¦‚æ­¤æœ‰ç”¨ï¼Œä»¥è‡³äº React è®©ä½ çš„ç»„ä»¶ä¹Ÿèƒ½æ‹¥æœ‰å®ƒã€‚</strong> ç»„ä»¶ä»ç„¶æ˜¯å‡½æ•°ä½†æ˜¯ React ç”¨å¯¹æ„å»º UI æœ‰å¥½å¤„çš„è®¸å¤šç‰¹æ€§å¢å¼ºäº†å®ƒã€‚åœ¨æ ‘ä¸­æ¯ä¸ªç»„ä»¶æ‰€ç»‘å®šçš„å±€éƒ¨çŠ¶æ€å°±æ˜¯è¿™äº›ç‰¹æ€§ä¹‹ä¸€ã€‚</p>
<p>æˆ‘ä»¬æŠŠè¿™äº›ç‰¹æ€§å«åš Hooks ã€‚ä¾‹å¦‚ï¼Œ<code>useState</code> å°±æ˜¯ä¸€ä¸ª Hook ã€‚</p>
<pre data-line="2,6,7,"  2,6,7="" class="language-jsx"><code 2,6,7="" class="language-jsx">function Example() {
  const [count, setCount] = useState(0);

  return (
    &lt;div&gt;
      &lt;p&gt;You clicked {count} times&lt;/p&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
        Click me
      &lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre><p>å®ƒè¿”å›ä¸€å¯¹å€¼ï¼šå½“å‰çš„çŠ¶æ€å’Œæ›´æ–°è¯¥çŠ¶æ€çš„å‡½æ•°ã€‚</p>
<p>æ•°ç»„çš„<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#Array_destructuring">è§£æ„è¯­æ³•</a>è®©æˆ‘ä»¬å¯ä»¥ç»™çŠ¶æ€å˜é‡è‡ªå®šä¹‰åç§°ã€‚ä¾‹å¦‚ï¼Œæˆ‘åœ¨è¿™é‡Œç§°å®ƒä»¬ä¸º <code>count</code> å’Œ <code>setCount</code> ï¼Œä½†æ˜¯å®ƒä»¬ä¹Ÿå¯ä»¥è¢«ç§°ä½œ <code>banana</code> å’Œ <code>setBanana</code> ã€‚åœ¨è¿™äº›æ–‡å­—ä¹‹ä¸‹ï¼Œæˆ‘ä»¬ä¼šç”¨ <code>setState</code> æ¥æ›¿ä»£ç¬¬äºŒä¸ªå€¼æ— è®ºå®ƒåœ¨å…·ä½“çš„ä¾‹å­ä¸­è¢«ç§°ä½œä»€ä¹ˆã€‚</p>
<p><em>(ä½ èƒ½åœ¨ <a href="https://reactjs.org/docs/hooks-intro.html">React æ–‡æ¡£</a> ä¸­å­¦ä¹ åˆ°æ›´å¤šå…³äº <code>useState</code> å’Œ å…¶ä»– Hooks çš„çŸ¥è¯†ã€‚)</em></p>
<h2>ä¸€è‡´æ€§</h2>
<p>å³ä½¿æˆ‘ä»¬æƒ³å°†åè°ƒè¿‡ç¨‹æœ¬èº«åˆ†å‰²æˆ<a href="https://www.youtube.com/watch?v=mDdgfyRB5kg">éé˜»å¡</a>çš„å·¥ä½œå—ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦åœ¨åŒæ­¥çš„å¾ªç¯ä¸­å¯¹çœŸå®çš„å®¿ä¸»å®ä¾‹è¿›è¡Œæ“ä½œã€‚è¿™æ ·æˆ‘ä»¬æ‰èƒ½ä¿è¯ç”¨æˆ·ä¸ä¼šçœ‹è§åŠæ›´æ–°çŠ¶æ€çš„ UI ï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå¯¹ç”¨æˆ·ä¸åº”çœ‹åˆ°çš„ä¸­é—´çŠ¶æ€è¿›è¡Œä¸å¿…è¦çš„å¸ƒå±€å’Œæ ·å¼çš„é‡æ–°è®¡ç®—ã€‚</p>
<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ React å°†æ‰€æœ‰çš„å·¥ä½œåˆ†æˆäº†â€æ¸²æŸ“é˜¶æ®µâ€œå’Œâ€æäº¤é˜¶æ®µâ€œçš„åŸå› ã€‚<em>æ¸²æŸ“é˜¶æ®µ</em> æ˜¯å½“ React è°ƒç”¨ä½ çš„ç»„ä»¶ç„¶åè¿›è¡Œåè°ƒçš„æ—¶æ®µã€‚åœ¨æ­¤é˜¶æ®µè¿›è¡Œå¹²æ¶‰æ˜¯å®‰å…¨çš„ä¸”åœ¨<a href="https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html">æœªæ¥</a>è¿™ä¸ªé˜¶æ®µå°†ä¼šå˜æˆå¼‚æ­¥çš„ã€‚<em>æäº¤é˜¶æ®µ</em> å°±æ˜¯ React æ“ä½œå®¿ä¸»æ ‘çš„æ—¶å€™ã€‚è€Œè¿™ä¸ªé˜¶æ®µæ°¸è¿œæ˜¯åŒæ­¥çš„ã€‚</p>
<h2>ç¼“å­˜</h2>
<p>å½“çˆ¶ç»„ä»¶é€šè¿‡ <code>setState</code> å‡†å¤‡æ›´æ–°æ—¶ï¼ŒReact é»˜è®¤ä¼šåè°ƒæ•´ä¸ªå­æ ‘ã€‚å› ä¸º React å¹¶ä¸çŸ¥é“åœ¨çˆ¶ç»„ä»¶ä¸­çš„æ›´æ–°æ˜¯å¦ä¼šå½±å“åˆ°å…¶å­ä»£ï¼Œæ‰€ä»¥ React é»˜è®¤ä¿æŒä¸€è‡´æ€§ã€‚è¿™å¬èµ·æ¥ä¼šæœ‰å¾ˆå¤§çš„æ€§èƒ½æ¶ˆè€—ä½†äº‹å®ä¸Šå¯¹äºå°å‹å’Œä¸­å‹çš„å­æ ‘æ¥è¯´ï¼Œè¿™å¹¶ä¸æ˜¯é—®é¢˜ã€‚</p>
<p>å½“æ ‘çš„æ·±åº¦å’Œå¹¿åº¦è¾¾åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œä½ å¯ä»¥è®© React å»<a href="https://en.wikipedia.org/wiki/Memoization">ç¼“å­˜</a>å­æ ‘å¹¶ä¸”é‡ç”¨å…ˆå‰çš„æ¸²æŸ“ç»“æœå½“ prop åœ¨æµ…æ¯”è¾ƒä¹‹åæ˜¯ç›¸åŒæ—¶ï¼š</p>
<pre data-line="5,"  5="" class="language-jsx"><code 5="" class="language-jsx">function Row({ item }) {
  // ...
}

export default React.memo(Row);
</code></pre><p>ç°åœ¨ï¼Œåœ¨çˆ¶ç»„ä»¶ <code>&lt;Table&gt;</code> ä¸­è°ƒç”¨ <code>setState</code> æ—¶å¦‚æœ <code>&lt;Row&gt;</code> ä¸­çš„ <code>item</code> ä¸å…ˆå‰æ¸²æŸ“çš„ç»“æœæ˜¯ç›¸åŒçš„ï¼ŒReact å°±ä¼šç›´æ¥è·³è¿‡åè°ƒçš„è¿‡ç¨‹ã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡ <a href="https://reactjs.org/docs/hooks-reference.html#usememo"><code>useMemo()</code> Hook</a> è·å¾—å•ä¸ªè¡¨è¾¾å¼çº§åˆ«çš„ç»†ç²’åº¦ç¼“å­˜ã€‚è¯¥ç¼“å­˜äºå…¶ç›¸å…³çš„ç»„ä»¶ç´§å¯†è”ç³»åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”å°†ä¸å±€éƒ¨çŠ¶æ€ä¸€èµ·è¢«é”€æ¯ã€‚å®ƒåªä¼šä¿ç•™æœ€åä¸€æ¬¡è®¡ç®—çš„ç»“æœã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒReact ä¸ä¼šæ•…æ„ç¼“å­˜ç»„ä»¶ã€‚è®¸å¤šç»„ä»¶åœ¨æ›´æ–°çš„è¿‡ç¨‹ä¸­æ€»æ˜¯ä¼šæ¥æ”¶åˆ°ä¸åŒçš„ props ï¼Œæ‰€ä»¥å¯¹å®ƒä»¬è¿›è¡Œç¼“å­˜åªä¼šé€ æˆå‡€äºæŸã€‚</p>
<h2>åŸå§‹æ¨¡å‹</h2>
<p>ä»¤äººè®½åˆºåœ°æ˜¯ï¼ŒReact å¹¶æ²¡æœ‰ä½¿ç”¨â€œååº”å¼â€çš„ç³»ç»Ÿæ¥æ”¯æŒç»†ç²’åº¦çš„æ›´æ–°ã€‚æ¢å¥è¯è¯´ï¼Œä»»ä½•åœ¨é¡¶å±‚çš„æ›´æ–°åªä¼šè§¦å‘åè°ƒè€Œä¸æ˜¯å±€éƒ¨æ›´æ–°é‚£äº›å—å½±å“çš„ç»„ä»¶ã€‚</p>
<p>è¿™æ ·çš„è®¾è®¡æ˜¯æœ‰æ„è€Œä¸ºä¹‹çš„ã€‚å¯¹äº web åº”ç”¨æ¥è¯´<a href="https://calibreapp.com/blog/time-to-interactive/">äº¤äº’æ—¶é—´</a>æ˜¯ä¸€ä¸ªå…³é”®æŒ‡æ ‡ï¼Œè€Œé€šè¿‡éå†æ•´ä¸ªæ¨¡å‹å»è®¾ç½®ç»†ç²’åº¦çš„ç›‘å¬å™¨åªä¼šæµªè´¹å®è´µçš„æ—¶é—´ã€‚æ­¤å¤–ï¼Œåœ¨å¾ˆå¤šåº”ç”¨ä¸­äº¤äº’å¾€å¾€ä¼šå¯¼è‡´æˆ–å°ï¼ˆæŒ‰é’®æ‚¬åœï¼‰æˆ–å¤§ï¼ˆé¡µé¢è½¬æ¢ï¼‰çš„æ›´æ–°ï¼Œå› æ­¤ç»†ç²’åº¦çš„è®¢é˜…åªä¼šæµªè´¹å†…å­˜èµ„æºã€‚</p>
<p>React çš„è®¾è®¡åŸåˆ™ä¹‹ä¸€å°±æ˜¯å®ƒå¯ä»¥å¤„ç†åŸå§‹æ•°æ®ã€‚å¦‚æœä½ æ‹¥æœ‰ä»ç½‘ç»œè¯·æ±‚ä¸­è·å¾—çš„ä¸€ç»„ JavaScript å¯¹è±¡ï¼Œä½ å¯ä»¥å°†å…¶ç›´æ¥äº¤ç»™ç»„ä»¶è€Œæ— éœ€è¿›è¡Œé¢„å¤„ç†ã€‚æ²¡æœ‰å…³äºå¯ä»¥è®¿é—®å“ªäº›å±æ€§çš„é—®é¢˜ï¼Œæˆ–è€…å½“ç»“æ„æœ‰æ‰€å˜åŒ–æ—¶é€ æˆçš„æ„å¤–çš„æ€§èƒ½ç¼ºæŸã€‚React æ¸²æŸ“æ˜¯ O(<em>è§†å›¾å¤§å°</em>) è€Œä¸æ˜¯ O(<em>æ¨¡å‹å¤§å°</em>) ï¼Œå¹¶ä¸”ä½ å¯ä»¥é€šè¿‡ <a href="https://react-window.now.sh/#/examples/list/fixed-size">windowing</a> æ˜¾è‘—åœ°å‡å°‘è§†å›¾å¤§å°ã€‚</p>
<p>æœ‰é‚£ä¹ˆä¸€äº›åº”ç”¨ç»†ç²’åº¦è®¢é˜…å¯¹å®ƒä»¬æ¥è¯´æ˜¯æœ‰ç”¨çš„ â€” ä¾‹å¦‚è‚¡ç¥¨ä»£ç ã€‚è¿™æ˜¯ä¸€ä¸ªæå°‘è§çš„ä¾‹å­ï¼Œå› ä¸ºâ€œæ‰€æœ‰çš„ä¸œè¥¿éƒ½éœ€è¦åœ¨åŒä¸€æ—¶é—´å†…æŒç»­æ›´æ–°â€ã€‚è™½ç„¶å‘½ä»¤å¼çš„æ–¹æ³•èƒ½å¤Ÿä¼˜åŒ–æ­¤ç±»ä»£ç ï¼Œä½† React å¹¶ä¸é€‚ç”¨äºè¿™ç§æƒ…å†µã€‚åŒæ ·çš„ï¼Œå¦‚æœä½ æƒ³è¦è§£å†³è¯¥é—®é¢˜ï¼Œä½ å°±å¾—åœ¨ React ä¹‹ä¸Šè‡ªå·±å®ç°ç»†ç²’åº¦çš„è®¢é˜…ã€‚</p>
<p><strong>æ³¨æ„ï¼Œå³ä½¿ç»†ç²’åº¦è®¢é˜…å’Œâ€œååº”å¼â€ç³»ç»Ÿä¹Ÿæ— æ³•è§£å†³ä¸€äº›å¸¸è§çš„æ€§èƒ½é—®é¢˜ã€‚</strong> ä¾‹å¦‚ï¼Œæ¸²æŸ“ä¸€æ£µå¾ˆæ·±çš„æ ‘ï¼ˆåœ¨æ¯æ¬¡é¡µé¢è½¬æ¢çš„æ—¶å€™å‘ç”Ÿï¼‰è€Œä¸é˜»å¡æµè§ˆå™¨ã€‚æ”¹å˜è·Ÿè¸ªå¹¶ä¸ä¼šè®©å®ƒå˜å¾—æ›´å¿« â€” è¿™æ ·åªä¼šè®©å…¶å˜å¾—æ›´æ…¢å› ä¸ºæˆ‘ä»¬æ‰§è¡Œäº†é¢å¤–çš„è®¢é˜…å·¥ä½œã€‚å¦ä¸€ä¸ªé—®é¢˜æ˜¯æˆ‘ä»¬éœ€è¦ç­‰å¾…è¿”å›çš„æ•°æ®åœ¨æ¸²æŸ“è§†å›¾ä¹‹å‰ã€‚åœ¨ React ä¸­ï¼Œæˆ‘ä»¬ç”¨<a href="https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html">å¹¶å‘æ¸²æŸ“</a>æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚</p>
<h2>æ‰¹é‡æ›´æ–°</h2>
<p>ä¸€äº›ç»„ä»¶ä¹Ÿè®¸æƒ³è¦æ›´æ–°çŠ¶æ€æ¥å“åº”åŒä¸€äº‹ä»¶ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­æ˜¯å‡è®¾çš„ï¼Œä½†æ˜¯å´è¯´æ˜äº†ä¸€ä¸ªå¸¸è§çš„æ¨¡å¼ï¼š</p>
<pre data-line="4,14,"  4,14="" class="language-jsx"><code 4,14="" class="language-jsx">function Parent() {
  let [count, setCount] = useState(0);
  return (
    &lt;div onClick={() =&gt; setCount(count + 1)}&gt;
      Parent clicked {count} times
      &lt;Child /&gt;
    &lt;/div&gt;
  );
}

function Child() {
  let [count, setCount] = useState(0);
  return (
    &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
      Child clicked {count} times
    &lt;/button&gt;
  );
}
</code></pre><p>å½“äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œå­ç»„ä»¶çš„ <code>onClick</code> é¦–å…ˆè¢«è§¦å‘ï¼ˆåŒæ—¶è§¦å‘äº†å®ƒçš„ <code>setState</code> ï¼‰ã€‚ç„¶åçˆ¶ç»„ä»¶åœ¨å®ƒè‡ªå·±çš„ <code>onClick</code> ä¸­è°ƒç”¨ <code>setState</code> ã€‚</p>
<p>å¦‚æœ React ç«‹å³é‡æ¸²æŸ“ç»„ä»¶ä»¥å“åº” <code>setState</code> è°ƒç”¨ï¼Œæœ€ç»ˆæˆ‘ä»¬ä¼šé‡æ¸²æŸ“å­ç»„ä»¶ä¸¤æ¬¡ï¼š</p>
<pre data-line="4,8,"  4,8="" class="language-jsx"><code 4,8="" class="language-jsx">*** è¿›å…¥ React æµè§ˆå™¨ click äº‹ä»¶å¤„ç†è¿‡ç¨‹ ***
Child (onClick)
  - setState
  - re-render Child // ğŸ˜ ä¸å¿…è¦çš„é‡æ¸²æŸ“
Parent (onClick)
  - setState
  - re-render Parent
  - re-render Child
*** ç»“æŸ React æµè§ˆå™¨ click äº‹ä»¶å¤„ç†è¿‡ç¨‹ ***
</code></pre><p>ç¬¬ä¸€æ¬¡ <code>Child</code> ç»„ä»¶æ¸²æŸ“æ˜¯æµªè´¹çš„ã€‚å¹¶ä¸”æˆ‘ä»¬ä¹Ÿä¸ä¼šè®© React è·³è¿‡ <code>Child</code> çš„ç¬¬äºŒæ¬¡æ¸²æŸ“å› ä¸º <code>Parent</code> å¯èƒ½ä¼šä¼ é€’ä¸åŒçš„æ•°æ®ç”±äºå…¶è‡ªèº«çš„çŠ¶æ€æ›´æ–°ã€‚</p>
<p><strong>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ React ä¼šåœ¨ç»„ä»¶å†…æ‰€æœ‰äº‹ä»¶è§¦å‘å®Œæˆåå†è¿›è¡Œæ‰¹é‡æ›´æ–°çš„åŸå› ï¼š</strong></p>
<pre   class="language-jsx"><code class="language-jsx">*** è¿›å…¥ React æµè§ˆå™¨ click äº‹ä»¶å¤„ç†è¿‡ç¨‹ ***
Child (onClick)
  - setState
Parent (onClick)
  - setState
*** Processing state updates                     ***
  - re-render Parent
  - re-render Child
*** ç»“æŸ React æµè§ˆå™¨ click äº‹ä»¶å¤„ç†è¿‡ç¨‹  ***
</code></pre><p>ç»„ä»¶å†…è°ƒç”¨ <code>setState</code> å¹¶ä¸ä¼šç«‹å³æ‰§è¡Œé‡æ¸²æŸ“ã€‚ç›¸åï¼ŒReact ä¼šå…ˆè§¦å‘æ‰€æœ‰çš„äº‹ä»¶å¤„ç†å™¨ï¼Œç„¶åå†è§¦å‘ä¸€æ¬¡é‡æ¸²æŸ“ä»¥è¿›è¡Œæ‰€è°“çš„æ‰¹é‡æ›´æ–°ã€‚</p>
<p>æ‰¹é‡æ›´æ–°è™½ç„¶æœ‰ç”¨ä½†å¯èƒ½ä¼šè®©ä½ æ„Ÿåˆ°æƒŠè®¶å¦‚æœä½ çš„ä»£ç è¿™æ ·å†™ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">  const [count, setCounter] = useState(0);

  function increment() {
    setCounter(count + 1);
  }

  function handleClick() {
    increment();
    increment();
    increment();
  }
</code></pre><p>å¦‚æœæˆ‘ä»¬å°† <code>count</code> åˆå§‹å€¼è®¾ä¸º <code>0</code> ï¼Œä¸Šé¢çš„ä»£ç åªä¼šä»£è¡¨ä¸‰æ¬¡  <code>setCount(1)</code> è°ƒç”¨ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç»™ <code>setState</code> æä¾›äº†ä¸€ä¸ª â€œupdaterâ€ å‡½æ•°ä½œä¸ºå‚æ•°ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">  const [count, setCounter] = useState(0);

  function increment() {
    setCounter(c =&gt; c + 1);
  }

  function handleClick() {
    increment();
    increment();
    increment();
  }
</code></pre><p>React ä¼šå°† updater å‡½æ•°æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œå¹¶åœ¨ä¹‹åæŒ‰é¡ºåºæ‰§è¡Œå®ƒä»¬ï¼Œæœ€ç»ˆ <code>count</code> ä¼šè¢«è®¾ç½®æˆ <code>3</code> å¹¶ä½œä¸ºä¸€æ¬¡é‡æ¸²æŸ“çš„ç»“æœã€‚</p>
<p>å½“çŠ¶æ€é€»è¾‘å˜å¾—æ›´åŠ å¤æ‚è€Œä¸ä»…ä»…åªæ˜¯å°‘æ•°çš„ <code>setState</code> è°ƒç”¨æ—¶ï¼Œæˆ‘å»ºè®®ä½ ä½¿ç”¨ <a href="https://reactjs.org/docs/hooks-reference.html#usereducer"><code>useReducer</code> Hook</a> æ¥æè¿°ä½ çš„å±€éƒ¨çŠ¶æ€ã€‚å®ƒå°±åƒ â€œupdaterâ€ çš„å‡çº§æ¨¡å¼åœ¨è¿™é‡Œä½ å¯ä»¥ç»™æ¯ä¸€æ¬¡æ›´æ–°å‘½åï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">  const [counter, dispatch] = useReducer((state, action) =&gt; {
    if (action === 'increment') {
      return state + 1;
    } else {
      return state;
    }
  }, 0);

  function handleClick() {
    dispatch('increment');
    dispatch('increment');
    dispatch('increment');
  }
</code></pre><p><code>action</code> å­—æ®µå¯ä»¥æ˜¯ä»»æ„å€¼ï¼Œå°½ç®¡å¯¹è±¡æ˜¯å¸¸ç”¨çš„é€‰æ‹©ã€‚</p>
<h2>è°ƒç”¨æ ‘</h2>
<p>ç¼–ç¨‹è¯­è¨€çš„è¿è¡Œæ—¶å¾€å¾€æœ‰<a href="https://medium.freecodecamp.org/understanding-the-javascript-call-stack-861e41ae61d4">è°ƒç”¨æ ˆ</a> ã€‚å½“å‡½æ•° <code>a()</code> è°ƒç”¨ <code>b()</code> ï¼Œ<code>b()</code> åˆè°ƒç”¨ <code>c()</code> æ—¶ï¼Œåœ¨ JavaScript å¼•æ“ä¸­ä¼šæœ‰åƒ <code>[a, b, c]</code> è¿™æ ·çš„æ•°æ®ç»“æ„æ¥â€œè·Ÿè¸ªâ€å½“å‰çš„ä½ç½®ä»¥åŠæ¥ä¸‹æ¥è¦æ‰§è¡Œçš„ä»£ç ã€‚ä¸€æ—¦ <code>c</code> å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå®ƒçš„è°ƒç”¨æ ˆå¸§å°±æ¶ˆå¤±äº†ï¼å› ä¸ºå®ƒä¸å†è¢«éœ€è¦äº†ã€‚æˆ‘ä»¬è¿”å›åˆ°å‡½æ•° <code>b</code> ä¸­ã€‚å½“æˆ‘ä»¬ç»“æŸå‡½æ•° <code>a</code> çš„æ‰§è¡Œæ—¶ï¼Œè°ƒç”¨æ ˆå°±è¢«æ¸…ç©ºã€‚</p>
<p>å½“ç„¶ï¼ŒReact ä»¥ JavaScript è¿è¡Œå½“ç„¶ä¹Ÿéµå¾ª JavaScript çš„è§„åˆ™ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æƒ³è±¡åœ¨ React å†…éƒ¨æœ‰è‡ªå·±çš„è°ƒç”¨æ ˆç”¨æ¥è®°å¿†æˆ‘ä»¬å½“å‰æ­£åœ¨æ¸²æŸ“çš„ç»„ä»¶ï¼Œä¾‹å¦‚ <code>[App, Page, Layout, Article /* æ­¤åˆ»çš„ä½ç½® */]</code> ã€‚</p>
<p>React ä¸é€šå¸¸æ„ä¹‰ä¸Šçš„ç¼–ç¨‹è¯­è¨€è¿›è¡Œæ—¶ä¸åŒå› ä¸ºå®ƒé’ˆå¯¹äºæ¸²æŸ“ UI æ ‘ï¼Œè¿™äº›æ ‘éœ€è¦ä¿æŒâ€œæ´»æ€§â€ï¼Œè¿™æ ·æ‰èƒ½ä½¿æˆ‘ä»¬ä¸å…¶è¿›è¡Œäº¤äº’ã€‚åœ¨ç¬¬ä¸€æ¬¡ <code>ReactDOM.render()</code> å‡ºç°ä¹‹å‰ï¼ŒDOM æ“ä½œå¹¶ä¸ä¼šæ‰§è¡Œã€‚</p>
<p>è¿™ä¹Ÿè®¸æ˜¯å¯¹éšå–»çš„å»¶ä¼¸ï¼Œä½†æˆ‘å–œæ¬¢æŠŠ React ç»„ä»¶å½“ä½œ â€œè°ƒç”¨æ ‘â€ è€Œä¸æ˜¯ â€œè°ƒç”¨æ ˆâ€ ã€‚å½“æˆ‘ä»¬è°ƒç”¨å®Œ <code>Article</code> ç»„ä»¶ï¼Œå®ƒçš„ React â€œè°ƒç”¨æ ‘â€ å¸§å¹¶æ²¡æœ‰è¢«æ‘§æ¯ã€‚æˆ‘ä»¬éœ€è¦å°†å±€éƒ¨çŠ¶æ€ä¿å­˜ä»¥ä¾¿æ˜ å°„åˆ°å®¿ä¸»å®ä¾‹çš„<a href="https://medium.com/react-in-depth/the-how-and-why-on-reacts-usage-of-linked-list-in-fiber-67f1014d0eb7">æŸä¸ªåœ°æ–¹</a>ã€‚</p>
<p>è¿™äº›â€œè°ƒç”¨æ ‘â€å¸§ä¼šéšå®ƒä»¬çš„å±€éƒ¨çŠ¶æ€å’Œå®¿ä¸»å®ä¾‹ä¸€èµ·è¢«æ‘§æ¯ï¼Œä½†æ˜¯åªä¼šåœ¨<a href="#%E5%8D%8F%E8%B0%83">åè°ƒ</a>è§„åˆ™è®¤ä¸ºè¿™æ˜¯å¿…è¦çš„æ—¶å€™æ‰§è¡Œã€‚å¦‚æœä½ æ›¾ç»è¯»è¿‡ React æºç ï¼Œä½ å°±ä¼šçŸ¥é“è¿™äº›å¸§å…¶å®å°±æ˜¯ <a href="https://en.wikipedia.org/wiki/Fiber_(computer_science)">Fibers</a> ã€‚</p>
<p>Fibers æ˜¯å±€éƒ¨çŠ¶æ€çœŸæ­£å­˜åœ¨çš„åœ°æ–¹ã€‚å½“çŠ¶æ€è¢«æ›´æ–°åï¼ŒReact å°†å…¶ä¸‹é¢çš„ Fibers æ ‡è®°ä¸ºéœ€è¦è¿›è¡Œåè°ƒï¼Œä¹‹åä¾¿ä¼šè°ƒç”¨è¿™äº›ç»„ä»¶ã€‚</p>
<h2>ä¸Šä¸‹æ–‡</h2>
<p>åœ¨ React ä¸­ï¼Œæˆ‘ä»¬å°†æ•°æ®ä½œä¸º props ä¼ é€’ç»™å…¶ä»–ç»„ä»¶ã€‚æœ‰äº›æ—¶å€™ï¼Œå¤§å¤šæ•°ç»„ä»¶éœ€è¦ç›¸åŒçš„ä¸œè¥¿ â€” ä¾‹å¦‚ï¼Œå½“å‰é€‰ä¸­çš„å¯è§†ä¸»é¢˜ã€‚å°†å®ƒä¸€å±‚å±‚åœ°ä¼ é€’ä¼šå˜å¾—ååˆ†éº»çƒ¦ã€‚</p>
<p>åœ¨ React ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ <a href="https://reactjs.org/docs/context.html">Context</a> è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å®ƒå°±åƒç»„ä»¶çš„<a href="http://wiki.c2.com/?DynamicScoping">åŠ¨æ€èŒƒå›´</a> ï¼Œèƒ½è®©ä½ ä»é¡¶å±‚ä¼ é€’æ•°æ®ï¼Œå¹¶è®©æ¯ä¸ªå­ç»„ä»¶åœ¨åº•éƒ¨èƒ½å¤Ÿè¯»å–è¯¥å€¼ï¼Œå½“å€¼å˜åŒ–æ—¶è¿˜èƒ½å¤Ÿè¿›è¡Œé‡æ–°æ¸²æŸ“ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">const ThemeContext = React.createContext(
  'light' // é»˜è®¤å€¼ä½œä¸ºåå¤‡
);

function DarkApp() {
  return (
    &lt;ThemeContext.Provider value=&quot;dark&quot;&gt;
      &lt;MyComponents /&gt;
    &lt;/ThemeContext.Provider&gt;
  );
}

function SomeDeeplyNestedChild() {
  // å–å†³äºå…¶å­ç»„ä»¶åœ¨å“ªé‡Œè¢«æ¸²æŸ“
  const theme = useContext(ThemeContext);
  // ...
}
</code></pre><p>å½“ <code>SomeDeeplyNestedChild</code> æ¸²æŸ“æ—¶ï¼Œ <code>useContext(ThemeContext)</code> ä¼šå¯»æ‰¾æ ‘ä¸­æœ€è¿‘çš„ <code>&lt;ThemeContext.Provider&gt;</code> ï¼Œå¹¶ä¸”ä½¿ç”¨å®ƒçš„ <code>value</code> ã€‚</p>
<p>(äº‹å®ä¸Šï¼ŒReact ç»´æŠ¤äº†ä¸€ä¸ªä¸Šä¸‹æ–‡æ ˆå½“å…¶æ¸²æŸ“æ—¶ã€‚)</p>
<p>å¦‚æœæ²¡æœ‰ <code>ThemeContext.Provider</code> å­˜åœ¨ï¼Œ<code>useContext(ThemeContext)</code> è°ƒç”¨çš„ç»“æœå°±ä¼šè¢«è°ƒç”¨ <code>createContext()</code> æ—¶ä¼ é€’çš„é»˜è®¤å€¼æ‰€å–ä»£ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè¿™ä¸ªå€¼ä¸º <code>'light'</code> ã€‚</p>
<h2>å‰¯ä½œç”¨</h2>
<p>æˆ‘ä»¬åœ¨ä¹‹å‰æåˆ°è¿‡ React ç»„ä»¶åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ä¸åº”è¯¥æœ‰å¯è§‚å¯Ÿåˆ°çš„å‰¯ä½œç”¨ã€‚ä½†æ˜¯æœ‰äº›æ—¶å€™å‰¯ä½œç”¨ç¡®å®å¿…è¦çš„ã€‚æˆ‘ä»¬ä¹Ÿè®¸éœ€è¦è¿›è¡Œç®¡ç† focus çŠ¶æ€ã€ç”¨ canvas ç”»å›¾ã€è®¢é˜…æ•°æ®æºç­‰æ“ä½œã€‚</p>
<p>åœ¨ React ä¸­ï¼Œè¿™äº›éƒ½å¯ä»¥é€šè¿‡å£°æ˜ effect æ¥å®Œæˆï¼š</p>
<pre data-line="4-6,"  4-6="" class="language-jsx"><code 4-6="" class="language-jsx">function Example() {
  const [count, setCount] = useState(0);

  useEffect(() =&gt; {
    document.title = `You clicked ${count} times`;
  });

  return (
    &lt;div&gt;
      &lt;p&gt;You clicked {count} times&lt;/p&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
        Click me
      &lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre><p>å¦‚æœå¯èƒ½ï¼ŒReact ä¼šæ¨è¿Ÿæ‰§è¡Œ effect ç›´åˆ°æµè§ˆå™¨é‡æ–°ç»˜åˆ¶å±å¹•ã€‚è¿™æ˜¯æœ‰å¥½å¤„çš„å› ä¸ºåƒè®¢é˜…æ•°æ®æºè¿™æ ·çš„ä»£ç å¹¶ä¸ä¼šå½±å“<a href="https://calibreapp.com/blog/time-to-interactive/">äº¤äº’æ—¶é—´</a>å’Œ<a href="https://developers.google.com/web/tools/lighthouse/audits/first-meaningful-paint">é¦–æ¬¡ç»˜åˆ¶æ—¶é—´</a> ã€‚</p>
<p>ï¼ˆæœ‰ä¸€ä¸ª<a href="https://reactjs.org/docs/hooks-reference.html#uselayouteffect">æå°‘ä½¿ç”¨</a>çš„ Hook èƒ½å¤Ÿè®©ä½ é€‰æ‹©é€€å‡ºè¿™ç§è¡Œä¸ºå¹¶è¿›è¡Œä¸€äº›åŒæ­¥çš„å·¥ä½œã€‚è¯·å°½é‡é¿å…ä½¿ç”¨å®ƒã€‚ï¼‰</p>
<p>effect ä¸åªæ‰§è¡Œä¸€æ¬¡ã€‚å½“ç»„ä»¶ç¬¬ä¸€æ¬¡å±•ç¤ºç»™ç”¨æˆ·ä»¥åŠä¹‹åçš„æ¯æ¬¡æ›´æ–°æ—¶å®ƒéƒ½ä¼šè¢«æ‰§è¡Œã€‚åœ¨ effect ä¸­èƒ½è§¦åŠå½“å‰çš„ props å’Œ stateï¼Œä¾‹å¦‚ä¸Šæ–‡ä¾‹å­ä¸­çš„ <code>count</code> ã€‚</p>
<p>effect å¯èƒ½éœ€è¦è¢«æ¸…ç†ï¼Œä¾‹å¦‚è®¢é˜…æ•°æ®æºçš„ä¾‹å­ã€‚åœ¨è®¢é˜…ä¹‹åå°†å…¶æ¸…ç†ï¼Œeffect èƒ½å¤Ÿè¿”å›ä¸€ä¸ªå‡½æ•°ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">  useEffect(() =&gt; {
    DataSource.addSubscription(handleChange);
    return () =&gt; DataSource.removeSubscription(handleChange);
  });
</code></pre><p>React ä¼šåœ¨ä¸‹æ¬¡è°ƒç”¨è¯¥ effect ä¹‹å‰æ‰§è¡Œè¿™ä¸ªè¿”å›çš„å‡½æ•°ï¼Œå½“ç„¶æ˜¯åœ¨ç»„ä»¶è¢«æ‘§æ¯ä¹‹å‰ã€‚</p>
<p>æœ‰äº›æ—¶å€™ï¼Œåœ¨æ¯æ¬¡æ¸²æŸ“ä¸­éƒ½é‡æ–°è°ƒç”¨ effect æ˜¯ä¸ç¬¦åˆå®é™…éœ€è¦çš„ã€‚ ä½ å¯ä»¥å‘Šè¯‰ React å¦‚æœç›¸åº”çš„å˜é‡ä¸ä¼šæ”¹å˜åˆ™è·³è¿‡æ­¤æ¬¡è°ƒç”¨ï¼š</p>
<pre data-line="3,"  3="" class="language-jsx"><code 3="" class="language-jsx">  useEffect(() =&gt; {
    document.title = `You clicked ${count} times`;
  }, [count]);
</code></pre><p>ä½†æ˜¯ï¼Œè¿™å¾€å¾€ä¼šæˆä¸ºè¿‡æ—©åœ°ä¼˜åŒ–å¹¶ä¼šé€ æˆä¸€äº›é—®é¢˜å¦‚æœä½ ä¸ç†Ÿæ‚‰ JavaScript ä¸­çš„é—­åŒ…æ˜¯å¦‚ä½•å·¥ä½œçš„è¯ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„è¿™æ®µä»£ç æ˜¯æœ‰ bug çš„ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">  useEffect(() =&gt; {
    DataSource.addSubscription(handleChange);
    return () =&gt; DataSource.removeSubscription(handleChange);
  }, []);
</code></pre><p>å®ƒå«æœ‰ bug å› ä¸º <code>[]</code> ä»£è¡¨ç€â€œä¸å†é‡æ–°æ‰§è¡Œè¿™ä¸ª effect ã€‚â€ä½†æ˜¯è¿™ä¸ª effect ä¸­çš„ <code>handleChange</code> æ˜¯è¢«å®šä¹‰åœ¨å¤–é¢çš„ã€‚<code>handleChange</code> ä¹Ÿè®¸ä¼šå¼•ç”¨ä»»ä½•çš„ props æˆ– state ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">  function handleChange() {
    console.log(count);
  }
</code></pre><p>å¦‚æœæˆ‘ä»¬ä¸å†è®©è¿™ä¸ª effect é‡æ–°è°ƒç”¨ï¼Œ<code>handleChange</code> å§‹ç»ˆä¼šæ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶çš„ç‰ˆæœ¬ï¼Œè€Œå…¶ä¸­çš„ <code>count</code> ä¹Ÿæ°¸è¿œåªä¼šæ˜¯ <code>0</code> ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯·ä¿è¯ä½ å£°æ˜äº†ç‰¹å®šçš„ä¾èµ–æ•°ç»„ï¼Œå®ƒåŒ…å«<strong>æ‰€æœ‰</strong>å¯ä»¥æ”¹å˜çš„ä¸œè¥¿ï¼Œå³ä½¿æ˜¯å‡½æ•°ä¹Ÿä¸ä¾‹å¤–ï¼š</p>
<pre data-line="4,"  4="" class="language-jsx"><code 4="" class="language-jsx">  useEffect(() =&gt; {
    DataSource.addSubscription(handleChange);
    return () =&gt; DataSource.removeSubscription(handleChange);
  }, [handleChange]);
</code></pre><p>å–å†³äºä½ çš„ä»£ç ï¼Œåœ¨æ¯æ¬¡æ¸²æŸ“å <code>handleChange</code> éƒ½ä¼šä¸åŒå› æ­¤ä½ å¯èƒ½ä»ç„¶ä¼šçœ‹åˆ°ä¸å¿…è¦çš„é‡è®¢é˜…ã€‚ <a href="https://reactjs.org/docs/hooks-reference.html#usecallback"><code>useCallback</code></a> èƒ½å¤Ÿå¸®ä½ è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ–è€…ï¼Œä½ å¯ä»¥ç›´æ¥è®©å®ƒé‡è®¢é˜…ã€‚ä¾‹å¦‚æµè§ˆå™¨ä¸­çš„ <code>addEventListener</code> API éå¸¸å¿«ï¼Œä½†ä¸ºäº†åœ¨ç»„ä»¶ä¸­é¿å…ä½¿ç”¨å®ƒå¯èƒ½ä¼šå¸¦æ¥æ›´å¤šçš„é—®é¢˜è€Œä¸æ˜¯å…¶çœŸæ­£çš„ä»·å€¼ã€‚</p>
<p><em>(ä½ èƒ½åœ¨ <a href="https://reactjs.org/docs/hooks-effect.html">React æ–‡æ¡£</a> ä¸­å­¦åˆ°æ›´å¤šå…³äº <code>useEffect</code> å’Œå…¶ä»– Hooks çš„çŸ¥è¯†ã€‚)</em></p>
<h2>è‡ªå®šä¹‰é’©å­</h2>
<p>ç”±äº <code>useState</code> å’Œ <code>useEffect</code> æ˜¯å‡½æ•°è°ƒç”¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†å…¶ç»„åˆæˆè‡ªå·±çš„ Hooks ï¼š</p>
<pre data-line="2,8,"  2,8="" class="language-jsx"><code 2,8="" class="language-jsx">function MyResponsiveComponent() {
  const width = useWindowWidth(); // æˆ‘ä»¬è‡ªå·±çš„ Hook
  return (
    &lt;p&gt;Window width is {width}&lt;/p&gt;
  );
}

function useWindowWidth() {
  const [width, setWidth] = useState(window.innerWidth);
  useEffect(() =&gt; {
    const handleResize = () =&gt; setWidth(window.innerWidth);
    window.addEventListener('resize', handleResize);
    return () =&gt; {
      window.removeEventListener('resize', handleResize);
    };
  });
  return width;
}
</code></pre><p>è‡ªå®šä¹‰ Hooks è®©ä¸åŒçš„ç»„ä»¶å…±äº«å¯é‡ç”¨çš„çŠ¶æ€é€»è¾‘ã€‚æ³¨æ„çŠ¶æ€æœ¬èº«æ˜¯ä¸å…±äº«çš„ã€‚æ¯æ¬¡è°ƒç”¨ Hook éƒ½åªå£°æ˜äº†å…¶è‡ªèº«çš„ç‹¬ç«‹çŠ¶æ€ã€‚</p>
<p><em>(ä½ èƒ½åœ¨ <a href="https://reactjs.org/docs/hooks-custom.html">React æ–‡æ¡£</a> ä¸­å­¦ä¹ æ›´å¤šå…³äºæ„å»ºè‡ªå·±çš„ Hooks çš„å†…å®¹ã€‚)</em></p>
<h2>é™æ€ä½¿ç”¨é¡ºåº</h2>
<p>ä½ å¯ä»¥æŠŠ <code>useState</code> æƒ³è±¡æˆä¸€ä¸ªå¯ä»¥å®šä¹‰â€œReact çŠ¶æ€å˜é‡â€çš„è¯­æ³•ã€‚å®ƒå¹¶ä¸æ˜¯çœŸæ­£çš„è¯­æ³•ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬ä»åœ¨ç”¨ JavaScript ç¼–å†™åº”ç”¨ã€‚ä½†æ˜¯æˆ‘ä»¬å°† React ä½œä¸ºä¸€ä¸ªè¿è¡Œæ—¶ç¯å¢ƒæ¥çœ‹å¾…ï¼Œå› ä¸º React ç”¨ JavaScript æ¥æç»˜æ•´ä¸ª UI æ ‘ï¼Œå®ƒçš„ç‰¹æ€§å¾€å¾€æ›´æ¥è¿‘äºè¯­è¨€å±‚é¢ã€‚</p>
<p>å‡è®¾ <code>use</code> æ˜¯è¯­æ³•ï¼Œå°†å…¶ä½¿ç”¨åœ¨ç»„ä»¶å‡½æ•°é¡¶å±‚ä¹Ÿå°±è¯´å¾—é€šäº†ï¼š</p>
<pre data-line="3,"  3="" class="language-jsx"><code 3="" class="language-jsx">// ğŸ˜‰ æ³¨æ„ï¼šå¹¶ä¸æ˜¯çœŸçš„è¯­æ³•
component Example(props) {
  const [count, setCount] = use State(0);

  return (
    &lt;div&gt;
      &lt;p&gt;You clicked {count} times&lt;/p&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
        Click me
      &lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre><p>å½“å®ƒè¢«æ”¾åœ¨æ¡ä»¶è¯­å¥ä¸­æˆ–è€…ç»„ä»¶å¤–æ—¶åˆä»£è¡¨ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<pre   class="language-jsx"><code class="language-jsx">// ğŸ˜‰ æ³¨æ„ï¼šå¹¶ä¸æ˜¯çœŸçš„è¯­æ³•

// å®ƒæ˜¯è°çš„...å±€éƒ¨çŠ¶æ€ï¼Ÿ
const [count, setCount] = use State(0);

component Example() {
  if (condition) {
    // è¦æ˜¯ condition æ˜¯ false æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ
    const [count, setCount] = use State(0);
  }

  function handleClick() {
    // è¦æ˜¯ç¦»å¼€äº†ç»„ä»¶å‡½æ•°ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ
    // è¿™å’Œä¸€èˆ¬çš„å˜é‡åˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ
    const [count, setCount] = use State(0);
  }
</code></pre><p>React çŠ¶æ€å’Œåœ¨æ ‘ä¸­ä¸å…¶ç›¸å…³çš„ç»„ä»¶ç´§å¯†è”ç³»åœ¨ä¸€èµ·ã€‚å¦‚æœ <code>use</code> æ˜¯çœŸæ­£çš„è¯­æ³•å½“å®ƒåœ¨ç»„ä»¶å‡½æ•°çš„é¡¶å±‚è°ƒç”¨æ—¶ä¹Ÿèƒ½è¯´çš„é€šï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">// ğŸ˜‰ æ³¨æ„ï¼šå¹¶ä¸æ˜¯çœŸçš„è¯­æ³•
component Example(props) {
  // åªåœ¨è¿™é‡Œæœ‰æ•ˆ
  const [count, setCount] = use State(0);

  if (condition) {
    // è¿™ä¼šæ˜¯ä¸€ä¸ªè¯­æ³•é”™è¯¯
    const [count, setCount] = use State(0);
  }
</code></pre><p>è¿™å’Œ <code>import</code> å£°æ˜åªåœ¨æ¨¡å—é¡¶å±‚æœ‰ç”¨æ˜¯ä¸€æ ·çš„é“ç†ã€‚</p>
<p><strong>å½“ç„¶ï¼Œ<code>use</code> å¹¶ä¸æ˜¯çœŸæ­£çš„è¯­æ³•ã€‚</strong> ï¼ˆå®ƒä¸ä¼šå¸¦æ¥å¾ˆå¤šå¥½å¤„ï¼Œå¹¶ä¸”ä¼šå¸¦æ¥å¾ˆå¤šæ‘©æ“¦ã€‚ï¼‰</p>
<p>ç„¶è€Œï¼ŒReact çš„ç¡®æœŸæœ›æ‰€æœ‰çš„ Hooks è°ƒç”¨åªå‘ç”Ÿåœ¨ç»„ä»¶çš„é¡¶éƒ¨å¹¶ä¸”ä¸åœ¨æ¡ä»¶è¯­å¥ä¸­ã€‚è¿™äº› Hooks çš„<a href="https://reactjs.org/docs/hooks-rules.html">è§„åˆ™</a>èƒ½å¤Ÿè¢« <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">linter plugin</a> æ‰€è§„èŒƒã€‚æœ‰å¾ˆå¤šå…³äºè¿™ç§è®¾è®¡é€‰æ‹©çš„æ¿€çƒˆäº‰è®ºï¼Œä½†åœ¨å®è·µä¸­æˆ‘å¹¶æ²¡æœ‰çœ‹åˆ°å®ƒè®©äººå›°æƒ‘ã€‚æˆ‘è¿˜å†™äº†å…³äºä¸ºä»€ä¹ˆé€šå¸¸æå‡ºçš„æ›¿ä»£æ–¹æ¡ˆ<a href="https://overreacted.io/why-do-hooks-rely-on-call-order/">ä¸èµ·ä½œç”¨</a>çš„æ–‡ç« ã€‚</p>
<p>Hooks çš„å†…éƒ¨å®ç°å…¶å®æ˜¯<a href="https://dev.to/aspittel/thank-u-next-an-introduction-to-linked-lists-4pph">é“¾è¡¨</a> ã€‚å½“ä½ è°ƒç”¨ <code>useState</code> çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†æŒ‡é’ˆç§»åˆ°ä¸‹ä¸€é¡¹ã€‚å½“æˆ‘ä»¬é€€å‡ºç»„ä»¶çš„<a href="#%E8%B0%83%E7%94%A8%E6%A0%91">â€œè°ƒç”¨æ ‘â€å¸§</a>æ—¶ï¼Œä¼šç¼“å­˜è¯¥ç»“æœçš„åˆ—è¡¨ç›´åˆ°ä¸‹æ¬¡æ¸²æŸ“å¼€å§‹ã€‚</p>
<p><a href="https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e">è¿™ç¯‡æ–‡ç« </a>ç®€è¦ä»‹ç»äº† Hooks å†…éƒ¨æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æ•°ç»„ä¹Ÿè®¸æ˜¯æ¯”é“¾è¡¨æ›´å¥½è§£é‡Šå…¶åŸç†çš„æ¨¡å‹ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">// ä¼ªä»£ç 
let hooks, i;
function useState() {
  i++;
  if (hooks[i]) {
    // å†æ¬¡æ¸²æŸ“æ—¶
    return hooks[i];
  }
  // ç¬¬ä¸€æ¬¡æ¸²æŸ“
  hooks.push(...);
}

// å‡†å¤‡æ¸²æŸ“
i = -1;
hooks = fiber.hooks || [];
// è°ƒç”¨ç»„ä»¶
YourComponent();
// ç¼“å­˜ Hooks çš„çŠ¶æ€
fiber.hooks = hooks;
</code></pre><p><em>(å¦‚æœä½ å¯¹å®ƒæ„Ÿå…´è¶£ï¼ŒçœŸæ­£çš„ä»£ç åœ¨<a href="https://github.com/facebook/react/blob/master/packages/react-reconciler/src/ReactFiberHooks.js">è¿™é‡Œ</a> ã€‚)</em></p>
<p>è¿™å¤§è‡´å°±æ˜¯æ¯ä¸ª <code>useState()</code> å¦‚ä½•è·å¾—æ­£ç¡®çŠ¶æ€çš„æ–¹å¼ã€‚å°±åƒæˆ‘ä»¬<a href="#%E5%8D%8F%E8%B0%83">ä¹‹å‰</a>æ‰€çŸ¥é“çš„ï¼Œâ€œåŒ¹é…â€å¯¹ React æ¥è¯´å¹¶ä¸æ˜¯ä»€ä¹ˆæ–°çš„çŸ¥è¯† â€” è¿™ä¸åè°ƒä¾èµ–äºåœ¨æ¸²æŸ“å‰åå…ƒç´ æ˜¯å¦åŒ¹é…æ˜¯åŒæ ·çš„é“ç†ã€‚</p>
<h2>æœªæåŠçš„çŸ¥è¯†</h2>
<p>æˆ‘ä»¬å·²ç»è§¦åŠåˆ° React è¿è¡Œæ—¶ç¯å¢ƒä¸­å‡ ä¹æ‰€æœ‰é‡è¦çš„æ–¹é¢ã€‚å¦‚æœä½ è¯»å®Œäº†æœ¬ç¯‡æ–‡ç« ï¼Œä½ å¯èƒ½å·²ç»æ¯” 90% çš„å¼€å‘è€…æ›´äº†è§£ React ï¼è¿™ä¸€ç‚¹ä¹Ÿæ²¡æœ‰é”™ï¼</p>
<p>å½“ç„¶æœ‰ä¸€äº›åœ°æ–¹æˆ‘å¹¶æ²¡æœ‰æåŠåˆ° â€” ä¸»è¦æ˜¯å› ä¸ºæˆ‘ä»¬å¯¹å®ƒä»¬ä¹Ÿä¸å¤ªæ¸…æ¥šã€‚React ç›®å‰å¯¹å¤šé“æ¸²æŸ“å¹¶æ²¡æœ‰å¤ªå¥½çš„æ”¯æŒï¼Œå³å½“çˆ¶ç»„ä»¶çš„æ¸²æŸ“éœ€è¦å­ç»„ä»¶æä¾›ä¿¡æ¯æ—¶ã€‚<a href="https://reactjs.org/docs/error-boundaries.html">é”™è¯¯å¤„ç† API</a> ç›®å‰ä¹Ÿè¿˜æ²¡æœ‰ Hooks çš„ç‰ˆæœ¬ã€‚è¿™ä¸¤ä¸ªé—®é¢˜å¯èƒ½ä¼šè¢«ä¸€èµ·è§£å†³ã€‚å¹¶å‘æ¨¡å¼åœ¨ç›®å‰çœ‹æ¥å¹¶ä¸ç¨³å®šï¼Œä¹Ÿæœ‰å¾ˆå¤šå…³äº Suspense è¯¥å¦‚ä½•é€‚åº”å½“å‰ç‰ˆæœ¬çš„æœ‰è¶£é—®é¢˜ã€‚ä¹Ÿè®¸æˆ‘ä¼šåœ¨å®ƒä»¬è¦å®Œæˆçš„æ—¶å€™å†æ¥è®¨è®ºï¼Œå¹¶ä¸” Suspense å·²ç»å‡†å¤‡å¥½æ¯” <a href="https://reactjs.org/blog/2018/10/23/react-v-16-6.html#reactlazy-code-splitting-with-suspense">lazy loading</a> èƒ½å¤Ÿåšçš„æ›´å¤šã€‚</p>
<p><strong>æˆ‘è®¤ä¸º React API çš„æˆåŠŸä¹‹å¤„åœ¨äºï¼Œå³ä½¿åœ¨æ²¡æœ‰è€ƒè™‘è¿‡ä¸Šé¢è¿™äº›å¤§å¤šæ•°ä¸»é¢˜çš„æƒ…å†µä¸‹ï¼Œä½ ä¹Ÿèƒ½è½»æ¾ä½¿ç”¨å®ƒå¹¶ä¸”å¯ä»¥èµ°çš„å¾ˆè¿œã€‚</strong> åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåƒåè°ƒè¿™æ ·å¥½çš„é»˜è®¤ç‰¹æ€§å¯å‘å¼åœ°ä¸ºæˆ‘ä»¬åšäº†æ­£ç¡®çš„äº‹æƒ…ã€‚åœ¨ä½ å¿˜è®°æ·»åŠ  <code>key</code> è¿™æ ·çš„å±æ€§æ—¶ï¼ŒReact èƒ½å¤Ÿå¥½å¿ƒæé†’ä½ ã€‚</p>
<p>å¦‚æœä½ æ˜¯ç—´è¿·äº UI åº“çš„ä¹¦å‘†å­ï¼Œæˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æ¥è¯´ä¼šå¾ˆæœ‰è¶£å¹¶ä¸”æ˜¯æ·±å…¥é˜æ˜äº† React æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚åˆæˆ–è®¸ä½ ä¼šè§‰å¾— React å¤ªè¿‡äºå¤æ‚ä¸ºæ­¤ä½ ä¸ä¼šå†å»æ·±å…¥ç†è§£å®ƒã€‚ä¸ç®¡æ€æ ·ï¼Œæˆ‘éƒ½å¾ˆä¹æ„åœ¨ Twitter ä¸Šæ”¶åˆ°ä½ çš„æ¶ˆæ¯ï¼è°¢è°¢ä½ çš„é˜…è¯»ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[React as a UI Runtime]]></title>
            <link>/post/react-as-a-ui-runtime</link>
            <guid>/post/react-as-a-ui-runtime</guid>
            <description><![CDATA[An in-depth description of the React programming model.]]></description>
            <content:encoded><![CDATA[<p>Most tutorials introduce React as a UI library. This makes sense because React <em>is</em> a UI library. Thatâ€™s literally what the tagline says!</p>
<p><img src="./react.png" alt="React homepage screenshot: &quot;A JavaScript library for building user interfaces&quot;"></p>
<p>Iâ€™ve written about the challenges of creating <a href="/the-elements-of-ui-engineering/">user interfaces</a> before. But this post talks about React in a different way â€” more as a <a href="https://en.wikipedia.org/wiki/Runtime_system">programming runtime</a>.</p>
<p><strong>This post wonâ€™t teach you anything about creating user interfaces.</strong> But it might help you understand the React programming model in more depth.</p>
<hr>
<p><strong>Note: If youâ€™re <em>learning</em> React, check out <a href="https://reactjs.org/docs/getting-started.html#learn-react">the docs</a> instead.</strong></p>
<p><font size="60">âš ï¸</font></p>
<p><strong>This is a deep dive â€” THIS IS NOT a beginner-friendly post.</strong> In this post, Iâ€™m describing most of the React programming model from first principles. I donâ€™t explain how to use it â€” just how it works.</p>
<p>Itâ€™s aimed at experienced programmers and folks working on other UI libraries who asked about some tradeoffs chosen in React. I hope youâ€™ll find it useful!</p>
<p><strong>Many people successfully use React for years without thinking about most of these topics.</strong> This is definitely a programmer-centric view of React rather than, say, a <a href="http://mrmrs.cc/writing/2016/04/21/developing-ui/">designer-centric one</a>. But I donâ€™t think it hurts to have resources for both.</p>
<p>With that disclaimer out of the way, letâ€™s go!</p>
<hr>
<h2>Host Tree</h2>
<p>Some programs output numbers. Other programs output poems. Different languages and their runtimes are often optimized for a particular set of use cases, and React is no exception to that.</p>
<p>React programs usually output <strong>a tree that may change over time</strong>. It might be a <a href="https://www.npmjs.com/package/react-dom">DOM tree</a>, an <a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/Devpedia-CocoaApp/View%20Hierarchy.html">iOS hierarchy</a>, a tree of <a href="https://react-pdf.org/">PDF primitives</a>, or even of <a href="https://reactjs.org/docs/test-renderer.html">JSON objects</a>. However, usually, we want to represent some UI with it. Weâ€™ll call it a â€œ<em>host</em> treeâ€ because it is a part of the <em>host environment</em> outside of React â€” like DOM or iOS. The host tree usually has <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild">its</a> <a href="https://developer.apple.com/documentation/uikit/uiview/1622616-addsubview">own</a> imperative API. React is a layer on top of it.</p>
<p>So what is React useful for? Very abstractly, it helps you write a program that predictably manipulates a complex host tree in response to external events like interactions, network responses, timers, and so on.</p>
<p>A specialized tool works better than a generic one when it can impose and benefit from particular constraints. React makes a bet on two principles:</p>
<ul>
<li>
<p><strong>Stability.</strong> The host tree is relatively stable and most updates donâ€™t radically change its overall structure. If an app rearranged all its interactive elements into a completely different combination every second, it would be difficult to use. Where did that button go? Why is my screen dancing?</p>
</li>
<li>
<p><strong>Regularity.</strong> The host tree can be broken down into UI patterns that look and behave consistently (such as buttons, lists, avatars) rather than random shapes.</p>
</li>
</ul>
<p><strong>These principles happen to be true for most UIs.</strong> However, React is ill-suited when there are no stable â€œpatternsâ€ in the output. For example, React may help you write a Twitter client but wonâ€™t be very useful for a <a href="https://www.youtube.com/watch?v=Uzx9ArZ7MUU">3D pipes screensaver</a>.</p>
<h2>Host Instances</h2>
<p>The host tree consists of nodes. Weâ€™ll call them â€œhost instancesâ€.</p>
<p>In the DOM environment, host instances are regular DOM nodes â€” like the objects you get when you call <code>document.createElement('div')</code>. On iOS, host instances could be values uniquely identifying a native view from JavaScript.</p>
<p>Host instances have their own properties (e.g. <code>domNode.className</code> or <code>view.tintColor</code>). They may also contain other host instances as children.</p>
<p>(This has nothing to do with React â€” Iâ€™m describing the host environments.)</p>
<p>There is usually an API to manipulate host instances. For example, the DOM provides APIs like <code>appendChild</code>, <code>removeChild</code>, <code>setAttribute</code>, and so on. In React apps, you usually donâ€™t call these APIs. Thatâ€™s the job of React.</p>
<h2>Renderers</h2>
<p>A <em>renderer</em> teaches React to talk to a specific host environment and manage its host instances. React DOM, React Native, and even <a href="https://mobile.twitter.com/vadimdemedes/status/1089344289102942211">Ink</a> are React renderers. You can also <a href="https://github.com/facebook/react/tree/master/packages/react-reconciler">create your own React renderer</a>.</p>
<p>React renderers can work in one of two modes.</p>
<p>The vast majority of renderers are written to use the â€œmutatingâ€ mode. This mode is how the DOM works: we can create a node, set its properties, and later add or remove children from it. The host instances are completely mutable.</p>
<p>React can also work in a <a href="https://en.wikipedia.org/wiki/Persistent_data_structure">â€œpersistentâ€</a> mode. This mode is for host environments that donâ€™t provide methods like <code>appendChild()</code> but instead clone the parent tree and always replace the top-level child. Immutability on the host tree level makes multi-threading easier. <a href="https://facebook.github.io/react-native/blog/2018/06/14/state-of-react-native-2018">React Fabric</a> takes advantage of that.</p>
<p>As a React user, you never need to think about these modes. I only want to highlight that React isnâ€™t just an adapter from one mode to another. Its usefulness is orthogonal to the target low-level view API paradigm.</p>
<h2>React Elements</h2>
<p>In the host environment, a host instance (like a DOM node) is the smallest building block. In React, the smallest building block is a <em>React element</em>.</p>
<p>A React element is a plain JavaScript object. It can <em>describe</em> a host instance.</p>
<pre   class="language-jsx"><code class="language-jsx">// JSX is a syntax sugar for these objects.
// &lt;button className=&quot;blue&quot; /&gt;
{
  type: 'button',
  props: { className: 'blue' }
}
</code></pre><p>A React element is lightweight and has no host instance tied to it. Again, it is merely a <em>description</em> of what you want to see on the screen.</p>
<p>Like host instances, React elements can form a tree:</p>
<pre   class="language-jsx"><code class="language-jsx">// JSX is a syntax sugar for these objects.
// &lt;dialog&gt;
//   &lt;button className=&quot;blue&quot; /&gt;
//   &lt;button className=&quot;red&quot; /&gt;
// &lt;/dialog&gt;
{
  type: 'dialog',
  props: {
    children: [{
      type: 'button',
      props: { className: 'blue' }
    }, {
      type: 'button',
      props: { className: 'red' }
    }]
  }
}
</code></pre><p><em>(Note: I omitted <a href="/why-do-react-elements-have-typeof-property/">some properties</a> that arenâ€™t important to this explanation.)</em></p>
<p>However, remember that <strong>React elements donâ€™t have their own persistent identity.</strong> Theyâ€™re meant to be re-created and thrown away all the time.</p>
<p>React elements are immutable. For example, you canâ€™t change the children or a property of a React element. If you want to render something different later, you will <em>describe</em> it with a new React element tree created from scratch.</p>
<p>I like to think of React elements as being like frames in a movie. They capture what the UI should look like at a specific point in time. They donâ€™t change.</p>
<h2>Entry Point</h2>
<p>Each React renderer has an â€œentry pointâ€. Itâ€™s the API that lets us tell React to render a particular React element tree inside a container host instance.</p>
<p>For example, React DOM entry point is <code>ReactDOM.render</code>:</p>
<pre   class="language-jsx"><code class="language-jsx">ReactDOM.render(
  // { type: 'button', props: { className: 'blue' } }
  &lt;button className=&quot;blue&quot; /&gt;,
  document.getElementById('container')
);
</code></pre><p>When we say <code>ReactDOM.render(reactElement, domContainer)</code>, we mean: <strong>â€œDear React, make the <code>domContainer</code> host tree match my <code>reactElement</code>.â€</strong></p>
<p>React will look at the <code>reactElement.type</code> (in our example, <code>'button'</code>) and ask the React DOM renderer to create a host instance for it and set the properties:</p>
<pre data-line="3,4,"  3,4="" class="language-jsx"><code 3,4="" class="language-jsx">// Somewhere in the ReactDOM renderer (simplified)
function createHostInstance(reactElement) {
  let domNode = document.createElement(reactElement.type);
  domNode.className = reactElement.props.className;
  return domNode;
}
</code></pre><p>In our example, effectively React will do this:</p>
<pre data-line="1,2,"  1,2="" class="language-jsx"><code 1,2="" class="language-jsx">let domNode = document.createElement('button');
domNode.className = 'blue';

domContainer.appendChild(domNode);
</code></pre><p>If the React element has child elements in <code>reactElement.props.children</code>, React will recursively create host instances for them too on the first render.</p>
<h2>Reconciliation</h2>
<p>What happens if we call <code>ReactDOM.render()</code> twice with the same container?</p>
<pre data-line="2,11,"  2,11="" class="language-jsx"><code 2,11="" class="language-jsx">ReactDOM.render(
  &lt;button className=&quot;blue&quot; /&gt;,
  document.getElementById('container')
);

// ... later ...

// Should this *replace* the button host instance
// or merely update a property on an existing one?
ReactDOM.render(
  &lt;button className=&quot;red&quot; /&gt;,
  document.getElementById('container')
);
</code></pre><p>Again, Reactâ€™s job is to <em>make the host tree match the provided React element tree</em>. The process of figuring out <em>what</em> to do to the host instance tree in response to new information is sometimes called <a href="https://reactjs.org/docs/reconciliation.html">reconciliation</a>.</p>
<p>There are two ways to go about it. A simplified version of React could blow away the existing tree and re-create it from scratch:</p>
<pre   class="language-jsx"><code class="language-jsx">let domContainer = document.getElementById('container');
// Clear the tree
domContainer.innerHTML = '';
// Create the new host instance tree
let domNode = document.createElement('button');
domNode.className = 'red';
domContainer.appendChild(domNode);
</code></pre><p>But in DOM, this is slow and loses important information like focus, selection, scroll state, and so on. Instead, we want React to do something like this:</p>
<pre   class="language-jsx"><code class="language-jsx">let domNode = domContainer.firstChild;
// Update existing host instance
domNode.className = 'red';
</code></pre><p>In other words, React needs to decide when to <em>update</em> an existing host instance to match a new React element, and when to create a <em>new</em> one.</p>
<p>This raises a question of <em>identity</em>. The React element may be different every time, but when does it refer to the same host instance conceptually?</p>
<p>In our example, itâ€™s simple. We used to render a <code>&lt;button&gt;</code> as a first (and only) child, and we want to render a <code>&lt;button&gt;</code> in the same place again. We already have a <code>&lt;button&gt;</code> host instance there so why re-create it? Letâ€™s just reuse it.</p>
<p>This is pretty close to how React thinks about it.</p>
<p><strong>If an element type in the same place in the tree â€œmatches upâ€ between the previous and the next renders, React reuses the existing host instance.</strong></p>
<p>Here is an example with comments showing roughly what React does:</p>
<pre data-line="9,10,16,26,27,"  9,10,16,26,27="" class="language-jsx"><code 9,10,16,26,27="" class="language-jsx">// let domNode = document.createElement('button');
// domNode.className = 'blue';
// domContainer.appendChild(domNode);
ReactDOM.render(
  &lt;button className=&quot;blue&quot; /&gt;,
  document.getElementById('container')
);

// Can reuse host instance? Yes! (button â†’ button)
// domNode.className = 'red';
ReactDOM.render(
  &lt;button className=&quot;red&quot; /&gt;,
  document.getElementById('container')
);

// Can reuse host instance? No! (button â†’ p)
// domContainer.removeChild(domNode);
// domNode = document.createElement('p');
// domNode.textContent = 'Hello';
// domContainer.appendChild(domNode);
ReactDOM.render(
  &lt;p&gt;Hello&lt;/p&gt;,
  document.getElementById('container')
);

// Can reuse host instance? Yes! (p â†’ p)
// domNode.textContent = 'Goodbye';
ReactDOM.render(
  &lt;p&gt;Goodbye&lt;/p&gt;,
  document.getElementById('container')
);
</code></pre><p>The same heuristic is used for child trees. For example, when we update a <code>&lt;dialog&gt;</code> with two <code>&lt;button&gt;</code>s inside, React first decides whether to re-use the <code>&lt;dialog&gt;</code>, and then repeats this decision procedure for each child.</p>
<h2>Conditions</h2>
<p>If React only reuses host instances when the element types â€œmatch upâ€ between updates, how can we render conditional content?</p>
<p>Say we want to first show only an input, but later render a message before it:</p>
<pre data-line="12,"  12="" class="language-jsx"><code 12="" class="language-jsx">// First render
ReactDOM.render(
  &lt;dialog&gt;
    &lt;input /&gt;
  &lt;/dialog&gt;,
  domContainer
);

// Next render
ReactDOM.render(
  &lt;dialog&gt;
    &lt;p&gt;I was just added here!&lt;/p&gt;
    &lt;input /&gt;
  &lt;/dialog&gt;,
  domContainer
);
</code></pre><p>In this example, the <code>&lt;input&gt;</code> host instance would get re-created. React would walk the element tree, comparing it with the previous version:</p>
<ul>
<li><code>dialog â†’ dialog</code>: Can reuse the host instance? <strong>Yes â€” the type matches.</strong>
<ul>
<li><code>input â†’ p</code>: Can reuse the host instance? <strong>No, the type has changed!</strong> Need to remove the existing <code>input</code> and create a new <code>p</code> host instance.</li>
<li><code>(nothing) â†’ input</code>: Need to create a new <code>input</code> host instance.</li>
</ul>
</li>
</ul>
<p>So effectively the update code executed by React would be like:</p>
<pre data-line="1,2,8,9,"  1,2,8,9="" class="language-jsx"><code 1,2,8,9="" class="language-jsx">let oldInputNode = dialogNode.firstChild;
dialogNode.removeChild(oldInputNode);

let pNode = document.createElement('p');
pNode.textContent = 'I was just added here!';
dialogNode.appendChild(pNode);

let newInputNode = document.createElement('input');
dialogNode.appendChild(newInputNode);
</code></pre><p>This is not great because <em>conceptually</em> the <code>&lt;input&gt;</code> hasnâ€™t been <em>replaced</em> with <code>&lt;p&gt;</code> â€” it just moved. We donâ€™t want to lose its selection, focus state, and content due to re-creating the DOM.</p>
<p>While this problem has an easy fix (which weâ€™ll get to in a minute), it doesnâ€™t occur often in React applications. Itâ€™s interesting to see why.</p>
<p>In practice, you would rarely call <code>ReactDOM.render</code> directly. Instead, React apps tend to be broken down into functions like this:</p>
<pre   class="language-jsx"><code class="language-jsx">function Form({ showMessage }) {
  let message = null;
  if (showMessage) {
    message = &lt;p&gt;I was just added here!&lt;/p&gt;;
  }
  return (
    &lt;dialog&gt;
      {message}
      &lt;input /&gt;
    &lt;/dialog&gt;
  );
}
</code></pre><p>This example doesnâ€™t suffer from the problem we just described. It might be easier to see why if we use object notation instead of JSX. Look at the <code>dialog</code> child element tree:</p>
<pre data-line="12-15,"  12-15="" class="language-jsx"><code 12-15="" class="language-jsx">function Form({ showMessage }) {
  let message = null;
  if (showMessage) {
    message = {
      type: 'p',
      props: { children: 'I was just added here!' }
    };
  }
  return {
    type: 'dialog',
    props: {
      children: [
        message,
        { type: 'input', props: {} }
      ]
    }
  };
}
</code></pre><p><strong>Regardless of whether <code>showMessage</code> is <code>true</code> or <code>false</code>, the <code>&lt;input&gt;</code> is the second child and doesnâ€™t change its tree position between renders.</strong></p>
<p>If <code>showMessage</code> changes from <code>false</code> to <code>true</code>, React would walk the element tree, comparing it with the previous version:</p>
<ul>
<li><code>dialog â†’ dialog</code>: Can reuse the host instance? <strong>Yes â€” the type matches.</strong>
<ul>
<li><code>(null) â†’ p</code>: Need to insert a new <code>p</code> host instance.</li>
<li><code>input â†’ input</code>: Can reuse the host instance? <strong>Yes â€” the type matches.</strong></li>
</ul>
</li>
</ul>
<p>And the code executed by React would be similar to this:</p>
<pre   class="language-jsx"><code class="language-jsx">let inputNode = dialogNode.firstChild;
let pNode = document.createElement('p');
pNode.textContent = 'I was just added here!';
dialogNode.insertBefore(pNode, inputNode);
</code></pre><p>No input state is lost now.</p>
<h2>Lists</h2>
<p>Comparing the element type at the same position in the tree is usually enough to decide whether to reuse or re-create the corresponding host instance.</p>
<p>But this only works well if child positions are static and donâ€™t re-order. In our example above, even though <code>message</code> could be a â€œholeâ€, we still knew that the input goes after the message, and there are no other children.</p>
<p>With dynamic lists, we canâ€™t be sure the order is ever the same:</p>
<pre   class="language-jsx"><code class="language-jsx">function ShoppingList({ list }) {
  return (
    &lt;form&gt;
      {list.map(item =&gt; (
        &lt;p&gt;
          You bought {item.name}
          &lt;br /&gt;
          Enter how many do you want: &lt;input /&gt;
        &lt;/p&gt;
      ))}
    &lt;/form&gt;
  )
}
</code></pre><p>If the <code>list</code> of our shopping items is ever re-ordered, React will see that all <code>p</code> and <code>input</code> elements inside have the same type, and wonâ€™t know to move them. (From Reactâ€™s point of view, the <em>items themselves</em> changed, not their order.)</p>
<p>The code executed by React to re-order 10 items would be something like:</p>
<pre   class="language-jsx"><code class="language-jsx">for (let i = 0; i &lt; 10; i++) {
  let pNode = formNode.childNodes[i];
  let textNode = pNode.firstChild;
  textNode.textContent = 'You bought ' + items[i].name;
}
</code></pre><p>So instead of <em>re-ordering</em> them, React would effectively <em>update</em> each of them. This can create performance issues and possible bugs. For example, the content of the first input would stay reflected in first input <em>after</em> the sort â€” even though conceptually they might refer to different products in your shopping list!</p>
<p><strong>This is why React nags you to specify a special property called <code>key</code> every time you include an array of elements in your output:</strong></p>
<pre data-line="5,"  5="" class="language-jsx"><code 5="" class="language-jsx">function ShoppingList({ list }) {
  return (
    &lt;form&gt;
      {list.map(item =&gt; (
        &lt;p key={item.productId}&gt;
          You bought {item.name}
          &lt;br /&gt;
          Enter how many do you want: &lt;input /&gt;
        &lt;/p&gt;
      ))}
    &lt;/form&gt;
  )
}
</code></pre><p>A <code>key</code> tells React that it should consider an item to be <em>conceptually</em> the same even if it has different <em>positions</em> inside its parent element between renders.</p>
<p>When React sees <code>&lt;p key=&quot;42&quot;&gt;</code> inside a <code>&lt;form&gt;</code>, it will check if the previous render also contained <code>&lt;p key=&quot;42&quot;&gt;</code> inside the same <code>&lt;form&gt;</code>. This works even if <code>&lt;form&gt;</code> children changed their order. React will reuse the previous host instance with the same key if it exists, and re-order the siblings accordingly.</p>
<p>Note that the <code>key</code> is only relevant within a particular parent React element, such as a <code>&lt;form&gt;</code>. React wonâ€™t try to â€œmatch upâ€ elements with the same keys between different parents. (React doesnâ€™t have idiomatic support for moving a host instance between different parents without re-creating it.)</p>
<p>Whatâ€™s a good value for a <code>key</code>? An easy way to answer this is to ask: <strong>when would <em>you</em> say an item is the â€œsameâ€ even if the order changed?</strong> For example, in our shopping list, the product ID uniquely identifies it between siblings.</p>
<h2>Components</h2>
<p>Weâ€™ve already seen functions that return React elements:</p>
<pre   class="language-jsx"><code class="language-jsx">function Form({ showMessage }) {
  let message = null;
  if (showMessage) {
    message = &lt;p&gt;I was just added here!&lt;/p&gt;;
  }
  return (
    &lt;dialog&gt;
      {message}
      &lt;input /&gt;
    &lt;/dialog&gt;
  );
}
</code></pre><p>They are called <em>components</em>. They let us create our own â€œtoolboxâ€ of buttons, avatars, comments, and so on. Components are the bread and butter of React.</p>
<p>Components take one argument â€” an object hash. It contains â€œpropsâ€ (short for â€œpropertiesâ€). Here, <code>showMessage</code> is a prop. Theyâ€™re like named arguments.</p>
<h2>Purity</h2>
<p>React components are assumed to be pure with respect to their props.</p>
<pre   class="language-jsx"><code class="language-jsx">function Button(props) {
  // ğŸ”´ Doesn't work
  props.isActive = true;
}
</code></pre><p>In general, mutation is not idiomatic in React. (Weâ€™ll talk more about the idiomatic way to update the UI in response to events later.)</p>
<p>However, <em>local mutation</em> is absolutely fine:</p>
<pre data-line="2,5,"  2,5="" class="language-jsx"><code 2,5="" class="language-jsx">function FriendList({ friends }) {
  let items = [];
  for (let i = 0; i &lt; friends.length; i++) {
    let friend = friends[i];
    items.push(
      &lt;Friend key={friend.id} friend={friend} /&gt;
    );
  }
  return &lt;section&gt;{items}&lt;/section&gt;;
}
</code></pre><p>We created <code>items</code> <em>while rendering</em> and no other component â€œsawâ€ it so we can mutate it as much as we like before handing it off as part of the render result. There is no need to contort your code to avoid local mutation.</p>
<p>Similarly, lazy initialization is fine despite not being fully â€œpureâ€:</p>
<pre   class="language-jsx"><code class="language-jsx">function ExpenseForm() {
  // Fine if it doesn't affect other components:
  SuperCalculator.initializeIfNotReady();

  // Continue rendering...
}
</code></pre><p>As long as calling a component multiple times is safe and doesnâ€™t affect the rendering of other components, React doesnâ€™t care if itâ€™s 100% pure in the strict FP sense of the word. <a href="https://stackoverflow.com/questions/1077412/what-is-an-idempotent-operation">Idempotence</a> is more important to React than purity.</p>
<p>That said, side effects that are directly visible to the user are not allowed in React components. In other words, merely <em>calling</em> a component function shouldnâ€™t by itself produce a change on the screen.</p>
<h2>Recursion</h2>
<p>How do we <em>use</em> components from other components? Components are functions so we <em>could</em> call them:</p>
<pre   class="language-jsx"><code class="language-jsx">let reactElement = Form({ showMessage: true });
ReactDOM.render(reactElement, domContainer);
</code></pre><p>However, this is <em>not</em> the idiomatic way to use components in the React runtime.</p>
<p>Instead, the idiomatic way to use a component is with the same mechanism weâ€™ve already seen before â€” React elements. <strong>This means that you donâ€™t directly call the component function, but instead let React later do it for you</strong>:</p>
<pre   class="language-jsx"><code class="language-jsx">// { type: Form, props: { showMessage: true } }
let reactElement = &lt;Form showMessage={true} /&gt;;
ReactDOM.render(reactElement, domContainer);
</code></pre><p>And somewhere inside React, your component will be called:</p>
<pre   class="language-jsx"><code class="language-jsx">// Somewhere inside React
let type = reactElement.type; // Form
let props = reactElement.props; // { showMessage: true }
let result = type(props); // Whatever Form returns
</code></pre><p>Component function names are by convention capitalized. When the JSX transform sees <code>&lt;Form&gt;</code> rather than <code>&lt;form&gt;</code>, it makes the object <code>type</code> itself an identifier rather than a string:</p>
<pre   class="language-jsx"><code class="language-jsx">console.log(&lt;form /&gt;.type); // 'form' string
console.log(&lt;Form /&gt;.type); // Form function
</code></pre><p>There is no global registration mechanism â€” we literally refer to <code>Form</code> by name when typing <code>&lt;Form /&gt;</code>. If <code>Form</code> doesnâ€™t exist in local scope, youâ€™ll see a JavaScript error just like you normally would with a bad variable name.</p>
<p><strong>Okay, so what does React do when an element type is a function? It calls your component, and asks what element <em>that</em> component wants to render.</strong></p>
<p>This process continues recursively and is described in more detail <a href="https://reactjs.org/blog/2015/12/18/react-components-elements-and-instances.html">here</a>. In short, it looks like this:</p>
<ul>
<li><strong>You:</strong> <code>ReactDOM.render(&lt;App /&gt;, domContainer)</code></li>
<li><strong>React:</strong> Hey <code>App</code>, what do you render to?
<ul>
<li><code>App</code>: I render <code>&lt;Layout&gt;</code> with <code>&lt;Content&gt;</code> inside.</li>
</ul>
</li>
<li><strong>React:</strong> Hey <code>Layout</code>, what do you render to?
<ul>
<li><code>Layout</code>: I render my children in a <code>&lt;div&gt;</code>. My child was <code>&lt;Content&gt;</code> so I guess that goes into the <code>&lt;div&gt;</code>.</li>
</ul>
</li>
<li><strong>React:</strong> Hey <code>&lt;Content&gt;</code>, what do you render to?
<ul>
<li><code>Content</code>: I render an <code>&lt;article&gt;</code> with some text and a <code>&lt;Footer&gt;</code> inside.</li>
</ul>
</li>
<li><strong>React:</strong> Hey <code>&lt;Footer&gt;</code>, what do you render to?
<ul>
<li><code>Footer</code>: I render a <code>&lt;footer&gt;</code> with some more text.</li>
</ul>
</li>
<li><strong>React:</strong> Okay, here you go:</li>
</ul>
<pre   class="language-jsx"><code class="language-jsx">// Resulting DOM structure
&lt;div&gt;
  &lt;article&gt;
    Some text
    &lt;footer&gt;some more text&lt;/footer&gt;
  &lt;/article&gt;
&lt;/div&gt;
</code></pre><p>This is why we say reconciliation is recursive. When React walks the element tree, it might meet an element whose <code>type</code> is a component. It will call it and keep descending down the tree of returned React elements. Eventually, weâ€™ll run out of components, and React will know what to change in the host tree.</p>
<p>The same reconciliation rules we already discussed apply here too. If the <code>type</code> at the same position (as determined by index and optional <code>key</code>) changes, React will throw away the host instances inside, and re-create them.</p>
<h2>Inversion of Control</h2>
<p>You might be wondering: why donâ€™t we just call components directly? Why write <code>&lt;Form /&gt;</code> rather than <code>Form()</code>?</p>
<p><strong>React can do its job better if it â€œknowsâ€ about your components rather than if it only sees the React element tree after recursively calling them.</strong></p>
<pre   class="language-jsx"><code class="language-jsx">// ğŸ”´ React has no idea Layout and Article exist.
// You're calling them.
ReactDOM.render(
  Layout({ children: Article() }),
  domContainer
)

// âœ… React knows Layout and Article exist.
// React calls them.
ReactDOM.render(
  &lt;Layout&gt;&lt;Article /&gt;&lt;/Layout&gt;,
  domContainer
)
</code></pre><p>This is a classic example of <a href="https://en.wikipedia.org/wiki/Inversion_of_control">inversion of control</a>. Thereâ€™s a few interesting properties we get by letting React take control of calling our components:</p>
<ul>
<li>
<p><strong>Components become more than functions.</strong> React can augment component functions with features like <em>local state</em> that are tied to the component identity in the tree. A good runtime provides fundamental abstractions that match the problem at hand. As we already mentioned, React is oriented specifically at programs that render UI trees and respond to interactions. If you called components directly, youâ€™d have to build these features yourself.</p>
</li>
<li>
<p><strong>Component types participate in the reconciliation.</strong> By letting React call your components, you also tell it more about the conceptual structure of your tree. For example, when you move from rendering <code>&lt;Feed&gt;</code> to the <code>&lt;Profile&gt;</code> page, React wonâ€™t attempt to re-use host instances inside them â€” just like when you replace <code>&lt;button&gt;</code> with a <code>&lt;p&gt;</code>. All state will be gone â€” which is usually good when you render a conceptually different view. You wouldn't want to preserve input state between <code>&lt;PasswordForm&gt;</code> and <code>&lt;MessengerChat&gt;</code> even if the <code>&lt;input&gt;</code> position in the tree accidentally â€œlines upâ€ between them.</p>
</li>
<li>
<p><strong>React can delay the reconciliation.</strong> If React takes control over calling our components, it can do many interesting things. For example, it can let the browser do some work between the component calls so that re-rendering a large component tree <a href="https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html">doesnâ€™t block the main thread</a>. Orchestrating this manually without reimplementing a large part of React is difficult.</p>
</li>
<li>
<p><strong>A better debugging story.</strong> If components are first-class citizens that the library is aware of, we can build <a href="https://github.com/facebook/react-devtools">rich developer tools</a> for introspection in development.</p>
</li>
</ul>
<p>The last benefit to React calling your component functions is <em>lazy evaluation</em>. Letâ€™s see what this means.</p>
<h2>Lazy Evaluation</h2>
<p>When we call functions in JavaScript, arguments are evaluated before the call:</p>
<pre   class="language-jsx"><code class="language-jsx">// (2) This gets computed second
eat(
  // (1) This gets computed first
  prepareMeal()
);
</code></pre><p>This is usually what JavaScript developers expect because JavaScript functions can have implicit side effects. It would be surprising if we called a function, but it wouldnâ€™t execute until its result gets somehow â€œusedâ€ in JavaScript.</p>
<p>However, React components are <a href="#purity">relatively</a> pure. There is absolutely no need to execute it if we know its result wonâ€™t get rendered on the screen.</p>
<p>Consider this component putting <code>&lt;Comments&gt;</code> inside a <code>&lt;Page&gt;</code>:</p>
<pre data-line="11,"  11="" class="language-jsx"><code 11="" class="language-jsx">function Story({ currentUser }) {
  // return {
  //   type: Page,
  //   props: {
  //     user: currentUser,
  //     children: { type: Comments, props: {} }
  //   }
  // }
  return (
    &lt;Page user={currentUser}&gt;
      &lt;Comments /&gt;
    &lt;/Page&gt;
  );
}
</code></pre><p>The <code>Page</code> component can render the children given to it inside some <code>Layout</code>:</p>
<pre data-line="4,"  4="" class="language-jsx"><code 4="" class="language-jsx">function Page({ user, children }) {
  return (
    &lt;Layout&gt;
      {children}
    &lt;/Layout&gt;
  );
}
</code></pre><p><em>(<code>&lt;A&gt;&lt;B /&gt;&lt;/A&gt;</code> in JSX is the same as <code>&lt;A children={&lt;B /&gt;} /&gt;</code>.)</em></p>
<p>But what if it has an early exit condition?</p>
<pre data-line="2-4,"  2-4="" class="language-jsx"><code 2-4="" class="language-jsx">function Page({ user, children }) {
  if (!user.isLoggedIn) {
    return &lt;h1&gt;Please log in&lt;/h1&gt;;
  }
  return (
    &lt;Layout&gt;
      {children}
    &lt;/Layout&gt;
  );
}
</code></pre><p>If we called <code>Comments()</code> as a function, it would execute immediately regardless of whether <code>Page</code> wants to render them or not:</p>
<pre data-line="4,8,"  4,8="" class="language-jsx"><code 4,8="" class="language-jsx">// {
//   type: Page,
//   props: {
//     children: Comments() // Always runs!
//   }
// }
&lt;Page&gt;
  {Comments()}
&lt;/Page&gt;
</code></pre><p>But if we pass a React element, we donâ€™t execute <code>Comments</code> ourselves at all:</p>
<pre data-line="4,8,"  4,8="" class="language-jsx"><code 4,8="" class="language-jsx">// {
//   type: Page,
//   props: {
//     children: { type: Comments }
//   }
// }
&lt;Page&gt;
  &lt;Comments /&gt;
&lt;/Page&gt;
</code></pre><p>This lets React decide when and <em>whether</em> to call it. If our <code>Page</code> component ignores its <code>children</code> prop and renders<br>
<code>&lt;h1&gt;Please log in&lt;/h1&gt;</code> instead, React wonâ€™t even attempt to call the <code>Comments</code> function. Whatâ€™s the point?</p>
<p>This is good because it both lets us avoid unnecessary rendering work that would be thrown away, and makes the code less fragile. (We donâ€™t care if <code>Comments</code> throws or not when the user is logged out â€” it wonâ€™t be called.)</p>
<h2>State</h2>
<p>We talked <a href="#reconciliation">earlier</a> about identity and how an elementâ€™s conceptual â€œpositionâ€ in the tree tells React whether to re-use a host instance or create a new one. Host instances can have all kinds of local state: focus, selection, input, etc. We want to preserve this state between updates that conceptually render the same UI. We also want to predictably destroy it when we render something conceptually different (such as moving from <code>&lt;SignupForm&gt;</code> to <code>&lt;MessengerChat&gt;</code>).</p>
<p><strong>Local state is so useful that React lets <em>your own</em> components have it too.</strong> Components are still functions but React augments them with features that are useful for UIs. Local state tied to the position in the tree is one of these features.</p>
<p>We call these features <em>Hooks</em>. For example, <code>useState</code> is a Hook.</p>
<pre data-line="2,6,7,"  2,6,7="" class="language-jsx"><code 2,6,7="" class="language-jsx">function Example() {
  const [count, setCount] = useState(0);

  return (
    &lt;div&gt;
      &lt;p&gt;You clicked {count} times&lt;/p&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
        Click me
      &lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre><p>It returns a pair of values: the current state and a function that updates it.</p>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#Array_destructuring">array destructuring</a> syntax lets us give arbitrary names to our state variables. For example, I called this pair <code>count</code> and <code>setCount</code>, but it couldâ€™ve been <code>banana</code> and <code>setBanana</code>. In the text below, I will use <code>setState</code> to refer to the second value regardless of its actual name in the specific examples.</p>
<p><em>(You can learn more about <code>useState</code> and other Hooks provided by React <a href="https://reactjs.org/docs/hooks-intro.html">here</a>.)</em></p>
<h2>Consistency</h2>
<p>Even if we want to split the reconciliation process itself into <a href="https://www.youtube.com/watch?v=mDdgfyRB5kg">non-blocking</a> chunks of work, we should still perform the actual host tree operations in a single synchronous swoop. This way we can ensure that the user doesnâ€™t see a half-updated UI, and that the browser doesnâ€™t perform unnecessary layout and style recalculation for intermediate states that the user shouldnâ€™t see.</p>
<p>This is why React splits all work into the â€œrender phaseâ€ and the â€œcommit phaseâ€. <em>Render phase</em> is when React calls your components and performs reconciliation. It is safe to interrupt and <a href="https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html">in the future</a> will be asynchronous. <em>Commit phase</em> is when React touches the host tree. It is always synchronous.</p>
<h2>Memoization</h2>
<p>When a parent schedules an update by calling <code>setState</code>, by default React reconciles its whole child subtree. This is because React canâ€™t know whether an update in the parent would affect the child or not, and by default, React opts to be consistent. This may sound very expensive but in practice, itâ€™s not a problem for small and medium-sized subtrees.</p>
<p>When trees get too deep or wide, you can tell React to <a href="https://en.wikipedia.org/wiki/Memoization">memoize</a> a subtree and reuse previous render results during shallow equal prop changes:</p>
<pre data-line="5,"  5="" class="language-jsx"><code 5="" class="language-jsx">function Row({ item }) {
  // ...
}

export default React.memo(Row);
</code></pre><p>Now <code>setState</code> in a parent <code>&lt;Table&gt;</code> component would skip over reconciling <code>Row</code>s whose <code>item</code> is referentially equal to the <code>item</code> rendered last time.</p>
<p>You can get fine-grained memoization at the level of individual expressions with the <a href="https://reactjs.org/docs/hooks-reference.html#usememo"><code>useMemo()</code> Hook</a>. The cache is local to component tree position and will be destroyed together with its local state. It only holds one last item.</p>
<p>React intentionally doesnâ€™t memoize components by default. Many components always receive different props so memoizing them would be a net loss.</p>
<h2>Raw Models</h2>
<p>Ironically, React doesnâ€™t use a â€œreactivityâ€ system for fine-grained updates. In other words, any update at the top triggers reconciliation instead of updating just the components affected by changes.</p>
<p>This is an intentional design decision. <a href="https://calibreapp.com/blog/time-to-interactive/">Time to interactive</a> is a crucial metric in consumer web applications, and traversing models to set up fine-grained listeners spends that precious time. Additionally, in many apps, interactions tend to result either in small (button hover) or large (page transition) updates, in which case fine-grained subscriptions are a waste of memory resources.</p>
<p>One of the core design principles of React is that it works with raw data. If you have a bunch of JavaScript objects received from the network, you can pump them directly into your components with no preprocessing. There are no gotchas about which properties you can access, or unexpected performance cliffs when a structure slightly changes. React rendering is O(<em>view size</em>) rather than O(<em>model size</em>), and you can significantly cut the <em>view size</em> with <a href="https://react-window.now.sh/#/examples/list/fixed-size">windowing</a>.</p>
<p>There are some kinds of applications where fine-grained subscriptions are beneficial â€” such as stock tickers. This is a rare example of â€œeverything constantly updating at the same timeâ€. While imperative escape hatches can help optimize such code, React might not be the best fit for this use case. Still, you can implement your own fine-grained subscription system on top of React.</p>
<p><strong>Note that there are common performance issues that even fine-grained subscriptions and â€œreactivityâ€ systems canâ€™t solve.</strong> For example, rendering a <em>new</em> deep tree (which happens on every page transition) without blocking the browser. Change tracking doesnâ€™t make it faster â€” it makes it slower because we have to do more work to set up subscriptions. Another problem is that we have to wait for data before we can start rendering the view. In React, we aim to solve both of these problems with <a href="https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html">Concurrent Rendering</a>.</p>
<h2>Batching</h2>
<p>Several components may want to update state in response to the same event. This example is contrived but it illustrates a common pattern:</p>
<pre data-line="4,14,"  4,14="" class="language-jsx"><code 4,14="" class="language-jsx">function Parent() {
  let [count, setCount] = useState(0);
  return (
    &lt;div onClick={() =&gt; setCount(count + 1)}&gt;
      Parent clicked {count} times
      &lt;Child /&gt;
    &lt;/div&gt;
  );
}

function Child() {
  let [count, setCount] = useState(0);
  return (
    &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
      Child clicked {count} times
    &lt;/button&gt;
  );
}
</code></pre><p>When an event is dispatched, the childâ€™s <code>onClick</code> fires first (triggering its <code>setState</code>). Then the parent calls <code>setState</code> in its own <code>onClick</code> handler.</p>
<p>If React immediately re-rendered components in response to <code>setState</code> calls, weâ€™d end up rendering the child twice:</p>
<pre data-line="4,8,"  4,8="" class="language-jsx"><code 4,8="" class="language-jsx">*** Entering React's browser click event handler ***
Child (onClick)
  - setState
  - re-render Child // ğŸ˜ unnecessary
Parent (onClick)
  - setState
  - re-render Parent
  - re-render Child
*** Exiting React's browser click event handler ***
</code></pre><p>The first <code>Child</code> render would be wasted. And we couldnâ€™t make React skip rendering <code>Child</code> for the second time because the <code>Parent</code> might pass some different data to it based on its updated state.</p>
<p><strong>This is why React batches updates inside event handlers:</strong></p>
<pre   class="language-jsx"><code class="language-jsx">*** Entering React's browser click event handler ***
Child (onClick)
  - setState
Parent (onClick)
  - setState
*** Processing state updates                     ***
  - re-render Parent
  - re-render Child
*** Exiting React's browser click event handler  ***
</code></pre><p>The <code>setState</code> calls in components wouldnâ€™t immediately cause a re-render. Instead, React would execute all event handlers first, and then trigger a single re-render batching all of those updates together.</p>
<p>Batching is good for performance but can be surprising if you write code like:</p>
<pre   class="language-jsx"><code class="language-jsx">  const [count, setCount] = useState(0);

  function increment() {
    setCount(count + 1);
  }

  function handleClick() {
    increment();
    increment();
    increment();
  }
</code></pre><p>If we start with <code>count</code> set to <code>0</code>, these would just be three <code>setCount(1)</code> calls. To fix this, <code>setState</code> provides an overload that accepts an â€œupdaterâ€ function:</p>
<pre   class="language-jsx"><code class="language-jsx">  const [count, setCount] = useState(0);

  function increment() {
    setCount(c =&gt; c + 1);
  }

  function handleClick() {
    increment();
    increment();
    increment();
  }
</code></pre><p>React would put the updater functions in a queue, and later run them in sequence, resulting in a re-render with <code>count</code> set to <code>3</code>.</p>
<p>When state logic gets more complex than a few <code>setState</code> calls, I recommend expressing it as a local state reducer with the <a href="https://reactjs.org/docs/hooks-reference.html#usereducer"><code>useReducer</code> Hook</a>. Itâ€™s like an evolution of this â€œupdaterâ€ pattern where each update is given a name:</p>
<pre   class="language-jsx"><code class="language-jsx">  const [counter, dispatch] = useReducer((state, action) =&gt; {
    if (action === 'increment') {
      return state + 1;
    } else {
      return state;
    }
  }, 0);

  function handleClick() {
    dispatch('increment');
    dispatch('increment');
    dispatch('increment');
  }
</code></pre><p>The <code>action</code> argument can be anything, although an object is a common choice.</p>
<h2>Call Tree</h2>
<p>A programming language runtime usually has a <a href="https://medium.freecodecamp.org/understanding-the-javascript-call-stack-861e41ae61d4">call stack</a>. When a function <code>a()</code> calls <code>b()</code> which itself calls <code>c()</code>, somewhere in the JavaScript engine thereâ€™s a data structure like <code>[a, b, c]</code> that â€œkeeps trackâ€ of where you are and what code to execute next. Once you exit out of <code>c</code>, its call stack frame is gone â€” poof! Itâ€™s not needed anymore. We jump back into <code>b</code>. By the time we exit <code>a</code>, the call stack is empty.</p>
<p>Of course, React itself runs in JavaScript and obeys JavaScript rules. But we can imagine that internally React has some kind of its own call stack to remember which component we are currently rendering, e.g. <code>[App, Page, Layout, Article /* we're here */]</code>.</p>
<p>React is different from a general purpose language runtime because itâ€™s aimed at rendering UI trees. These trees need to â€œstay aliveâ€ for us to interact with them. The DOM doesnâ€™t disappear after our first <code>ReactDOM.render()</code> call.</p>
<p>This may be stretching the metaphor but I like to think of React components as being in a â€œcall treeâ€ rather than just a â€œcall stackâ€. When we go â€œoutâ€ of the <code>Article</code> component, its React â€œcall treeâ€ frame doesnâ€™t get destroyed. We need to keep the local state and references to the host instances <a href="https://medium.com/react-in-depth/the-how-and-why-on-reacts-usage-of-linked-list-in-fiber-67f1014d0eb7">somewhere</a>.</p>
<p>These â€œcall treeâ€ frames <em>are</em> destroyed along with their local state and host instances, but only when the <a href="#reconciliation">reconciliation</a> rules say itâ€™s necessary. If you ever read React source, you might have seen these frames being referred to as <a href="https://en.wikipedia.org/wiki/Fiber_(computer_science)">Fibers</a>.</p>
<p>Fibers are where the local state actually lives. When the state is updated, React marks the Fibers below as needing reconciliation, and calls those components.</p>
<h2>Context</h2>
<p>In React, we pass things down to other components as props. Sometimes, the majority of components need the same thing â€” for example, the currently chosen visual theme. It gets cumbersome to pass it down through every level.</p>
<p>In React, this is solved by <a href="https://reactjs.org/docs/context.html">Context</a>. It is essentially like <a href="http://wiki.c2.com/?DynamicScoping">dynamic scoping</a> for components. Itâ€™s like a wormhole that lets you put something on the top, and have every child at the bottom be able to read it and re-render when it changes.</p>
<pre   class="language-jsx"><code class="language-jsx">const ThemeContext = React.createContext(
  'light' // Default value as a fallback
);

function DarkApp() {
  return (
    &lt;ThemeContext.Provider value=&quot;dark&quot;&gt;
      &lt;MyComponents /&gt;
    &lt;/ThemeContext.Provider&gt;
  );
}

function SomeDeeplyNestedChild() {
  // Depends on where the child is rendered
  const theme = useContext(ThemeContext);
  // ...
}
</code></pre><p>When <code>SomeDeeplyNestedChild</code> renders, <code>useContext(ThemeContext)</code> will look for the closest <code>&lt;ThemeContext.Provider&gt;</code> above it in the tree, and use its <code>value</code>.</p>
<p>(In practice, React maintains a context stack while it renders.)</p>
<p>If thereâ€™s no <code>ThemeContext.Provider</code> above, the result of <code>useContext(ThemeContext)</code> call will be the default value specified in the <code>createContext()</code> call. In our example, it is <code>'light'</code>.</p>
<h2>Effects</h2>
<p>We mentioned earlier that React components shouldnâ€™t have observable side effects during rendering. But side effects are sometimes necessary. We may want to manage focus, draw on a canvas, subscribe to a data source, and so on.</p>
<p>In React, this is done by declaring an effect:</p>
<pre data-line="4-6,"  4-6="" class="language-jsx"><code 4-6="" class="language-jsx">function Example() {
  const [count, setCount] = useState(0);

  useEffect(() =&gt; {
    document.title = `You clicked ${count} times`;
  });

  return (
    &lt;div&gt;
      &lt;p&gt;You clicked {count} times&lt;/p&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
        Click me
      &lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre><p>When possible, React defers executing effects until after the browser re-paints the screen. This is good because code like data source subscriptions shouldnâ€™t hurt <a href="https://calibreapp.com/blog/time-to-interactive/">time to interactive</a> and <a href="https://developers.google.com/web/tools/lighthouse/audits/first-meaningful-paint">time to first paint</a>. (There's a <a href="https://reactjs.org/docs/hooks-reference.html#uselayouteffect">rarely used</a> Hook that lets you opt out of that behavior and do things synchronously. Avoid it.)</p>
<p>Effects donâ€™t just run once. They run both after a component is shown to the user for the first time, and after it updates. Effects can close over current props and state, such as with <code>count</code> in the above example.</p>
<p>Effects may require cleanup, such as in case of subscriptions. To clean up after itself, an effect can return a function:</p>
<pre   class="language-jsx"><code class="language-jsx">  useEffect(() =&gt; {
    DataSource.addSubscription(handleChange);
    return () =&gt; DataSource.removeSubscription(handleChange);
  });
</code></pre><p>React will execute the returned function before applying this effect the next time, and also before the component is destroyed.</p>
<p>Sometimes, re-running the effect on every render can be undesirable. You can tell React to <a href="https://reactjs.org/docs/hooks-effect.html#tip-optimizing-performance-by-skipping-effects">skip</a> applying an effect if certain variables didnâ€™t change:</p>
<pre data-line="3,"  3="" class="language-jsx"><code 3="" class="language-jsx">  useEffect(() =&gt; {
    document.title = `You clicked ${count} times`;
  }, [count]);
</code></pre><p>However, it is often a premature optimization and can lead to problems if youâ€™re not familiar with how JavaScript closures work.</p>
<p>For example, this code is buggy:</p>
<pre   class="language-jsx"><code class="language-jsx">  useEffect(() =&gt; {
    DataSource.addSubscription(handleChange);
    return () =&gt; DataSource.removeSubscription(handleChange);
  }, []);
</code></pre><p>It is buggy because <code>[]</code> says â€œdonâ€™t ever re-execute this effectâ€. But the effect closes over <code>handleChange</code> which is defined outside of it. And <code>handleChange</code> might reference any props or state:</p>
<pre   class="language-jsx"><code class="language-jsx">  function handleChange() {
    console.log(count);
  }
</code></pre><p>If we never let the effect re-run, <code>handleChange</code> will keep pointing at the version from the first render, and <code>count</code> will always be <code>0</code> inside of it.</p>
<p>To solve this, make sure that if you specify the dependency array, it includes <strong>all</strong> things that can change, including the functions:</p>
<pre data-line="4,"  4="" class="language-jsx"><code 4="" class="language-jsx">  useEffect(() =&gt; {
    DataSource.addSubscription(handleChange);
    return () =&gt; DataSource.removeSubscription(handleChange);
  }, [handleChange]);
</code></pre><p>Depending on your code, you might still see unnecessary resubscriptions because <code>handleChange</code> itself is different on every render. The <a href="https://reactjs.org/docs/hooks-reference.html#usecallback"><code>useCallback</code></a> Hook can help you with that. Alternatively, you can just let it re-subscribe. For example, browserâ€™s <code>addEventListener</code> API is extremely fast, and jumping through hoops to avoid calling it might cause more problems than itâ€™s worth.</p>
<p><em>(You can learn more about <code>useEffect</code> and other Hooks provided by React <a href="https://reactjs.org/docs/hooks-effect.html">here</a>.)</em></p>
<h2>Custom Hooks</h2>
<p>Since Hooks like <code>useState</code> and <code>useEffect</code> are function calls, we can compose them into our own Hooks:</p>
<pre data-line="2,8,"  2,8="" class="language-jsx"><code 2,8="" class="language-jsx">function MyResponsiveComponent() {
  const width = useWindowWidth(); // Our custom Hook
  return (
    &lt;p&gt;Window width is {width}&lt;/p&gt;
  );
}

function useWindowWidth() {
  const [width, setWidth] = useState(window.innerWidth);
  useEffect(() =&gt; {
    const handleResize = () =&gt; setWidth(window.innerWidth);
    window.addEventListener('resize', handleResize);
    return () =&gt; {
      window.removeEventListener('resize', handleResize);
    };
  });
  return width;
}
</code></pre><p>Custom Hooks let different components share reusable stateful logic. Note that the <em>state itself</em> is not shared. Each call to a Hook declares its own isolated state.</p>
<p><em>(You can learn more about writing your own Hooks <a href="https://reactjs.org/docs/hooks-custom.html">here</a>.)</em></p>
<h2>Static Use Order</h2>
<p>You can think of <code>useState</code> as a syntax for defining a â€œReact state variableâ€. Itâ€™s not <em>really</em> a syntax, of course. Weâ€™re still writing JavaScript. But we are looking at React as a runtime environment, and because React tailors JavaScript to describing UI trees, its features sometimes live closer to the language space.</p>
<p>If <code>use</code> <em>were</em> a syntax, it would make sense for it to be at the top level:</p>
<pre data-line="3,"  3="" class="language-jsx"><code 3="" class="language-jsx">// ğŸ˜‰ Note: not a real syntax
component Example(props) {
  const [count, setCount] = use State(0);

  return (
    &lt;div&gt;
      &lt;p&gt;You clicked {count} times&lt;/p&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
        Click me
      &lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre><p>What would putting it into a condition or a callback or outside a component even mean?</p>
<pre   class="language-jsx"><code class="language-jsx">// ğŸ˜‰ Note: not a real syntax

// This is local state... of what?
const [count, setCount] = use State(0);

component Example() {
  if (condition) {
    // What happens to it when condition is false?
    const [count, setCount] = use State(0);
  }

  function handleClick() {
    // What happens to it when we leave a function?
    // How is this different from a variable?
    const [count, setCount] = use State(0);
  }
</code></pre><p>React state is local to the <em>component</em> and its identity in the tree. If <code>use</code> were a real syntax it would make sense to scope it to the top-level of a component too:</p>
<pre   class="language-jsx"><code class="language-jsx">// ğŸ˜‰ Note: not a real syntax
component Example(props) {
  // Only valid here
  const [count, setCount] = use State(0);

  if (condition) {
    // This would be a syntax error
    const [count, setCount] = use State(0);
  }
</code></pre><p>This is similar to how <code>import</code> only works at the top level of a module.</p>
<p><strong>Of course, <code>use</code> is not actually a syntax.</strong> (It wouldnâ€™t bring much benefit and would create a lot of friction.)</p>
<p>However, React <em>does</em> expect that all calls to Hooks happen only at the top level of a component and unconditionally. These <a href="https://reactjs.org/docs/hooks-rules.html">Rules of Hooks</a> can be enforced with <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">a linter plugin</a>. There have been heated arguments about this design choice but in practice, I havenâ€™t seen it confusing people. I also wrote about why commonly proposed alternatives <a href="https://overreacted.io/why-do-hooks-rely-on-call-order/">donâ€™t work</a>.</p>
<p>Internally, Hooks are implemented as <a href="https://dev.to/aspittel/thank-u-next-an-introduction-to-linked-lists-4pph">linked lists</a>. When you call <code>useState</code>, we move the pointer to the next item. When we exit the componentâ€™s <a href="#call-tree">â€œcall treeâ€ frame</a>, we save the resulting list there until the next render.</p>
<p><a href="https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e">This article</a> provides a simplified explanation for how Hooks work internally. Arrays might be an easier mental model than linked lists:</p>
<pre   class="language-jsx"><code class="language-jsx">// Pseudocode
let hooks, i;
function useState() {
  i++;
  if (hooks[i]) {
    // Next renders
    return hooks[i];
  }
  // First render
  hooks.push(...);
}

// Prepare to render
i = -1;
hooks = fiber.hooks || [];
// Call the component
YourComponent();
// Remember the state of Hooks
fiber.hooks = hooks;
</code></pre><p><em>(If youâ€™re curious, the real code is <a href="https://github.com/facebook/react/blob/master/packages/react-reconciler/src/ReactFiberHooks.js">here</a>.)</em></p>
<p>This is roughly how each <code>useState()</code> call gets the right state. As weâ€™ve learned <a href="#reconciliation">earlier</a>, â€œmatching things upâ€ isnâ€™t new to React â€” reconciliation relies on the elements matching up between renders in a similar way.</p>
<h2>Whatâ€™s Left Out</h2>
<p>Weâ€™ve touched on pretty much all important aspects of the React runtime environment. If you finished this page, you probably know React in more detail than 90% of its users. And thereâ€™s nothing wrong with that!</p>
<p>There are some parts I left out â€” mostly because theyâ€™re unclear even to us. React doesnâ€™t currently have a good story for multipass rendering, i.e. when the parent render needs information about the children. Also, the <a href="https://reactjs.org/docs/error-boundaries.html">error handling API</a> doesnâ€™t yet have a Hooks version. Itâ€™s possible that these two problems can be solved together. Concurrent Mode is not stable yet, and there are interesting questions about how Suspense fits into this picture. Maybe Iâ€™ll do a follow-up when theyâ€™re fleshed out and Suspense is ready for more than <a href="https://reactjs.org/blog/2018/10/23/react-v-16-6.html#reactlazy-code-splitting-with-suspense">lazy loading</a>.</p>
<p><strong>I think it speaks to the success of Reactâ€™s API that you can get very far without ever thinking about most of these topics.</strong> Good defaults like the reconciliation heuristics do the right thing in most cases. Warnings, like the <code>key</code> warning, nudge you when you risk shooting yourself in the foot.</p>
<p>If youâ€™re a UI library nerd, I hope this post was somewhat entertaining and clarified how React works in more depth. Or maybe you decided React is too complicated and youâ€™ll never look at it again. In either case, Iâ€™d love to hear from you on Twitter! Thank you for reading.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[â€œBug-Oâ€ è¡¨ç¤ºæ³•]]></title>
            <link>/post/the-bug-o-notation-zh</link>
            <guid>/post/the-bug-o-notation-zh</guid>
            <description><![CDATA[ä½ çš„ API çš„ ğŸ(<i>n</i>) æ˜¯ä»€ä¹ˆï¼Ÿ]]></description>
            <content:encoded><![CDATA[<p>å½“ä½ åœ¨å†™ä¸€äº›å…³ä¹æ€§èƒ½çš„ä»£ç æ—¶ï¼Œæœ€å¥½æ—¶åˆ»æ³¨æ„å®ƒçš„ç®—æ³•å¤æ‚åº¦ã€‚ç®—æ³•å¤æ‚åº¦é€šå¸¸ä¼šç”¨<a href="https://rob-bell.net/2009/06/a-beginners-guide-to-big-o-notation/">å¤§ O è¡¨ç¤ºæ³•</a>æ¥ä½“ç°ã€‚</p>
<p>å¤§ O è¡¨ç¤ºæ³•æ˜¯ä¸€ç§è¡¡é‡æŒ‡æ ‡ï¼šå½“ä¼ å…¥çš„æ•°æ®è¶Šæ¥è¶Šå¤§æ—¶ï¼Œä½ çš„ä»£ç ä¼šå˜å¾—å¤šæ…¢ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä¸€ä¸ªæ’åºç®—æ³•æœ‰ O(<i>n<sup>2</sup></i>) å¤æ‚åº¦ï¼Œå¯¹åŸæ¥é‡çº§ 50 å€çš„å…ƒç´ æ’åºï¼Œä½ çš„ä»£ç å¤§çº¦ä¼šæ…¢ 50<sup>2</sup> = 2,500 å€ã€‚å¤§ O è¡¨ç¤ºæ³•ä¸ä¼šç»™ä½ ä¸€ä¸ªç¡®åˆ‡çš„æ•°å€¼ï¼Œä½†å®ƒèƒ½è®©ä½ æ›´å¥½åœ°ç†è§£ä½ çš„ç®—æ³•çš„ä¼¸ç¼©æ€§ã€‚</p>
<p>ä¸€äº›ä¾‹å­ï¼šO(<i>n</i>)ã€O(<i>n</i> log <i>n</i>)ã€O(<i>n<sup>2</sup></i>) å’Œ O(<i>n!</i>)ã€‚</p>
<p>ç„¶è€Œï¼Œ<strong>è¿™ç¯‡æ–‡ç« ä¸æ˜¯å…³äºç®—æ³•å’Œæ€§èƒ½çš„</strong>ï¼Œè€Œæ˜¯å…³äº APIs å’Œè°ƒè¯•çš„ã€‚äº‹å®è¯æ˜ï¼Œè®¾è®¡ API æ—¶ä¹Ÿéœ€è¦è€ƒè™‘ç±»ä¼¼çš„äº‹æƒ…ã€‚</p>
<hr>
<p>æˆ‘ä»¬ç»å¤§å¤šæ•°æ—¶é—´éƒ½åœ¨ä¸ºæˆ‘ä»¬çš„ä»£ç æ‰¾ bug å’Œä¿® bugã€‚å¤§å¤šæ•°å¼€å‘è€…ä¹Ÿå¸Œæœ›èƒ½æ›´å¿«åœ°æ‰¾åˆ° bugã€‚å³ä¾¿æœ€å bug æ‰¾åˆ°äº†ï¼Œèˆ’æœäº†ï¼Œä½†å®ƒä¹Ÿå¯èƒ½æ¶ˆè€—äº†æˆ‘ä»¬ä¸€æ•´å¤©çš„æ—¶é—´ï¼Œæœ‰è¿™ä¸ªæ—¶é—´éƒ½å¤Ÿä½ å®Œæˆå‡ ä¸ª roadmap ä¸Šçš„äº‹æƒ…äº†ã€‚</p>
<p>è°ƒè¯•çš„ä½“éªŒå—æˆ‘ä»¬é€‰æ‹©çš„æŠ½è±¡ã€åº“å’Œå·¥å…·çš„å½±å“ã€‚æœ‰çš„ API å’Œè¯­è¨€è®¾è®¡å°±èƒ½è®©æˆ‘ä»¬é¿å…ä¸€æ•´ç±»çš„é”™è¯¯ï¼Œä½†æœ‰çš„åˆ™ä¼šåˆ¶é€ æ— å°½çš„éº»çƒ¦ã€‚<strong>ä½†ä½ æ€ä¹ˆåŒºåˆ†å®ƒä»¬å‘¢ï¼Ÿ</strong></p>
<p>ç½‘ä¸Šè®¸å¤šå…³äº APIs çš„è®¨è®ºéƒ½ä¸»è¦é›†ä¸­åœ¨å®¡ç¾ä¸Šï¼Œä½†é‚£çœŸçš„<a href="/optimized-for-change/">å¯¹å®é™…ä½¿ç”¨å®ƒæ—¶çš„æ„Ÿå—æ²¡æœ‰å¤ªå¤§å½±å“</a>ã€‚</p>
<p><strong>å…³äºè¿™ä»¶äº‹æœ‰ä¸€ä¸ªè¡¡é‡æŒ‡æ ‡ï¼Œæˆ‘ç§°å®ƒä¸º <em>Bug-O</em> è¡¨ç¤ºæ³•:</strong></p>
<p><font size="40">ğŸ(<i>n</i>)</font></p>
<p>å¤§ O è¡¨ç¤ºæ³•æè¿°éšç€æ•°æ®é‡å¢å¤§ï¼Œä½ çš„ç®—æ³•ä¼šå˜å¾—å¤šæ…¢ã€‚<em>Bug-O</em> è¡¨ç¤ºæ³•æè¿°éšç€ä»£ç é‡çš„å¢å¤§ï¼Œè¿™ä¸ª API ä¼šè®©<strong>ä½ </strong>åšä¸€ä»¶äº‹å˜å¾—å¤šæ…¢ã€‚</p>
<hr>
<p>æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾ä¸‹é¢çš„ä»£ç æ¯æ¬¡éƒ½é€šè¿‡åƒ <code>node.appendChild()</code> å’Œ <code>node.removeChild()</code> è¿™æ ·å‘½ä»¤å¼çš„æ“ä½œæ¥æ‰‹åŠ¨æ›´æ–° DOMï¼Œå¹¶ä¸”æ²¡æœ‰æ˜ç¡®çš„ç»„ç»‡ç»“æ„ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">function trySubmit() {
  // Section 1
  let spinner = createSpinner();
  formStatus.appendChild(spinner);
  submitForm().then(() =&gt; {
  	// Section 2
    formStatus.removeChild(spinner);
    let successMessage = createSuccessMessage();
    formStatus.appendChild(successMessage);
  }).catch(error =&gt; {
  	// Section 3
    formStatus.removeChild(spinner);
    let errorMessage = createErrorMessage(error);
    let retryButton = createRetryButton();
    formStatus.appendChild(errorMessage);
    formStatus.appendChild(retryButton)
    retryButton.addEventListener('click', function() {
      // Section 4
      formStatus.removeChild(errorMessage);
      formStatus.removeChild(retryButton);
      trySubmit();
    });
  })
}
</code></pre><p>é—®é¢˜ä¸åœ¨äºä»£ç ä¸‘ä¸ä¸‘ï¼Œæˆ‘ä»¬æš‚ä¸”ä¸è°ˆä»£ç çš„ç¾è§‚æ€§ã€‚<strong>é—®é¢˜æ˜¯å¦‚æœç°åœ¨è¿™ä¸ªä»£ç é‡Œå‡ºç°äº†ä¸€ä¸ª bugï¼Œæˆ‘éƒ½ä¸çŸ¥é“ä»å“ªæŸ¥èµ·ã€‚</strong></p>
<p>**å–å†³äºå›è°ƒå’Œäº‹ä»¶è§¦å‘çš„é¡ºåºï¼Œæ•´ä¸ªç¨‹åºä¸­ä»£ç è¿è¡Œçš„è·¯å¾„ç»„åˆä¼šéå¸¸å¤šï¼Œ**å…¶ä¸­æœ‰äº›èƒ½äº§ç”Ÿæ­£ç¡®çš„ç»“æœï¼Œæœ‰äº›æˆ‘å¯èƒ½ä¼šçœ‹åˆ°å¤šä¸ªè¿›åº¦æ¡æˆ–è€…ä»€ä¹ˆå¥‡æ€ªçš„ç°è±¡ï¼Œæœ‰çš„æ—¶å€™ç”šè‡³ç¨‹åºç›´æ¥å°±å´©æºƒäº†ã€‚</p>
<p>è¿™ä¸ªå‡½æ•°æœ‰ 4 ä¸ªä¸åŒçš„éƒ¨åˆ†ï¼Œå¹¶ä¸”é¡ºåºæ²¡æœ‰ä¿è¯ã€‚æ ¹æ®æˆ‘ç²—ç•¥çš„è®¡ç®—ï¼Œå®ƒä»¬çš„è¿è¡Œé¡ºåºå¤§çº¦æœ‰ 4Ã—3Ã—2Ã—1 = 24 ç§ã€‚å¦‚æœæˆ‘ä»¬åœ¨ä»£ç é‡Œå†æ·»åŠ ä¸€äº›ä¸œè¥¿ï¼Œå¯èƒ½ä¼šæœ‰ 8Ã—7Ã—6Ã—5Ã—4Ã—3Ã—2Ã—1 â€” <em>å››ä¸‡</em>å¤šç§ç»„åˆã€‚ä½ å°±æ…¢æ…¢è°ƒè¯•å»å§...</p>
<p><strong>æ¢å¥è¯è¯´ï¼Œå®ƒçš„ Bug-O æ˜¯ ğŸ(<i>n!</i>)</strong>ï¼Œå…¶ä¸­ <em>n</em> æ˜¯ä¿®æ”¹ DOM çš„ä»£ç ç‰‡æ®µæ•°ã€‚æ˜¯çš„ï¼Œå®ƒæ˜¯é˜¶ä¹˜çº§çš„ã€‚å½“ç„¶ï¼Œæˆ‘è¿™é‡Œå¯èƒ½ä¸æ˜¯å¾ˆä¸¥è°¨ã€‚å®é™…æƒ…å†µä¸‹ä¸æ˜¯æ‰€æœ‰çš„ç»„åˆéƒ½ä¼šå‘ç”Ÿã€‚ä¸è¿‡å¦ä¸€æ–¹é¢ï¼Œè¿™äº›ä»£ç ç‰‡æ®µå¯èƒ½ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Œwhatever... æ€»ä¹‹è¿™ä¸ªä»£ç å°±æ˜¯ä¸æ€ä¹ˆæ ·ï¼Œæˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½ã€‚</p>
<hr>
<p>ä¸ºäº†æ”¹è¿›è¿™ä¸ªä»£ç çš„ Bug-Oï¼Œæˆ‘ä»¬å¯ä»¥é™åˆ¶å¯èƒ½çš„çŠ¶æ€å’Œç»“æœæ•°é‡ã€‚æˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨ä»»ä½•åº“ï¼Œåªè¦å¼ºåŒ–ä¸€ä¸‹ä»£ç çš„ç»“æ„ã€‚æ¯”å¦‚è¿™æ ·ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">let currentState = {
  step: 'initial', // 'initial' | 'pending' | 'success' | 'error'
};

function trySubmit() {
  if (currentState.step === 'pending') {
    // Don't allow to submit twice
    return;
  }
  setState({ step: 'pending' });
  submitForm().then(() =&gt; {
    setState({ step: 'success' });
  }).catch(error =&gt; {
    setState({ step: 'error', error });
  });
}

function setState(nextState) {
  // Clear all existing children
  formStatus.innerHTML = '';

  currentState = nextState;
  switch (nextState.step) {
    case 'initial':
      break;
    case 'pending':
      formStatus.appendChild(spinner);
      break;
    case 'success':
      let successMessage = createSuccessMessage();
      formStatus.appendChild(successMessage);
      break;
    case 'error':
      let errorMessage = createErrorMessage(nextState.error);
      let retryButton = createRetryButton();
      formStatus.appendChild(errorMessage);
      formStatus.appendChild(retryButton);
      retryButton.addEventListener('click', trySubmit);
      break;
  }
}
</code></pre><p>çœ‹èµ·æ¥å¯èƒ½å·®å¼‚ä¸å¤§ï¼Œç”šè‡³æ›´å•°å—¦äº†ï¼Œä½†æ˜¯å®ƒå´æˆå‰§æ€§åœ°è®©è°ƒè¯•å˜å¾—æ›´ç®€å•äº†ã€‚å› ä¸ºè¿™å‡ è¡Œï¼š</p>
<pre data-line="3,"  3="" class="language-jsx"><code 3="" class="language-jsx">function setState(nextState) {
  // Clear all existing children
  formStatus.innerHTML = '';

  // ... the code adding stuff to formStatus ...
</code></pre><p>é€šè¿‡åœ¨åšä»»ä½•æ“ä½œå‰æ¸…ç©ºè¡¨å•çŠ¶æ€ï¼Œæˆ‘ä»¬ä¿è¯äº†æ‰€æœ‰ DOM æ“ä½œéƒ½ä»æ–°å¼€å§‹ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥æˆ˜èƒœå¿…ç„¶å‘ç”Ÿçš„<a href="/the-elements-of-ui-engineering/">å¢’å˜</a>ï¼Œé€šè¿‡<em>ä¸è®©é”™è¯¯ç§¯ç´¯</em>ã€‚è¿™ä¸ªä»£ç çš„åšæ³•æœ‰ç‚¹åƒâ€œæŠŠå®ƒå…³æ‰ç„¶åå†æ‰“å¼€â€ï¼Œå°±æ˜¯è¿™ä¹ˆç¥å¥‡ã€‚</p>
<p><strong>å¦‚æœç»“æœæœ‰é”™è¯¯ï¼Œæˆ‘ä»¬åªéœ€è¦å¾€å›æƒ³ä¸€æ­¥ï¼Œçœ‹ä¸€ä¸‹ä¸Šæ¬¡çš„ <code>setState</code> è°ƒç”¨ã€‚</strong> è°ƒè¯•æ¸²æŸ“ç»“æœçš„ Bug-O æ˜¯ ğŸ(<em>n</em>) å…¶ä¸­ <em>n</em> æ˜¯æ¸²æŸ“ç›¸å…³çš„ä»£ç è·¯å¾„æ•°ï¼Œåœ¨è¿™é‡Œå³ä¸º 4ï¼ˆå› ä¸º <code>switch</code> é‡Œæœ‰ 4 ç§æƒ…å†µï¼‰ã€‚</p>
<p>æˆ‘ä»¬å¯èƒ½ä»ç„¶ä¼šåœ¨<em>è®¾ç½®</em>çŠ¶æ€çš„æ—¶å€™é‡åˆ°ç«æ€ï¼Œä½†æ˜¯è°ƒè¯•å®ƒä¼šæ¯”ä¹‹å‰æ›´ç®€å•ï¼Œå› ä¸ºæ¯ä¸ªä¸­é—´çŠ¶æ€éƒ½å¯ä»¥è¢«æ—¥å¿—è®°å½•å’Œæ£€æŸ¥ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ˜¾å¼åœ°é˜»æ­¢ä¸€äº›éé¢„æœŸçš„çŠ¶æ€å˜åŒ–ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">function trySubmit() {
  if (currentState.step === 'pending') {
    // Don't allow to submit twice
    return;
  }
</code></pre><p>å½“ç„¶ï¼Œæ¯æ¬¡éƒ½é‡ç½® DOM ä¹Ÿæœ‰åˆ©æœ‰å¼Šã€‚ç®€å•åœ°ç§»é™¤ç„¶åé‡å»º DOM ä¼šé”€æ¯å®ƒä»¬çš„å†…éƒ¨çŠ¶æ€ï¼Œè®©å®ƒä»¬å¤±å»ç„¦ç‚¹ï¼Œåœ¨æ›´å¤§å‹çš„åº”ç”¨é‡Œä¹Ÿä¼šé€ æˆä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚</p>
<p>è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆåƒ React è¿™æ ·çš„åº“ä¼šå¾ˆæœ‰å¸®åŠ©äº†ï¼Œå› ä¸ºå®ƒä»¬åªéœ€è¦è®©ä½ æ€è€ƒå¦‚ä½•ä»é›¶å¼€å§‹æ­å»º UIï¼Œå®é™…ä¸Šåº“çš„å†…éƒ¨å´å¹¶ä¸æ˜¯è¿™æ ·åšçš„ï¼š</p>
<pre   class="language-jsx"><code class="language-jsx">function FormStatus() {
  let [state, setState] = useState({
    step: 'initial'
  });

  function handleSubmit(e) {
    e.preventDefault();
    if (state.step === 'pending') {
      // Don't allow to submit twice
      return;
    }
    setState({ step: 'pending' });
    submitForm().then(() =&gt; {
      setState({ step: 'success' });
    }).catch(error =&gt; {
      setState({ step: 'error', error });
    });
  }

  let content;
  switch (state.step) {
    case 'pending':
      content = &lt;Spinner /&gt;;
      break;
    case 'success':
      content = &lt;SuccessMessage /&gt;;
      break;
    case 'error':
      content = (
        &lt;&gt;
          &lt;ErrorMessage error={state.error} /&gt;
          &lt;RetryButton onClick={handleSubmit} /&gt;
        &lt;/&gt;
      );
      break;
  }

  return (
    &lt;form onSubmit={handleSubmit}&gt;
      {content}
    &lt;/form&gt;
  );
}
</code></pre><p>ä»£ç çœ‹èµ·æ¥å¯èƒ½ä¸å¤ªä¸€æ ·ï¼Œä½†æ˜¯åŸåˆ™æ˜¯ç›¸åŒçš„ã€‚ç»„ä»¶çš„æŠ½è±¡å¼ºåŒ–äº†æŒ‡è´£çš„è¾¹ç•Œï¼Œå› æ­¤ä½ ä¸çŸ¥é“å…¶ä»–é¡µé¢ä¸Šèƒ½å½±å“ DOM å’ŒçŠ¶æ€çš„ä»£ç ã€‚ç»„ä»¶åŒ–æœ‰åŠ©äºé™ä½ Bug-Oã€‚</p>
<p>äº‹å®ä¸Šï¼Œå¦‚æœä¸€ä¸ª React åº”ç”¨é‡Œæœ‰ä»»ä½•å€¼åœ¨ DOM ä¸Šçœ‹èµ·æ¥ä¸å¤ªå¯¹ï¼Œä½ éƒ½å¯ä»¥è·Ÿè¸ªå®ƒæ˜¯ä»å“ªé‡Œæ¥çš„ï¼Œé€šè¿‡ä¸€ä¸ªä¸€ä¸ªåœ°æŸ¥çœ‹åœ¨å®ƒä¹‹ä¸Šçš„ç»„ä»¶çš„ä»£ç ã€‚ä¸è®ºä½ çš„åº”ç”¨æœ‰å¤šå¤§ï¼Œè·Ÿè¸ªä¸€ä¸ªæ¸²æŸ“å‡ºæ¥çš„å€¼æ˜¯ ğŸ(<em>tree height</em>) çš„ã€‚</p>
<p><strong>ä¸‹ä¸€æ¬¡ä½ çœ‹åˆ°ä¸€ä¸ªæœ‰å…³ API çš„è®¨è®ºï¼Œé¦–å…ˆè€ƒè™‘ï¼šå®ƒçš„å¸¸è§„è°ƒè¯•ä»»åŠ¡çš„ ğŸ(<em>n</em>) æ˜¯å¤šå°‘ï¼Ÿ</strong> ç°æœ‰ä½ ååˆ†ç†Ÿæ‚‰çš„ APIs å’Œå¼€å‘åŸåˆ™æ€ä¹ˆæ ·ï¼ŸReduxã€CSSã€ç»§æ‰¿... å®ƒä»¬éƒ½æœ‰è‡ªå·±çš„ Bug-Oã€‚</p>
<hr>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[The â€œBug-Oâ€ Notation]]></title>
            <link>/post/the-bug-o-notation</link>
            <guid>/post/the-bug-o-notation</guid>
            <description><![CDATA[What is the ğŸ(<i>n</i>) of your API?]]></description>
            <content:encoded><![CDATA[<p>When you write performance-sensitive code, itâ€™s a good idea to keep in mind its algorithmic complexity. It is often expressed with the <a href="https://rob-bell.net/2009/06/a-beginners-guide-to-big-o-notation/">Big-O notation</a>.</p>
<p>Big-O is a measure of <strong>how much slower the code will get as you throw more data at it</strong>. For example, if a sorting algorithm has O(<i>n<sup>2</sup></i>) complexity, sorting Ã—50 times more items will be roughly 50<sup>2</sup> = 2,500 times slower. Big O doesnâ€™t give you an exact number, but it helps you understand how an algorithm <em>scales</em>.</p>
<p>Some examples: O(<i>n</i>), O(<i>n</i> log <i>n</i>), O(<i>n<sup>2</sup></i>), O(<i>n!</i>).</p>
<p>However, <strong>this post isnâ€™t about algorithms or performance</strong>. Itâ€™s about APIs and debugging. It turns out, API design involves very similar considerations.</p>
<hr>
<p>A significant part of our time goes into finding and fixing mistakes in our code. Most developers would like to find bugs faster. As satisfactory as it may be in the end, it sucks to spend the whole day chasing a single bug when you could have implemented something from your roadmap.</p>
<p>Debugging experience influences our choice of abstractions, libraries, and tools. Some API and language designs make a whole class of mistakes impossible. Some create endless problems. <strong>But how can you tell which one is which?</strong></p>
<p>Many online discussions about APIs are primarily concerned with aesthetics. But that <a href="/optimized-for-change/">doesnâ€™t say much</a> about what it feels like to use an API in practice.</p>
<p><strong>I have a metric that helps me think about this. I call it the <em>Bug-O</em> notation:</strong></p>
<p><font size="40">ğŸ(<i>n</i>)</font></p>
<p>The Big-O describes how much an algorithm slows down as the inputs grow. The <em>Bug-O</em> describes how much an API slows <em>you</em> down as your codebase grows.</p>
<hr>
<p>For example, consider this code that manually updates the DOM over time with imperative operations like <code>node.appendChild()</code> and <code>node.removeChild()</code> and no clear structure:</p>
<pre   class="language-jsx"><code class="language-jsx">function trySubmit() {
  // Section 1
  let spinner = createSpinner();
  formStatus.appendChild(spinner);
  submitForm().then(() =&gt; {
  	// Section 2
    formStatus.removeChild(spinner);
    let successMessage = createSuccessMessage();
    formStatus.appendChild(successMessage);
  }).catch(error =&gt; {
  	// Section 3
    formStatus.removeChild(spinner);
    let errorMessage = createErrorMessage(error);
    let retryButton = createRetryButton();
    formStatus.appendChild(errorMessage);
    formStatus.appendChild(retryButton)
    retryButton.addEventListener('click', function() {
      // Section 4
      formStatus.removeChild(errorMessage);
      formStatus.removeChild(retryButton);
      trySubmit();
    });
  })
}
</code></pre><p>The problem with this code isnâ€™t that itâ€™s â€œuglyâ€. Weâ€™re not talking about aesthetics. <strong>The problem is that if there is a bug in this code, I donâ€™t know where to start looking.</strong></p>
<p><strong>Depending on the order in which the callbacks and events fire, there is a combinatorial explosion of the number of codepaths this program could take.</strong> In some of them, Iâ€™ll see the right messages. In others, Iâ€™ll see multiple spinners, failure and error messages together, and possibly crashes.</p>
<p>This function has 4 different sections and no guarantees about their ordering. My very non-scientific calculation tells me there are 4Ã—3Ã—2Ã—1 = 24 different orders in which they could run. If I add four more code segments, itâ€™ll be 8Ã—7Ã—6Ã—5Ã—4Ã—3Ã—2Ã—1 â€” <em>forty thousand</em> combinations. Good luck debugging that.</p>
<p><strong>In other words, the Bug-O of this approach is ğŸ(<i>n!</i>)</strong> where <em>n</em> is the number of code segments touching the DOM. Yeah, thatâ€™s a <em>factorial</em>. Of course, Iâ€™m not being very scientific here. Not all transitions are possible in practice. But on the other hand, each of these segments can run more than once. <span style="word-break: keep-all">ğŸ(<em>Â¯\_(ãƒ„)_/Â¯</em>)</span> might be more accurate but itâ€™s still pretty bad. We can do better.</p>
<hr>
<p>To improve the Bug-O of this code, we can limit the number of possible states and outcomes. We don't need any library to do this. Itâ€™s just a matter of enforcing some structure on our code. Here is one way we could do it:</p>
<pre   class="language-jsx"><code class="language-jsx">let currentState = {
  step: 'initial', // 'initial' | 'pending' | 'success' | 'error'
};

function trySubmit() {
  if (currentState.step === 'pending') {
    // Don't allow to submit twice
    return;
  }
  setState({ step: 'pending' });
  submitForm().then(() =&gt; {
    setState({ step: 'success' });
  }).catch(error =&gt; {
    setState({ step: 'error', error });
  });
}

function setState(nextState) {
  // Clear all existing children
  formStatus.innerHTML = '';

  currentState = nextState;
  switch (nextState.step) {
    case 'initial':
      break;
    case 'pending':
      formStatus.appendChild(spinner);
      break;
    case 'success':
      let successMessage = createSuccessMessage();
      formStatus.appendChild(successMessage);
      break;
    case 'error':
      let errorMessage = createErrorMessage(nextState.error);
      let retryButton = createRetryButton();
      formStatus.appendChild(errorMessage);
      formStatus.appendChild(retryButton);
      retryButton.addEventListener('click', trySubmit);
      break;
  }
}
</code></pre><p>This code might not look too different. Itâ€™s even a bit more verbose. But it is <em>dramatically</em> simpler to debug because of this line:</p>
<pre data-line="3,"  3="" class="language-jsx"><code 3="" class="language-jsx">function setState(nextState) {
  // Clear all existing children
  formStatus.innerHTML = '';

  // ... the code adding stuff to formStatus ...
</code></pre><p>By clearing out the form status before doing any manipulations, we ensure that our DOM operations always start from scratch. This is how we can fight the inevitable <a href="/the-elements-of-ui-engineering/">entropy</a> â€” by <em>not</em> letting the mistakes accumulate. This is the coding equivalent of â€œturning it off and on againâ€, and it works amazingly well.</p>
<p><strong>If there is a bug in the output, we only need to think <em>one</em> step back â€” to the previous <code>setState</code> call.</strong> The Bug-O of debugging a rendering result is ğŸ(<em>n</em>) where <em>n</em> is the number of rendering code paths. Here, itâ€™s just four (because we have four cases in a <code>switch</code>).</p>
<p>We might still have race conditions in <em>setting</em> the state, but debugging those is easier because each intermediate state can be logged and inspected. We can also disallow any undesired transitions explicitly:</p>
<pre   class="language-jsx"><code class="language-jsx">function trySubmit() {
  if (currentState.step === 'pending') {
    // Don't allow to submit twice
    return;
  }
</code></pre><p>Of course, always resetting the DOM comes with a tradeoff. NaÃ¯vely removing and recreating the DOM every time would destroy its internal state, lose focus, and cause terrible performance problems in larger applications.</p>
<p>Thatâ€™s why libraries like React can be helpful. They let you <em>think</em> in the paradigm of always recreating the UI from scratch without necessarily doing it:</p>
<pre   class="language-jsx"><code class="language-jsx">function FormStatus() {
  let [state, setState] = useState({
    step: 'initial'
  });

  function handleSubmit(e) {
    e.preventDefault();
    if (state.step === 'pending') {
      // Don't allow to submit twice
      return;
    }
    setState({ step: 'pending' });
    submitForm().then(() =&gt; {
      setState({ step: 'success' });
    }).catch(error =&gt; {
      setState({ step: 'error', error });
    });
  }

  let content;
  switch (state.step) {
    case 'pending':
      content = &lt;Spinner /&gt;;
      break;
    case 'success':
      content = &lt;SuccessMessage /&gt;;
      break;
    case 'error':
      content = (
        &lt;&gt;
          &lt;ErrorMessage error={state.error} /&gt;
          &lt;RetryButton onClick={handleSubmit} /&gt;
        &lt;/&gt;
      );
      break;
  }

  return (
    &lt;form onSubmit={handleSubmit}&gt;
      {content}
    &lt;/form&gt;
  );
}
</code></pre><p>The code may look different, but the principle is the same. The component abstraction enforces boundaries so that you know no <em>other</em> code on the page could mess with its DOM or state. Componentization helps reduce the Bug-O.</p>
<p>In fact, if <em>any</em> value looks wrong in the DOM of a React app, you can trace where it comes from by looking at the code of components above it in the React tree one by one. No matter the app size, tracing a rendered value is ğŸ(<em>tree height</em>).</p>
<p><strong>Next time you see an API discussion, consider: what is the ğŸ(<em>n</em>) of common debugging tasks in it?</strong> What about existing APIs and principles youâ€™re deeply familiar with? Redux, CSS, inheritance â€” they all have their own Bug-O.</p>
<hr>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[UIå·¥ç¨‹çš„è¦ç´ ]]></title>
            <link>/post/the-elements-of-ui-engineering-zh</link>
            <guid>/post/the-elements-of-ui-engineering-zh</guid>
            <description><![CDATA[UIå·¥ç¨‹çš„å›°éš¾ä¹‹å¤„?]]></description>
            <content:encoded><![CDATA[<p>åœ¨æˆ‘ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘è®¨è®ºäº†å…³äºæˆ‘ä»¬å­˜åœ¨çŸ¥è¯†æ¼æ´é—®é¢˜ã€‚ä½ ä»¬ä¹Ÿè®¸ä¼šæ€»ç»“ä¸ºæˆ‘æå€¡å¹³åº¸ï¼Œå¹¶ä¸æ˜¯ï¼Œè¿™æ˜¯å¾ˆå®½çš„é¢†åŸŸã€‚</p>
<p>æˆ‘åšä¿¡ä½ èƒ½ä»ä»»ä½•åœ°æ–¹å¼€å§‹å­¦ä¹ ï¼Œå¹¶ä¸”ä¸éœ€è¦éµä»ç‰¹å®šçš„é¡ºåºã€‚ä½†æ˜¯è·å–è¶³å¤Ÿçš„ç»éªŒè¿˜æ˜¯æœ‰å¾ˆå¤§çš„ä»·å€¼çš„ã€‚æˆ‘ä¸ªäººå·²ç»å¯¹åˆ›å»ºç”¨æˆ·ç•Œé¢éå¸¸æ„Ÿå…´è¶£äº†ã€‚</p>
<p>æˆ‘ä¸€ç›´åœ¨æ€è€ƒæˆ‘çœŸæ­£äº†è§£å’Œè®¤ä¸ºæœ‰ä»·å€¼çš„æ˜¯ä»€ä¹ˆã€‚å½“ç„¶ï¼Œæˆ‘ç†Ÿæ‚‰ä¸€äº›æŠ€æœ¯ï¼ˆæ¯”å¦‚<code>JavaScript</code>å’Œ<code>React</code>ï¼‰ã€‚ä½†æ›´é‡è¦çš„ç»éªŒæ•™è®­æ˜¯éš¾ä»¥æ‰æ‘¸çš„ã€‚æˆ‘ä»æœªè¯•å›¾ç”¨è¯­è¨€è¡¨è¾¾å‡ºæ¥ã€‚è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å°è¯•å°†å®ƒä»¬ç½—åˆ—å‡ºæ¥å¹¶ä¸”å¯¹å®ƒä»¬è¿›è¡Œæè¿°ã€‚</p>
<hr>
<p>å¸‚é¢ä¸Šæœ‰å¾ˆå¤šå…³äºæŠ€æœ¯æˆ–åº“çš„å­¦ä¹ è·¯çº¿ã€‚å“ªä¸ªåº“å°†åœ¨2019æµè¡Œï¼Ÿ2020åˆä¼šæ˜¯ä»€ä¹ˆï¼Ÿä½ åº”è¯¥å­¦ä¹ <code>Vue</code>æˆ–è€…<code>React</code>å—ï¼Ÿ<code>Angular</code>ï¼Ÿ<code>Redux</code>æˆ–è€…<code>Rx</code>å—ï¼Ÿä½ éœ€è¦å­¦ä¹ <code>Apollo</code>ï¼Ÿ<code>REST</code>æˆ–è€…<code>GraphQL</code>å—ï¼Ÿè¿™æ˜¯å¾ˆå®¹æ˜“è¿·èŒ«çš„ã€‚å¦‚æœä½œè€…é”™äº†å‘¢ï¼Ÿ</p>
<p>æˆ‘å­¦ä¹ çš„æœ€å¤§çªç ´ä¸æ˜¯å­¦ä¹ ä¸€é—¨å›ºå®šçš„æŠ€æœ¯ã€‚è€Œæ˜¯ï¼Œå½“æˆ‘åœ¨è§£å†³ä¸€ä¸ªç‰¹å®šçš„UIé—®é¢˜æ—¶å­¦åˆ°äº†å¾ˆå¤šã€‚æœ‰æ—¶ï¼Œæˆ‘ä¼šåœ¨ä¹‹åå‘ç°ä¸€äº›åº“æˆ–è€…åŒä¼´å¸®åŠ©äº†æˆ‘ã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæˆ‘ä¼šæƒ³åˆ°è‡ªå·±çš„è§£å†³æ–¹æ¡ˆï¼ˆå¥½çš„æˆ–è€…åçš„ï¼‰ã€‚</p>
<p>ç†è§£é—®é¢˜ã€å°è¯•ä½¿ç”¨è§£å†³æ–¹æ¡ˆã€åº”ç”¨ä¸åŒçš„ç­–ç•¥ï¼Œè¿™äº›ç»„åˆä½¿å¾—æˆ‘è·å–äº†æœ€å…·ä»·å€¼çš„å­¦ä¹ ç»éªŒã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦å°±æ˜¯æ¢è®¨è¿™äº›é—®é¢˜çš„ã€‚</p>
<hr>
<p>å¦‚æœä½ ä¸»è¦å·¥ä½œäºç”¨æˆ·é¡µé¢ï¼Œä½ å¯èƒ½å¤„ç†äº†ä¸å°‘è¿™æ ·çš„æŒ‘æˆ˜â€”â€”ç›´æ¥çš„æˆ–ä½¿ç”¨åº“ã€‚æ— è®ºå¦‚ä½•ï¼Œæˆ‘é¼“åŠ±ä½ åˆ›å»ºä¸€ä¸ªä¸ä¾èµ–åº“çš„å°åº”ç”¨ï¼Œç„¶åè¿›è¡Œå¤ç°å’Œè§£å†³è¿™äº›é—®é¢˜ã€‚å®ƒä»¬éƒ½æ²¡æœ‰ä¸€ä¸ªæ­£ç¡®çš„è§£ã€‚å­¦ä¹ æ¥è‡ªäºæ¢ç´¢é—®é¢˜é¢†åŸŸå’Œå°è¯•ä¸åŒå¯èƒ½çš„æƒè¡¡ã€‚</p>
<p>ğŸ¤”åˆ—ä¸¾å‡ºé¡µé¢å¼€å‘ä¸­çš„ä¸€äº›é—®é¢˜ï¼Œè‡ªå·±æ€è€ƒè§£å†³</p>
<hr>
<ul>
<li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€‚</strong> ä½ ç‚¹å‡»äº†â€œlikeâ€æŒ‰é’®åï¼Œæ–‡æœ¬å˜æˆäº†ï¼šâ€œä½ å’Œä½ å¦å¤–çš„ä¸‰ä¸ªæœ‹å‹å–œæ¬¢äº†è¿™ç¯‡æ–‡ç« ã€‚â€ä½ å†æ­¤ç‚¹å‡»ï¼Œæ–‡æœ¬åˆå˜å›å»äº†ã€‚å¬èµ·æ¥å¾ˆç®€å•å§ã€‚ä½†æ˜¯åœ¨å±å¹•ä¸Šå¥½å‡ ä¸ªåœ°æ–¹éƒ½å­˜åœ¨è¿™æ ·çš„æ ‡ç­¾ã€‚ä¹Ÿè®¸æœ‰ä¸€äº›å…¶ä»–çš„æç¤ºéœ€è¦æ”¹å˜ï¼ˆä¾‹å¦‚æŒ‰é’®çš„èƒŒæ™¯è‰²ï¼‰ã€‚â€˜likersâ€™åˆ—è¡¨å·²ç»æå‰ä»æœåŠ¡ç«¯è·å–åˆ°äº†ï¼Œå¹¶ä¸”å½“é¼ æ ‡ç§»ä¸Šå»çš„æ—¶å€™ä¹Ÿåº”è¯¥èƒ½å¤Ÿçœ‹åˆ°ä½ çš„åå­—äº†ã€‚å¦‚æœä½ å¯¼èˆªåˆ°å¦ä¸€ä¸ªå±å¹•å¹¶è¿”å›ï¼Œåšå®¢ä¸åº”è¯¥â€œå¿˜è®°â€å®ƒè¢«å–œæ¬¢è¿‡ã€‚å³ä½¿æ˜¯å±€éƒ¨ä¸€è‡´æ€§æœ¬èº«ï¼Œä¹Ÿä¼šå¸¦æ¥ä¸€äº›æŒ‘æˆ˜ã€‚ä½†æ˜¯å…¶å®ƒçš„ç”¨æˆ·å¯èƒ½ä¹Ÿä¼šæ”¹å˜æˆ‘ä»¬å±•ç¤ºçš„ä¸€äº›æ•°æ®ï¼ˆä¾‹å¦‚å–œæ¬¢æˆ‘ä»¬æ­£åœ¨çœ‹çš„å¸–å­ï¼‰ã€‚æˆ‘ä»¬æ€æ ·ä¿è¯å±å¹•ä¸Šä¸åŒéƒ¨åˆ†åŒæ­¥ç›¸åŒçš„æ•°æ®å‘¢ï¼Ÿæˆ‘ä»¬å¦‚ä½•ä»¥åŠä½•æ—¶ä½¿æœ¬åœ°æ•°æ®ä¸æœåŠ¡å™¨ä¸€è‡´ï¼Œåä¹‹äº¦ç„¶ï¼Ÿ</li>
<li><strong>å“åº”æ€§ï¼ˆResponsivenessï¼‰ã€‚</strong> äººä»¬åªèƒ½åœ¨æœ‰é™çš„æ—¶é—´å†…å¿å—ä»–ä»¬çš„è¡Œä¸ºç¼ºä¹åé¦ˆã€‚å¯¹äºæ‰‹åŠ¿å’Œæ»šåŠ¨ç­‰è¿ç»­æ€§æ“ä½œï¼Œè¿™ä¸ªé™åˆ¶å¾ˆä½ã€‚(å³ä¾¿æ˜¯è·³è¿‡ä¸€ä¸ª16msçš„å¸§ä¹Ÿä¼šè®©äººæ„Ÿè§‰å¾ˆâ€œä¸çˆ½â€ã€‚)å¯¹äºåƒç‚¹å‡»è¿™æ ·çš„ç¦»æ•£æ“ä½œï¼Œæœ‰ç ”ç©¶è¡¨æ˜ï¼Œç”¨æˆ·è®¤ä¸ºä»»ä½•å°äº100msçš„å»¶è¿Ÿéƒ½å¾ˆå¿«ã€‚å¦‚æœä¸€ä¸ªåŠ¨ä½œéœ€è¦æ›´é•¿çš„æ—¶é—´ï¼Œæˆ‘ä»¬éœ€è¦æ˜¾ç¤ºä¸€ä¸ªè§†è§‰æŒ‡ç¤ºå™¨ã€‚ä½†ä¹Ÿæœ‰ä¸€äº›è¿åç›´è§‰ã€‚å¯¼è‡´é¡µé¢å¸ƒå±€çš„â€œè·³è·ƒâ€æˆ–ç»å†å‡ ä¸ªåŠ è½½é˜¶æ®µçš„æŒ‡ç¤ºå™¨ä¼šè®©åŠ¨ä½œæ„Ÿè§‰æ¯”ä»¥å‰æ›´æ…¢ã€‚ç±»ä¼¼åœ°ï¼Œåœ¨20mså†…å¤„ç†äº¤äº’(ä»¥ä¸¢å¸§ä¸ºä»£ä»·)æ¯”åœ¨30mså†…å¤„ç†äº¤äº’è¦æ…¢ï¼Œè€Œä¸”æ²¡æœ‰åˆ é™¤å¸§ã€‚å¤§è„‘å¹¶ä¸æ˜¯åŸºå‡†ã€‚æˆ‘ä»¬å¦‚ä½•ä¿è¯æˆ‘ä»¬çš„åº”ç”¨å“åº”ä¸åŒçš„è¾“å…¥å‘¢ï¼Ÿ</li>
<li><strong>å»¶è¿Ÿï¼ˆLatencyï¼‰ã€‚</strong> è®¡ç®—å’Œç½‘ç»œé“¾æ¥éƒ½éœ€è¦æ—¶é—´ã€‚æœ‰æ—¶ï¼Œå¦‚æœä¸å½±å“ç›®æ ‡è®¾å¤‡çš„å“åº”èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥å¿½ç•¥è®¡ç®—æˆæœ¬ï¼ˆç¡®ä¿åœ¨ä½é…çš„è®¾å¤‡ä¸Šæµ‹è¯•è¿‡ä½ çš„åº”ç”¨ï¼‰ã€‚ä½†æ˜¯å¤„ç†ç½‘ç»œå»¶è¿Ÿæ˜¯æ— å¯é¿å…çš„â€”â€”å®ƒå°†æ¶ˆè€—å‡ ç§’é’Ÿï¼æˆ‘ä»¬çš„åº”ç”¨ä¸èƒ½é™æ­¢ç­‰å¾…æ•°æ®æˆ–ä»£ç åŠ è½½ã€‚ä½†æ˜¯é‚£æœ‰å¯èƒ½å‘ç”Ÿåœ¨æ¯ä¸€ä¸ªå±å¹•ä¸­ã€‚å¦‚ä½•åœ¨ä¸æ˜¾ç¤ºâ€œloadingâ€åŠ è½½æˆ–ç©ºç™½æƒ…å†µä¸‹ä¼˜é›…åœ°å¤„ç†å»¶è¿Ÿå‘¢ï¼Ÿå¦‚ä½•é¿å…â€œè·³è·ƒâ€å¸ƒå±€å‘¢ï¼Ÿä»¥åŠå¦‚ä½•åœ¨æ¯æ¬¡ä¸â€œé‡æ–°è¿æ¥â€ä»£ç çš„æƒ…å†µä¸‹æ›´æ”¹å¼‚æ­¥åŠ è½½é¡¹å‘¢ï¼Ÿ</li>
<li><strong>å¯¼èˆªï¼ˆNavigationï¼‰ã€‚</strong> å½“æˆ‘ä»¬ä¸é¡µé¢äº¤äº’æ—¶ï¼Œæˆ‘ä»¬æœŸæœ›UIèƒ½å¤Ÿä¿æŒâ€œç¨³å®šâ€ã€‚äº‹ç‰©ä¸åº”è¯¥å°±åœ¨æˆ‘ä»¬çœ¼å‰æ¶ˆå¤±ã€‚å¯¼èˆªï¼Œæ— è®ºæ˜¯åœ¨åº”ç”¨ç¨‹åºå†…éƒ¨å¯åŠ¨ï¼ˆå¦‚å•å‡»é“¾æ¥ï¼‰ï¼Œè¿˜æ˜¯ç”±äºå¤–éƒ¨äº‹ä»¶ï¼ˆå¦‚å•å‡»â€œåé€€â€æŒ‰é’®ï¼‰ï¼Œéƒ½åº”è¯¥éµä»è¿™ä¸€åŸåˆ™ã€‚ä¾‹å¦‚ï¼Œåœ¨é…ç½®æ–‡ä»¶å±å¹•ä¸Šçš„<code>/profile/likes</code>å’Œ<code>/profile/following</code>é€‰é¡¹å¡ä¹‹é—´åˆ‡æ¢ä¸åº”è¯¥æ¸…é™¤é€‰é¡¹å¡è§†å›¾ä¹‹å¤–çš„æœç´¢è¾“å…¥ã€‚å°½ç®¡å¯¼èˆªåˆ°å¦ä¸€ä¸ªå±å¹•ä¸­å°±åƒèµ°è¿›äº†ä¸€é—´æˆ¿é—´ä¸€æ ·ã€‚äººä»¬æœŸæœ›èƒ½å¤Ÿèµ°å›å»å¹¶èƒ½æ‰¾åˆ°ä»–ä»¬ç•™ä¸‹çš„ä¸œè¥¿ã€‚å¦‚æœä½ åœ¨å¯¼èˆªä¸­ï¼Œå•å‡»ä¸€ä¸ªé“¾æ¥ï¼Œç„¶åè¿”å›ï¼Œä½ å¤±å»äº†åœ¨å¯¼èˆªä¸­çš„ä½ç½®ï¼Œè¿™æ˜¯ä»¤äººæ²®ä¸§çš„â€”â€”æˆ–è€…ç­‰å¾…å®ƒå†æ¬¡åŠ è½½ã€‚æˆ‘ä»¬å¦‚ä½•åœ¨ä¸ä¸¢å¤±é‡è¦ä¸Šä¸‹æ–‡çš„æƒ…å†µä¸‹è®¾è®¡åº”ç”¨ç¨‹åºæ¥å¤„ç†ä»»æ„å¯¼èˆªã€‚</li>
<li><strong>é™ˆæ—§ï¼ˆStalenessï¼‰ã€‚</strong> é€šè¿‡å¼•å…¥æœ¬åœ°ç¼“å­˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿â€œåé€€â€æŒ‰é’®å¯¼èˆªç«‹å³ç”Ÿæ•ˆã€‚åœ¨ç¼“å­˜ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥â€œè®°ä½â€ä¸€äº›æ•°æ®ï¼Œä»¥ä¾¿å¿«æ·è®¿é—®ï¼Œå³ä½¿ç†è®ºä¸Šæˆ‘ä»¬å¯ä»¥é‡æ–°è·å–å®ƒã€‚ä½†æ˜¯ç¼“å­˜è‡ªèº«ä¹Ÿå­˜åœ¨ç€ä¸€äº›é—®é¢˜ã€‚ç¼“å­˜å¯èƒ½ä¼šè¿‡æœŸã€‚å¦‚ä½•å¤„ç†å½“æˆ‘æ”¹å˜äº†ä¸€ä¸ªå¤´åƒï¼Œç¼“å­˜ä¹Ÿåº”è¯¥ä¼šæ›´æ–°çš„é—®é¢˜ã€‚å¦‚æœæˆ‘åˆ›å»ºäº†ä¸€ç¯‡æ–°çš„æ–‡ç« ï¼Œä¹Ÿåº”è¯¥ç«‹å³å‡ºç°åœ¨ç¼“å­˜ä¸­ï¼Œå¦åˆ™ç¼“å­˜å°†æ˜¯æ— æ•ˆçš„ã€‚è¿™å°†å˜å¾—å›°éš¾ä¸”å®¹æ˜“å‡ºé”™ã€‚å¦‚æœå‘å¸ƒå¤±è´¥äº†å‘¢ï¼Ÿç¼“å­˜åœ¨å†…å­˜ä¸­åœç•™å¤šé•¿æ—¶é—´ï¼Ÿå½“æˆ‘ä»¬é‡æ–°è·å–æè¦æ—¶ï¼Œæ˜¯å°†æ–°è·å–çš„æè¦ä¸ç¼“å­˜çš„æè¦â€œæ•´åˆâ€ï¼Œè¿˜æ˜¯å°†ç¼“å­˜ä¸¢å¼ƒï¼Ÿå¦‚ä½•åœ¨ç¼“å­˜ä¸­è¡¨ç¤ºåˆ†é¡µæˆ–æ’åºï¼Ÿ</li>
<li><strong>ç†µï¼ˆEntropyï¼‰ã€‚</strong> çƒ­åŠ›å­¦ç¬¬äºŒå®šå¾‹æ˜¯è¿™æ ·è¯´çš„ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œç‰©è´¨ä¼šå˜å¾—ä¸€å›¢ç³Ÿï¼ˆå—¯ï¼Œä¸å®Œå…¨æ˜¯ï¼‰ã€‚è¿™ä¹ŸåŒæ ·é€‚ç”¨äºç”¨æˆ·ç•Œé¢ã€‚æˆ‘ä»¬ä¸èƒ½å‡†ç¡®åœ°é¢„æµ‹ç”¨æˆ·äº¤äº’åŠå…¶é¡ºåºã€‚åœ¨ä»»ä½•æ—¶é—´ç‚¹ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¯èƒ½å¤„äºæ•°é‡æƒŠäººçš„çŠ¶æ€ä¸‹ã€‚æˆ‘ä»¬å°½æœ€å¤§åŠªåŠ›ä½¿ç»“æœå¯é¢„æµ‹å¹¶ä¸”é™åˆ¶æˆ‘ä»¬çš„è®¾è®¡ã€‚æˆ‘ä»¬ä¸æƒ³çœ‹åˆ°ä¸€ä¸ªbugæˆªå›¾ï¼Œç„¶åç–‘æƒ‘â€œè¿™æ˜¯æ€æ ·å‘ç”Ÿçš„ï¼Ÿâ€ã€‚å¯¹äºNä¸ªå¯èƒ½çš„çŠ¶æ€ï¼Œå®ƒä»¬ä¹‹é—´æœ‰N*(N - 1)ä¸ªå¯èƒ½çš„è·ƒè¿ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªæŒ‰é’®å¯ä»¥å¤„äº5ç§ä¸åŒçš„çŠ¶æ€ä¹‹ä¸€ï¼ˆæ­£å¸¸ï¼Œæ¿€æ´»ï¼Œæ‚¬åœï¼Œå±é™©ï¼Œç¦ç”¨ï¼‰ï¼Œå¯¹äº5Ã—4=20ä¸ªå¯èƒ½çš„è½¬æ¢ï¼Œæ›´æ–°æŒ‰é’®çš„ä»£ç å¿…é¡»æ˜¯æ­£ç¡®çš„â€”â€”æˆ–è€…ç¦æ­¢å…¶ä¸­ä¸€äº›ã€‚æˆ‘ä»¬å¦‚ä½•æ§åˆ¶å¯èƒ½çŠ¶æ€çš„ç»„åˆçˆ†ç‚¸ï¼Œå¹¶ä½¿è§†è§‰è¾“å‡ºå¯é¢„æµ‹ï¼Ÿ</li>
<li><strong>ä¼˜å…ˆçº§ï¼ˆPriorityï¼‰ã€‚</strong> æœ‰äº›äº‹æƒ…æ¯”å…¶å®ƒäº‹æƒ…æ›´é‡è¦ã€‚å¯¹è¯æ¡†å¯èƒ½å‡ºç°åœ¨äº§ç”Ÿå®ƒçš„æŒ‰é’®çš„â€œä¸Šæ–¹â€ï¼Œå¹¶â€œè·³å‡ºâ€å…¶å†…å®¹çš„å‰ªè¾‘è¾¹ç•Œã€‚æ–°è°ƒåº¦çš„ä»»åŠ¡(ä¾‹å¦‚å“åº”å•å‡»)å¯èƒ½æ¯”å·²ç»å¯åŠ¨çš„é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡(ä¾‹å¦‚åœ¨å±å¹•æŠ˜å ä¸‹æ–¹å‘ˆç°ä¸‹ä¸€ç¯‡æ–‡ç« )æ›´é‡è¦ã€‚éšç€æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„æˆé•¿ï¼Œå®ƒçš„éƒ¨åˆ†ä»£ç æ˜¯ç”±ä¸åŒçš„äººå’Œå›¢é˜Ÿç¼–å†™çš„ï¼Œå®ƒä»¬äº‰å¤ºæœ‰é™çš„èµ„æºï¼Œå¦‚å¤„ç†å™¨ã€ç½‘ç»œã€å±å¹•ç©ºé—´å’ŒåŒ…å¤§å°é¢„ç®—ã€‚æœ‰æ—¶æ‚¨å¯ä»¥æ ¹æ®â€œé‡è¦æ€§â€çš„å…±äº«çº§åˆ«å¯¹ç«äº‰è€…è¿›è¡Œæ’åºï¼Œæ¯”å¦‚CSS z-indexå±æ€§ã€‚<a href="https://blogs.msdn.microsoft.com/oldnewthing/20050607-00/?p=35413">ä½†æ˜¯å®ƒå¾ˆå°‘æœ‰å¥½çš„ç»“å±€</a> æ¯ä¸ªå¼€å‘äººå‘˜éƒ½åé¢‡åœ°è®¤ä¸ºä»–ä»¬çš„ä»£ç å¾ˆé‡è¦ã€‚å¦‚æœä¸€åˆ‡éƒ½å¾ˆé‡è¦ï¼Œé‚£ä¹ˆä»€ä¹ˆéƒ½ä¸é‡è¦!æˆ‘ä»¬å¦‚ä½•è®©ç‹¬ç«‹çš„å°éƒ¨ä»¶åˆä½œï¼Œè€Œä¸æ˜¯äº‰å¤ºèµ„æº?</li>
<li><strong>å¯è®¿é—®æ€§ï¼ˆAccessibilityï¼‰ã€‚</strong> æ— æ³•è®¿é—®çš„ç½‘ç«™ä¸æ˜¯ä¸€ä¸ªå°ä¼—é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œåœ¨è‹±å›½ï¼Œæ¯5ä¸ªäººä¸­å°±æœ‰1äººæ‚£æœ‰æ®‹ç–¾ã€‚ï¼ˆ<a href="https://www.abrightclearweb.com/web-accessibility-in-the-uk/">è¿™æ˜¯ä¸€å¼ ä¸é”™çš„ä¿¡æ¯å›¾è¡¨</a>ï¼‰æˆ‘ä¹Ÿæœ‰è¿™ç§æ„Ÿè§‰ã€‚è™½ç„¶æˆ‘åªæœ‰26å²ï¼Œä½†æˆ‘è¿˜æ˜¯å¾ˆéš¾é˜…è¯»å­—ä½“ç»†ã€å¯¹æ¯”åº¦ä½çš„ç½‘ç«™ã€‚æˆ‘è¯•ç€å‡å°‘ä½¿ç”¨è§¦æ§æ¿çš„æ¬¡æ•°ï¼Œæˆ‘æ‹…å¿ƒæœ‰ä¸€å¤©æˆ‘å°†ä¸å¾—ä¸é€šè¿‡é”®ç›˜æ¥æµè§ˆåŠŸèƒ½ä¸ä½³çš„ç½‘ç«™ã€‚æˆ‘ä»¬éœ€è¦è®©æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¯¹äºæœ‰å›°éš¾çš„äººæ¥è¯´ä¸é‚£ä¹ˆå¯æ€•â€”â€”å¥½æ¶ˆæ¯æ˜¯æœ‰å¾ˆå¤šå”¾æ‰‹å¯å¾—çš„æˆæœã€‚é¦–å…ˆæ˜¯æ•™è‚²å’Œå·¥å…·ã€‚ä½†æˆ‘ä»¬ä¹Ÿéœ€è¦è®©äº§å“å¼€å‘äººå‘˜åšæ­£ç¡®çš„äº‹æƒ…ã€‚æˆ‘ä»¬å¯ä»¥åšäº›ä»€ä¹ˆæ¥ä½¿æ˜“è®¿é—®æ€§æˆä¸ºé»˜è®¤è€Œä¸æ˜¯äº‹åè€ƒè™‘?</li>
<li><strong>å›½é™…åŒ–ï¼ˆInternationalizationï¼‰ã€‚</strong> æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéœ€è¦åœ¨å…¨ä¸–ç•Œå„åœ°è¿è¡Œã€‚äººä»¬ä¸ä»…ä¼šè¯´ä¸åŒçš„è¯­è¨€ï¼Œè€Œä¸”æˆ‘ä»¬è¿˜éœ€è¦ç”¨äº§å“å·¥ç¨‹å¸ˆæœ€å°‘çš„å·¥ä½œé‡æ¥æ”¯æŒä»å³åˆ°å·¦çš„å¸ƒå±€ã€‚æˆ‘ä»¬å¦‚ä½•åœ¨ä¸ç‰ºç‰²å»¶è¿Ÿå’Œå“åº”æ€§çš„æƒ…å†µä¸‹æ”¯æŒä¸åŒçš„è¯­è¨€ï¼Ÿ</li>
<li><strong>äº¤ä»˜ï¼ˆDeliveryï¼‰ã€‚</strong> æˆ‘ä»¬éœ€è¦å°†åº”ç”¨ç¨‹åºä»£ç å‘é€åˆ°ç”¨æˆ·çš„è®¡ç®—æœºã€‚æˆ‘ä»¬ä½¿ç”¨ä»€ä¹ˆä¼ è¾“å’Œæ ¼å¼?è¿™å¬èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯è¿™é‡Œæœ‰å¾ˆå¤šæƒè¡¡ã€‚ä¾‹å¦‚ï¼Œæœ¬æœºåº”ç”¨ç¨‹åºå€¾å‘äºæå‰åŠ è½½æ‰€æœ‰ä»£ç ï¼Œä»£ä»·å°±æ˜¯ä½¿å¾—åº”ç”¨ç¨‹åºå˜å¾—æ›´å¤§ã€‚Webåº”ç”¨ç¨‹åºçš„åˆå§‹è´Ÿè½½å¾€å¾€è¾ƒå°ï¼Œä½†åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šæœ‰æ›´å¤šçš„å»¶è¿Ÿã€‚æˆ‘ä»¬å¦‚ä½•é€‰æ‹©åœ¨å“ªä¸ªç‚¹å¼•å…¥å»¶è¿Ÿï¼Ÿæˆ‘ä»¬å¦‚ä½•åŸºäºä½¿ç”¨æ¨¡å¼ä¼˜åŒ–æˆ‘ä»¬çš„äº¤ä»˜ï¼Ÿæœ€ä¼˜è§£éœ€è¦ä»€ä¹ˆæ ·çš„æ•°æ®ï¼Ÿ</li>
<li><strong>ä¼¸ç¼©æ€§ï¼ˆResilienceï¼‰ã€‚</strong> å¦‚æœä½ æ˜¯æ˜†è™«å­¦è€…ä½ å¯èƒ½ä¼šå–œæ¬¢bugsï¼Œä½†ä½ å¯èƒ½ä¸å–œæ¬¢çœ‹åˆ°å®ƒä»¬å‡ºç°åœ¨ä½ çš„ç¨‹åºä¸­ã€‚ç„¶è€Œï¼Œä½ çš„ä¸€äº›bugå°†ä¸å¯é¿å…åœ°è¿›å…¥ç”Ÿäº§ç¯å¢ƒã€‚ç„¶åä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿä¸€äº›bugä¼šå¯¼è‡´é”™è¯¯ä½†å®šä¹‰è‰¯å¥½çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œä½ çš„ä»£ç å¯èƒ½åœ¨æŸäº›æ¡ä»¶ä¸‹æ˜¾ç¤ºä¸æ­£ç¡®çš„è¾“å‡ºã€‚ä½†æ˜¯å¦‚æœæ¸²æŸ“ä»£ç å´©æºƒäº†å‘¢?é‚£ä¹ˆæˆ‘ä»¬å°±ä¸èƒ½æœ‰æ„ä¹‰åœ°ç»§ç»­ï¼Œå› ä¸ºè§†è§‰è¾“å‡ºä¼šä¸ä¸€è‡´ã€‚ä¸€ä¸ªå¸–å­çš„å´©æºƒä¸åº”è¯¥â€œæ‹‰ä¸‹â€æ•´ä¸ªfeedï¼Œä¹Ÿä¸åº”è¯¥è®©å®ƒè¿›å…¥ä¸€ä¸ªå¯¼è‡´æ›´å¤šå´©æºƒçš„åŠä¸­æ–­çŠ¶æ€ã€‚æˆ‘ä»¬å¦‚ä½•ç¼–å†™ä»£ç æ¥éš”ç¦»æ¸²æŸ“å’Œè·å–å¤±è´¥ï¼Œå¹¶ä¿æŒåº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†è¿è¡Œï¼Ÿå®¹é”™å¯¹äºç”¨æˆ·ç•Œé¢æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</li>
<li><strong>æŠ½è±¡ï¼ˆAbstractionï¼‰ã€‚</strong> åœ¨ä¸€ä¸ªå°çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç¡¬ç¼–ç è®¸å¤šç‰¹æ®Šçš„æƒ…å†µæ¥è§£å†³ä¸Šè¿°é—®é¢˜ã€‚ä½†æ˜¯åº”ç”¨ç¨‹åºå¾€å¾€ä¼šå¢é•¿ã€‚æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿ<a href="https://overreacted.io/optimized-for-change/">é‡ç”¨ã€åˆ†å‰å’Œè”æ¥</a>ä»£ç çš„å„ä¸ªéƒ¨åˆ†ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿä¸€èµ·å·¥ä½œã€‚æˆ‘ä»¬æƒ³åœ¨ä¸åŒçš„äººç†Ÿæ‚‰çš„ç‰‡æ®µä¹‹é—´å®šä¹‰æ¸…æ™°çš„ç•Œé™ï¼Œé¿å…ä½¿ç»å¸¸å˜åŒ–çš„é€»è¾‘è¿‡äºåƒµåŒ–ã€‚æˆ‘ä»¬å¦‚ä½•åˆ›å»ºéšè—ç‰¹å®šUIéƒ¨åˆ†å®ç°ç»†èŠ‚çš„æŠ½è±¡ï¼Ÿæˆ‘ä»¬å¦‚ä½•é¿å…åœ¨æˆ‘ä»¬çš„åº”ç”¨å¢é•¿è¿‡ç¨‹ä¸­å†æ¬¡å¼•å…¥æˆ‘ä»¬åˆšåˆšè§£å†³çš„é—®é¢˜ï¼Ÿ</li>
</ul>
<hr>
<p>å½“ç„¶ï¼Œè¿˜æœ‰å¾ˆå¤šæˆ‘æ²¡æœ‰æåˆ°çš„é—®é¢˜ã€‚è¿™ä¸ªåˆ—è¡¨ç»ä¸æ˜¯è¯¦å°½çš„!ä¾‹å¦‚ï¼Œæˆ‘æ²¡æœ‰è°ˆåˆ°è®¾è®¡äººå‘˜å’Œå·¥ç¨‹åä½œï¼Œæˆ–è€…è°ƒè¯•å’Œæµ‹è¯•ã€‚ä¹Ÿè®¸ä¸‹ä¸€æ¬¡æˆ‘ä¼šå†™çš„æ›´è¯¦å°½ã€‚é˜…è¯»å…³äºè¿™äº›é—®é¢˜çš„æ–‡ç« æ—¶ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°ä½¿ç”¨ç‰¹å®šçš„è§†å›¾åº“æˆ–æ•°æ®è·å–åº“ä½œä¸ºè§£å†³æ–¹æ¡ˆã€‚ä½†æ˜¯æˆ‘é¼“åŠ±ä½ å‡è£…è¿™äº›åº“ä¸å­˜åœ¨ï¼Œä»è¿™ä¸ªè§’åº¦å†è¯»ä¸€éã€‚æ‚¨å°†å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜?å»è¯•è¯•æ„å»ºä¸€ä¸ªå°çš„åº”ç”¨ç¨‹åºå§!(æˆ‘å¾ˆä¹æ„çœ‹åˆ°ä½ åœ¨GitHubä¸Šåšçš„å®éªŒâ€”â€”ä½ å¯ä»¥å‘æ¨ç‰¹ï¼ˆTwitterï¼‰å›å¤æˆ‘ã€‚)</p>
<p>è¿™äº›é—®é¢˜çš„æœ‰è¶£ä¹‹å¤„åœ¨äºï¼Œå®ƒä»¬ä¸­çš„å¤§å¤šæ•°éƒ½èƒ½ä»¥ä»»ä½•è§„æ¨¡å‡ºç°ã€‚ä½ å¯ä»¥åœ¨è¯¸å¦‚typeaheadæˆ–å·¥å…·æç¤ºè¿™æ ·çš„å°å·¥å…·ä¸­çœ‹åˆ°å®ƒä»¬ï¼Œä¹Ÿå¯ä»¥åœ¨è¯¸å¦‚Twitterå’ŒFacebookè¿™æ ·çš„å¤§å‹åº”ç”¨ç¨‹åºä¸­çœ‹åˆ°å®ƒä»¬ã€‚</p>
<p><strong>æƒ³æƒ³ä½ å–œæ¬¢ä½¿ç”¨çš„åº”ç”¨ç¨‹åºä¸­çš„ä¸€ä¸ªéè¯•éªŒæ€§çš„UIå…ƒç´ ï¼Œä»”ç»†æ£€æŸ¥ä¸€ä¸‹è¿™ä¸ªé—®é¢˜åˆ—è¡¨ã€‚æ‚¨èƒ½æè¿°ä¸€ä¸‹å®ƒçš„å¼€å‘äººå‘˜æ‰€é€‰æ‹©çš„ä¸€äº›æŠ˜è¡·æ–¹æ¡ˆå—?å°è¯•ä»å¤´åˆ›å»ºä¸€ä¸ªç±»ä¼¼çš„è¡Œä¸º!</strong></p>
<p>é€šè¿‡åœ¨ä¸ä½¿ç”¨åº“çš„å°å‹åº”ç”¨ç¨‹åºä¸­è¯•éªŒè¿™äº›é—®é¢˜ï¼Œæˆ‘å­¦åˆ°äº†å¾ˆå¤šå…³äºUIå·¥ç¨‹çš„çŸ¥è¯†ã€‚æˆ‘å‘ä»»ä½•æƒ³å¯¹UIå·¥ç¨‹ä¸­æƒè¡¡åˆ©å¼Šçš„äººæ¨èåŒæ ·çš„æ–¹æ³•ã€‚</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[The Elements of UI Engineering]]></title>
            <link>/post/the-elements-of-ui-engineering</link>
            <guid>/post/the-elements-of-ui-engineering</guid>
            <description><![CDATA[What makes UI engineering difficult?]]></description>
            <content:encoded><![CDATA[<p>In my <a href="/things-i-dont-know-as-of-2018/">previous post</a>, I talked about admitting our knowledge gaps. You might conclude that I suggest settling for mediocrity. I donâ€™t! This is a broad field.</p>
<p>I strongly believe that you can â€œbegin anywhereâ€ and donâ€™t need to learn technologies in any particular order. But I also place great value in gaining expertise. Personally Iâ€™ve mostly been interested in creating user interfaces.</p>
<p><strong>Iâ€™ve been mulling over what it is that I <em>do</em> know about and consider valuable.</strong> Sure, Iâ€™m familiar with a few technologies (e.g. JavaScript and React). But the more important lessons from experience are elusive. I never tried to put them into words. This is my first attempt to catalog and describe some of them.</p>
<hr>
<p>There are plenty ofÂ â€œlearning roadmapsâ€ about technologies and libraries. Which library is going to be in vogue in 2019? What about 2020? Should you learn Vue or React? Angular? What about Redux or Rx? Do you need to learn Apollo? REST or GraphQL? Itâ€™s easy to get lost. What if the author is wrong?</p>
<p><strong>My biggest learning breakthroughs werenâ€™t about a particular technology.</strong> Rather, I learned the most when I struggled to solve a particular UI problem. Sometimes, I would later discover libraries or patterns that helped me. In other cases, Iâ€™d come up with my own solutions (both good and bad ones).</p>
<p>Itâ€™s this combination of understanding the <em>problems</em>, experimenting with the <em>solutions</em>, and applying different <em>strategies</em> that led to the most rewarding learning experiences in my life. <strong>This post focuses on just the problems.</strong></p>
<hr>
<p>If you worked a user interface, youâ€™ve likely dealt with at least some of these challenges â€” either directly or using a library. In either case, I encourage you to create a tiny app with <em>no</em> libraries, and play with reproducing and solving these problems. Thereâ€™s no one right solution to any of them. Learning comes from exploring the problem space and trying different possible tradeoffs.</p>
<hr>
<ul>
<li>
<p><strong>Consistency.</strong> You click on a â€œLikeâ€ button and the text updates: â€œYou and 3 other friends liked this post.â€ You click it again, and the text flips back. Sounds easy. But maybe a label like this exists in several places on the screen. Maybe there is some other visual indication (such as the button background) that needs to change. The list of â€œlikersâ€ that was previously fetched from the server and is visible on hover should now include your name. If you navigate to another screen and go back, the post shouldnâ€™t â€œforgetâ€ it was liked. Even local consistency <em>alone</em> creates a set of challenges. But other users might also modify the data we display (e.g. by liking a post weâ€™re viewing). How do we keep the same data in sync on different parts of the screen? How and when do we make the local data consistent with the server, and the other way around?</p>
</li>
<li>
<p><strong>Responsiveness.</strong> People can only tolerate a lack of visual feedback to their actions for a limited time. For <em>continuous</em> actions like gestures and scroll, this limit is low. (Even skipping a single 16ms frame feels â€œjankyâ€.) For <em>discrete</em> actions like clicks, there is research saying users perceive any &lt; 100ms delays as equally fast. If an action takes longer, we need to show a visual indicator. But there are some counter-intuitive challenges. Indicators that cause the page layout to â€œjumpâ€ or that go through several loading â€œstagesâ€ can make the action <em>feel longer</em> than it was. Similarly, handling an interaction within 20ms at the cost of dropping an animation frame can <em>feel slower</em> than handling it within 30ms and no dropped frames. Brains arenâ€™t benchmarks. How do we keep our apps responsive to different kinds of inputs?</p>
</li>
<li>
<p><strong>Latency.</strong> Both computations and network access take time. <em>Sometimes</em> we can ignore the computational cost if it doesnâ€™t hurt the responsiveness on our target devices (make sure to test your app on the low-end device spectrum). But handling network latency is unavoidable â€” it can take seconds! Our app canâ€™t just freeze waiting for the data or code to load. This means any action that depends on new data, code, or assets is potentially asynchronous and needs to handle the â€œloadingâ€ case. But that can happen for almost every screen. How do we gracefully handle latency without displaying a â€œcascadeâ€ of spinners or empty â€œholesâ€? How do we avoid â€œjumpyâ€ layout? And how do we change async dependencies without â€œrewiringâ€ our code every time?</p>
</li>
<li>
<p><strong>Navigation.</strong> We expect that the UI remains â€œstableâ€ as we interact with it. Things shouldnâ€™t disappear from right under our noses. Navigation, whether started within the app (e.g. clicking a link) or due to an external event (e.g. clicking the â€œbackâ€ button), should also respect this principle. For example, switching between <code>/profile/likes</code> and <code>/profile/follows</code> tabs on a profile screen shouldnâ€™t clear a search input outside the tabbed view. Even navigating to <em>another</em> screen is like walking into a room. People expect to go back later and find things as they left them (with, perhaps, some new items). If youâ€™re in the middle of a feed, click on a profile, and go back, itâ€™s frustrating to lose your position in the feed â€” or wait for it to load again. How do we architect our app to handle arbitrary navigation without losing important context?</p>
</li>
<li>
<p><strong>Staleness.</strong> We can make the â€œbackâ€ button navigation instant by introducing a local cache. In that cache, we can â€œrememberâ€ some data for quick access even if we could theoretically refetch it. But caching brings its own problems. Caches can get stale. If I change an avatar, it should update in the cache too. If I make a new post, it needs to appear in the cache immediately, or the cache needs to be invalidated. This can become difficult and error-prone. What if the posting fails? How long does the cache stay in memory? When we refetch the feed, do we â€œstitchâ€ the newly fetched feed with the cached one, or throw the cache away? How is pagination or sorting represented in the cache?</p>
</li>
<li>
<p><strong>Entropy.</strong> The second law of thermodynamics says something like â€œwith time, things turn into a messâ€ (well, not exactly). This applies to user interfaces too. We canâ€™t predict the exact user interactions and their order. At any point in time, our app may be in one of a mind-boggling number of possible states. We do our best to make the result predictable and limited by our design. We donâ€™t want to look at a bug screenshot and wonder â€œhow did <em>that</em> happenâ€. For <em>N</em> possible states, there are <em>NÃ—(Nâ€“1)</em> possible transitions between them. For example, if a button can be in one of 5 different states (normal, active, hover, danger, disabled), the code updating the button must be correct for 5Ã—4=20 possible transitions â€” or forbid some of them. How do we tame the combinatorial explosion of possible states and make visual output predictable?</p>
</li>
<li>
<p><strong>Priority.</strong> Some things are more important than others. A dialog might need to appear physically â€œaboveâ€ the button that spawned it and â€œbreak outâ€ of its containerâ€™s clip boundaries. A newly scheduled task (e.g. responding to a click) might be more important than a long-running task that already started (e.g. rendering next posts below the screen fold). As our app grows, parts of its code written by different people and teams compete for limited resources like processor, network, screen estate, and the bundle size budget. Sometimes you can rank the contenders on a shared scale of â€œimportanceâ€, like the CSS <code>z-index</code> property. <a href="https://blogs.msdn.microsoft.com/oldnewthing/20050607-00/?p=35413">But it rarely ends well.</a> Every developer is biased to think <em>their</em> code is important. And if everything is important, then nothing is! How do we get independent widgets to <em>cooperate</em> instead of fighting for resources?</p>
</li>
<li>
<p><strong>Accessibility.</strong> Inaccessible websites are <em>not</em> a niche problem. For example, in UK disability affects 1 in 5 people. <a href="https://www.abrightclearweb.com/web-accessibility-in-the-uk/">(Hereâ€™s a nice infographic.)</a> Iâ€™ve felt this personally too. Though Iâ€™m only 26, I struggle to read websites with thin fonts and low contrast. I try to use the trackpad less often, and I dread the day Iâ€™ll have to navigate poorly implemented websites by keyboard. We need to make our apps not horrible to people with difficulties â€” and the good news is that thereâ€™s a lot of low-hanging fruit. It starts with education and tooling. But we also need to make it easy for product developers to do the right thing. What can we do to make accessibility a <em>default</em> rather than an afterthought?</p>
</li>
<li>
<p><strong>Internationalization.</strong> Our app needs to work all over the world. Not only do people speak different languages, but we also need to support right-to-left layouts with the least amount of effort from product engineers. How do we support different languages without sacrificing latency and responsiveness?</p>
</li>
<li>
<p><strong>Delivery.</strong> We need to get our application code to the userâ€™s computer. What transport and format do we use? This might sound straightforward but there are many tradeoffs here. For example, native apps tend to load all code in advance at the cost of a huge app size. Web apps tend to have smaller initial payload at the cost of more latency during use. How do we choose at which point to introduce latency? How do we optimize our delivery based on the usage patterns? What kind of data would we need for an optimal solution?</p>
</li>
<li>
<p><strong>Resilience.</strong> You might like bugs if youâ€™re an entomologist, but you probably donâ€™t enjoy seeing them in your programs. However, some of your bugs will inevitably get to production. What happens then? Some bugs cause wrong but well-defined behavior. For example, maybe your code displays incorrect visual output under some condition. But what if the rendering code <em>crashes</em>? Then we canâ€™t meaningfully continue because the visual output would be inconsistent. A crash rendering a single post shouldnâ€™t â€œbring downâ€ an entire feed or get it into a semi-broken state that causes further crashes. How do we write code in a way that isolates rendering and fetching failures and keeps the rest of the app running? What does fault tolerance mean for user interfaces?</p>
</li>
<li>
<p><strong>Abstraction.</strong> In a tiny app, we can hardcode a lot of special cases to account for the above problems. But apps tend to grow. We want to be able to <a href="/optimized-for-change/">reuse, fork, and join</a> parts of our code, and work on it collectively. We want to define clear boundaries between the pieces familiar to different people, and avoid making often-changing logic too rigid. How do we create abstractions that hide implementation details of a particular UI part? How do we avoid re-introducing the same problems that we just solved as our app grows?</p>
</li>
</ul>
<hr>
<p>Of course, there are many problems I havenâ€™t mentioned. This list is by no means exhaustive! For example, I havenâ€™t talked about the designer and engineering collaboration, or debugging and testing. Maybe another time.</p>
<p>Itâ€™s tempting to read about these problems with a particular view library or a data fetching library in mind as a solution. But I encourage you to pretend that these libraries donâ€™t exist, and read again from that perspective. How would <em>you</em> approach solving these issues? Give them a try on a tiny app! (Iâ€™d love to see your experiments on GitHub â€” feel free to tweet me in response.)</p>
<p>Whatâ€™s interesting about these problems is that most of them show up at any scale. You can see them both in small widgets like a typeahead or a tooltip, and in huge apps like Twitter and Facebook.</p>
<p><strong>Think of a non-trivial UI element from an app you enjoy using, and go through this list of problems. Can you describe some of the tradeoffs chosen by its developers? Try to recreate a similar behavior from scratch!</strong></p>
<p>I learned a lot about UI engineering by experimenting with these problems in small apps without using libraries. I recommend the same to anyone who wants to gain a deeper appreciation for the tradeoffs in UI engineering.</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[èŠèŠ 2018 å¹´æˆ‘æ‰€ä¸äº†è§£çš„æŠ€æœ¯]]></title>
            <link>/post/things-i-dont-know-as-of-2018-zh</link>
            <guid>/post/things-i-dont-know-as-of-2018-zh</guid>
            <description><![CDATA[æ‰¿è®¤çŸ¥è¯†ç¼ºå£ï¼Œå¹¶ä¸ä¼šä½¿æˆ‘ä»¬çš„çŸ¥è¯†ç»éªŒè´¬å€¼ã€‚]]></description>
            <content:encoded><![CDATA[<p>å¤§å®¶æ€»ä»¥ä¸ºæˆ‘æ‡‚å¾—è®¸å¤šæŠ€æœ¯ï¼Œä½†å®é™…æƒ…å†µå¹¶éå¦‚æ­¤ã€‚æˆ‘ä¸æ˜¯åœ¨æŠ±æ€¨ä»€ä¹ˆï¼Œè¿™ä¹Ÿä¸æ˜¯ä»€ä¹ˆåäº‹ã€‚ ï¼ˆå°½ç®¡å°‘æ•°æ´¾æœ‹å‹ä»¬æœ‰æ¥ä¹‹ä¸æ˜“çš„è¯æ®ï¼Œä½†ä»–ä»¬æ€»æ˜¯å—åˆ°åè§ï¼Œè¿™å°±æ¯”è¾ƒæ¶å¿ƒäº†ã€‚ï¼‰</p>
<p><strong>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†åˆ—å‡ºä¸€ä»½å¤§å®¶ç»å¸¸è¯¯ä»¥ä¸ºæˆ‘å¾ˆäº†è§£çš„ç¼–ç¨‹ä¸»é¢˜åˆ—è¡¨</strong>ã€‚æˆ‘å¹¶ä¸æ˜¯è¯´<em>ä½ </em>ä¸å¿…å­¦ä¹ å®ƒä»¬ - æˆ–è€…æˆ‘ä¸äº†è§£<em>å…¶ä»–</em>æœ‰ç”¨çš„ä¸œè¥¿ã€‚ ä½†ç”±äºæˆ‘ç°åœ¨çš„ç«‹åœºå¹¶ä¸å¼±ï¼Œæ‰€ä»¥æˆ‘å¯ä»¥å¼€è¯šå¸ƒå…¬åœ°è°ˆã€‚</p>
<p>ä»¥ä¸‹æ˜¯æˆ‘è®¤ä¸ºè¿™å¾ˆé‡è¦çš„åŸå› ã€‚</p>
<hr>
<p>é¦–å…ˆï¼Œå¤§å®¶æœ‰ä¸ªä¸ç°å®çš„æœŸæœ›ï¼Œè®¤ä¸ºç»éªŒä¸°å¯Œçš„å·¥ç¨‹å¸ˆå°±è¯¥äº†è§£æ‰€åœ¨é¢†åŸŸçš„æ¯ä¸€é¡¹æŠ€æœ¯ã€‚ä½ åº”è¯¥è§è¿‡å›Šæ‹¬äº†ä¸Šç™¾ä¸ªåº“å’Œå·¥å…·çš„ã€Œå­¦ä¹ è·¯çº¿å›¾ã€å§ï¼Ÿå®ƒå¾ˆæœ‰ç”¨ - ä½†ä»¤äººæœ›è€Œå´æ­¥ã€‚</p>
<p>æ›´æœ‰ç”šè€…ï¼Œæ— è®ºä½ ç»éªŒå¤šä¸°å¯Œï¼Œä½ å¯èƒ½è¿˜æ˜¯ä¼šæ—¶è€Œæ„Ÿè§‰è‰¯å¥½ã€æ—¶è€Œä¿¡å¿ƒä¸è¶³ï¼ˆå†’åé¡¶æ›¿ç»¼åˆç—‡ï¼ˆImpostor syndromeï¼‰ï¼‰ï¼Œæ—¶è€Œè¿‡åº¦è‡ªä¿¡ï¼ˆDunning-Kruger æ•ˆåº”ï¼‰ã€‚è¿™å–å†³äºä½ æ‰€å¤„çš„ç¯å¢ƒï¼Œä½ çš„å·¥ä½œï¼Œä¸ªæ€§ï¼Œé˜Ÿå‹ï¼Œç²¾ç¥çŠ¶æ€ï¼Œåšäº‹çš„æ—¶é—´ç­‰ç­‰å› ç´ ã€‚</p>
<p>è€ç»ƒçš„å¼€å‘è€…æœ‰æ—¶ä¼šå…¬å¼€è¡¨ç¤ºä»–ä»¬çš„ä¸å®‰ï¼Œä»¥é¼“åŠ±åˆå­¦è€…ã€‚ä½†å…¶å®äºŒè€…æœ‰å¤©å£¤ä¹‹åˆ«ï¼Œå°±åƒä¸€ä¸ªç»éªŒä¸°å¯Œä½†ä»ä¼šç´§å¼ çš„å¤–ç§‘åŒ»ç”Ÿï¼Œå’Œä¸€ä¸ªç¬¬ä¸€æ¬¡æ‹¿æ‰‹æœ¯åˆ€çš„å­¦ç”Ÿï¼</p>
<p>å¬è§åˆ«äººè¯´ã€Œæˆ‘ä»¬éƒ½æ˜¯åˆçº§å¼€å‘è€…ã€æŒºä¸§çš„ï¼Œå°±åƒæ˜¯å¯¹ç€ä¸ä½ æœ‰çŸ¥è¯†å·®è·çš„å­¦ä¹ è€…ç©ºè°ˆã€‚åƒæˆ‘è¿™æ ·å–„æ„çš„ä»ä¸šè€…ä¹Ÿå¹¶ä¸èƒ½ç”¨å¤šå¥½çš„å£è¿°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>å°½ç®¡å¦‚æ­¤ï¼Œå³ä½¿æ˜¯ç»éªŒä¸°å¯Œçš„å·¥ç¨‹å¸ˆä¹Ÿå­˜åœ¨è®¸å¤šçŸ¥è¯†ç¼ºå£ã€‚è¿™ç¯‡æ–‡ç« å†™äº†æˆ‘çš„çŸ¥è¯†ç¼ºå£ï¼Œæˆ‘é¼“åŠ±é‚£äº›èƒ½å¤Ÿæ¥å—ç±»ä¼¼ä¸è¶³çš„å·¥ç¨‹å¸ˆä»¬åˆ†äº«ä½ ä»¬çš„ç»éªŒè§è§£ã€‚ä½†åˆ†äº«çš„æ—¶å€™ï¼Œè®°ä½ä¸è¦ä½ä¼°æˆ‘ä»¬çš„ä»·å€¼ã€‚</p>
<p><strong>æˆ‘ä»¬å¯ä»¥å¤§æ–¹æ‰¿è®¤æˆ‘ä»¬çš„çŸ¥è¯†ç¼ºå£ï¼Œä½†ä¹Ÿè¦è®°å¾—æˆ‘ä»¬ä»ç„¶æ‹¥æœ‰å®è´µçš„ä¸“ä¸šçŸ¥è¯†ï¼Œè¿™äº›éœ€è¦å¤šå¹´åŠªåŠ›ç§¯ç´¯æ‰èƒ½è·å¾—ã€‚</strong></p>
<hr>
<p>å…ˆè¯´å¥½å…è´£å£°æ˜ï¼Œä»¥ä¸‹æ˜¯æˆ‘ä¸äº†è§£çš„ä¸€äº›ä¸œè¥¿ï¼š</p>
<ul>
<li>
<p><strong>Unix å‘½ä»¤å’Œ Bashï¼ˆUnix commands and Bashï¼‰</strong> æˆ‘è®°å¾— <code>ls</code> å’Œ <code>cd</code>, ä½†å…¶ä»–å‘½ä»¤æˆ‘ä¹Ÿå¾—æŸ¥äº†æ‰ä¼šç”¨ã€‚æˆ‘ç†è§£ç®¡é“ï¼ˆpipingï¼‰çš„æ¦‚å¿µï¼Œä½†æˆ‘åªåœ¨ç®€å•çš„åœºæ™¯ä¸‹ä½¿ç”¨å®ƒã€‚æˆ‘ä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨ <code>xargs</code> åˆ›å»ºå¤æ‚çš„é“¾ï¼ˆchainï¼‰ï¼Œå¦‚ä½•ç»„åˆå¹¶é‡å®šå‘ä¸åŒçš„è¾“å‡ºæµã€‚æˆ‘ä¹Ÿä»æ¥æ²¡æœ‰ç³»ç»Ÿåœ°å­¦ä¹ è¿‡ Bashï¼Œæ‰€ä»¥æˆ‘åªèƒ½ç¼–å†™éå¸¸ç®€å•ï¼ˆé€šå¸¸æ˜¯é”™è¯¯çš„ï¼‰shell è„šæœ¬ã€‚</p>
</li>
<li>
<p><strong>ä½çº§è¯­è¨€ï¼ˆLow-level languagesï¼‰</strong> æˆ‘çŸ¥é“ Assembly èƒ½å°†å†…å®¹å­˜å‚¨åœ¨å†…å­˜ä¸­å¹¶è·³è½¬æ‰§è¡Œä»£ç ï¼Œä½†æˆ‘äº†è§£çš„ä»…æ­¤è€Œå·²ã€‚æˆ‘å†™è¿‡å‡ è¡Œ Cï¼Œæ˜ç™½æŒ‡é’ˆæ˜¯ä»€ä¹ˆï¼Œä½†æˆ‘ä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨ <code>malloc</code> æˆ–å…¶ä»–æ‰‹åŠ¨å†…å­˜ç®¡ç†æŠ€æœ¯ã€‚ä»æ¥æ²¡ç©è¿‡ Rustã€‚</p>
</li>
<li>
<p><strong>ç½‘ç»œå †æ ˆï¼ˆNetworking stackï¼‰</strong> æˆ‘çŸ¥é“è®¡ç®—æœºæœ‰ IP åœ°å€ï¼ŒDNS æ˜¯æˆ‘ä»¬è§£æä¸»æœºåï¼ˆhostnameï¼‰çš„æ–¹å¼ã€‚æˆ‘çŸ¥é“æœ‰åƒ TCP/IP è¿™æ ·çš„ä½çº§åè®®æ¥äº¤æ¢æ•°æ®åŒ…ï¼ˆå¯èƒ½ï¼Ÿï¼‰ä»¥ç¡®ä¿å®Œæ•´æ€§ã€‚æˆ‘å°±çŸ¥é“è¿™ä¹ˆå¤š - å¹¶ä¸”å¯¹ç»†èŠ‚è®¤è¯†æ¯”è¾ƒæ¨¡ç³Šã€‚</p>
</li>
<li>
<p><strong>å®¹å™¨ï¼ˆContainersï¼‰</strong> æˆ‘ä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨ Docker æˆ– Kubernetesã€‚ ï¼ˆå®ƒä»¬æœ‰å…³ç³»å—ï¼Ÿï¼‰æˆ‘å¯¹å®ƒä»¬ä¸€ä¸ªæ¨¡ç³Šçš„è®¤çŸ¥ï¼ŒçŸ¥é“å®ƒä»¬èƒ½è®©æˆ‘ä»¥å¯é çš„æ–¹å¼å¯åŠ¨ä¸€ä¸ªå•ç‹¬çš„ VMã€‚å¬èµ·æ¥å¾ˆé…·ï¼Œä½†æˆ‘è¿˜æ²¡è¯•è¿‡ã€‚</p>
</li>
<li>
<p><strong>æ— æœåŠ¡ï¼ˆServerlessï¼‰</strong> å¬èµ·æ¥ä¹Ÿå¾ˆé…·ï¼Œä½†æ²¡è¯•è¿‡ã€‚æˆ‘ä¸æ˜¯å¾ˆæ˜ç™½è¯¥æ¨¡å‹å¦‚ä½•æ”¹å˜äº†åç«¯ç¼–ç¨‹ï¼ˆä¹Ÿè®¸å®ƒå¹¶æ²¡æœ‰ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å¾®æœåŠ¡ï¼ˆMicroservicesï¼‰</strong> å¦‚æœæˆ‘ç†è§£æ²¡é”™çš„è¯ï¼Œå®ƒåªæ˜¯æ„å‘³ç€ã€Œè®¸å¤š API endpoints é—´ç›¸äº’é€šä¿¡ã€ã€‚æˆ‘ä¸çŸ¥é“è¿™ç§æ–¹æ³•çš„å®é™…ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Œå› ä¸ºæˆ‘æ²¡ç”¨è¿‡ã€‚</p>
</li>
<li>
<p><strong>Python.</strong> æˆ‘ä¸æ˜¯å¾ˆå–œæ¬¢å®ƒ- æˆ‘<em>å·²ç»</em>ç”¨ Python å·¥ä½œäº†å¥½å¤šå¹´ï¼Œè€Œä¸”æˆ‘ä»æ¥æ²¡æœ‰è´¹å¿ƒåŠ›å»å­¦å®ƒã€‚å®ƒçš„å¯¼å…¥ï¼ˆimportï¼‰è¡Œä¸ºç­‰å¾ˆå¤šä¸œè¥¿å¯¹æˆ‘æ¥è¯´æ˜¯å®Œå…¨çš„é»‘ç›’ã€‚</p>
</li>
<li>
<p><strong>Node åç«¯ï¼ˆNode backendsï¼‰</strong> æˆ‘çŸ¥é“å¦‚ä½•è¿è¡Œ Nodeï¼Œä½¿ç”¨åƒ <code>fs</code> è¿™æ ·çš„ API æ¥æ„å»ºå·¥å…·ï¼Œå¹¶ä¸”èƒ½ä½¿ç”¨ Expressã€‚ä½†æˆ‘ä»æ¥æ²¡æœ‰ç”¨ Node è¿æ¥è¿‡æ•°æ®åº“ï¼Œä¹Ÿä¸çŸ¥é“å¦‚ä½•ç”¨å®ƒç¼–å†™åç«¯ã€‚æˆ‘ä¹Ÿä¸ç†Ÿæ‚‰åƒ Next è¿™æ ·èƒ½å®ç°ã€Œhello worldã€çš„ React æ¡†æ¶ã€‚</p>
</li>
<li>
<p><strong>åŸç”Ÿå¹³å°ï¼ˆNative platformsï¼‰</strong> æˆ‘æ›¾å°è¯•å­¦è¿‡ Objective C ä½†æ˜¯æ²¡æœ‰æˆåŠŸã€‚æˆ‘ä¹Ÿæ²¡æœ‰å­¦è¿‡ Swift, Java ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ï¼ˆè™½ç„¶æˆ‘å¯ä»¥å­¦ä¹  Javaï¼Œå› ä¸ºæˆ‘ä¼š C#, ä½†æ˜¯æˆ‘å¹¶æ²¡æœ‰å­¦ä¹ å®ƒï¼‰ã€‚</p>
</li>
<li>
<p><strong>ç®—æ³•ï¼ˆAlgorithmsï¼‰</strong> æˆ‘ä¼šçš„æœ€å¤šå°±åªæœ‰å†’æ³¡æ’åºä»¥åŠå¿«æ’äº†ã€‚å¦‚æœå®ƒä»¬ä¸ç‰¹å®šçš„å®é™…é—®é¢˜è”ç³»åœ¨ä¸€èµ·ï¼Œæˆ‘èƒ½è¿›è¡Œç®€å•çš„å›¾å½¢éå†ã€‚æˆ‘ç†è§£ O(n) ç¬¦å·ï¼Œä½†æˆ‘çš„ç†è§£å¹¶ä¸æ¯”ã€Œä¸è¦åœ¨å¾ªç¯ä¸­åµŒå¥—å¾ªç¯ã€æ·±åˆ»å¤šå°‘ã€‚</p>
</li>
<li>
<p><strong>å‡½æ•°å¼è¯­è¨€ï¼ˆFunctional languagesï¼‰</strong> é™¤éç®—ä¸Š JavaScriptï¼Œå¦åˆ™æˆ‘ä¸ä¼šæµç•…çš„ä½¿ç”¨ä»»ä½•ä¼ ç»Ÿå‡½æ•°å¼è¯­è¨€ã€‚ ï¼ˆæˆ‘åªç²¾é€š C# å’Œ JavaScript - C# çš„çŸ¥è¯†æˆ‘å·®ä¸å¤šéƒ½å¿˜äº†ï¼‰ã€‚é˜…è¯» LISP é£æ ¼ï¼ˆå¦‚ Clojureï¼‰ï¼ŒHaskell é£æ ¼ï¼ˆå¦‚ Elmï¼‰æˆ– ML é£æ ¼ï¼ˆå¦‚ OCamlï¼‰çš„ä»£ç ä¹Ÿè®©æˆ‘è§‰å¾—åƒåŠ›ã€‚</p>
</li>
<li>
<p><strong>å‡½æ•°å¼æœ¯è¯­ï¼ˆFunctional terminologyï¼‰</strong> å°±æˆ‘è€Œè¨€ï¼ŒMap å’Œ reduce æ˜¯æœ€é‡è¦çš„ã€‚æˆ‘ä¸äº†è§£ monoidsï¼Œfunctors ç­‰ã€‚æˆ‘çŸ¥é“ monad æ˜¯ä»€ä¹ˆï¼ˆä½†ä¹Ÿè®¸æ˜¯æˆ‘çš„å¹»è§‰å§ ğŸ¤£ï¼‰ã€‚</p>
</li>
<li>
<p><strong>Modern CSS.</strong> æˆ‘ä¸äº†è§£ Flexbox æˆ– Gridã€‚Floats æ‰æ˜¯æˆ‘çš„èœã€‚</p>
</li>
<li>
<p><strong>CSS æ–¹æ³•è®ºï¼ˆCSS Methodologiesï¼‰</strong> æˆ‘ç”¨è¿‡ BEMï¼ˆæ„æ€æ˜¯ CSS éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯åŸå§‹çš„ BEMï¼‰ï¼Œä½†æˆ‘å°±çŸ¥é“è¿™ä¹ˆå¤šäº†ã€‚æˆ‘æ²¡æœ‰å°è¯•è¿‡ OOCSS æˆ–å…¶ä»–æ–¹æ³•ã€‚</p>
</li>
<li>
<p><strong>SCSS/Sass.</strong> ä»æ¥æ²¡æœ‰å­¦è¿‡ã€‚</p>
</li>
<li>
<p><strong>CORS.</strong> æˆ‘è¶…æ€•è¿™äº›é”™è¯¯ï¼æˆ‘çŸ¥é“å¾—è®¾ç½®ä¸€äº›é¦–éƒ¨å­—æ®µï¼ˆheaderï¼‰æ¥ä¿®å¤å®ƒä»¬ï¼Œä½†è¿‡å»æˆ‘æµªè´¹äº†å‡ ä¸ªå°æ—¶åšè¿™äº‹æƒ…ã€‚</p>
</li>
<li>
<p><strong>HTTPS/SSL.</strong> ä»æœªè®¾ç½®è¿‡ã€‚ä»…äº†è§£å…¬é’¥ç§é’¥çš„æ¦‚å¿µï¼Œä¸çŸ¥é“å®ƒä»¬æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚</p>
</li>
<li>
<p><strong>GraphQL.</strong> æˆ‘ä¼šä½¿ç”¨ queryï¼Œä½†æˆ‘çœŸçš„ä¸çŸ¥é“å¦‚ä½•è§£é‡Š node å’Œ edge ç­‰ä¸œè¥¿ï¼Œä½•æ—¶ä½¿ç”¨ fragmentï¼Œä»¥åŠåˆ†é¡µçš„åŸç†ã€‚</p>
</li>
<li>
<p><strong>Sockets.</strong> æˆ‘çš„å¿ƒæ™ºæ¨¡å‹æ˜¯ä»–ä»¬å®ç°äº†è®¡ç®—æœºåœ¨è¯·æ±‚/å“åº”æ¨¡å‹ï¼ˆrequest/response modelï¼‰ä¹‹å¤–äº’è”ï¼Œä½†æˆ‘å°±çŸ¥é“è¿™ä¹ˆå¤šã€‚</p>
</li>
<li>
<p><strong>Streams.</strong> é™¤äº† Rx Observables ä¹‹å¤–ï¼Œæˆ‘è¿˜æ²¡æœ‰å¯†åˆ‡å…³æ³¨è¿‡ streamã€‚æˆ‘ä½¿ç”¨ä¸€ä¸¤æ¬¡æ—§çš„ node æµï¼Œä½†æ€»æ˜¯æä¹±é”™è¯¯å¤„ç†ã€‚</p>
</li>
<li>
<p><strong>Electron.</strong> æ²¡è¯•è¿‡ã€‚</p>
</li>
<li>
<p><strong>TypeScript.</strong> æˆ‘ç†è§£ç±»å‹ï¼ˆtypesï¼‰çš„æ¦‚å¿µï¼Œå¯ä»¥çœ‹æ‡‚æ³¨é‡Šï¼Œä½†ä»æ¥æ²¡æœ‰å†™è¿‡å®ƒã€‚æˆ‘è¯•è¿‡å‡ æ¬¡ï¼Œé‡åˆ°äº†å›°éš¾ã€‚</p>
</li>
<li>
<p><strong>éƒ¨ç½²å’Œ DevOpsï¼ˆDeployment and devopsï¼‰</strong> æˆ‘å¯ä»¥é€šè¿‡ FTP å‘é€æ–‡ä»¶æˆ–æ€æ­»è¿›ç¨‹ï¼Œä½†æˆ‘çš„ devops æŠ€èƒ½ä»…é™äºæ­¤ã€‚</p>
</li>
<li>
<p><strong>å›¾å½¢ï¼ˆGraphicsï¼‰</strong> æ— è®ºæ˜¯ canvasï¼ŒSVGï¼ŒWebGL è¿˜æ˜¯ä½çº§å›¾å½¢ï¼Œæˆ‘éƒ½æ²¡æœ‰é«˜æ•ˆä½¿ç”¨è¿‡ã€‚æˆ‘äº†è§£æ•´ä½“æƒ³æ³•ï¼Œä½†éœ€è¦å­¦ä¹ åŸè¯­ï¼ˆprimitivesï¼‰ã€‚</p>
</li>
</ul>
<p>å½“ç„¶ï¼Œè¿™ä»½æ¸…å•å¹¶éè¯¦å°½æ— é—ã€‚ æˆ‘ä¸çŸ¥é“çš„è¿˜å¤šç€å‘¢ã€‚</p>
<hr>
<p>è®¨è®ºè¿™äº›å¯èƒ½çœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼Œç”šè‡³è¿™ç¯‡æ–‡ç« éƒ½å†™å¾—æœ‰é—®é¢˜ã€‚ æˆ‘å¹å˜˜è‡ªå·±çš„æ— çŸ¥å—ï¼Ÿä¸ï¼Œæˆ‘æƒ³è¡¨è¾¾çš„æ˜¯ï¼š</p>
<ul>
<li>
<p><strong>å³ä½¿æ˜¯ä½ æœ€å–œæ¬¢çš„å¼€å‘è€…ä¹Ÿå¯èƒ½ä¸çŸ¥é“å¾ˆå¤šä½ çŸ¥é“çš„ä¸œè¥¿ã€‚</strong></p>
</li>
<li>
<p><strong>æ— è®ºä½ çš„çŸ¥è¯†æ°´å¹³å¦‚ä½•ï¼Œä¸åŒæ—¶æœŸä½ çš„ä¿¡å¿ƒéƒ½ä¼šæœ‰å¾ˆå¤§å·®å¼‚ã€‚</strong></p>
</li>
<li>
<p><strong>å°½ç®¡å­˜åœ¨çŸ¥è¯†ç¼ºå£ï¼Œä½†ç»éªŒä¸°å¯Œçš„å¼€å‘è€…æœ¯ä¸šæœ‰ä¸“æ”»ã€‚</strong></p>
</li>
</ul>
<p>æˆ‘çŸ¥é“æˆ‘çš„çŸ¥è¯†ç¼ºå£ï¼ˆè‡³å°‘æ˜¯ä¸€éƒ¨åˆ†ï¼‰ã€‚ å¦‚æœæˆ‘å¯¹æŸä¸ªæŠ€æœ¯æ„Ÿåˆ°å¥½å¥‡ï¼Œæˆ–è€…é¡¹ç›®éœ€è¦ç”¨åˆ°ï¼Œæˆ‘ä¹‹åå¯ä»¥å­¦ä¹ å®ƒã€‚</p>
<p>è¿™ä¸ä¼šä½¿æˆ‘çš„çŸ¥è¯†ç»éªŒè´¬å€¼ã€‚ æˆ‘å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ã€‚ ä¾‹å¦‚ï¼Œåœ¨éœ€è¦çš„æ—¶å€™å†å»å­¦å®ƒã€‚</p>
<blockquote>
<p>æ›´æ–°: åœ¨ <a href="/the-elements-of-ui-engineering/">UI å·¥ç¨‹çš„å…ƒç´ </a>ä¸­ï¼Œæˆ‘å†™äº†ä¸€äº›æˆ‘æŒæ¡çš„æŠ€æœ¯ã€‚</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Things I Donâ€™t Know as of 2018]]></title>
            <link>/post/things-i-dont-know-as-of-2018</link>
            <guid>/post/things-i-dont-know-as-of-2018</guid>
            <description><![CDATA[We can admit our knowledge gaps without devaluing our expertise.]]></description>
            <content:encoded><![CDATA[<p>People often assume that I know far more than I actually do. Thatâ€™s not a bad problem to have and Iâ€™m not complaining. (Folks from minority groups often suffer the opposite bias despite their hard-earned credentials, and that <em>sucks</em>.)</p>
<p><strong>In this post Iâ€™ll offer an incomplete list of programming topics that people often wrongly assume that I know.</strong> Iâ€™m not saying <em>you</em> donâ€™t need to learn them â€” or that I donâ€™t know <em>other</em> useful things. But since Iâ€™m not in a vulnerable position myself right now, I can be honest about this.</p>
<p>Hereâ€™s why I think itâ€™s important.</p>
<hr>
<p>First, there is often an unrealistic expectation that an experienced engineer knows every technology in their field. Have you seen a â€œlearning roadmapâ€ that consists of a hundred libraries and tools? Itâ€™s useful â€” but intimidating.</p>
<p>Whatâ€™s more, no matter how experienced you get, you may still find yourself switching between feeling capable, inadequate (â€œImpostor syndromeâ€), and overconfident (â€œDunningâ€“Kruger effectâ€). It depends on your environment, job, personality, teammates, mental state, time of day, and so on.</p>
<p>Experienced developers sometimes open up about their insecurities to encourage beginners. But thereâ€™s a world of difference between a seasoned surgeon who still gets the jitters and a student holding their first scalpel!</p>
<p>Hearing how â€œweâ€™re all junior developersâ€ can be disheartening and sound like empty talk to the learners faced with an actual gap in knowledge. Feel-good confessions from well-intentioned practitioners like me canâ€™t bridge it.</p>
<p>Still, even experienced engineers have many knowledge gaps. This post is about mine, and I encourage those who can afford similar vulnerability to share their own. But letâ€™s not devalue our experience while we do that.</p>
<p><strong>We can admit our knowledge gaps, may or may not feel like impostors, and still have deeply valuable expertise that takes years of hard work to develop.</strong></p>
<hr>
<p>With that disclaimer out of the way, hereâ€™s just a few things I donâ€™t know:</p>
<ul>
<li>
<p><strong>Unix commands and Bash.</strong> I can <code>ls</code> and <code>cd</code> but I look up everything else. I get the concept of piping but Iâ€™ve only used it in simple cases. I donâ€™t know how to use <code>xargs</code> to create complex chains, or how to compose and redirect different output streams. I also never properly learned Bash so I can only write very simple (and often buggy) shell scripts.</p>
</li>
<li>
<p><strong>Low-level languages.</strong> I understand Assembly lets you store things in memory and jump around the code but thatâ€™s about it. I wrote a few lines of C and understand what a pointer is, but I donâ€™t know how to use <code>malloc</code> or other manual memory management techniques. Never played with Rust.</p>
</li>
<li>
<p><strong>Networking stack.</strong> I know computers have IP addresses, and DNS is how we resolve hostnames. I know thereâ€™s low level protocols like TCP/IP to exchange packets that (maybe?) ensure integrity. Thatâ€™s it â€” Iâ€™m fuzzy on details.</p>
</li>
<li>
<p><strong>Containers.</strong> I have no idea about how to use Docker or Kubernetes. (Are those related?) I have a vague idea that they let me spin up a separate VM in a predictable way. Sounds cool but I havenâ€™t tried it.</p>
</li>
<li>
<p><strong>Serverless.</strong> Also sounds cool. Never tried it. I donâ€™t have a clear idea of how that model changes backend programming (if it does at all).</p>
</li>
<li>
<p><strong>Microservices.</strong> If I understand correctly, this just means â€œmany API endpoints talking to each otherâ€. I donâ€™t know what the practical advantages or downsides of this approach are because I havenâ€™t worked with it.</p>
</li>
<li>
<p><strong>Python.</strong> I feel bad about this one â€” I <em>have</em> worked with Python for several years at some point and Iâ€™ve never bothered to actually learn it. There are many things there like import behavior that are completely opaque to me.</p>
</li>
<li>
<p><strong>Node backends.</strong> I understand how to run Node, used some APIs like <code>fs</code> for build tooling, and can set up Express. But Iâ€™ve never talked from Node to a database and donâ€™t really know how to write a backend in it. Iâ€™m also not familiar with React frameworks like Next beyond a â€œhello worldâ€.</p>
</li>
<li>
<p><strong>Native platforms.</strong> I tried learning Objective C at some point but it didnâ€™t work out. I havenâ€™t learned Swift either. Same about Java. (I could probably pick it up though since I worked with C#.)</p>
</li>
<li>
<p><strong>Algorithms.</strong> The most youâ€™ll get out of me is bubble sort and maybe quicksort on a good day. I can probably do simple graph traversing tasks if theyâ€™re tied to a particular practical problem. I understand the O(n) notation but my understanding isnâ€™t much deeper than â€œdonâ€™t put loops inside loopsâ€.</p>
</li>
<li>
<p><strong>Functional languages.</strong> Unless you count JavaScript, Iâ€™m not fluent in any traditionally functional language. (Iâ€™m only fluent in C# and JavaScript â€” and I already forgot most of C#.) I struggle to read either LISP-inspired (like Clojure), Haskell-inspired (like Elm), or ML-inspired (like OCaml) code.</p>
</li>
<li>
<p><strong>Functional terminology.</strong> Map and reduce is as far as I go. I donâ€™t know monoids, functors, etc. I know what a monad is but maybe thatâ€™s an illusion.</p>
</li>
<li>
<p><strong>Modern CSS.</strong> I donâ€™t know Flexbox or Grid. Floats are my jam.</p>
</li>
<li>
<p><strong>CSS Methodologies.</strong> I used BEM (meaning the CSS part, not the original BEM) but thatâ€™s all I know. I havenâ€™t tried OOCSS or other methodologies.</p>
</li>
<li>
<p><strong>SCSS / Sass.</strong> Never got to learn them.</p>
</li>
<li>
<p><strong>CORS.</strong> I dread these errors! I know I need to set up some headers to fix them but Iâ€™ve wasted hours here in the past.</p>
</li>
<li>
<p><strong>HTTPS / SSL.</strong> Never set it up. Donâ€™t know how it works beyond the idea of private and public keys.</p>
</li>
<li>
<p><strong>GraphQL.</strong> I can read a query but I donâ€™t really know how to express stuff with nodes and edges, when to use fragments, and how pagination works there.</p>
</li>
<li>
<p><strong>Sockets.</strong> My mental model is they let computers talk to each other outside the request/response model but thatâ€™s about all I know.</p>
</li>
<li>
<p><strong>Streams.</strong> Aside from Rx Observables, I havenâ€™t worked with streams closely. I used old Node streams one or two times but always messed up error handling.</p>
</li>
<li>
<p><strong>Electron.</strong> Never tried it.</p>
</li>
<li>
<p><strong>TypeScript.</strong> I understand the concept of types and can read annotations but Iâ€™ve never written it. The few times I tried, I ran into difficulties.</p>
</li>
<li>
<p><strong>Deployment and devops.</strong> I can manage to send some files over FTP or kill some processes but thatâ€™s the limit of my devops skills.</p>
</li>
<li>
<p><strong>Graphics.</strong> Whether itâ€™s canvas, SVG, WebGL or low-level graphics, Iâ€™m not productive in it. I get the overall idea but Iâ€™d need to learn the primitives.</p>
</li>
</ul>
<p>Of course this list is not exhaustive. There are many things that I donâ€™t know.</p>
<hr>
<p>It might seem like a strange thing to discuss. It even feels wrong to write it. Am I boasting of my ignorance? My intended takeaway from this post is that:</p>
<ul>
<li>
<p><strong>Even your favorite developers may not know many things that you know.</strong></p>
</li>
<li>
<p><strong>Regardless of your knowledge level, your confidence can vary greatly.</strong></p>
</li>
<li>
<p><strong>Experienced developers have valuable expertise despite knowledge gaps.</strong></p>
</li>
</ul>
<p>Iâ€™m aware of my knowledge gaps (at least, some of them). I can fill them in later if I become curious or if I need them for a project.</p>
<p>This doesnâ€™t devalue my knowledge and experience. Thereâ€™s plenty of things that I can do well. For example, learning technologies when I need them.</p>
<blockquote>
<p>Update: I also <a href="/the-elements-of-ui-engineering/">wrote</a> about a few things that I know.</p>
</blockquote>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Why Do React Hooks Rely on Call Order?]]></title>
            <link>/post/why-do-hooks-rely-on-call-order</link>
            <guid>/post/why-do-hooks-rely-on-call-order</guid>
            <description><![CDATA[Lessons learned from mixins, render props, HOCs, and classes.]]></description>
            <content:encoded><![CDATA[<p>At React Conf 2018, the React team presented the <a href="https://reactjs.org/docs/hooks-intro.html">Hooks proposal</a>.</p>
<p>If youâ€™d like to understand what Hooks are and what problems they solve, check out <a href="https://www.youtube.com/watch?v=dpw9EHDh2bM">our talks</a> introducing them and <a href="https://medium.com/@dan_abramov/making-sense-of-react-hooks-fdbde8803889">my follow-up article</a> addressing common misconceptions.</p>
<p>Chances are you wonâ€™t like Hooks at first:</p>
<p><img src="./hooks-hn1.png" alt="Negative HN comment"></p>
<p>Theyâ€™re like a music record that grows on you only after a few good listens:</p>
<p><img src="./hooks-hn2.png" alt="Positive HN comment from the same person four days later"></p>
<p>When you read the docs, donâ€™t miss <a href="https://reactjs.org/docs/hooks-custom.html">the most important page</a> about building your own Hooks! Too many people get fixated on some part of our messaging they disagree with (e.g. that learning classes is difficult) and miss the bigger picture behind Hooks. And the bigger picture is that <strong>Hooks are like <em>functional mixins</em> that let you create and compose your own abstractions.</strong></p>
<p>Hooks <a href="https://reactjs.org/docs/hooks-faq.html#what-is-the-prior-art-for-hooks">are influenced by some prior art</a> but I havenâ€™t seen anything <em>quite</em> like them until Sebastian shared his idea with the team. Unfortunately, itâ€™s easy to overlook the connection between the specific API choices and the valuable properties unlocked by this design. With this post I hope to help more people understand the rationale for the most controversial aspect of Hooks proposal.</p>
<p><strong>The rest of this post assumes you know the <code>useState()</code> Hook API and how to write a custom Hook. If you donâ€™t, check out the earlier links. Also, keep in mind Hooks are experimental and you donâ€™t have to learn them right now!</strong></p>
<p>(Disclaimer: this is a personal post and doesnâ€™t necessarily reflect the opinions of the React team. Itâ€™s large, the topic is complex, and I may have made mistakes somewhere.)</p>
<hr>
<p>The first and probably the biggest shock when you learn about Hooks is that they rely on <em>persistent call index between re-renders</em>. This has some <a href="https://reactjs.org/docs/hooks-rules.html">implications</a>.</p>
<p>This decision is obviously controversial. This is why, <a href="https://www.reddit.com/r/reactjs/comments/9xs2r6/sebmarkbages_response_to_hooks_rfc_feedback/e9wh4um/">against our principles</a>, we only published this proposal after we felt the documentation and talks describe it well enough for people to give it a fair chance.</p>
<p><strong>If youâ€™re concerned about some aspects of the Hooks API design, I encourage you to read Sebastianâ€™s <a href="https://github.com/reactjs/rfcs/pull/68#issuecomment-439314884">full response</a> to the 1,000+ comment RFC discussion.</strong> It is thorough but also quite dense. I could probably turn every paragraph of this comment into its own blog post. (In fact, I already <a href="/how-does-setstate-know-what-to-do/">did</a> that once!)</p>
<p>There is one specific part that Iâ€™d like to focus on today. As you may recall, each Hook can be used in a component more than once. For example, we can declare <a href="https://reactjs.org/docs/hooks-state.html#tip-using-multiple-state-variables">multiple state variables</a> by calling <code>useState()</code> repeatedly:</p>
<pre data-line="2,3,4,"  2,3,4="" class="language-jsx"><code 2,3,4="" class="language-jsx">function Form() {
  const [name, setName] = useState('Mary'); // State variable 1
  const [surname, setSurname] = useState('Poppins'); // State variable 2
  const [width, setWidth] = useState(window.innerWidth); // State variable 3

  useEffect(() =&gt; {
    const handleResize = () =&gt; setWidth(window.innerWidth);
    window.addEventListener('resize', handleResize);
    return () =&gt; window.removeEventListener('resize', handleResize);
  });

  function handleNameChange(e) {
    setName(e.target.value);
  }

  function handleSurnameChange(e) {
    setSurname(e.target.value);
  }

  return (
    &lt;&gt;
      &lt;input value={name} onChange={handleNameChange} /&gt;
      &lt;input value={surname} onChange={handleSurnameChange} /&gt;
      &lt;p&gt;
        Hello, {name} {surname}
      &lt;/p&gt;
      &lt;p&gt;Window width: {width}&lt;/p&gt;
    &lt;/&gt;
  );
}
</code></pre><p>Note that we use array destructuring syntax to name <code>useState()</code> state variables but these names are not passed to React. Instead, in this example <strong>React treats <code>name</code> as â€œthe first state variableâ€, <code>surname</code> as â€œthe second state variableâ€, and so on</strong>. Their <em>call index</em> is what gives them a stable identity between re-renders. This mental model is well-described <a href="https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e">in this article</a>.</p>
<p>On a surface level, relying on the call index just <em>feels wrong</em>. A gut feeling is a useful signal but it can be misleading â€” especially if we havenâ€™t fully internalized the problem weâ€™re solving. <strong>In this post, Iâ€™ll take a few commonly suggested alternative designs for Hooks and show where they break down.</strong></p>
<hr>
<p>This post wonâ€™t be exhaustive. Depending on how granular youâ€™re counting, weâ€™ve seen from a dozen to <em>hundreds</em> of different alternative proposals. Weâ€™ve also been <a href="https://github.com/reactjs/react-future">thinking</a> about alternative component APIs for the last five years.</p>
<p>Blog posts like this are tricky because even if you cover a hundred alternatives, somebody can tweak one and say: â€œHa, you didnâ€™t think of <em>that</em>!â€</p>
<p>In practice, different alternative proposals tend to overlap in their downsides. Rather than enumerate <em>all</em> the suggested APIs (which would take me months), Iâ€™ll demonstrate the most common flaws with specific examples. Categorizing other possible APIs by these problems could be an exercise to the reader. ğŸ§</p>
<p><em>That is not to say that Hooks are flawless.</em> But once you get familiar with the flaws of other solutions, you might find that the Hooks design makes some sense.</p>
<hr>
<h3>Flaw #1: Canâ€™t Extract a Custom Hook</h3>
<p>Surprisingly, many alternative proposals donâ€™t allow <a href="https://reactjs.org/docs/hooks-custom.html">custom Hooks</a> at all. Perhaps we didnâ€™t emphasize custom Hooks enough in the â€œmotivationâ€ docs. Itâ€™s difficult to do until the primitives are well-understood. So itâ€™s a chicken-and-egg problem. But custom Hooks are largely the point of the proposal.</p>
<p>For example, an alternative banned multiple <code>useState()</code> calls in a component. Youâ€™d keep state in one object. That works for classes, right?</p>
<pre   class="language-jsx"><code class="language-jsx">function Form() {
  const [state, setState] = useState({
    name: 'Mary',
    surname: 'Poppins',
    width: window.innerWidth,
  });
  // ...
}
</code></pre><p>To be clear, Hooks <em>do</em> allow this style. You donâ€™t <em>have to</em> split your state into a bunch of state variables (see our <a href="https://reactjs.org/docs/hooks-faq.html#should-i-use-one-or-many-state-variables">recommendations</a> in the FAQ).</p>
<p>But the point of supporting multiple <code>useState()</code> calls is so that you can <em>extract</em> parts of stateful logic (state + effects) out of your components into custom Hooks which can <em>also</em> independently use local state and effects:</p>
<pre data-line="6-7,"  6-7="" class="language-jsx"><code 6-7="" class="language-jsx">function Form() {
  // Declare some state variables directly in component body
  const [name, setName] = useState('Mary');
  const [surname, setSurname] = useState('Poppins');

  // We moved some state and effects into a custom Hook
  const width = useWindowWidth();
  // ...
}

function useWindowWidth() {
  // Declare some state and effects in a custom Hook
  const [width, setWidth] = useState(window.innerWidth);
  useEffect(() =&gt; {
    // ...
  });
  return width;
}
</code></pre><p>If you only allow one <code>useState()</code> call per component, you lose the ability of custom Hooks to introduce local state. Which is the point of custom Hooks.</p>
<h3>Flaw #2: Name Clashes</h3>
<p>One common suggestion is to let <code>useState()</code> accept a key argument (e.g. a string) that uniquely identifies a particular state variable within a component.</p>
<p>There are a few variations on this idea, but they roughly look like this:</p>
<pre   class="language-jsx"><code class="language-jsx">// âš ï¸ This is NOT the React Hooks API
function Form() {
  // We pass some kind of state key to useState()
  const [name, setName] = useState('name');
  const [surname, setSurname] = useState('surname');
  const [width, setWidth] = useState('width');
  // ...
</code></pre><p>This tries to avoid reliance on the call index (yay explicit keys!) but introduces another problem â€” name clashes.</p>
<p>Granted, you probably wonâ€™t be tempted to call <code>useState('name')</code> twice in the same component except by mistake. This can happen accidentally but we could argue that about any bug. However, itâ€™s quite likely that when you work on a <em>custom Hook</em>, youâ€™ll want to add or remove state variables and effects.</p>
<p>With this proposal, any time you add a new state variable inside a custom Hook, you risk breaking any components that use it (directly or transitively) because <em>they might already use the same name</em> for their own state variables.</p>
<p>This is an example of an API thatâ€™s not <a href="/optimized-for-change/">optimized for change</a>. The current code might always look â€œelegantâ€, but it is very fragile to changes in requirements. We should <a href="https://reactjs.org/blog/2016/07/13/mixins-considered-harmful.html#mixins-cause-name-clashes">learn</a> from our mistakes.</p>
<p>The actual Hooks proposal solves this by relying on the call order: even if two Hooks use a <code>name</code> state variable, they would be isolated from each other. Every <code>useState()</code> call gets its own â€œmemory cellâ€.</p>
<p>There are still a few other ways we could work around this flaw but they also have their own issues. Letâ€™s explore this problem space more closely.</p>
<h3>Flaw #3: Canâ€™t Call the Same Hook Twice</h3>
<p>Another variation of the â€œkeyedâ€ <code>useState</code> proposal is to use something like Symbols. Those canâ€™t clash, right?</p>
<pre   class="language-jsx"><code class="language-jsx">// âš ï¸ This is NOT the React Hooks API
const nameKey = Symbol();
const surnameKey = Symbol();
const widthKey = Symbol();

function Form() {
  // We pass some kind of state key to useState()
  const [name, setName] = useState(nameKey);
  const [surname, setSurname] = useState(surnameKey);
  const [width, setWidth] = useState(widthKey);
  // ...
</code></pre><p>This proposal seems to work for extracting the <code>useWindowWidth()</code> Hook:</p>
<pre data-line="4,11-17,"  4,11-17="" class="language-jsx"><code 4,11-17="" class="language-jsx">// âš ï¸ This is NOT the React Hooks API
function Form() {
  // ...
  const width = useWindowWidth();
  // ...
}

/*********************
 * useWindowWidth.js *
 ********************/
const widthKey = Symbol();

function useWindowWidth() {
  const [width, setWidth] = useState(widthKey);
  // ...
  return width;
}
</code></pre><p>But if we attempt to extract input handling, it would fail:</p>
<pre data-line="4,5,19-29,"  4,5,19-29="" class="language-jsx"><code 4,5,19-29="" class="language-jsx">// âš ï¸ This is NOT the React Hooks API
function Form() {
  // ...
  const name = useFormInput();
  const surname = useFormInput();
  // ...
  return (
    &lt;&gt;
      &lt;input {...name} /&gt;
      &lt;input {...surname} /&gt;
      {/* ... */}
    &lt;/&gt;
  );
}

/*******************
 * useFormInput.js *
 ******************/
const valueKey = Symbol();

function useFormInput() {
  const [value, setValue] = useState(valueKey);
  return {
    value,
    onChange(e) {
      setValue(e.target.value);
    },
  };
}
</code></pre><p>(Iâ€™ll admit this <code>useFormInput()</code> Hook isnâ€™t particularly useful but you could imagine it handling things like validation and dirty state flag a la <a href="https://github.com/jaredpalmer/formik">Formik</a>.)</p>
<p>Can you spot the bug?</p>
<p>Weâ€™re calling <code>useFormInput()</code> twice but our <code>useFormInput()</code> always calls <code>useState()</code> with the same key. So effectively weâ€™re doing something like:</p>
<pre   class="language-jsx"><code class="language-jsx">const [name, setName] = useState(valueKey);
const [surname, setSurname] = useState(valueKey);
</code></pre><p>And this is how we get a clash again.</p>
<p>The actual Hooks proposal doesnâ€™t have this problem because <strong>each <em>call</em> to <code>useState()</code> gets its own isolated state.</strong> Relying on a persistent call index frees us from worrying about name clashes.</p>
<h3>Flaw #4: The Diamond Problem</h3>
<p>This is technically the same flaw as the previous one but itâ€™s worth mentioning for its notoriety. Itâ€™s even <a href="https://en.wikipedia.org/wiki/Multiple_inheritance#The_diamond_problem">described on Wikipedia</a>. (Apparently, itâ€™s sometimes called â€œthe deadly diamond of deathâ€ â€” cool beans.)</p>
<p>Our own mixin system <a href="https://reactjs.org/blog/2016/07/13/mixins-considered-harmful.html#mixins-cause-name-clashes">suffered from it</a>.</p>
<p>Two custom Hooks like <code>useWindowWidth()</code> and <code>useNetworkStatus()</code> might want to use the same custom Hook like <code>useSubscription()</code> under the hood:</p>
<pre data-line="12,23-27,32-42,"  12,23-27,32-42="" class="language-jsx"><code 12,23-27,32-42="" class="language-jsx">function StatusMessage() {
  const width = useWindowWidth();
  const isOnline = useNetworkStatus();
  return (
    &lt;&gt;
      &lt;p&gt;Window width is {width}&lt;/p&gt;
      &lt;p&gt;You are {isOnline ? 'online' : 'offline'}&lt;/p&gt;
    &lt;/&gt;
  );
}

function useSubscription(subscribe, unsubscribe, getValue) {
  const [state, setState] = useState(getValue());
  useEffect(() =&gt; {
    const handleChange = () =&gt; setState(getValue());
    subscribe(handleChange);
    return () =&gt; unsubscribe(handleChange);
  });
  return state;
}

function useWindowWidth() {
  const width = useSubscription(
    handler =&gt; window.addEventListener('resize', handler),
    handler =&gt; window.removeEventListener('resize', handler),
    () =&gt; window.innerWidth,
  );
  return width;
}

function useNetworkStatus() {
  const isOnline = useSubscription(
    handler =&gt; {
      window.addEventListener('online', handler);
      window.addEventListener('offline', handler);
    },
    handler =&gt; {
      window.removeEventListener('online', handler);
      window.removeEventListener('offline', handler);
    },
    () =&gt; navigator.onLine,
  );
  return isOnline;
}
</code></pre><p>This is a completely valid use case. <strong>It should be safe for a custom Hook author to start or stop using another custom Hook without worrying whether it is â€œalready usedâ€ somewhere in the chain.</strong> In fact, <em>you can never know</em> the whole chain unless you audit every component using your Hook on every change.</p>
<p>(As a counterexample, the legacy React <code>createClass()</code> mixins did not let you do this. Sometimes youâ€™d have two mixins that both do exactly what you need but are mutually incompatible due to extending the same â€œbaseâ€ mixin.)</p>
<p>This is our â€œdiamondâ€: ğŸ’</p>
<pre   class="language-javascript"><code class="language-javascript">       / useWindowWidth()   \                   / useState()  ğŸ”´ Clash
Status                        useSubscription()
       \ useNetworkStatus() /                   \ useEffect() ğŸ”´ Clash
</code></pre><p>Reliance on the persistent call order naturally resolves it:</p>
<pre   class="language-javascript"><code class="language-javascript">                                                 / useState()  âœ… #1. State
       / useWindowWidth()   -&gt; useSubscription()
      /                                          \ useEffect() âœ… #2. Effect
Status
      \                                          / useState()  âœ… #3. State
       \ useNetworkStatus() -&gt; useSubscription()
                                                 \ useEffect() âœ… #4. Effect
</code></pre><p>Function calls donâ€™t have a â€œdiamondâ€ problem because they form a tree. ğŸ„</p>
<h3>Flaw #5: Copy Paste Breaks Things</h3>
<p>Maybe we could salvage the keyed state proposal by introducing some sort of namespacing. There are a few different ways to do it.</p>
<p>One way could be to isolate state keys with closures. This would require you to â€œinstantiateâ€ custom Hooks and add a function wrapper around each of them:</p>
<pre data-line="5,6,"  5,6="" class="language-jsx"><code 5,6="" class="language-jsx">/*******************
 * useFormInput.js *
 ******************/
function createUseFormInput() {
  // Unique per instantiation
  const valueKey = Symbol();

  return function useFormInput() {
    const [value, setValue] = useState(valueKey);
    return {
      value,
      onChange(e) {
        setValue(e.target.value);
      },
    };
  };
}
</code></pre><p>This approach is rather heavy-handed. One of the design goals of Hooks is to avoid the deeply nested functional style that is prevalent with higher-order components and render props. Here, we have to â€œinstantiateâ€ <em>any</em> custom Hook before its use â€” and use the resulting function <em>exactly once</em> in the body of a component. This isnâ€™t much simpler than calling Hooks unconditionally.</p>
<p>Additionally, you have to repeat every custom Hook used in a component twice. Once in the top level scope (or inside a function scope if weâ€™re writing a custom Hook), and once at the actual call site. This means you have to jump between the rendering and top-level declarations even for small changes:</p>
<pre data-line="2,3,7,8,"  2,3,7,8="" class="language-jsx"><code 2,3,7,8="" class="language-jsx">// âš ï¸ This is NOT the React Hooks API
const useNameFormInput = createUseFormInput();
const useSurnameFormInput = createUseFormInput();

function Form() {
  // ...
  const name = useNameFormInput();
  const surname = useNameFormInput();
  // ...
}
</code></pre><p>You also need to be very precise with their names. You would always have â€œtwo levelsâ€ of names â€” factories like <code>createUseFormInput</code> and the instantiated Hooks like <code>useNameFormInput</code> and <code>useSurnameFormInput</code>.</p>
<p>If you call the same custom Hook â€œinstanceâ€ twice youâ€™d get a state clash. In fact, the code above has this mistake â€” have you noticed? It should be:</p>
<pre   class="language-jsx"><code class="language-jsx">const name = useNameFormInput();
const surname = useSurnameFormInput(); // Not useNameFormInput!
</code></pre><p>These problems are not insurmountable but I would argue that they add <em>more</em> friction than following the <a href="https://reactjs.org/docs/hooks-rules.html">Rules of Hooks</a>.</p>
<p>Importantly, they break the expectations of copy-paste. Extracting a custom Hook without an extra closure wrapper <em>still works</em> with this approach but only until you call it twice. (Which is when it creates a conflict.) Itâ€™s unfortunate when an API seems to work but then forces you to Wrap All the Thingsâ„¢ï¸ once you realize there is a conflict somewhere deep down the chain.</p>
<h3>Flaw #6: We Still Need a Linter</h3>
<p>There is another way to avoid conflicts with keyed state. If you know about it, you were probably really annoyed I still havenâ€™t acknowledged it! Sorry.</p>
<p>The idea is that we could <em>compose</em> keys every time we write a custom Hook. Something like this:</p>
<pre data-line="4,5,16,17,"  4,5,16,17="" class="language-jsx"><code 4,5,16,17="" class="language-jsx">// âš ï¸ This is NOT the React Hooks API
function Form() {
  // ...
  const name = useFormInput('name');
  const surname = useFormInput('surname');
  // ...
  return (
    &lt;&gt;
      &lt;input {...name} /&gt;
      &lt;input {...surname} /&gt;
      {/* ... */}
    &lt;/&gt;
  );
}

function useFormInput(formInputKey) {
  const [value, setValue] = useState('useFormInput(' + formInputKey + ').value');
  return {
    value,
    onChange(e) {
      setValue(e.target.value);
    },
  };
}
</code></pre><p>Out of different alternatives, I dislike this approach the least. I donâ€™t think itâ€™s worth it though.</p>
<p>Code passing non-unique or badly composed keys would <em>accidentally work</em> until a Hook is called multiple times or clashes with another Hook. Worse, if itâ€™s meant to be conditional (weâ€™re trying to â€œfixâ€ the unconditional call requirement, right?), we might not even encounter the clashes until later.</p>
<p>Remembering to pass keys through all layers of custom Hooks seems fragile enough that weâ€™d want to lint for that. They would add extra work at runtime (donâ€™t forget theyâ€™d need to serve <em>as keys</em>), and each of them is a paper cut for bundle size. <strong>But if we have to lint anyway, what problem did we solve?</strong></p>
<p>This might make sense if conditionally declaring state and effects was very desirable. But in practice I find it confusing. In fact, I donâ€™t recall anyone ever asking to conditionally define <code>this.state</code> or <code>componentDidMount</code> either.</p>
<p>What does this code mean exactly?</p>
<pre data-line="3,4,"  3,4="" class="language-jsx"><code 3,4="" class="language-jsx">// âš ï¸ This is NOT the React Hooks API
function Counter(props) {
  if (props.isActive) {
    const [count, setCount] = useState('count');
    return (
      &lt;p onClick={() =&gt; setCount(count + 1)}&gt;
        {count}
      &lt;/p&gt;;
    );
  }
  return null;
}
</code></pre><p>Is <code>count</code> preserved when <code>props.isActive</code> is <code>false</code>? Or does it get reset because <code>useState('count')</code> wasnâ€™t called?</p>
<p>If conditional state gets preserved, what about an effect?</p>
<pre data-line="5-8,"  5-8="" class="language-jsx"><code 5-8="" class="language-jsx">// âš ï¸ This is NOT the React Hooks API
function Counter(props) {
  if (props.isActive) {
    const [count, setCount] = useState('count');
    useEffect(() =&gt; {
      const id = setInterval(() =&gt; setCount(c =&gt; c + 1), 1000);
      return () =&gt; clearInterval(id);
    }, []);
    return (
      &lt;p onClick={() =&gt; setCount(count + 1)}&gt;
        {count}
      &lt;/p&gt;;
    );
  }
  return null;
}
</code></pre><p>It definitely canâ€™t run <em>before</em> <code>props.isActive</code> is <code>true</code> for the first time. But once it becomes <code>true</code>, does it ever stop running? Does the interval reset when <code>props.isActive</code> flips to <code>false</code>? If it does, itâ€™s confusing that effect behaves differently from state (which we said wouldnâ€™t reset). If the effect keeps running, itâ€™s confusing that <code>if</code> outside the effect doesnâ€™t actually make the effect conditional. Didnâ€™t we say we wanted conditional effects?</p>
<p>If the state <em>does</em> get reset when we donâ€™t â€œuseâ€ it during a render, what happens if multiple <code>if</code> branches contain <code>useState('count')</code> but only one runs at any given time? Is that valid code? If our mental model is a â€œmap with keysâ€, why do things â€œdisappearâ€ from it? Would the developer expect an early <code>return</code> from a component to reset all state after it? If we truly wanted to reset the state, we could make it explicit by extracting a component:</p>
<pre   class="language-jsx"><code class="language-jsx">function Counter(props) {
  if (props.isActive) {
    // Clearly has its own state
    return &lt;TickingCounter /&gt;;
  }
  return null;
}
</code></pre><p>That would probably become the â€œbest practiceâ€ to avoid these confusing questions anyway. So whichever way you choose to answer them, I think the semantics of conditionally <em>declaring</em> state and effects itself end up weird enough that you might want to lint against it.</p>
<p>If we have to lint anyway, the requirement to correctly compose keys becomes â€œdead weightâ€. It doesnâ€™t buy us anything we actually <em>want</em> to do. However, dropping that requirement (and going back to the original proposal) <em>does</em> buy us something. It makes copy-pasting component code into a custom Hook safe without namespacing it, reduces bundle size paper cuts from keys and unlocks a slightly more efficient implementation (no need for Map lookups).</p>
<p>Small things add up.</p>
<h3>Flaw #7: Canâ€™t Pass Values Between Hooks</h3>
<p>One of the best features of Hooks is that you can pass values between them.</p>
<p>Here is a hypothetical example of a message recipient picker that shows whether the currently chosen friend is online:</p>
<pre data-line="8,9,"  8,9="" class="language-jsx"><code 8,9="" class="language-jsx">const friendList = [{ id: 1, name: 'Phoebe' }, { id: 2, name: 'Rachel' }, { id: 3, name: 'Ross' }];

function ChatRecipientPicker() {
  const [recipientID, setRecipientID] = useState(1);
  const isRecipientOnline = useFriendStatus(recipientID);

  return (
    &lt;&gt;
      &lt;Circle color={isRecipientOnline ? 'green' : 'red'} /&gt;
      &lt;select value={recipientID} onChange={e =&gt; setRecipientID(Number(e.target.value))}&gt;
        {friendList.map(friend =&gt; (
          &lt;option key={friend.id} value={friend.id}&gt;
            {friend.name}
          &lt;/option&gt;
        ))}
      &lt;/select&gt;
    &lt;/&gt;
  );
}

function useFriendStatus(friendID) {
  const [isOnline, setIsOnline] = useState(null);
  const handleStatusChange = status =&gt; setIsOnline(status.isOnline);
  useEffect(() =&gt; {
    ChatAPI.subscribeToFriendStatus(friendID, handleStatusChange);
    return () =&gt; {
      ChatAPI.unsubscribeFromFriendStatus(friendID, handleStatusChange);
    };
  });
  return isOnline;
}
</code></pre><p>When you change the recipient, our <code>useFriendStatus()</code> Hook would unsubscribe from the previous friendâ€™s status, and subscribe to the next one.</p>
<p>This works because we can pass the return value of the <code>useState()</code> Hook to the <code>useFriendStatus()</code> Hook:</p>
<pre data-line="2,"  2="" class="language-jsx"><code 2="" class="language-jsx">const [recipientID, setRecipientID] = useState(1);
const isRecipientOnline = useFriendStatus(recipientID);
</code></pre><p>Passing values between Hooks is very powerful. For example, <a href="https://medium.com/@drcmda/hooks-in-react-spring-a-tutorial-c6c436ad7ee4">React Spring</a> lets you create a trailing animation of several values â€œfollowingâ€ each other:</p>
<pre   class="language-jsx"><code class="language-jsx">const [{ pos1 }, set] = useSpring({ pos1: [0, 0], config: fast });
const [{ pos2 }] = useSpring({ pos2: pos1, config: slow });
const [{ pos3 }] = useSpring({ pos3: pos2, config: slow });
</code></pre><p>(Hereâ€™s a <a href="https://codesandbox.io/s/ppxnl191zx">demo</a>.)</p>
<p>Proposals that put Hook initialization into default argument values or that write Hooks in a decorator form make it difficult to express this kind of logic.</p>
<p>If calling Hooks doesnâ€™t happen in the function body, you can no longer easily pass values between them, transform those values without creating many layers of components, or add <code>useMemo()</code> to memoize an intermediate computation. You also canâ€™t easily reference these values in effects because they canâ€™t capture them in a closure. There are ways to work around these issues with some convention but they require you to mentally â€œmatch upâ€ inputs and outputs. This is tricky and violates Reactâ€™s otherwise direct style.</p>
<p>Passing values between Hooks is at the heart of our proposal. Render props pattern was the closest you could get to it without Hooks, but you couldnâ€™t get full benefits without something like <a href="https://ui.reach.tech/component-component">Component Component</a> which has a lot of syntactic noise due to a â€œfalse hierarchyâ€. Hooks flatten that hierarchy to passing values â€” and function calls is the simplest way to do that.</p>
<h3>Flaw #8: Too Much Ceremony</h3>
<p>There are many proposals that fall under this umbrella. Most attempt to avoid the perceived dependency of Hooks on React. There is a wide variety of ways to do it: by making built-in Hooks available on <code>this</code>, making them an extra argument you have to pass through everything, and so on.</p>
<p>I think <a href="https://github.com/reactjs/rfcs/pull/68#issuecomment-439314884">Sebastianâ€™s answer</a> addresses this way better than I could describe so I encourage you to check out its first section (â€œInjection Modelâ€).</p>
<p>Iâ€™ll just say there is a reason programmers tend to prefer <code>try</code> / <code>catch</code> for error handling to passing error codes through every function. Itâ€™s the same reason why we prefer ES Modules with <code>import</code> (or CommonJS <code>require</code>) to AMDâ€™s â€œexplicitâ€ definitions where <code>require</code> is passed to us.</p>
<pre   class="language-jsx"><code class="language-jsx">// Anyone miss AMD?
define(['require', 'dependency1', 'dependency2'], function (require) {
  var dependency1 = require('dependency1'),
  var dependency2 = require('dependency2');
  return function () {};
});
</code></pre><p>Yes, AMD may be more â€œhonestâ€ to the fact that modules arenâ€™t actually synchronously loaded in a browser environment. But once you learn about that, writing the <code>define</code> sandwich becomes a mindless chore.</p>
<p><code>try</code> / <code>catch</code>, <code>require</code>, and React Context API are pragmatic examples of how we want to have some â€œambientâ€ handler available to us instead of explicitly threading it through every level â€” even if in general we value explicitness. I think the same is true for Hooks.</p>
<p>This is similar to how, when we define components, we just grab <code>Component</code> from <code>React</code>. Maybe our code would be more decoupled from React if we exported a factory for every component instead:</p>
<pre   class="language-jsx"><code class="language-jsx">function createModal(React) {
  return class Modal extends React.Component {
    // ...
  };
}
</code></pre><p>But in practice this ends up being just an annoying indirection. When we actually want to stub React with something else, we can always do that at the module system level instead.</p>
<p>The same applies to Hooks. Still, as <a href="https://github.com/reactjs/rfcs/pull/68#issuecomment-439314884">Sebastianâ€™s answer</a> mentions, it is <em>technically possible</em> to â€œredirectâ€ Hooks exported from <code>react</code> to a different implementation. (<a href="/how-does-setstate-know-what-to-do/">One of my previous posts</a> mentions how.)</p>
<p>Another way to impose more ceremony is by making Hooks <a href="https://paulgray.net/an-alternative-design-for-hooks/">monadic</a> or adding a first-class concept like <code>React.createHook()</code>. Aside from the runtime overhead, any solution that adds wrappers loses a huge benefit of using plain functions: <em>they are as easy to debug as it gets</em>.</p>
<p>Plain functions let you step in and out with a debugger without any library code in the middle, and see exactly how values flow inside your component body. Indirections make this difficult. Solutions similar in spirit to either higher-order components (â€œdecoratorâ€ Hooks) or render props (e.g. <code>adopt</code> proposal or <code>yield</code>ing from generators) suffer from the same problem. Indirections also complicate static typing.</p>
<hr>
<p>As I mentioned earlier, this post doesnâ€™t aim to be exhaustive. There are other interesting problems with different proposals. Some of them are more obscure (e.g. related to concurrency or advanced compilation techniques) and might be a topic for another blog post in the future.</p>
<p>Hooks arenâ€™t perfect either, but itâ€™s the best tradeoff we could find for solving these problems. There are things we <a href="https://github.com/reactjs/rfcs/pull/68#issuecomment-440780509">still need to fix</a>, and there exist things that are more awkward with Hooks than classes. That is also a topic for another blog post.</p>
<p>Whether I covered your favorite alternative proposal or not, I hope this writeup helped shed some light on our thinking process and the criteria we consider when choosing an API. As you can see, a lot of it (such as making sure that copy-pasting, moving code, adding and removing dependencies works as expected) has to do with <a href="/optimized-for-change/">optimizing for change</a>. I hope that React users will appreciate these aspects.</p>
]]></content:encoded>
        </item>
    </channel>
</rss>