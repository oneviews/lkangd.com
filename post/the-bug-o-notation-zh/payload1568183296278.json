{"post":{"attributes":{"title":"â€œBug-Oâ€ è¡¨ç¤ºæ³•","date":"2019-01-25","spoiler":"ä½ çš„ API çš„ ğŸ(<i>n</i>) æ˜¯ä»€ä¹ˆï¼Ÿ","featured":true,"link":"/post/the-bug-o-notation-zh","min2read":"â˜•ï¸ 6 min read","wordcount":"1.7k"},"body":"<p>å½“ä½ åœ¨å†™ä¸€äº›å…³ä¹æ€§èƒ½çš„ä»£ç æ—¶ï¼Œæœ€å¥½æ—¶åˆ»æ³¨æ„å®ƒçš„ç®—æ³•å¤æ‚åº¦ã€‚ç®—æ³•å¤æ‚åº¦é€šå¸¸ä¼šç”¨<a href=\"https://rob-bell.net/2009/06/a-beginners-guide-to-big-o-notation/\">å¤§ O è¡¨ç¤ºæ³•</a>æ¥ä½“ç°ã€‚</p>\n<p>å¤§ O è¡¨ç¤ºæ³•æ˜¯ä¸€ç§è¡¡é‡æŒ‡æ ‡ï¼šå½“ä¼ å…¥çš„æ•°æ®è¶Šæ¥è¶Šå¤§æ—¶ï¼Œä½ çš„ä»£ç ä¼šå˜å¾—å¤šæ…¢ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä¸€ä¸ªæ’åºç®—æ³•æœ‰ O(<i>n<sup>2</sup></i>) å¤æ‚åº¦ï¼Œå¯¹åŸæ¥é‡çº§ 50 å€çš„å…ƒç´ æ’åºï¼Œä½ çš„ä»£ç å¤§çº¦ä¼šæ…¢ 50<sup>2</sup> = 2,500 å€ã€‚å¤§ O è¡¨ç¤ºæ³•ä¸ä¼šç»™ä½ ä¸€ä¸ªç¡®åˆ‡çš„æ•°å€¼ï¼Œä½†å®ƒèƒ½è®©ä½ æ›´å¥½åœ°ç†è§£ä½ çš„ç®—æ³•çš„ä¼¸ç¼©æ€§ã€‚</p>\n<p>ä¸€äº›ä¾‹å­ï¼šO(<i>n</i>)ã€O(<i>n</i> log <i>n</i>)ã€O(<i>n<sup>2</sup></i>) å’Œ O(<i>n!</i>)ã€‚</p>\n<p>ç„¶è€Œï¼Œ<strong>è¿™ç¯‡æ–‡ç« ä¸æ˜¯å…³äºç®—æ³•å’Œæ€§èƒ½çš„</strong>ï¼Œè€Œæ˜¯å…³äº APIs å’Œè°ƒè¯•çš„ã€‚äº‹å®è¯æ˜ï¼Œè®¾è®¡ API æ—¶ä¹Ÿéœ€è¦è€ƒè™‘ç±»ä¼¼çš„äº‹æƒ…ã€‚</p>\n<hr>\n<p>æˆ‘ä»¬ç»å¤§å¤šæ•°æ—¶é—´éƒ½åœ¨ä¸ºæˆ‘ä»¬çš„ä»£ç æ‰¾ bug å’Œä¿® bugã€‚å¤§å¤šæ•°å¼€å‘è€…ä¹Ÿå¸Œæœ›èƒ½æ›´å¿«åœ°æ‰¾åˆ° bugã€‚å³ä¾¿æœ€å bug æ‰¾åˆ°äº†ï¼Œèˆ’æœäº†ï¼Œä½†å®ƒä¹Ÿå¯èƒ½æ¶ˆè€—äº†æˆ‘ä»¬ä¸€æ•´å¤©çš„æ—¶é—´ï¼Œæœ‰è¿™ä¸ªæ—¶é—´éƒ½å¤Ÿä½ å®Œæˆå‡ ä¸ª roadmap ä¸Šçš„äº‹æƒ…äº†ã€‚</p>\n<p>è°ƒè¯•çš„ä½“éªŒå—æˆ‘ä»¬é€‰æ‹©çš„æŠ½è±¡ã€åº“å’Œå·¥å…·çš„å½±å“ã€‚æœ‰çš„ API å’Œè¯­è¨€è®¾è®¡å°±èƒ½è®©æˆ‘ä»¬é¿å…ä¸€æ•´ç±»çš„é”™è¯¯ï¼Œä½†æœ‰çš„åˆ™ä¼šåˆ¶é€ æ— å°½çš„éº»çƒ¦ã€‚<strong>ä½†ä½ æ€ä¹ˆåŒºåˆ†å®ƒä»¬å‘¢ï¼Ÿ</strong></p>\n<p>ç½‘ä¸Šè®¸å¤šå…³äº APIs çš„è®¨è®ºéƒ½ä¸»è¦é›†ä¸­åœ¨å®¡ç¾ä¸Šï¼Œä½†é‚£çœŸçš„<a href=\"/optimized-for-change/\">å¯¹å®é™…ä½¿ç”¨å®ƒæ—¶çš„æ„Ÿå—æ²¡æœ‰å¤ªå¤§å½±å“</a>ã€‚</p>\n<p><strong>å…³äºè¿™ä»¶äº‹æœ‰ä¸€ä¸ªè¡¡é‡æŒ‡æ ‡ï¼Œæˆ‘ç§°å®ƒä¸º <em>Bug-O</em> è¡¨ç¤ºæ³•:</strong></p>\n<p><font size=\"40\">ğŸ(<i>n</i>)</font></p>\n<p>å¤§ O è¡¨ç¤ºæ³•æè¿°éšç€æ•°æ®é‡å¢å¤§ï¼Œä½ çš„ç®—æ³•ä¼šå˜å¾—å¤šæ…¢ã€‚<em>Bug-O</em> è¡¨ç¤ºæ³•æè¿°éšç€ä»£ç é‡çš„å¢å¤§ï¼Œè¿™ä¸ª API ä¼šè®©<strong>ä½ </strong>åšä¸€ä»¶äº‹å˜å¾—å¤šæ…¢ã€‚</p>\n<hr>\n<p>æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾ä¸‹é¢çš„ä»£ç æ¯æ¬¡éƒ½é€šè¿‡åƒ <code>node.appendChild()</code> å’Œ <code>node.removeChild()</code> è¿™æ ·å‘½ä»¤å¼çš„æ“ä½œæ¥æ‰‹åŠ¨æ›´æ–° DOMï¼Œå¹¶ä¸”æ²¡æœ‰æ˜ç¡®çš„ç»„ç»‡ç»“æ„ï¼š</p>\n<pre   class=\"language-jsx\"><code class=\"language-jsx\">function trySubmit() {\n  // Section 1\n  let spinner = createSpinner();\n  formStatus.appendChild(spinner);\n  submitForm().then(() =&gt; {\n  \t// Section 2\n    formStatus.removeChild(spinner);\n    let successMessage = createSuccessMessage();\n    formStatus.appendChild(successMessage);\n  }).catch(error =&gt; {\n  \t// Section 3\n    formStatus.removeChild(spinner);\n    let errorMessage = createErrorMessage(error);\n    let retryButton = createRetryButton();\n    formStatus.appendChild(errorMessage);\n    formStatus.appendChild(retryButton)\n    retryButton.addEventListener('click', function() {\n      // Section 4\n      formStatus.removeChild(errorMessage);\n      formStatus.removeChild(retryButton);\n      trySubmit();\n    });\n  })\n}\n</code></pre><p>é—®é¢˜ä¸åœ¨äºä»£ç ä¸‘ä¸ä¸‘ï¼Œæˆ‘ä»¬æš‚ä¸”ä¸è°ˆä»£ç çš„ç¾è§‚æ€§ã€‚<strong>é—®é¢˜æ˜¯å¦‚æœç°åœ¨è¿™ä¸ªä»£ç é‡Œå‡ºç°äº†ä¸€ä¸ª bugï¼Œæˆ‘éƒ½ä¸çŸ¥é“ä»å“ªæŸ¥èµ·ã€‚</strong></p>\n<p>**å–å†³äºå›è°ƒå’Œäº‹ä»¶è§¦å‘çš„é¡ºåºï¼Œæ•´ä¸ªç¨‹åºä¸­ä»£ç è¿è¡Œçš„è·¯å¾„ç»„åˆä¼šéå¸¸å¤šï¼Œ**å…¶ä¸­æœ‰äº›èƒ½äº§ç”Ÿæ­£ç¡®çš„ç»“æœï¼Œæœ‰äº›æˆ‘å¯èƒ½ä¼šçœ‹åˆ°å¤šä¸ªè¿›åº¦æ¡æˆ–è€…ä»€ä¹ˆå¥‡æ€ªçš„ç°è±¡ï¼Œæœ‰çš„æ—¶å€™ç”šè‡³ç¨‹åºç›´æ¥å°±å´©æºƒäº†ã€‚</p>\n<p>è¿™ä¸ªå‡½æ•°æœ‰ 4 ä¸ªä¸åŒçš„éƒ¨åˆ†ï¼Œå¹¶ä¸”é¡ºåºæ²¡æœ‰ä¿è¯ã€‚æ ¹æ®æˆ‘ç²—ç•¥çš„è®¡ç®—ï¼Œå®ƒä»¬çš„è¿è¡Œé¡ºåºå¤§çº¦æœ‰ 4Ã—3Ã—2Ã—1 = 24 ç§ã€‚å¦‚æœæˆ‘ä»¬åœ¨ä»£ç é‡Œå†æ·»åŠ ä¸€äº›ä¸œè¥¿ï¼Œå¯èƒ½ä¼šæœ‰ 8Ã—7Ã—6Ã—5Ã—4Ã—3Ã—2Ã—1 â€” <em>å››ä¸‡</em>å¤šç§ç»„åˆã€‚ä½ å°±æ…¢æ…¢è°ƒè¯•å»å§...</p>\n<p><strong>æ¢å¥è¯è¯´ï¼Œå®ƒçš„ Bug-O æ˜¯ ğŸ(<i>n!</i>)</strong>ï¼Œå…¶ä¸­ <em>n</em> æ˜¯ä¿®æ”¹ DOM çš„ä»£ç ç‰‡æ®µæ•°ã€‚æ˜¯çš„ï¼Œå®ƒæ˜¯é˜¶ä¹˜çº§çš„ã€‚å½“ç„¶ï¼Œæˆ‘è¿™é‡Œå¯èƒ½ä¸æ˜¯å¾ˆä¸¥è°¨ã€‚å®é™…æƒ…å†µä¸‹ä¸æ˜¯æ‰€æœ‰çš„ç»„åˆéƒ½ä¼šå‘ç”Ÿã€‚ä¸è¿‡å¦ä¸€æ–¹é¢ï¼Œè¿™äº›ä»£ç ç‰‡æ®µå¯èƒ½ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Œwhatever... æ€»ä¹‹è¿™ä¸ªä»£ç å°±æ˜¯ä¸æ€ä¹ˆæ ·ï¼Œæˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½ã€‚</p>\n<hr>\n<p>ä¸ºäº†æ”¹è¿›è¿™ä¸ªä»£ç çš„ Bug-Oï¼Œæˆ‘ä»¬å¯ä»¥é™åˆ¶å¯èƒ½çš„çŠ¶æ€å’Œç»“æœæ•°é‡ã€‚æˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨ä»»ä½•åº“ï¼Œåªè¦å¼ºåŒ–ä¸€ä¸‹ä»£ç çš„ç»“æ„ã€‚æ¯”å¦‚è¿™æ ·ï¼š</p>\n<pre   class=\"language-jsx\"><code class=\"language-jsx\">let currentState = {\n  step: 'initial', // 'initial' | 'pending' | 'success' | 'error'\n};\n\nfunction trySubmit() {\n  if (currentState.step === 'pending') {\n    // Don't allow to submit twice\n    return;\n  }\n  setState({ step: 'pending' });\n  submitForm().then(() =&gt; {\n    setState({ step: 'success' });\n  }).catch(error =&gt; {\n    setState({ step: 'error', error });\n  });\n}\n\nfunction setState(nextState) {\n  // Clear all existing children\n  formStatus.innerHTML = '';\n\n  currentState = nextState;\n  switch (nextState.step) {\n    case 'initial':\n      break;\n    case 'pending':\n      formStatus.appendChild(spinner);\n      break;\n    case 'success':\n      let successMessage = createSuccessMessage();\n      formStatus.appendChild(successMessage);\n      break;\n    case 'error':\n      let errorMessage = createErrorMessage(nextState.error);\n      let retryButton = createRetryButton();\n      formStatus.appendChild(errorMessage);\n      formStatus.appendChild(retryButton);\n      retryButton.addEventListener('click', trySubmit);\n      break;\n  }\n}\n</code></pre><p>çœ‹èµ·æ¥å¯èƒ½å·®å¼‚ä¸å¤§ï¼Œç”šè‡³æ›´å•°å—¦äº†ï¼Œä½†æ˜¯å®ƒå´æˆå‰§æ€§åœ°è®©è°ƒè¯•å˜å¾—æ›´ç®€å•äº†ã€‚å› ä¸ºè¿™å‡ è¡Œï¼š</p>\n<pre data-line=\"3,\"  3=\"\" class=\"language-jsx\"><code 3=\"\" class=\"language-jsx\">function setState(nextState) {\n  // Clear all existing children\n  formStatus.innerHTML = '';\n\n  // ... the code adding stuff to formStatus ...\n</code></pre><p>é€šè¿‡åœ¨åšä»»ä½•æ“ä½œå‰æ¸…ç©ºè¡¨å•çŠ¶æ€ï¼Œæˆ‘ä»¬ä¿è¯äº†æ‰€æœ‰ DOM æ“ä½œéƒ½ä»æ–°å¼€å§‹ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥æˆ˜èƒœå¿…ç„¶å‘ç”Ÿçš„<a href=\"/the-elements-of-ui-engineering/\">å¢’å˜</a>ï¼Œé€šè¿‡<em>ä¸è®©é”™è¯¯ç§¯ç´¯</em>ã€‚è¿™ä¸ªä»£ç çš„åšæ³•æœ‰ç‚¹åƒâ€œæŠŠå®ƒå…³æ‰ç„¶åå†æ‰“å¼€â€ï¼Œå°±æ˜¯è¿™ä¹ˆç¥å¥‡ã€‚</p>\n<p><strong>å¦‚æœç»“æœæœ‰é”™è¯¯ï¼Œæˆ‘ä»¬åªéœ€è¦å¾€å›æƒ³ä¸€æ­¥ï¼Œçœ‹ä¸€ä¸‹ä¸Šæ¬¡çš„ <code>setState</code> è°ƒç”¨ã€‚</strong> è°ƒè¯•æ¸²æŸ“ç»“æœçš„ Bug-O æ˜¯ ğŸ(<em>n</em>) å…¶ä¸­ <em>n</em> æ˜¯æ¸²æŸ“ç›¸å…³çš„ä»£ç è·¯å¾„æ•°ï¼Œåœ¨è¿™é‡Œå³ä¸º 4ï¼ˆå› ä¸º <code>switch</code> é‡Œæœ‰ 4 ç§æƒ…å†µï¼‰ã€‚</p>\n<p>æˆ‘ä»¬å¯èƒ½ä»ç„¶ä¼šåœ¨<em>è®¾ç½®</em>çŠ¶æ€çš„æ—¶å€™é‡åˆ°ç«æ€ï¼Œä½†æ˜¯è°ƒè¯•å®ƒä¼šæ¯”ä¹‹å‰æ›´ç®€å•ï¼Œå› ä¸ºæ¯ä¸ªä¸­é—´çŠ¶æ€éƒ½å¯ä»¥è¢«æ—¥å¿—è®°å½•å’Œæ£€æŸ¥ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ˜¾å¼åœ°é˜»æ­¢ä¸€äº›éé¢„æœŸçš„çŠ¶æ€å˜åŒ–ï¼š</p>\n<pre   class=\"language-jsx\"><code class=\"language-jsx\">function trySubmit() {\n  if (currentState.step === 'pending') {\n    // Don't allow to submit twice\n    return;\n  }\n</code></pre><p>å½“ç„¶ï¼Œæ¯æ¬¡éƒ½é‡ç½® DOM ä¹Ÿæœ‰åˆ©æœ‰å¼Šã€‚ç®€å•åœ°ç§»é™¤ç„¶åé‡å»º DOM ä¼šé”€æ¯å®ƒä»¬çš„å†…éƒ¨çŠ¶æ€ï¼Œè®©å®ƒä»¬å¤±å»ç„¦ç‚¹ï¼Œåœ¨æ›´å¤§å‹çš„åº”ç”¨é‡Œä¹Ÿä¼šé€ æˆä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚</p>\n<p>è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆåƒ React è¿™æ ·çš„åº“ä¼šå¾ˆæœ‰å¸®åŠ©äº†ï¼Œå› ä¸ºå®ƒä»¬åªéœ€è¦è®©ä½ æ€è€ƒå¦‚ä½•ä»é›¶å¼€å§‹æ­å»º UIï¼Œå®é™…ä¸Šåº“çš„å†…éƒ¨å´å¹¶ä¸æ˜¯è¿™æ ·åšçš„ï¼š</p>\n<pre   class=\"language-jsx\"><code class=\"language-jsx\">function FormStatus() {\n  let [state, setState] = useState({\n    step: 'initial'\n  });\n\n  function handleSubmit(e) {\n    e.preventDefault();\n    if (state.step === 'pending') {\n      // Don't allow to submit twice\n      return;\n    }\n    setState({ step: 'pending' });\n    submitForm().then(() =&gt; {\n      setState({ step: 'success' });\n    }).catch(error =&gt; {\n      setState({ step: 'error', error });\n    });\n  }\n\n  let content;\n  switch (state.step) {\n    case 'pending':\n      content = &lt;Spinner /&gt;;\n      break;\n    case 'success':\n      content = &lt;SuccessMessage /&gt;;\n      break;\n    case 'error':\n      content = (\n        &lt;&gt;\n          &lt;ErrorMessage error={state.error} /&gt;\n          &lt;RetryButton onClick={handleSubmit} /&gt;\n        &lt;/&gt;\n      );\n      break;\n  }\n\n  return (\n    &lt;form onSubmit={handleSubmit}&gt;\n      {content}\n    &lt;/form&gt;\n  );\n}\n</code></pre><p>ä»£ç çœ‹èµ·æ¥å¯èƒ½ä¸å¤ªä¸€æ ·ï¼Œä½†æ˜¯åŸåˆ™æ˜¯ç›¸åŒçš„ã€‚ç»„ä»¶çš„æŠ½è±¡å¼ºåŒ–äº†æŒ‡è´£çš„è¾¹ç•Œï¼Œå› æ­¤ä½ ä¸çŸ¥é“å…¶ä»–é¡µé¢ä¸Šèƒ½å½±å“ DOM å’ŒçŠ¶æ€çš„ä»£ç ã€‚ç»„ä»¶åŒ–æœ‰åŠ©äºé™ä½ Bug-Oã€‚</p>\n<p>äº‹å®ä¸Šï¼Œå¦‚æœä¸€ä¸ª React åº”ç”¨é‡Œæœ‰ä»»ä½•å€¼åœ¨ DOM ä¸Šçœ‹èµ·æ¥ä¸å¤ªå¯¹ï¼Œä½ éƒ½å¯ä»¥è·Ÿè¸ªå®ƒæ˜¯ä»å“ªé‡Œæ¥çš„ï¼Œé€šè¿‡ä¸€ä¸ªä¸€ä¸ªåœ°æŸ¥çœ‹åœ¨å®ƒä¹‹ä¸Šçš„ç»„ä»¶çš„ä»£ç ã€‚ä¸è®ºä½ çš„åº”ç”¨æœ‰å¤šå¤§ï¼Œè·Ÿè¸ªä¸€ä¸ªæ¸²æŸ“å‡ºæ¥çš„å€¼æ˜¯ ğŸ(<em>tree height</em>) çš„ã€‚</p>\n<p><strong>ä¸‹ä¸€æ¬¡ä½ çœ‹åˆ°ä¸€ä¸ªæœ‰å…³ API çš„è®¨è®ºï¼Œé¦–å…ˆè€ƒè™‘ï¼šå®ƒçš„å¸¸è§„è°ƒè¯•ä»»åŠ¡çš„ ğŸ(<em>n</em>) æ˜¯å¤šå°‘ï¼Ÿ</strong> ç°æœ‰ä½ ååˆ†ç†Ÿæ‚‰çš„ APIs å’Œå¼€å‘åŸåˆ™æ€ä¹ˆæ ·ï¼ŸReduxã€CSSã€ç»§æ‰¿... å®ƒä»¬éƒ½æœ‰è‡ªå·±çš„ Bug-Oã€‚</p>\n<hr>\n","frontmatter":"title: â€œBug-Oâ€ è¡¨ç¤ºæ³•\ndate: '2019-01-25'\nspoiler: ä½ çš„ API çš„ ğŸ(<i>n</i>) æ˜¯ä»€ä¹ˆï¼Ÿ\nfeatured: true","link":"/post/the-bug-o-notation-zh","next":{"title":"The â€œBug-Oâ€ Notation","date":"2019-01-25","spoiler":"What is the ğŸ(<i>n</i>) of your API?","link":"/post/the-bug-o-notation","min2read":"â˜•ï¸ 7 min read","wordcount":"1.2k"}}}