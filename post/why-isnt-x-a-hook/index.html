<!doctype html>
<html data-n-head-ssr>
  <head>
    <title>Why Isn’t X a Hook? - Curtis' Spot</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Front-end Engineer. Bloggin about life, tech & everything I love."><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.png"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC&display=swap"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:900&display=swap"><base href="/lkangd.com/"><link rel="preload" href="/lkangd.com/_nuxt/65dc7a5cd1c1cd57e7eb.js" as="script"><link rel="preload" href="/lkangd.com/_nuxt/48f65a593c854d50b992.js" as="script"><link rel="preload" href="/lkangd.com/_nuxt/2bc7cee40a450e203637.js" as="script"><link rel="preload" href="/lkangd.com/_nuxt/ef6c14c0800794aa78c2.js" as="script"><link rel="preload" href="/lkangd.com/_nuxt/7e77b8e6cd7011676488.js" as="script"><style data-vue-ssr-id="4c1d7b6c:0 08fa13ea:0 1ff19d8c:0 e7f76474:0 c85b1ba0:0 6f6dcbd0:0 fb70d044:0 230384db:0 861b946c:0">a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,html,i,iframe,img,input,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font-size:100%;font-weight:400;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}body{line-height:1}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:none}table{border-collapse:collapse;border-spacing:0}a{backface-visibility:hidden;-webkit-backface-visibility:hidden;-webkit-touch-callout:none;text-decoration:none;cursor:pointer}li{list-style:none}body{-webkit-text-size-adjust:none;-webkit-tap-highlight-color:transparent}*{box-sizing:border-box}html{font-size:16px!important}body,html{height:100%;line-height:1;font-family:"Noto Serif SC",serif;-webkit-tap-highlight-color:transparent;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}body{margin:0 auto;scroll-behavior:smooth}strong{font-weight:700}a,button{color:inherit;outline:0;border:none;background-color:transparent;-webkit-tap-highlight-color:transparent;transition:text-shadow .3s;white-space:pre-wrap;word-break:break-all;cursor:pointer}a:active,a:focus,button:active,button:focus{outline:0!important}a:hover,button:hover{text-shadow:0 0 1px #000}::-moz-selection{background:rgba(255,233,87,.6)}::selection{background:rgba(255,233,87,.6)}.cs-outside-link{position:relative;cursor:pointer;transition:color .2s cubic-bezier(0,.8,.13,1);-webkit-text-decoration-color:transparent!important;text-decoration-color:transparent!important}.cs-outside-link:after{content:"";position:absolute;z-index:-1;top:60%;left:-.1em;right:-.1em;bottom:0;transition:top .2s cubic-bezier(0,.8,.13,1);background-color:var(--yellow)}.cs-outside-link:hover{color:#121314}.cs-outside-link:hover:after{top:0}.cs-nav-link{position:relative}.cs-nav-link:before{content:"";position:absolute;height:1px;bottom:3px;left:0;right:0;background-color:var(--site-nav);transform-origin:bottom left;transform:scaleX(1);transition:transform .3s ease-in-out}.cs-nav-link:hover:before{transform:scaleX(0);transform-origin:bottom right}.cs-container{margin:0 auto;padding:0 32px;max-width:764px}.cs-container-big{margin:0 auto;padding:0 32px;max-width:1024px}.cs-split-title{height:0;font-weight:700;line-height:0;text-transform:uppercase;text-align:center;border-bottom:1px solid var(--hr);margin-top:48px;margin-bottom:20px;cursor:default;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.cs-split-title>span{padding-left:.5em;padding-right:.5em;font-weight:700;color:var(--text-normal);background-color:var(--bg)}.cs-title{font-size:24px;line-height:34px;font-weight:700}.cs-title,.cs-title-big{margin:20px auto;font-family:Montserrat,serif;color:var(--text-title)}.cs-title-big{font-size:32px;line-height:42px;font-weight:900}.cs-text{margin-bottom:10px;line-height:1.3;color:var(--text-normal);word-break:break-all;white-space:wrap}.cs-text a{text-decoration:underline}.cs-text small{font-size:.8em}.cs-date{margin:24px 0 32px;line-height:1.7;color:var(--site-desc)}.cs-list{margin:16px auto;padding-left:40px;list-style-type:disc}.cs-list__item{display:list-item;list-style:inherit;line-height:1.5;word-break:break-all;white-space:wrap}.fl{float:left}.fr{float:right}body{--yellow:rgba(255,233,87,0.6);--bg:#fff;--header:var(--pink);--text-normal:#000;--text-title:#222;--text-link:#d23669;--hr:#a7adba;--footer-bg:#fafafa;--logo:#000;--site-desc:#65737e;--site-nav:#343d46;--inline-code-fg:rgba(49,51,51,0.9);--inline-code-bg:rgba(255,233,87,0.4);color:var(--text-normal);background-color:var(--bg)}body.dark{--yellow:#373c49;--bg:#282c35;--header:#fff;--text-normal:hsla(0,0%,100%,0.88);--text-title:#fff;--text-link:var(--pink);--hr:hsla(0,0%,100%,0.2);--footer-bg:#242830;--logo:#fff;--site-desc:hsla(0,0%,100%,0.88);--site-nav:hsla(0,0%,100%,0.88);--inline-code-fg:#e6e6e6;--inline-code-bg:#373c49;-webkit-font-smoothing:antialiased}code[class*=language-],pre[class*=language-]{color:#fff;background:0 0;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;font-feature-settings:normal;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;margin-bottom:0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{overflow:auto;padding:1.3125rem}pre[class*=language-]::-moz-selection{background:#27292a}pre[class*=language-]::selection{background:#27292a}pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:hsla(0,0%,100%,.15)}pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:hsla(0,0%,100%,.15)}:not(pre)>code[class*=language-]{border-radius:.3em;background:var(--inline-code-bg);color:var(--inline-code-fg);padding:.15em .2em .05em;white-space:normal}.token.attr-name{color:#addb67;font-style:italic}.token.comment{color:#809393}.token.string,.token.url{color:#addb67}.token.variable{color:#d6deeb}.token.number{color:#f78c6c}.token.builtin,.token.char,.token.constant,.token.function{color:#82aaff}.token.punctuation{color:#c792ea}.token.doctype,.token.selector{color:#c792ea;font-style:italic}.token.class-name{color:#ffcb8b}.token.keyword,.token.operator,.token.tag{color:#ffa7c4}.token.boolean{color:#ff5874}.token.property{color:#80cbc4}.token.namespace{color:#b2ccd6}pre[data-line]{padding:1em 0 1em 3em;position:relative}.gatsby-highlight-code-line{background-color:#022a4b;display:block;padding-right:1em;padding-left:1.25em;border-left:.25em solid #ffa7c4}.gatsby-highlight,.gatsby-highlight-code-line{margin-right:-1.3125rem;margin-left:-1.3125rem}.gatsby-highlight{margin-bottom:1.75rem;border-radius:10px;background:#011627;-webkit-overflow-scrolling:touch;overflow:auto}@media (max-width:672px){.gatsby-highlight{border-radius:0}}.gatsby-highlight pre[class*=language-]{float:left;min-width:100%}.line-highlight{border-left:4px solid #ffa7c4}.line-highlight:after,.line-highlight:before{display:none}.cs-loading[data-v-0dfe3184]{position:fixed;top:0;left:0;z-index:100;width:100%;height:100%;background-color:var(--bg);will-change:opacity;transition:opacity .5s .4s}.cs-loading.loaded[data-v-0dfe3184]{opacity:0}.cs-loading .main[data-v-0dfe3184]{position:absolute;top:calc(50% - 63px);left:calc(50% - 63px);z-index:1;width:126px;height:126px}.cs-loading .main.out-of-window .line1-2[data-v-0dfe3184],.cs-loading .main.out-of-window .line1[data-v-0dfe3184],.cs-loading .main.out-of-window .line3-2[data-v-0dfe3184],.cs-loading .main.out-of-window .line3[data-v-0dfe3184],.cs-loading .main.out-of-window .line5[data-v-0dfe3184],.cs-loading .main.out-of-window .line7[data-v-0dfe3184],.cs-loading .main.out-of-window .line9[data-v-0dfe3184]{transform:rotate(45deg) translateY(100vh)}.cs-loading .main.out-of-window .line10[data-v-0dfe3184],.cs-loading .main.out-of-window .line2-2[data-v-0dfe3184],.cs-loading .main.out-of-window .line2[data-v-0dfe3184],.cs-loading .main.out-of-window .line4-2[data-v-0dfe3184],.cs-loading .main.out-of-window .line4-3[data-v-0dfe3184],.cs-loading .main.out-of-window .line4[data-v-0dfe3184],.cs-loading .main.out-of-window .line6[data-v-0dfe3184],.cs-loading .main.out-of-window .line8-1[data-v-0dfe3184],.cs-loading .main.out-of-window .line8[data-v-0dfe3184]{transform:rotate(45deg) translateY(-100vh)}.cs-loading .main.out-of-window .text[data-v-0dfe3184]{opacity:0;transition:opacity .5s}.cs-loading .main .line[data-v-0dfe3184]{position:absolute;z-index:3;width:7px;background:var(--text-normal);will-change:transform;transform:rotate(45deg)}.cs-loading .main .line.line1[data-v-0dfe3184]{top:51px;left:5px;height:17px;transition:transform .5s}.cs-loading .main .line.line1-2[data-v-0dfe3184]{top:-3px;left:50px;height:36px;transition:transform .5s}.cs-loading .main .line.line2[data-v-0dfe3184]{top:55px;left:9px;height:27px;transition:transform .5s}.cs-loading .main .line.line2-2[data-v-0dfe3184]{top:-5px;left:56px;height:53px;transition:transform .5s}.cs-loading .main .line.line3[data-v-0dfe3184]{top:58px;left:15px;height:35px;transition:transform .5s .1s}.cs-loading .main .line.line3-2[data-v-0dfe3184]{top:-2px;left:63px;height:59px;transition:transform .5s .1s}.cs-loading .main .line.line4[data-v-0dfe3184]{top:55px;left:24px;height:48px;transition:transform .5s .1s}.cs-loading .main .line.line4-2[data-v-0dfe3184]{top:27px;left:60px;height:33px;transition:transform .5s .1s}.cs-loading .main .line.line4-3[data-v-0dfe3184]{top:9px;left:84px;height:21px;transition:transform .5s .1s}.cs-loading .main .line.line5[data-v-0dfe3184]{top:4px;left:54px;height:117px;transition:transform .5s .2s}.cs-loading .main .line.line6[data-v-0dfe3184]{top:15px;left:59px;height:111px;transition:transform .5s .2s}.cs-loading .main .line.line7[data-v-0dfe3184]{top:16px;left:69px;height:115px;transition:transform .5s .3s}.cs-loading .main .line.line8[data-v-0dfe3184]{top:56px;left:63px;height:72px;transition:transform .5s .3s}.cs-loading .main .line.line8-1[data-v-0dfe3184]{top:30px;left:116px;height:18px;transition:transform .5s .3s}.cs-loading .main .line.line9[data-v-0dfe3184]{top:67px;left:70px;height:61px;transition:transform .5s .4s}.cs-loading .main .line.line10[data-v-0dfe3184]{top:82px;left:78px;height:40px;transition:transform .5s .4s}.cs-loading .main .text[data-v-0dfe3184]{position:absolute;bottom:-18%;left:0;width:100%;font-size:18px;font-weight:700;color:var(--text-normal);text-align:center;will-change:opacity;transition:opacity .5s .5s}.cs-header[data-v-e2fcdc26]{padding-top:64px}.cs-header__logo[data-v-e2fcdc26]{position:relative;left:4px;display:block;margin:0 auto;width:128px;height:128px;color:var(--logo);transition:color .5s;cursor:pointer}.cs-header__logo[data-v-e2fcdc26]:hover{color:#ffe957}.cs-header__text[data-v-e2fcdc26]{margin:16px 0;padding:0 32px;font-weight:700;line-height:1.4;text-align:center;color:var(--text-normal)}.cs-header__text--light[data-v-e2fcdc26]{color:var(--site-desc);font-weight:500}.cs-nav[data-v-3775b65b]{padding:32px;font-size:0;text-align:center}.cs-nav__item[data-v-3775b65b]{display:inline-block;padding:0 8px;color:var(--site-nav);cursor:pointer}.cs-nav__item>a[data-v-3775b65b]{font-size:16px;font-weight:700;line-height:1.4}.post{background-color:transparent}.post hr{margin:64px 0;border:0;border-bottom:1px solid var(--hr)}.post .cs-post-article a{padding:0 4px;text-decoration:underline}.post .cs-post-article h2{margin:24px 0;font-size:20px;font-weight:700}.post .cs-post-article h3{margin:24px 0;font-size:18px;font-weight:700}.post .cs-post-article li,.post .cs-post-article p{margin:24px 0;font-size:16px;line-height:28px;color:var(--text-normal)}.post .cs-post-article code:not([class*=language-]){padding:0 4px;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;color:var(--inline-code-fg);background-color:var(--inline-code-bg);border-radius:3px}.post .cs-post-article strong em{margin:0 6px;font-weight:700}.post .cs-post-article hr{margin:30px 0;border:0;border-bottom:1px solid var(--hr)}.post .cs-post-article em{margin:0 6px}.post .cs-post-article pre{background-color:#011627;border-radius:10px}.post .cs-post-article ul li{font-size:16px;line-height:28px;list-style:disc}.post .cs-post-article ol li{list-style:decimal}.post .cs-post-article img{width:100%;height:auto}.post__wrapper{overflow:hidden}.post__wrapper>a{margin:20px 0}.cs-statement[data-v-6cb3297c]{text-align:center}.cs-statement hr[data-v-6cb3297c]{margin:64px 0;border:0;border-bottom:1px solid var(--hr)}.cs-statement__text[data-v-6cb3297c]{margin:8px 0;line-height:1.7;color:var(--text-normal)}.cs-statement__reward-code[data-v-6cb3297c]{margin-top:50px;max-width:30%;height:auto}@media (max-width:375px){.cs-statement .cs-statement__reward-code[data-v-6cb3297c]{max-width:76%!important}}.cs-footer[data-v-04c3be52]{position:relative;margin-top:40px;padding:40px 40px 20px;color:#9aa0ac;text-align:center}.cs-footer[data-v-04c3be52]:after{content:"";position:absolute;top:0;left:0;right:0;bottom:0;z-index:-2;background-color:var(--footer-bg)}.cs-footer__logo[data-v-04c3be52]{display:block;margin:18px auto;width:28px;height:28px;color:var(--logo)}.cs-footer__text>a[data-v-04c3be52],.cs-footer__text[data-v-04c3be52]{font-weight:600}.cs-footer__text[data-v-04c3be52]{margin:18px 0}.cs-footer__slogan[data-v-04c3be52]{display:inline-block;vertical-align:middle;font-size:14px}.cs-color-slogan[data-v-1740ad80]{display:inline-block;position:relative;font-family:serif;color:var(--text-normal);background-color:transparent}.cs-color-slogan__placeholder[data-v-1740ad80]{opacity:0}.cs-color-slogan__wrapper[data-v-1740ad80]{position:absolute;top:0;white-space:nowrap}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><header class="cs-header" data-v-e2fcdc26><svg xmlns="http://www.w3.org/2000/svg" class="cs-header__logo" data-v-e2fcdc26><use href="/lkangd.com/_nuxt/262e991fa0c906f1d05d77a4571a395b.svg#i-logo" xlink:href="/lkangd.com/_nuxt/262e991fa0c906f1d05d77a4571a395b.svg#i-logo"></use></svg> <p class="cs-header__text" data-v-e2fcdc26>Curtis Liong</p> <p class="cs-header__text cs-header__text--light" data-v-e2fcdc26><a href="https://en.wikipedia.org/wiki/Front-end_web_development" target="_blank" class="cs-outside-link" data-v-e2fcdc26>Front-end</a> Engineer. Blogging about life, tech & everything I love.
  </p></header> <nav class="cs-nav" data-v-3775b65b><div class="cs-nav__item" data-v-3775b65b><a href="/lkangd.com/" class="cs-nav-link nuxt-link-active" data-v-3775b65b>Home</a></div><div class="cs-nav__item" data-v-3775b65b><a href="/lkangd.com/tech/" class="cs-nav-link" data-v-3775b65b>Tech</a></div><div class="cs-nav__item" data-v-3775b65b><a href="/lkangd.com/think/" class="cs-nav-link" data-v-3775b65b>Think</a></div><div class="cs-nav__item" data-v-3775b65b><a href="/lkangd.com/fun/" class="cs-nav-link" data-v-3775b65b>Fun</a></div><div class="cs-nav__item" data-v-3775b65b><a href="/lkangd.com/about/" class="cs-nav-link" data-v-3775b65b>About</a></div><div class="cs-nav__item" data-v-3775b65b><a href="/lkangd.com/donate/" class="cs-nav-link" data-v-3775b65b>Donate</a></div> <div class="cs-nav__item" data-v-3775b65b><a href="/feed.xml" target="_blank" class="cs-nav-link" data-v-3775b65b>RSS</a></div> <div class="cs-nav__item" data-v-3775b65b><a href="/sitemap.xml" target="_blank" class="cs-nav-link" data-v-3775b65b>Sitemap</a></div></nav> <section class="post cs-container-big"><h2 class="cs-title-big">Why Isn’t X a Hook?</h2> <p class="cs-date">26, Jan, 2019•1.4k words•☕️☕️ 8 min read</p> <article class="cs-post-article"><p>Since the first alpha version of <a href="https://reactjs.org/hooks">React Hooks</a> was released, there is a question that keeps coming up in discussions: “Why isn’t <em>&lt;some other API></em> a Hook?”</p>
<p>To remind you, here’s a few things that <em>are</em> Hooks:</p>
<ul>
<li><a href="https://reactjs.org/docs/hooks-reference.html#usestate"><code>useState()</code></a> lets you declare a state variable.</li>
<li><a href="https://reactjs.org/docs/hooks-reference.html#useeffect"><code>useEffect()</code></a> lets you declare a side effect.</li>
<li><a href="https://reactjs.org/docs/hooks-reference.html#usecontext"><code>useContext()</code></a> lets you read some context.</li>
</ul>
<p>But there are some other APIs, like <code>React.memo()</code> and <code>&lt;Context.Provider></code>, that are <em>not</em> Hooks. Commonly proposed Hook versions of them would be <em>noncompositional</em> or <em>antimodular</em>. This article will help you understand why.</p>
<p><strong>Note: this post is a deep dive for folks who are interested in API discussions. You don’t need to think about any of this to be productive with React!</strong></p>
<hr>
<p>There are two important properties that we want React APIs to preserve:</p>
<ol>
<li>
<p><strong>Composition:</strong> <a href="https://reactjs.org/docs/hooks-custom.html">Custom Hooks</a> are largely the reason we’re excited about the Hooks API. We expect people to build their own Hooks very often, and we need to make sure Hooks written by different people <a href="/why-do-hooks-rely-on-call-order/#flaw-4-the-diamond-problem">don't conflict</a>. (Aren’t we all spoiled by how components compose cleanly and don’t break each other?)</p>
</li>
<li>
<p><strong>Debugging:</strong> We want the bugs to be <a href="/the-bug-o-notation/">easy to find</a> as the application grows. One of React's best features is that if you see something wrong rendered, you can walk up the tree until you find which component's prop or state caused the mistake.</p>
</li>
</ol>
<p>These two constraints put together can tell us what can or <em>cannot</em> be a Hook. Let’s try a few examples.</p>
<hr>
<h2>A Real Hook: <code>useState()</code></h2>
<h3>Composition</h3>
<p>Multiple custom Hooks each calling <code>useState()</code> don’t conflict:</p>
<pre class="language-jsx"><code class="language-jsx">function useMyCustomHook1() {
  const [value, setValue] = useState(0);
  // What happens here, stays here.
}

function useMyCustomHook2() {
  const [value, setValue] = useState(0);
  // What happens here, stays here.
}

function MyComponent() {
  useMyCustomHook1();
  useMyCustomHook2();
  // ...
}
</code></pre><p>Adding a new unconditional <code>useState()</code> call is always safe. You don’t need to know anything about other Hooks used by a component to declare a new state variable. You also can’t break other state variables by updating one of them.</p>
<p><strong>Verdict:</strong> ✅ <code>useState()</code> doesn’t make custom Hooks fragile.</p>
<h3>Debugging</h3>
<p>Hooks are useful because you can pass values <em>between</em> Hooks:</p>
<pre data-line="4,12,14," 4,12,14="" class="language-jsx"><code 4,12,14="" class="language-jsx">function useWindowWidth() {
  const [width, setWidth] = useState(window.innerWidth);
  // ...
  return width;
}

function useTheme(isMobile) {
  // ...
}

function Comment() {
  const width = useWindowWidth();
  const isMobile = width &lt; MOBILE_VIEWPORT;
  const theme = useTheme(isMobile);
  return (
    &lt;section className={theme.comment}>
      {/* ... */}
    &lt;/section>
  );
}
</code></pre><p>But what if we make a mistake? What’s the debugging story?</p>
<p>Let's say the CSS class we get from <code>theme.comment</code> is wrong. How would we debug this? We can set a breakpoint or a few logs in the body of our component.</p>
<p>Maybe we’d see that <code>theme</code> is wrong but <code>width</code> and <code>isMobile</code> are correct. That would tell us the problem is inside <code>useTheme()</code>. Or perhaps we'd see that <code>width</code> itself is wrong. That would tell us to look into <code>useWindowWidth()</code>.</p>
<p><strong>A single look at the intermediate values tells us which of the Hooks at the top level contains the bug.</strong> We don't need to look at <em>all</em> of their implementations.</p>
<p>Then we can “zoom in” on the one that has a bug, and repeat.</p>
<p>This becomes more important if the depth of custom Hook nesting increases. Imagine we have 3 levels of custom Hook nesting, each level using 3 different custom Hooks inside. The <a href="/the-bug-o-notation/">difference</a> between looking for a bug in <strong>3 places</strong> versus potentially checking <strong>3 + 3×3 + 3×3×3 = 39 places</strong> is enormous. Luckily, <code>useState()</code> can't magically “influence” other Hooks or components. A buggy value returned by it leaves a trail behind it, just like any variable. 🐛</p>
<p><strong>Verdict:</strong> ✅ <code>useState()</code> doesn’t obscure the cause-effect relationship in our code. We can follow the breadcrumbs directly to the bug.</p>
<hr>
<h2>Not a Hook: <code>useBailout()</code></h2>
<p>As an optimization, components using Hooks can bail out of re-rendering.</p>
<p>One way to do it is to put a <a href="https://reactjs.org/blog/2018/10/23/react-v-16-6.html#reactmemo"><code>React.memo()</code></a> wrapper around the whole component. It bails out of re-rendering if props are shallowly equal to what we had during the last render. This makes it similar to <code>PureComponent</code> in classes.</p>
<p><code>React.memo()</code> takes a component and returns a component:</p>
<pre data-line="4," 4="" class="language-jsx"><code 4="" class="language-jsx">function Button(props) {
  // ...
}
export default React.memo(Button);
</code></pre><p><strong>But why isn’t it just a Hook?</strong></p>
<p>Whether you call it <code>useShouldComponentUpdate()</code>, <code>usePure()</code>, <code>useSkipRender()</code>, or <code>useBailout()</code>, the proposal tends to look something like this:</p>
<pre class="language-jsx"><code class="language-jsx">function Button({ color }) {
  // ⚠️ Not a real API
  useBailout(prevColor => prevColor !== color, color);

  return (
    &lt;button className={'button-' + color}>  
      OK
    &lt;/button>
  )
}
</code></pre><p>There are a few more variations (e.g. a simple <code>usePure()</code> marker) but in broad strokes they have the same flaws.</p>
<h3>Composition</h3>
<p>Let’s say we try to put <code>useBailout()</code> in two custom Hooks:</p>
<pre data-line="4,5,19,20," 4,5,19,20="" class="language-jsx"><code 4,5,19,20="" class="language-jsx">function useFriendStatus(friendID) {
  const [isOnline, setIsOnline] = useState(null);

  // ⚠️ Not a real API
  useBailout(prevIsOnline => prevIsOnline !== isOnline, isOnline);

  useEffect(() => {
    const handleStatusChange = status => setIsOnline(status.isOnline);
    ChatAPI.subscribe(friendID, handleStatusChange);
    return () => ChatAPI.unsubscribe(friendID, handleStatusChange);
  });

  return isOnline;
}

function useWindowWidth() {
  const [width, setWidth] = useState(window.innerWidth);
  
  // ⚠️ Not a real API
  useBailout(prevWidth => prevWidth !== width, width);

  useEffect(() => {
    const handleResize = () => setWidth(window.innerWidth);
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  });

  return width;
}
</code></pre><p>Now what happens if you use them both in the same component?</p>
<pre data-line="2,3," 2,3="" class="language-jsx"><code 2,3="" class="language-jsx">function ChatThread({ friendID, isTyping }) {
  const width = useWindowWidth();
  const isOnline = useFriendStatus(friendID);
  return (
    &lt;ChatLayout width={width}>
      &lt;FriendStatus isOnline={isOnline} />
      {isTyping && 'Typing...'}
    &lt;/ChatLayout>
  );
}
</code></pre><p>When does it re-render?</p>
<p>If every <code>useBailout()</code> call has the power to skip an update, then updates from <code>useWindowWidth()</code> would be blocked by <code>useFriendStatus()</code>, and vice versa. <strong>These Hooks would break each other.</strong></p>
<p>However, if <code>useBailout()</code> was only respected when <em>all</em> calls to it inside a single component “agree” to block an update, our <code>ChatThread</code> would fail to update on changes to the <code>isTyping</code> prop.</p>
<p>Even worse, with these semantics <strong>any newly added Hooks to <code>ChatThread</code> would break if they don’t <em>also</em> call <code>useBailout()</code></strong>. Otherwise, they can’t “vote against” the bailout inside <code>useWindowWidth()</code> and <code>useFriendStatus()</code>.</p>
<p><strong>Verdict:</strong> 🔴 <code>useBailout()</code> breaks composition. Adding it to a Hook breaks state updates in other Hooks. We want the APIs to be <a href="/optimized-for-change/">antifragile</a>, and this behavior is pretty much the opposite.</p>
<h3>Debugging</h3>
<p>How does a Hook like <code>useBailout()</code> affect debugging?</p>
<p>We’ll use the same example:</p>
<pre class="language-jsx"><code class="language-jsx">function ChatThread({ friendID, isTyping }) {
  const width = useWindowWidth();
  const isOnline = useFriendStatus(friendID);
  return (
    &lt;ChatLayout width={width}>
      &lt;FriendStatus isOnline={isOnline} />
      {isTyping && 'Typing...'}
    &lt;/ChatLayout>
  );
}
</code></pre><p>Let’s say the <code>Typing...</code> label doesn’t appear when we expect, even though somewhere many layers above the prop is changing. How do we debug it?</p>
<p><strong>Normally, in React you can confidently answer this question by looking <em>up</em>.</strong> If <code>ChatThread</code> doesn’t get a new <code>isTyping</code> value, we can open the component that renders <code>&lt;ChatThread isTyping={myVar} /></code> and check <code>myVar</code>, and so on. At one of these levels, we’ll either find a buggy <code>shouldComponentUpdate()</code> bailout, or an incorrect <code>isTyping</code> value being passed down. One look at each component in the chain is usually enough to locate the source of the problem.</p>
<p>However, if this <code>useBailout()</code> Hook was real, you would never know the reason an update was skipped until you checked <em>every single custom Hook</em> (deeply) used by our <code>ChatThread</code> and components in its owner chain. Since every parent component can <em>also</em> use custom Hooks, this <a href="/the-bug-o-notation/">scales</a> terribly.</p>
<p>It’s like if you were looking for a screwdriver in a chest of drawers, and each drawer contained a bunch of smaller chests of drawers, and you don’t know how deep the rabbit hole goes.</p>
<p><strong>Verdict:</strong> 🔴 Not only <code>useBailout()</code> Hook breaks composition, but it also vastly increases the number of debugging steps and cognitive load for finding a buggy bailout — in some cases, exponentially.</p>
<hr>
<p>We just looked at one real Hook, <code>useState()</code>, and a common suggestion that is intentionally <em>not</em> a Hook — <code>useBailout()</code>. We compared them through the prism of Composition and Debugging, and discussed why one of them works and the other one doesn’t.</p>
<p>While there is no “Hook version” of <code>memo()</code> or <code>shouldComponentUpdate()</code>, React <em>does</em> provide a Hook called <a href="https://reactjs.org/docs/hooks-reference.html#usememo"><code>useMemo()</code></a>. It serves a similar purpose, but its semantics are different enough to not run into the pitfalls described above.</p>
<p><code>useBailout()</code> is just one example of something that doesn’t work well as a Hook. But there are a few others — for example, <code>useProvider()</code>, <code>useCatch()</code>, or <code>useSuspense()</code>.</p>
<p>Can you see why?</p>
<p><em>(Whispers: Composition... Debugging...)</em></p>
</article> <hr> <div class="post__wrapper"><a href="/lkangd.com/post/writing-resilient-components-zh" class="cs-outside-link fr">编写有弹性的组件 →</a> <a href="/lkangd.com/post/why-isnt-x-a-hook-zh" class="cs-outside-link fl">← 为什么 'XX' 不是一个 Hooks API?</a></div> <section class="cs-statement" data-v-6cb3297c><hr data-v-6cb3297c> <p class="cs-statement__text" data-v-6cb3297c>
    讨论请发邮件到
    <a href="mailto:lkangd@gmail.com" target="_blank" class="cs-outside-link" data-v-6cb3297c>lkangd@gmail.com</a></p> <p class="cs-statement__text" data-v-6cb3297c>未经授权，禁止转载</p> <p class="cs-statement__text" data-v-6cb3297c>通过支付宝 lkangd@foxmail.com 或赞赏码赞助此文</p> <img alt="reward-code" src="/lkangd.com/_nuxt/img/3b0f29f.jpg" class="cs-statement__reward-code" data-v-6cb3297c></section></section> <footer class="cs-footer" data-v-04c3be52><div class="cs-color-slogan cs-footer__slogan" data-v-1740ad80 data-v-04c3be52><span data-v-1740ad80>Work With </span> <span class="cs-color-slogan__placeholder" data-v-1740ad80></span> <span class="cs-color-slogan__wrapper" data-v-1740ad80>
     
    <span data-v-1740ad80></span></span></div> <svg xmlns="http://www.w3.org/2000/svg" class="cs-footer__logo" data-v-04c3be52><use href="/lkangd.com/_nuxt/262e991fa0c906f1d05d77a4571a395b.svg#i-logo" xlink:href="/lkangd.com/_nuxt/262e991fa0c906f1d05d77a4571a395b.svg#i-logo"></use></svg> <p class="cs-footer__text" data-v-04c3be52>
    2017-2019 
    <a href="/" target="_blank" class="cs-outside-link" data-v-04c3be52>Curtis' Spot</a></p></footer></div></div></div><script defer src="/lkangd.com/post/why-isnt-x-a-hook/payload1568183296278.js"></script><script src="/lkangd.com/_nuxt/65dc7a5cd1c1cd57e7eb.js" defer></script><script src="/lkangd.com/_nuxt/7e77b8e6cd7011676488.js" defer></script><script src="/lkangd.com/_nuxt/48f65a593c854d50b992.js" defer></script><script src="/lkangd.com/_nuxt/2bc7cee40a450e203637.js" defer></script><script src="/lkangd.com/_nuxt/ef6c14c0800794aa78c2.js" defer></script><script data-n-head="ssr" type="text/javascript" data-body="true">!function(){function t(e){r=e,document.body.className=e}var r,a={light:"light",dark:"dark"};try{r=localStorage.getItem("theme")}catch(e){}window.__setPreferredTheme=function(e){t(e);try{localStorage.setItem("theme",e)}catch(e){}};var e=window.matchMedia("(prefers-color-scheme: dark)");e.addListener(function(e){window.__setPreferredTheme(a[r]||(e.matches?"dark":"light"))}),t(a[r]||(e.matches?"dark":"light"))}()</script>
  </body>
</html>
