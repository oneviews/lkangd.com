<!doctype html>
<html data-n-head-ssr>
  <head>
    <title>Why Do React Elements Have a $$typeof Property? - Curtis' Spot</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Front-end Engineer. Bloggin about life, tech & everything I love."><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.png"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC&display=swap"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:900&display=swap"><base href="/lkangd.com/"><link rel="preload" href="/lkangd.com/_nuxt/65dc7a5cd1c1cd57e7eb.js" as="script"><link rel="preload" href="/lkangd.com/_nuxt/48f65a593c854d50b992.js" as="script"><link rel="preload" href="/lkangd.com/_nuxt/2bc7cee40a450e203637.js" as="script"><link rel="preload" href="/lkangd.com/_nuxt/ef6c14c0800794aa78c2.js" as="script"><link rel="preload" href="/lkangd.com/_nuxt/7e77b8e6cd7011676488.js" as="script"><style data-vue-ssr-id="4c1d7b6c:0 08fa13ea:0 1ff19d8c:0 e7f76474:0 c85b1ba0:0 6f6dcbd0:0 fb70d044:0 230384db:0 861b946c:0">a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,html,i,iframe,img,input,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font-size:100%;font-weight:400;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}body{line-height:1}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:none}table{border-collapse:collapse;border-spacing:0}a{backface-visibility:hidden;-webkit-backface-visibility:hidden;-webkit-touch-callout:none;text-decoration:none;cursor:pointer}li{list-style:none}body{-webkit-text-size-adjust:none;-webkit-tap-highlight-color:transparent}*{box-sizing:border-box}html{font-size:16px!important}body,html{height:100%;line-height:1;font-family:"Noto Serif SC",serif;-webkit-tap-highlight-color:transparent;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}body{margin:0 auto;scroll-behavior:smooth}strong{font-weight:700}a,button{color:inherit;outline:0;border:none;background-color:transparent;-webkit-tap-highlight-color:transparent;transition:text-shadow .3s;white-space:pre-wrap;word-break:break-all;cursor:pointer}a:active,a:focus,button:active,button:focus{outline:0!important}a:hover,button:hover{text-shadow:0 0 1px #000}::-moz-selection{background:rgba(255,233,87,.6)}::selection{background:rgba(255,233,87,.6)}.cs-outside-link{position:relative;cursor:pointer;transition:color .2s cubic-bezier(0,.8,.13,1);-webkit-text-decoration-color:transparent!important;text-decoration-color:transparent!important}.cs-outside-link:after{content:"";position:absolute;z-index:-1;top:60%;left:-.1em;right:-.1em;bottom:0;transition:top .2s cubic-bezier(0,.8,.13,1);background-color:var(--yellow)}.cs-outside-link:hover{color:#121314}.cs-outside-link:hover:after{top:0}.cs-nav-link{position:relative}.cs-nav-link:before{content:"";position:absolute;height:1px;bottom:3px;left:0;right:0;background-color:var(--site-nav);transform-origin:bottom left;transform:scaleX(1);transition:transform .3s ease-in-out}.cs-nav-link:hover:before{transform:scaleX(0);transform-origin:bottom right}.cs-container{margin:0 auto;padding:0 32px;max-width:764px}.cs-container-big{margin:0 auto;padding:0 32px;max-width:1024px}.cs-split-title{height:0;font-weight:700;line-height:0;text-transform:uppercase;text-align:center;border-bottom:1px solid var(--hr);margin-top:48px;margin-bottom:20px;cursor:default;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.cs-split-title>span{padding-left:.5em;padding-right:.5em;font-weight:700;color:var(--text-normal);background-color:var(--bg)}.cs-title{font-size:24px;line-height:34px;font-weight:700}.cs-title,.cs-title-big{margin:20px auto;font-family:Montserrat,serif;color:var(--text-title)}.cs-title-big{font-size:32px;line-height:42px;font-weight:900}.cs-text{margin-bottom:10px;line-height:1.3;color:var(--text-normal);word-break:break-all;white-space:wrap}.cs-text a{text-decoration:underline}.cs-text small{font-size:.8em}.cs-date{margin:24px 0 32px;line-height:1.7;color:var(--site-desc)}.cs-list{margin:16px auto;padding-left:40px;list-style-type:disc}.cs-list__item{display:list-item;list-style:inherit;line-height:1.5;word-break:break-all;white-space:wrap}.fl{float:left}.fr{float:right}body{--yellow:rgba(255,233,87,0.6);--bg:#fff;--header:var(--pink);--text-normal:#000;--text-title:#222;--text-link:#d23669;--hr:#a7adba;--footer-bg:#fafafa;--logo:#000;--site-desc:#65737e;--site-nav:#343d46;--inline-code-fg:rgba(49,51,51,0.9);--inline-code-bg:rgba(255,233,87,0.4);color:var(--text-normal);background-color:var(--bg)}body.dark{--yellow:#373c49;--bg:#282c35;--header:#fff;--text-normal:hsla(0,0%,100%,0.88);--text-title:#fff;--text-link:var(--pink);--hr:hsla(0,0%,100%,0.2);--footer-bg:#242830;--logo:#fff;--site-desc:hsla(0,0%,100%,0.88);--site-nav:hsla(0,0%,100%,0.88);--inline-code-fg:#e6e6e6;--inline-code-bg:#373c49;-webkit-font-smoothing:antialiased}code[class*=language-],pre[class*=language-]{color:#fff;background:0 0;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;font-feature-settings:normal;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;margin-bottom:0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{overflow:auto;padding:1.3125rem}pre[class*=language-]::-moz-selection{background:#27292a}pre[class*=language-]::selection{background:#27292a}pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:hsla(0,0%,100%,.15)}pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:hsla(0,0%,100%,.15)}:not(pre)>code[class*=language-]{border-radius:.3em;background:var(--inline-code-bg);color:var(--inline-code-fg);padding:.15em .2em .05em;white-space:normal}.token.attr-name{color:#addb67;font-style:italic}.token.comment{color:#809393}.token.string,.token.url{color:#addb67}.token.variable{color:#d6deeb}.token.number{color:#f78c6c}.token.builtin,.token.char,.token.constant,.token.function{color:#82aaff}.token.punctuation{color:#c792ea}.token.doctype,.token.selector{color:#c792ea;font-style:italic}.token.class-name{color:#ffcb8b}.token.keyword,.token.operator,.token.tag{color:#ffa7c4}.token.boolean{color:#ff5874}.token.property{color:#80cbc4}.token.namespace{color:#b2ccd6}pre[data-line]{padding:1em 0 1em 3em;position:relative}.gatsby-highlight-code-line{background-color:#022a4b;display:block;padding-right:1em;padding-left:1.25em;border-left:.25em solid #ffa7c4}.gatsby-highlight,.gatsby-highlight-code-line{margin-right:-1.3125rem;margin-left:-1.3125rem}.gatsby-highlight{margin-bottom:1.75rem;border-radius:10px;background:#011627;-webkit-overflow-scrolling:touch;overflow:auto}@media (max-width:672px){.gatsby-highlight{border-radius:0}}.gatsby-highlight pre[class*=language-]{float:left;min-width:100%}.line-highlight{border-left:4px solid #ffa7c4}.line-highlight:after,.line-highlight:before{display:none}.cs-loading[data-v-0dfe3184]{position:fixed;top:0;left:0;z-index:100;width:100%;height:100%;background-color:var(--bg);will-change:opacity;transition:opacity .5s .4s}.cs-loading.loaded[data-v-0dfe3184]{opacity:0}.cs-loading .main[data-v-0dfe3184]{position:absolute;top:calc(50% - 63px);left:calc(50% - 63px);z-index:1;width:126px;height:126px}.cs-loading .main.out-of-window .line1-2[data-v-0dfe3184],.cs-loading .main.out-of-window .line1[data-v-0dfe3184],.cs-loading .main.out-of-window .line3-2[data-v-0dfe3184],.cs-loading .main.out-of-window .line3[data-v-0dfe3184],.cs-loading .main.out-of-window .line5[data-v-0dfe3184],.cs-loading .main.out-of-window .line7[data-v-0dfe3184],.cs-loading .main.out-of-window .line9[data-v-0dfe3184]{transform:rotate(45deg) translateY(100vh)}.cs-loading .main.out-of-window .line10[data-v-0dfe3184],.cs-loading .main.out-of-window .line2-2[data-v-0dfe3184],.cs-loading .main.out-of-window .line2[data-v-0dfe3184],.cs-loading .main.out-of-window .line4-2[data-v-0dfe3184],.cs-loading .main.out-of-window .line4-3[data-v-0dfe3184],.cs-loading .main.out-of-window .line4[data-v-0dfe3184],.cs-loading .main.out-of-window .line6[data-v-0dfe3184],.cs-loading .main.out-of-window .line8-1[data-v-0dfe3184],.cs-loading .main.out-of-window .line8[data-v-0dfe3184]{transform:rotate(45deg) translateY(-100vh)}.cs-loading .main.out-of-window .text[data-v-0dfe3184]{opacity:0;transition:opacity .5s}.cs-loading .main .line[data-v-0dfe3184]{position:absolute;z-index:3;width:7px;background:var(--text-normal);will-change:transform;transform:rotate(45deg)}.cs-loading .main .line.line1[data-v-0dfe3184]{top:51px;left:5px;height:17px;transition:transform .5s}.cs-loading .main .line.line1-2[data-v-0dfe3184]{top:-3px;left:50px;height:36px;transition:transform .5s}.cs-loading .main .line.line2[data-v-0dfe3184]{top:55px;left:9px;height:27px;transition:transform .5s}.cs-loading .main .line.line2-2[data-v-0dfe3184]{top:-5px;left:56px;height:53px;transition:transform .5s}.cs-loading .main .line.line3[data-v-0dfe3184]{top:58px;left:15px;height:35px;transition:transform .5s .1s}.cs-loading .main .line.line3-2[data-v-0dfe3184]{top:-2px;left:63px;height:59px;transition:transform .5s .1s}.cs-loading .main .line.line4[data-v-0dfe3184]{top:55px;left:24px;height:48px;transition:transform .5s .1s}.cs-loading .main .line.line4-2[data-v-0dfe3184]{top:27px;left:60px;height:33px;transition:transform .5s .1s}.cs-loading .main .line.line4-3[data-v-0dfe3184]{top:9px;left:84px;height:21px;transition:transform .5s .1s}.cs-loading .main .line.line5[data-v-0dfe3184]{top:4px;left:54px;height:117px;transition:transform .5s .2s}.cs-loading .main .line.line6[data-v-0dfe3184]{top:15px;left:59px;height:111px;transition:transform .5s .2s}.cs-loading .main .line.line7[data-v-0dfe3184]{top:16px;left:69px;height:115px;transition:transform .5s .3s}.cs-loading .main .line.line8[data-v-0dfe3184]{top:56px;left:63px;height:72px;transition:transform .5s .3s}.cs-loading .main .line.line8-1[data-v-0dfe3184]{top:30px;left:116px;height:18px;transition:transform .5s .3s}.cs-loading .main .line.line9[data-v-0dfe3184]{top:67px;left:70px;height:61px;transition:transform .5s .4s}.cs-loading .main .line.line10[data-v-0dfe3184]{top:82px;left:78px;height:40px;transition:transform .5s .4s}.cs-loading .main .text[data-v-0dfe3184]{position:absolute;bottom:-18%;left:0;width:100%;font-size:18px;font-weight:700;color:var(--text-normal);text-align:center;will-change:opacity;transition:opacity .5s .5s}.cs-header[data-v-e2fcdc26]{padding-top:64px}.cs-header__logo[data-v-e2fcdc26]{position:relative;left:4px;display:block;margin:0 auto;width:128px;height:128px;color:var(--logo);transition:color .5s;cursor:pointer}.cs-header__logo[data-v-e2fcdc26]:hover{color:#ffe957}.cs-header__text[data-v-e2fcdc26]{margin:16px 0;padding:0 32px;font-weight:700;line-height:1.4;text-align:center;color:var(--text-normal)}.cs-header__text--light[data-v-e2fcdc26]{color:var(--site-desc);font-weight:500}.cs-nav[data-v-3775b65b]{padding:32px;font-size:0;text-align:center}.cs-nav__item[data-v-3775b65b]{display:inline-block;padding:0 8px;color:var(--site-nav);cursor:pointer}.cs-nav__item>a[data-v-3775b65b]{font-size:16px;font-weight:700;line-height:1.4}.post{background-color:transparent}.post hr{margin:64px 0;border:0;border-bottom:1px solid var(--hr)}.post .cs-post-article a{padding:0 4px;text-decoration:underline}.post .cs-post-article h2{margin:24px 0;font-size:20px;font-weight:700}.post .cs-post-article h3{margin:24px 0;font-size:18px;font-weight:700}.post .cs-post-article li,.post .cs-post-article p{margin:24px 0;font-size:16px;line-height:28px;color:var(--text-normal)}.post .cs-post-article code:not([class*=language-]){padding:0 4px;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;color:var(--inline-code-fg);background-color:var(--inline-code-bg);border-radius:3px}.post .cs-post-article strong em{margin:0 6px;font-weight:700}.post .cs-post-article hr{margin:30px 0;border:0;border-bottom:1px solid var(--hr)}.post .cs-post-article em{margin:0 6px}.post .cs-post-article pre{background-color:#011627;border-radius:10px}.post .cs-post-article ul li{font-size:16px;line-height:28px;list-style:disc}.post .cs-post-article ol li{list-style:decimal}.post .cs-post-article img{width:100%;height:auto}.post__wrapper{overflow:hidden}.post__wrapper>a{margin:20px 0}.cs-statement[data-v-6cb3297c]{text-align:center}.cs-statement hr[data-v-6cb3297c]{margin:64px 0;border:0;border-bottom:1px solid var(--hr)}.cs-statement__text[data-v-6cb3297c]{margin:8px 0;line-height:1.7;color:var(--text-normal)}.cs-statement__reward-code[data-v-6cb3297c]{margin-top:50px;max-width:30%;height:auto}@media (max-width:375px){.cs-statement .cs-statement__reward-code[data-v-6cb3297c]{max-width:76%!important}}.cs-footer[data-v-04c3be52]{position:relative;margin-top:40px;padding:40px 40px 20px;color:#9aa0ac;text-align:center}.cs-footer[data-v-04c3be52]:after{content:"";position:absolute;top:0;left:0;right:0;bottom:0;z-index:-2;background-color:var(--footer-bg)}.cs-footer__logo[data-v-04c3be52]{display:block;margin:18px auto;width:28px;height:28px;color:var(--logo)}.cs-footer__text>a[data-v-04c3be52],.cs-footer__text[data-v-04c3be52]{font-weight:600}.cs-footer__text[data-v-04c3be52]{margin:18px 0}.cs-footer__slogan[data-v-04c3be52]{display:inline-block;vertical-align:middle;font-size:14px}.cs-color-slogan[data-v-1740ad80]{display:inline-block;position:relative;font-family:serif;color:var(--text-normal);background-color:transparent}.cs-color-slogan__placeholder[data-v-1740ad80]{opacity:0}.cs-color-slogan__wrapper[data-v-1740ad80]{position:absolute;top:0;white-space:nowrap}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><header class="cs-header" data-v-e2fcdc26><svg xmlns="http://www.w3.org/2000/svg" class="cs-header__logo" data-v-e2fcdc26><use href="/lkangd.com/_nuxt/262e991fa0c906f1d05d77a4571a395b.svg#i-logo" xlink:href="/lkangd.com/_nuxt/262e991fa0c906f1d05d77a4571a395b.svg#i-logo"></use></svg> <p class="cs-header__text" data-v-e2fcdc26>Curtis Liong</p> <p class="cs-header__text cs-header__text--light" data-v-e2fcdc26><a href="https://en.wikipedia.org/wiki/Front-end_web_development" target="_blank" class="cs-outside-link" data-v-e2fcdc26>Front-end</a> Engineer. Blogging about life, tech & everything I love.
  </p></header> <nav class="cs-nav" data-v-3775b65b><div class="cs-nav__item" data-v-3775b65b><a href="/lkangd.com/" class="cs-nav-link nuxt-link-active" data-v-3775b65b>Home</a></div><div class="cs-nav__item" data-v-3775b65b><a href="/lkangd.com/tech/" class="cs-nav-link" data-v-3775b65b>Tech</a></div><div class="cs-nav__item" data-v-3775b65b><a href="/lkangd.com/think/" class="cs-nav-link" data-v-3775b65b>Think</a></div><div class="cs-nav__item" data-v-3775b65b><a href="/lkangd.com/fun/" class="cs-nav-link" data-v-3775b65b>Fun</a></div><div class="cs-nav__item" data-v-3775b65b><a href="/lkangd.com/about/" class="cs-nav-link" data-v-3775b65b>About</a></div><div class="cs-nav__item" data-v-3775b65b><a href="/lkangd.com/donate/" class="cs-nav-link" data-v-3775b65b>Donate</a></div> <div class="cs-nav__item" data-v-3775b65b><a href="/feed.xml" target="_blank" class="cs-nav-link" data-v-3775b65b>RSS</a></div> <div class="cs-nav__item" data-v-3775b65b><a href="/sitemap.xml" target="_blank" class="cs-nav-link" data-v-3775b65b>Sitemap</a></div></nav> <section class="post cs-container-big"><h2 class="cs-title-big">Why Do React Elements Have a $$typeof Property?</h2> <p class="cs-date">03, Dec, 2018•1k words•☕️ 6 min read</p> <article class="cs-post-article"><p>You might think you’re writing JSX:</p>
<pre class="language-jsx"><code class="language-jsx">&lt;marquee bgcolor="#ffa7c4">hi&lt;/marquee>
</code></pre><p>But really, you’re calling a function:</p>
<pre class="language-jsx"><code class="language-jsx">React.createElement(
  /* type */ 'marquee',
  /* props */ { bgcolor: '#ffa7c4' },
  /* children */ 'hi'
)
</code></pre><p>And that function gives you back an object. We call this object a React <em>element</em>. It tells React what to render next. Your components return a tree of them.</p>
<pre data-line="9," 9="" class="language-jsx"><code 9="" class="language-jsx">{
  type: 'marquee',
  props: {
    bgcolor: '#ffa7c4',
    children: 'hi',
  },
  key: null,
  ref: null,
  $$typeof: Symbol.for('react.element'), // 🧐 Who dis
}
</code></pre><p>If you used React you might be familiar with <code>type</code>, <code>props</code>, <code>key</code>, and <code>ref</code> fields. <strong>But what is <code>$$typeof</code>? And why does it have a <code>Symbol()</code> as a value?</strong></p>
<p>That’s another one of those things that you don’t <em>need</em> to know to use React, but that will make you feel good when you do. There’s also some tips about security in this post that you might want to know. Maybe one day you’ll write your own UI library and all of this will come in handy. I certainly hope so.</p>
<hr>
<p>Before client-side UI libraries became common and added basic protection, it was common for app code to construct HTML and insert it into the DOM:</p>
<pre class="language-jsx"><code class="language-jsx">const messageEl = document.getElementById('message');
messageEl.innerHTML = '&lt;p>' + message.text + '&lt;/p>';
</code></pre><p>That works fine, except when your <code>message.text</code> is something like <code>'&lt;img src onerror="stealYourPassword()">'</code>. <strong>You don’t want things written by strangers to appear verbatim in your app’s rendered HTML.</strong></p>
<p>(Fun fact: if you only do client-side rendering, a <code>&lt;script></code> tag here wouldn’t let you run JavaScript. But <a href="https://gomakethings.com/preventing-cross-site-scripting-attacks-when-using-innerhtml-in-vanilla-javascript/">don’t let this</a> lull you into a false sense of security.)</p>
<p>To protect against such attacks, you can use safe APIs like <code>document.createTextNode()</code> or <code>textContent</code> that only deal with text. You can also preemptively “escape” inputs by replacing potentially dangerous characters like <code>&lt;</code>, <code>></code> and others in any user-provided text.</p>
<p>Still, the cost of a mistake is high and it’s a hassle to remember it every time you interpolate a user-written string into your output. <strong>This is why modern libraries like React escape text content for strings by default:</strong></p>
<pre class="language-jsx"><code class="language-jsx">&lt;p>
  {message.text}
&lt;/p>
</code></pre><p>If <code>message.text</code> is a malicious string with an <code>&lt;img></code> or another tag, it won’t turn into a real <code>&lt;img></code> tag. React will escape the content and <em>then</em> insert it into the DOM. So instead of seeing the <code>&lt;img></code> tag you’ll just see its markup.</p>
<p>To render arbitrary HTML inside a React element, you have to write <code>dangerouslySetInnerHTML={{ __html: message.text }}</code>. <strong>The fact that it’s clumsy to write is a <em>feature</em>.</strong> It’s meant to be highly visible so that you can catch it in code reviews and codebase audits.</p>
<hr>
<p><strong>Does it mean React is entirely safe from injection attacks? No.</strong> HTML and DOM offer <a href="https://github.com/facebook/react/issues/3473#issuecomment-90594748">plenty of attack surface</a> that is too difficult or slow for React or other UI libraries to mitigate against. Most of the remaining attack vectors involve attributes. For example, if you render <code>&lt;a href={user.website}></code>, beware of the user whose website is <code>'javascript: stealYourPassword()'</code>. Spreading user input like <code>&lt;div {...userData}></code> is rare but also dangerous.</p>
<p>React <a href="https://github.com/facebook/react/issues/10506">could</a> provide more protection over time but in many cases these are consequences of server issues that <a href="https://github.com/facebook/react/issues/3473#issuecomment-91327040">should</a> be fixed there anyway.</p>
<p>Still, escaping text content is a reasonable first line of defence that catches a lot of potential attacks. Isn’t it nice to know that code like this is safe?</p>
<pre class="language-jsx"><code class="language-jsx">// Escaped automatically
&lt;p>
  {message.text}
&lt;/p>
</code></pre><p><strong>Well, that wasn’t always true either.</strong> And that’s where <code>$$typeof</code> comes in.</p>
<hr>
<p>React elements are plain objects by design:</p>
<pre class="language-jsx"><code class="language-jsx">{
  type: 'marquee',
  props: {
    bgcolor: '#ffa7c4',
    children: 'hi',
  },
  key: null,
  ref: null,
  $$typeof: Symbol.for('react.element'),
}
</code></pre><p>While normally you create them with <code>React.createElement()</code>, it is not required. There are valid use cases for React to support plain element objects written like I just did above. Of course, you probably wouldn’t <em>want</em> to write them like this — but this <a href="https://github.com/facebook/react/pull/3583#issuecomment-90296667">can be</a> useful for an optimizing compiler, passing UI elements between workers, or for decoupling JSX from the React package.</p>
<p>However, <strong>if your server has a hole that lets the user store an arbitrary JSON object</strong> while the client code expects a string, this could become a problem:</p>
<pre data-line="2-10,15," 2-10,15="" class="language-jsx"><code 2-10,15="" class="language-jsx">// Server could have a hole that lets user store JSON
let expectedTextButGotJSON = {
  type: 'div',
  props: {
    dangerouslySetInnerHTML: {
      __html: '/* put your exploit here */'
    },
  },
  // ...
};
let message = { text: expectedTextButGotJSON };

// Dangerous in React 0.13
&lt;p>
  {message.text}
&lt;/p>
</code></pre><p>In that case, React 0.13 would be <a href="http://danlec.com/blog/xss-via-a-spoofed-react-element">vulnerable</a> to an XSS attack. To clarify, again, <strong>this attack depends on an existing server hole</strong>. Still, React could do a better job of protecting people against it. And starting with React 0.14, it does.</p>
<p>The fix in React 0.14 was to <a href="https://github.com/facebook/react/pull/4832">tag every React element with a Symbol</a>:</p>
<pre data-line="9," 9="" class="language-jsx"><code 9="" class="language-jsx">{
  type: 'marquee',
  props: {
    bgcolor: '#ffa7c4',
    children: 'hi',
  },
  key: null,
  ref: null,
  $$typeof: Symbol.for('react.element'),
}
</code></pre><p>This works because you can’t just put <code>Symbol</code>s in JSON. <strong>So even if the server has a security hole and returns JSON instead of text, that JSON can’t include <code>Symbol.for('react.element')</code>.</strong> React will check <code>element.$$typeof</code>, and will refuse to process the element if it’s missing or invalid.</p>
<p>The nice thing about using <code>Symbol.for()</code> specifically is that <strong>Symbols are global between environments like iframes and workers.</strong> So this fix doesn’t prevent passing trusted elements between different parts of the app even in more exotic conditions. Similarly, even if there are multiple copies of React on the page, they can still “agree” on the valid <code>$$typeof</code> value.</p>
<hr>
<p>What about the browsers that <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol#Browser_compatibility">don’t support</a> Symbols?</p>
<p>Alas, they don’t get this extra protection. React still includes the <code>$$typeof</code> field on the element for consistency, but it’s <a href="https://github.com/facebook/react/blob/8482cbe22d1a421b73db602e1f470c632b09f693/packages/shared/ReactSymbols.js#L14-L16">set to a number</a> — <code>0xeac7</code>.</p>
<p>Why this number specifically? <code>0xeac7</code> kinda looks like “React”.</p>
</article> <hr> <div class="post__wrapper"><a href="/lkangd.com/post/why-do-we-write-super-props-zh" class="cs-outside-link fr">为什么我们要写 super(props) ？ →</a> <a href="/lkangd.com/post/why-do-react-elements-have-typeof-property-zh" class="cs-outside-link fl">← 为什么React元素有一个$$typeof属性？</a></div> <section class="cs-statement" data-v-6cb3297c><hr data-v-6cb3297c> <p class="cs-statement__text" data-v-6cb3297c>
    讨论请发邮件到
    <a href="mailto:lkangd@gmail.com" target="_blank" class="cs-outside-link" data-v-6cb3297c>lkangd@gmail.com</a></p> <p class="cs-statement__text" data-v-6cb3297c>未经授权，禁止转载</p> <p class="cs-statement__text" data-v-6cb3297c>通过支付宝 lkangd@foxmail.com 或赞赏码赞助此文</p> <img alt="reward-code" src="/lkangd.com/_nuxt/img/3b0f29f.jpg" class="cs-statement__reward-code" data-v-6cb3297c></section></section> <footer class="cs-footer" data-v-04c3be52><div class="cs-color-slogan cs-footer__slogan" data-v-1740ad80 data-v-04c3be52><span data-v-1740ad80>Work With </span> <span class="cs-color-slogan__placeholder" data-v-1740ad80></span> <span class="cs-color-slogan__wrapper" data-v-1740ad80>
     
    <span data-v-1740ad80></span></span></div> <svg xmlns="http://www.w3.org/2000/svg" class="cs-footer__logo" data-v-04c3be52><use href="/lkangd.com/_nuxt/262e991fa0c906f1d05d77a4571a395b.svg#i-logo" xlink:href="/lkangd.com/_nuxt/262e991fa0c906f1d05d77a4571a395b.svg#i-logo"></use></svg> <p class="cs-footer__text" data-v-04c3be52>
    2017-2019 
    <a href="/" target="_blank" class="cs-outside-link" data-v-04c3be52>Curtis' Spot</a></p></footer></div></div></div><script defer src="/lkangd.com/post/why-do-react-elements-have-typeof-property/payload1568183296278.js"></script><script src="/lkangd.com/_nuxt/65dc7a5cd1c1cd57e7eb.js" defer></script><script src="/lkangd.com/_nuxt/7e77b8e6cd7011676488.js" defer></script><script src="/lkangd.com/_nuxt/48f65a593c854d50b992.js" defer></script><script src="/lkangd.com/_nuxt/2bc7cee40a450e203637.js" defer></script><script src="/lkangd.com/_nuxt/ef6c14c0800794aa78c2.js" defer></script><script data-n-head="ssr" type="text/javascript" data-body="true">!function(){function t(e){r=e,document.body.className=e}var r,a={light:"light",dark:"dark"};try{r=localStorage.getItem("theme")}catch(e){}window.__setPreferredTheme=function(e){t(e);try{localStorage.setItem("theme",e)}catch(e){}};var e=window.matchMedia("(prefers-color-scheme: dark)");e.addListener(function(e){window.__setPreferredTheme(a[r]||(e.matches?"dark":"light"))}),t(a[r]||(e.matches?"dark":"light"))}()</script>
  </body>
</html>
